# Admin panel product management module
_Exported on 04/01/2026 at 19:38:45 GMT+5:30 from Cursor (2.2.36)_

---

**User**

Create Product Management module after Item management section  in Admin Panel (Web View) to manage all product-related APIs and data.
Follow existing admin theme, sidebar structure, controllers, routes, permissions, and Blade folder structure.
Do NOT modify existing API response formats or business logic.

‚ö†Ô∏è STRICT RULES

‚ùå Do NOT change /api/products, /api/products/{id}, /api/categories, /api/dashboard, /api/express-30/* logic

‚ùå Do NOT refactor existing APIs

‚ùå Do NOT change database schema unless required for admin flags

‚úÖ Admin panel should only INSERT / UPDATE / MANAGE data used by APIs

‚úÖ Follow existing admin UI patterns

üß≠ SIDEBAR MENU STRUCTURE

Add Product Management menu with submenus:

<li class="navbar-vertical-aside-has-menu {{ Request::is('admin/product*') ? 'active' : '' }}">
    <a class="js-navbar-vertical-aside-menu-link nav-link" href="javascript:void(0)">
        <i class="tio-shop nav-icon"></i>
        <span class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">
            {{ translate('messages.product_management') }}
        </span>
    </a>

    <ul class="js-navbar-vertical-aside-submenu nav nav-sub">
        <li class="nav-item">
            <a class="nav-link {{ Request::is('admin/categories*') ? 'active' : '' }}"
               href="{{ route('admin.categories.index') }}">
                {{ translate('messages.categories') }}
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link {{ Request::is('admin/products*') ? 'active' : '' }}"
               href="{{ route('admin.products.index') }}">
                {{ translate('messages.products') }}
            </a>
        </li>
    </ul>
</li>

üì¶ MODULES TO CREATE
1Ô∏è‚É£ CATEGORY MANAGEMENT (Admin)

Manages data for:

GET /api/categories

Admin Features:

Create / Edit / Delete Category

Category Name

Category Image (used in dashboard API)

Active / Inactive

Sort Order

Files:
Controller: App\Http\Controllers\Admin\CategoryController
Views: resources/views/admin/categories/
Routes: admin.categories.*

2Ô∏è‚É£ PRODUCT MANAGEMENT (Admin)

Manages data for:

GET /api/products
GET /api/products/{product_id}

Admin Features:

Product CRUD

Assign Category

Product Name, Description

Images (multiple)

Price, MRP, Discount

Stock (via fulfillment center mapping)

Status (active/inactive)

Files:
Controller: App\Http\Controllers\Admin\ProductController
Views: resources/views/admin/products/
Routes: admin.products.*

üß© PRODUCT FLAGS (ADMIN CONTROLLABLE)

Add checkboxes / toggles in Product Create & Edit Form:

is_trending       ‚Üí controls api/dashboard trending_products
is_latest         ‚Üí controls api/dashboard latest_products
is_express_30     ‚Üí controls /api/express-30/products


These fields already exist or are used by APIs ‚Äì admin panel must only manage values.

üöÄ DASHBOARD INTEGRATION (ADMIN)

Admin panel must allow:

Mark / unmark product as:

Trending

Latest

These flags directly affect:

/api/dashboard


No separate dashboard API changes allowed.

‚ö° EXPRESS 30 MANAGEMENT

Admin panel must:

Enable / disable product for 30-minute delivery

Show label/badge in product list

Only toggle is_express_30 flag

No delivery logic change

Related API:

/api/express-30/products

üñ•Ô∏è ADMIN PRODUCT LIST PAGE

Columns:

Image

Product Name

Category

Price

Trending (toggle)

Latest (toggle)

Express-30 (toggle)

Status

Actions (Edit / Delete)

Use:

Existing table UI

Toggle switch UI

Pagination & search

üìù PRODUCT CREATE / EDIT FORM

Sections:

Basic Info

Category Selection

Pricing

Images (upload + preview)

Flags:

Trending

Latest

Express-30

Status

Validation:

Required fields only

Follow existing validation pattern

üåç MULTI-LANGUAGE SUPPORT

Add translation keys:

messages.product_management
messages.products
messages.add_product
messages.edit_product
messages.trending
messages.latest
messages.express_30
messages.product_saved

üîê PERMISSIONS

Use existing admin permission middleware

Match access control style used in other modules

---

**Cursor**


Exploring the codebase to understand the admin structure, patterns, and existing implementations.



Reviewing existing admin views and controllers to understand the patterns:



Checking existing admin views and locating the Item management section:



Reviewing the sidebar structure and existing views:



Checking the Dashboard API for how is_latest and is_trending are used:



Creating the initial todo list and starting implementation:



Creating the migration for `is_latest`, then building the controllers and views:



Updating the migration, then creating the controllers and views:



Finding and updating the migration file:



Reading and updating the migration, then creating the controllers and views:



Updating the migration and Product model, then creating the controllers and views:


```php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::table('products', function (Blueprint $table) {
            if (!Schema::hasColumn('products', 'is_latest')) {
                $table->boolean('is_latest')->default(false)->after('is_trending');
                $table->index('is_latest');
            }
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::table('products', function (Blueprint $table) {
            if (Schema::hasColumn('products', 'is_latest')) {
                $table->dropIndex(['is_latest']);
                $table->dropColumn('is_latest');
            }
        });
    }
};

```

```php
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Product extends Model
{
    use HasFactory;

    protected $fillable = [
        'category_id',
        'brand_id',
        'name',
        'slug',
        'description',
        'short_description',
        'status',
        'is_trending',
        'is_latest',
        'is_express_30',
    ];

    protected function casts(): array
    {
        return [
            'is_trending' => 'boolean',
            'is_latest' => 'boolean',
            'is_express_30' => 'boolean',
        ];
    }

    public function category()
    {
        return $this->belongsTo(Category::class);
    }

    public function brand()
    {
        return $this->belongsTo(Brand::class);
    }

    public function variants()
    {
        return $this->hasMany(ProductVariant::class);
    }

    public function images()
    {
        return $this->hasMany(ProductImage::class);
    }

    public function reviews()
    {
        return $this->hasMany(ProductReview::class);
    }

    public function questions()
    {
        return $this->hasMany(ProductQuestion::class);
    }
}

```


Creating CategoryController and ProductController:


```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Category;
use Illuminate\Http\Request;
use App\CentralLogics\ToastrWrapper as Toastr;
use App\CentralLogics\Helpers;
use Illuminate\Support\Str;

class CategoryController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index(Request $request)
    {
        $query = Category::query();
        
        // Search
        if ($request->has('search')) {
            $search = $request->search;
            $query->where(function ($q) use ($search) {
                $q->where('name', 'like', "%{$search}%")
                    ->orWhere('slug', 'like', "%{$search}%");
            });
        }
        
        // Filter by status
        if ($request->has('status') && $request->status !== '') {
            $query->where('status', $request->status);
        }
        
        // Filter by parent
        if ($request->has('parent_id')) {
            if ($request->parent_id === 'null') {
                $query->whereNull('parent_id');
            } else {
                $query->where('parent_id', $request->parent_id);
            }
        }
        
        $categories = $query->with('parent')->orderBy('name', 'asc')->paginate(25);
        $parentCategories = Category::whereNull('parent_id')->where('status', 'active')->orderBy('name', 'asc')->get();
        
        return view('admin-views.categories.index', compact('categories', 'parentCategories'));
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        $parentCategories = Category::whereNull('parent_id')->where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.categories.create', compact('parentCategories'));
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'parent_id' => 'nullable|exists:categories,id',
                'image' => 'nullable|image|mimes:jpeg,jpg,png,gif,webp|max:2048',
                'icon' => 'nullable|image|mimes:jpeg,jpg,png,gif,webp|max:2048',
                'status' => 'required|in:active,inactive',
            ], [
                'name.required' => translate('messages.Category name is required!'),
                'parent_id.exists' => translate('messages.Parent category not found!'),
                'image.image' => translate('messages.Please upload image files only!'),
                'image.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'image.max' => translate('messages.Image size should be less than 2MB!'),
                'icon.image' => translate('messages.Please upload image files only!'),
                'icon.mimes' => translate('messages.Icon must be jpeg, jpg, png, gif, or webp!'),
                'icon.max' => translate('messages.Icon size should be less than 2MB!'),
                'status.required' => translate('messages.Status is required!'),
                'status.in' => translate('messages.Invalid status!'),
            ]);

            $category = new Category();
            $category->name = $request->name;
            $category->slug = Str::slug($request->name);
            $category->parent_id = $request->parent_id ?? null;
            $category->status = $request->status;

            // Handle image upload
            if ($request->hasFile('image')) {
                $image = $request->file('image');
                if ($image && $image->isValid()) {
                    try {
                        $extension = $image->getClientOriginalExtension();
                        $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                        $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                        
                        $imageName = Helpers::upload('category/', $format, $image);
                        
                        if ($imageName && $imageName !== 'def.png') {
                            $category->image_url = $imageName;
                        }
                    } catch (\Exception $e) {
                        \Log::error('Category image upload error: ' . $e->getMessage());
                        Toastr::error(translate('messages.failed_to_upload_image') . ': ' . $e->getMessage());
                        return back()->withInput();
                    }
                }
            }

            // Handle icon upload
            if ($request->hasFile('icon')) {
                $icon = $request->file('icon');
                if ($icon && $icon->isValid()) {
                    try {
                        $extension = $icon->getClientOriginalExtension();
                        $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                        $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                        
                        $iconName = Helpers::upload('category/', $format, $icon);
                        
                        if ($iconName && $iconName !== 'def.png') {
                            $category->icon_url = $iconName;
                        }
                    } catch (\Exception $e) {
                        \Log::error('Category icon upload error: ' . $e->getMessage());
                        Toastr::error(translate('messages.failed_to_upload_image') . ': ' . $e->getMessage());
                        return back()->withInput();
                    }
                }
            }

            $category->save();

            Toastr::success(translate('messages.category_added'));
            return redirect()->route('admin.categories.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_add_category') . ': ' . $e->getMessage());
            \Log::error('Category creation error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit($id)
    {
        $category = Category::findOrFail($id);
        $parentCategories = Category::whereNull('parent_id')
            ->where('status', 'active')
            ->where('id', '!=', $id)
            ->orderBy('name', 'asc')
            ->get();
        return view('admin-views.categories.edit', compact('category', 'parentCategories'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, $id)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'parent_id' => 'nullable|exists:categories,id|not_in:' . $id,
                'image' => 'nullable|image|mimes:jpeg,jpg,png,gif,webp|max:2048',
                'icon' => 'nullable|image|mimes:jpeg,jpg,png,gif,webp|max:2048',
                'status' => 'required|in:active,inactive',
            ], [
                'name.required' => translate('messages.Category name is required!'),
                'parent_id.exists' => translate('messages.Parent category not found!'),
                'parent_id.not_in' => translate('messages.Category cannot be its own parent!'),
                'image.image' => translate('messages.Please upload image files only!'),
                'image.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'image.max' => translate('messages.Image size should be less than 2MB!'),
                'icon.image' => translate('messages.Please upload image files only!'),
                'icon.mimes' => translate('messages.Icon must be jpeg, jpg, png, gif, or webp!'),
                'icon.max' => translate('messages.Icon size should be less than 2MB!'),
                'status.required' => translate('messages.Status is required!'),
                'status.in' => translate('messages.Invalid status!'),
            ]);

            $category = Category::findOrFail($id);
            $category->name = $request->name;
            $category->slug = Str::slug($request->name);
            $category->parent_id = $request->parent_id ?? null;
            $category->status = $request->status;

            // Handle image upload
            if ($request->hasFile('image')) {
                $image = $request->file('image');
                if ($image && $image->isValid()) {
                    try {
                        $extension = $image->getClientOriginalExtension();
                        $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                        $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                        
                        $imageName = Helpers::upload('category/', $format, $image);
                        
                        if ($imageName && $imageName !== 'def.png') {
                            // Delete old image if exists
                            if ($category->image_url) {
                                try {
                                    $storageType = Helpers::getDisk();
                                    if ($storageType === 's3') {
                                        \Storage::disk('s3')->delete('category/' . $category->image_url);
                                    } else {
                                        \Storage::disk('public')->delete('category/' . $category->image_url);
                                    }
                                } catch (\Exception $e) {
                                    \Log::warning('Failed to delete old category image: ' . $e->getMessage());
                                }
                            }
                            $category->image_url = $imageName;
                        }
                    } catch (\Exception $e) {
                        \Log::error('Category image upload error: ' . $e->getMessage());
                        Toastr::error(translate('messages.failed_to_upload_image') . ': ' . $e->getMessage());
                        return back()->withInput();
                    }
                }
            }

            // Handle icon upload
            if ($request->hasFile('icon')) {
                $icon = $request->file('icon');
                if ($icon && $icon->isValid()) {
                    try {
                        $extension = $icon->getClientOriginalExtension();
                        $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                        $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                        
                        $iconName = Helpers::upload('category/', $format, $icon);
                        
                        if ($iconName && $iconName !== 'def.png') {
                            // Delete old icon if exists
                            if ($category->icon_url) {
                                try {
                                    $storageType = Helpers::getDisk();
                                    if ($storageType === 's3') {
                                        \Storage::disk('s3')->delete('category/' . $category->icon_url);
                                    } else {
                                        \Storage::disk('public')->delete('category/' . $category->icon_url);
                                    }
                                } catch (\Exception $e) {
                                    \Log::warning('Failed to delete old category icon: ' . $e->getMessage());
                                }
                            }
                            $category->icon_url = $iconName;
                        }
                    } catch (\Exception $e) {
                        \Log::error('Category icon upload error: ' . $e->getMessage());
                        Toastr::error(translate('messages.failed_to_upload_image') . ': ' . $e->getMessage());
                        return back()->withInput();
                    }
                }
            }

            $category->save();

            Toastr::success(translate('messages.category_updated'));
            return redirect()->route('admin.categories.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_category') . ': ' . $e->getMessage());
            \Log::error('Category update error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy($id)
    {
        try {
            $category = Category::findOrFail($id);
            
            // Check if category has products
            if ($category->products()->count() > 0) {
                Toastr::error(translate('messages.Cannot delete category with products!'));
                return back();
            }
            
            // Check if category has children
            if ($category->children()->count() > 0) {
                Toastr::error(translate('messages.Cannot delete category with subcategories!'));
                return back();
            }
            
            // Delete images
            if ($category->image_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('category/' . $category->image_url);
                    } else {
                        \Storage::disk('public')->delete('category/' . $category->image_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete category image: ' . $e->getMessage());
                }
            }
            
            if ($category->icon_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('category/' . $category->icon_url);
                    } else {
                        \Storage::disk('public')->delete('category/' . $category->icon_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete category icon: ' . $e->getMessage());
                }
            }
            
            $category->delete();
            
            Toastr::success(translate('messages.category_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_category') . ': ' . $e->getMessage());
            \Log::error('Category deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle category status
     */
    public function statusToggle(Request $request)
    {
        try {
            $category = Category::findOrFail($request->id);
            $category->status = $request->status;
            $category->save();
            Toastr::success(translate('messages.category_status_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_status') . ': ' . $e->getMessage());
            \Log::error('Category status update error: ' . $e->getMessage());
            return back();
        }
    }
}

```


Creating ProductController. Checking ProductImage and ProductVariant models first:



Creating ProductController:


```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Product;
use App\Models\Category;
use App\Models\Brand;
use App\Models\ProductVariant;
use App\Models\ProductImage;
use Illuminate\Http\Request;
use App\CentralLogics\ToastrWrapper as Toastr;
use App\CentralLogics\Helpers;
use Illuminate\Support\Str;

class ProductController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index(Request $request)
    {
        $query = Product::with(['category', 'brand', 'variants', 'images']);
        
        // Search
        if ($request->has('search')) {
            $search = $request->search;
            $query->where(function ($q) use ($search) {
                $q->where('name', 'like', "%{$search}%")
                    ->orWhere('description', 'like', "%{$search}%");
            });
        }
        
        // Filter by status
        if ($request->has('status') && $request->status !== '') {
            $query->where('status', $request->status);
        }
        
        // Filter by category
        if ($request->has('category_id') && $request->category_id !== '') {
            $query->where('category_id', $request->category_id);
        }
        
        // Filter by trending
        if ($request->has('is_trending') && $request->is_trending !== '') {
            $query->where('is_trending', $request->is_trending);
        }
        
        // Filter by latest
        if ($request->has('is_latest') && $request->is_latest !== '') {
            $query->where('is_latest', $request->is_latest);
        }
        
        // Filter by express_30
        if ($request->has('is_express_30') && $request->is_express_30 !== '') {
            $query->where('is_express_30', $request->is_express_30);
        }
        
        $products = $query->orderBy('created_at', 'desc')->paginate(25);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        
        return view('admin-views.products.index', compact('products', 'categories'));
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.create', compact('categories', 'brands'));
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Variant fields
                'variant_sku' => 'required|string|max:255',
                'variant_price' => 'required|numeric|min:0',
                'variant_sale_price' => 'nullable|numeric|min:0',
                'variant_status' => 'required|in:active,inactive',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:2048',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'variant_sku.required' => translate('messages.SKU is required!'),
                'variant_price.required' => translate('messages.Price is required!'),
                'variant_price.numeric' => translate('messages.Price must be a number!'),
                'variant_price.min' => translate('messages.Price must be greater than or equal to 0!'),
                'variant_sale_price.numeric' => translate('messages.Sale price must be a number!'),
                'variant_sale_price.min' => translate('messages.Sale price must be greater than or equal to 0!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 2MB!'),
            ]);

            // Check if SKU already exists
            if (ProductVariant::where('sku', $request->variant_sku)->exists()) {
                Toastr::error(translate('messages.SKU already exists!'));
                return back()->withInput();
            }

            // Create product
            $product = new Product();
            $product->name = $request->name;
            $product->slug = Str::slug($request->name) . '-' . uniqid();
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Create default variant
            $variant = new ProductVariant();
            $variant->product_id = $product->id;
            $variant->sku = $request->variant_sku;
            $variant->price = $request->variant_price;
            $variant->sale_price = $request->variant_sale_price ?? null;
            $variant->status = $request->variant_status;
            $variant->save();

            // Handle images
            if ($request->hasFile('images')) {
                $sortOrder = 0;
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant->id;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = ($sortOrder === 0) ? true : false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_added'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_add_product') . ': ' . $e->getMessage());
            \Log::error('Product creation error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit($id)
    {
        $product = Product::with(['category', 'brand', 'variants', 'images'])->findOrFail($id);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.edit', compact('product', 'categories', 'brands'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, $id)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:2048',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 2MB!'),
            ]);

            $product = Product::findOrFail($id);
            $product->name = $request->name;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Handle new images
            if ($request->hasFile('images')) {
                $existingImages = ProductImage::where('product_id', $product->id)->count();
                $sortOrder = $existingImages;
                
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $variant = $product->variants->first();
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant ? $variant->id : null;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_updated'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_product') . ': ' . $e->getMessage());
            \Log::error('Product update error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy($id)
    {
        try {
            $product = Product::findOrFail($id);
            
            // Delete product images
            foreach ($product->images as $image) {
                if ($image->image_url) {
                    try {
                        $storageType = Helpers::getDisk();
                        if ($storageType === 's3') {
                            \Storage::disk('s3')->delete('product/' . $image->image_url);
                        } else {
                            \Storage::disk('public')->delete('product/' . $image->image_url);
                        }
                    } catch (\Exception $e) {
                        \Log::warning('Failed to delete product image: ' . $e->getMessage());
                    }
                }
                $image->delete();
            }
            
            // Delete variants (this will cascade delete related data)
            $product->variants()->delete();
            
            $product->delete();
            
            Toastr::success(translate('messages.product_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_product') . ': ' . $e->getMessage());
            \Log::error('Product deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product status
     */
    public function statusToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $product->status = $request->status;
            $product->save();
            Toastr::success(translate('messages.product_status_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_status') . ': ' . $e->getMessage());
            \Log::error('Product status update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product flag (trending, latest, express_30)
     */
    public function flagToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $flag = $request->flag; // is_trending, is_latest, is_express_30
            
            if (!in_array($flag, ['is_trending', 'is_latest', 'is_express_30'])) {
                Toastr::error(translate('messages.Invalid flag!'));
                return back();
            }
            
            $product->$flag = $request->value;
            $product->save();
            
            Toastr::success(translate('messages.product_flag_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_flag') . ': ' . $e->getMessage());
            \Log::error('Product flag update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Delete product image
     */
    public function deleteImage($id)
    {
        try {
            $image = ProductImage::findOrFail($id);
            
            // Delete file
            if ($image->image_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('product/' . $image->image_url);
                    } else {
                        \Storage::disk('public')->delete('product/' . $image->image_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete product image file: ' . $e->getMessage());
                }
            }
            
            $image->delete();
            
            Toastr::success(translate('messages.image_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_image') . ': ' . $e->getMessage());
            \Log::error('Image deletion error: ' . $e->getMessage());
            return back();
        }
    }
}

```


Creating category views, starting with the index:


```blade
@extends('layouts.admin.app')

@section('title', translate('messages.categories'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .dataTables_wrapper .dataTables_length label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .dataTables_wrapper .dataTables_length select {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 80px;
    }
    
    .dataTables_wrapper .dataTables_filter {
        text-align: right;
    }
    
    .dataTables_wrapper .dataTables_filter label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: flex-end;
    }
    
    .dataTables_wrapper .dataTables_filter input {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 200px;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-category"></i>
                </span>
                <span>
                    {{ translate('messages.categories') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.categories') }} <span class="badge badge-soft-dark ml-2" id="category-count">{{ $categories->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.categories.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_category') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": true,
                             "pageLength": 25,
                             "lengthMenu": [[10, 25, 50, 100, -1], [10, 25, 50, 100, "All"]],
                             "searching": true,
                             "info": true,
                             "dom": "<\"row\"<\"col-sm-12 col-md-6\"l><\"col-sm-12 col-md-6\"f>>rtip"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Name</th>
                        <th class="border-0">Parent</th>
                        <th class="border-0">Slug</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @foreach($categories as $key => $category)
                        <tr>
                            <td>{{ $categories->firstItem() + $key }}</td>
                            <td>
                                @if($category->image_url)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('category', $category->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $category->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/100x100/2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->name }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->parent ? $category->parent->name : '-' }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->slug }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $category->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $category->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this category?"
                                           data-title-off="Want to deactivate this category?"
                                           id="status-{{ $category->id }}" {{ $category->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.categories.status') }}" method="post" id="status-{{ $category->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $category->id }}">
                                    <input type="hidden" name="status" value="{{ $category->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.categories.edit', $category->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="category-{{ $category->id }}" 
                                       data-form-id="category-{{ $category->id }}"
                                       data-message="Want to delete this category?" 
                                       data-title="Delete Category"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.categories.destroy', $category->id) }}"
                                            method="post" id="category-{{ $category->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @endforeach
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                <div class="mt-3">
                    {{ $categories->links() }}
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: true,
            info: true,
            order: [],
            orderCellsTop: true,
            dom: "<'row'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'f>>rt<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
                lengthMenu: "Show _MENU_ entries",
                search: "Search:",
                info: "Showing _START_ to _END_ of _TOTAL_ entries",
                infoEmpty: "Showing 0 to 0 of 0 entries",
                infoFiltered: "(filtered from _MAX_ total entries)",
            },
            initComplete: function() {
                if (typeof PageLoader !== 'undefined') {
                    setTimeout(function() {
                        PageLoader.hide();
                    }, 300);
                }
            }
        });
        
        table.on('draw', function () {
            var info = table.page.info();
            $('#category-count').text(info.recordsTotal);
        });
        
        setTimeout(function() {
            $('.dataTables_length').css({'display': 'block', 'visibility': 'visible'});
            $('.dataTables_filter').css({'display': 'block', 'visibility': 'visible'});
            $('.dataTables_info').css({'display': 'block', 'visibility': 'visible'});
        }, 200);
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        $(window).on('load', function() {
            setTimeout(function() {
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.hide();
                }
            }, 500);
        });
    });
</script>
@endpush

```


Creating the category create and edit views, then the product views. Continuing with the remaining views:


```blade
@extends('layouts.admin.app')

@section('title', translate('messages.add_category'))

@push('css_or_js')
<style>
    .card {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075), 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        border: 1px solid rgba(0, 0, 0, 0.125);
        border-radius: 0.5rem;
    }
    .card-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .card-footer {
        background-color: #f8f9fa;
        border-top: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .image-preview-container {
        margin-top: 15px;
        display: none;
    }
    .image-preview-container img {
        max-width: 100%;
        max-height: 300px;
        border-radius: 8px;
        border: 2px solid #e4e6ef;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-add-circle"></i>
                </span>
                <span>
                    {{ translate('messages.add_category') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">{{ translate('messages.add_category') }}</h5>
                    </div>
                    <form action="{{ route('admin.categories.store') }}" method="post" enctype="multipart/form-data">
                        @csrf
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="name">Category Name <span class="text-danger">*</span></label>
                                        <input type="text" name="name" id="name" class="form-control" placeholder="Enter category name" value="{{ old('name') }}" required maxlength="255">
                                        @error('name')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="parent_id">Parent Category</label>
                                        <select name="parent_id" id="parent_id" class="form-control">
                                            <option value="">None (Main Category)</option>
                                            @foreach($parentCategories as $parent)
                                                <option value="{{ $parent->id }}" {{ old('parent_id') == $parent->id ? 'selected' : '' }}>{{ $parent->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('parent_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="status">Status <span class="text-danger">*</span></label>
                                        <select name="status" id="status" class="form-control" required>
                                            <option value="active" {{ old('status', 'active') == 'active' ? 'selected' : '' }}>Active</option>
                                            <option value="inactive" {{ old('status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                        </select>
                                        @error('status')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="image">Category Image</label>
                                        <input type="file" name="image" id="image" class="form-control" accept="image/*" onchange="readURL(this, 'image-preview')">
                                        <small class="text-muted">Accepted formats: JPG, PNG, GIF, WEBP (Max: 2MB)</small>
                                        <div class="image-preview-container" id="image-preview-container">
                                            <img id="image-preview" src="" alt="Preview">
                                        </div>
                                        @error('image')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="icon">Category Icon</label>
                                        <input type="file" name="icon" id="icon" class="form-control" accept="image/*" onchange="readURL(this, 'icon-preview')">
                                        <small class="text-muted">Accepted formats: JPG, PNG, GIF, WEBP (Max: 2MB)</small>
                                        <div class="image-preview-container" id="icon-preview-container">
                                            <img id="icon-preview" src="" alt="Preview">
                                        </div>
                                        @error('icon')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="btn--container justify-content-end">
                                <a href="{{ route('admin.categories.index') }}" class="btn btn--reset">{{ translate('messages.cancel') }}</a>
                                <button type="submit" class="btn btn--primary">{{ translate('messages.submit') }}</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    function readURL(input, viewer) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function(e) {
                $('#' + viewer).attr('src', e.target.result);
                $('#' + viewer + '-container').show();
            }
            reader.readAsDataURL(input.files[0]);
        }
    }
</script>
@endpush

```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.edit_category'))

@push('css_or_js')
<style>
    .card {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075), 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        border: 1px solid rgba(0, 0, 0, 0.125);
        border-radius: 0.5rem;
    }
    .card-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .card-footer {
        background-color: #f8f9fa;
        border-top: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .image-preview-container {
        margin-top: 15px;
    }
    .image-preview-container img {
        max-width: 100%;
        max-height: 300px;
        border-radius: 8px;
        border: 2px solid #e4e6ef;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-edit"></i>
                </span>
                <span>
                    {{ translate('messages.edit_category') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">{{ translate('messages.edit_category') }}</h5>
                    </div>
                    <form action="{{ route('admin.categories.update', $category->id) }}" method="post" enctype="multipart/form-data">
                        @csrf
                        @method('PUT')
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="name">Category Name <span class="text-danger">*</span></label>
                                        <input type="text" name="name" id="name" class="form-control" placeholder="Enter category name" value="{{ old('name', $category->name) }}" required maxlength="255">
                                        @error('name')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="parent_id">Parent Category</label>
                                        <select name="parent_id" id="parent_id" class="form-control">
                                            <option value="">None (Main Category)</option>
                                            @foreach($parentCategories as $parent)
                                                <option value="{{ $parent->id }}" {{ old('parent_id', $category->parent_id) == $parent->id ? 'selected' : '' }}>{{ $parent->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('parent_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="status">Status <span class="text-danger">*</span></label>
                                        <select name="status" id="status" class="form-control" required>
                                            <option value="active" {{ old('status', $category->status) == 'active' ? 'selected' : '' }}>Active</option>
                                            <option value="inactive" {{ old('status', $category->status) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                        </select>
                                        @error('status')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="image">Category Image</label>
                                        <input type="file" name="image" id="image" class="form-control" accept="image/*" onchange="readURL(this, 'image-preview')">
                                        <small class="text-muted">Accepted formats: JPG, PNG, GIF, WEBP (Max: 2MB). Leave empty to keep current image.</small>
                                        <div class="image-preview-container" id="image-preview-container">
                                            @if($category->image_url)
                                                <img id="image-preview" src="{{ \App\CentralLogics\Helpers::get_full_url('category', $category->image_url, \App\CentralLogics\Helpers::getDisk()) }}" alt="Current Image">
                                            @else
                                                <img id="image-preview" src="" alt="Preview" style="display: none;">
                                            @endif
                                        </div>
                                        @error('image')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="icon">Category Icon</label>
                                        <input type="file" name="icon" id="icon" class="form-control" accept="image/*" onchange="readURL(this, 'icon-preview')">
                                        <small class="text-muted">Accepted formats: JPG, PNG, GIF, WEBP (Max: 2MB). Leave empty to keep current icon.</small>
                                        <div class="image-preview-container" id="icon-preview-container">
                                            @if($category->icon_url)
                                                <img id="icon-preview" src="{{ \App\CentralLogics\Helpers::get_full_url('category', $category->icon_url, \App\CentralLogics\Helpers::getDisk()) }}" alt="Current Icon">
                                            @else
                                                <img id="icon-preview" src="" alt="Preview" style="display: none;">
                                            @endif
                                        </div>
                                        @error('icon')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="btn--container justify-content-end">
                                <a href="{{ route('admin.categories.index') }}" class="btn btn--reset">{{ translate('messages.cancel') }}</a>
                                <button type="submit" class="btn btn--primary">{{ translate('messages.submit') }}</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    function readURL(input, viewer) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function(e) {
                $('#' + viewer).attr('src', e.target.result);
                $('#' + viewer + '-container').show();
                $('#' + viewer).show();
            }
            reader.readAsDataURL(input.files[0]);
        }
    }
</script>
@endpush

```


Creating the product views, starting with the index:


```blade
@extends('layouts.admin.app')

@section('title', translate('messages.products'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .badge-express {
        background-color: #f0ad4e;
        color: #fff;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-shop"></i>
                </span>
                <span>
                    {{ translate('messages.products') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.products') }} <span class="badge badge-soft-dark ml-2" id="product-count">{{ $products->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.products.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_product') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": true,
                             "pageLength": 25,
                             "lengthMenu": [[10, 25, 50, 100, -1], [10, 25, 50, 100, "All"]],
                             "searching": true,
                             "info": true,
                             "dom": "<\"row\"<\"col-sm-12 col-md-6\"l><\"col-sm-12 col-md-6\"f>>rtip"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Product Name</th>
                        <th class="border-0">Category</th>
                        <th class="border-0">Price</th>
                        <th class="border-0 text-center">Trending</th>
                        <th class="border-0 text-center">Latest</th>
                        <th class="border-0 text-center">Express-30</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @foreach($products as $key => $product)
                        <tr>
                            <td>{{ $products->firstItem() + $key }}</td>
                            <td>
                                @php
                                    $primaryImage = $product->images->where('is_primary', true)->first() ?? $product->images->first();
                                @endphp
                                @if($primaryImage)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $primaryImage->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $product->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/160x160/img2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ Str::limit($product->name, 30, '...') }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $product->category ? $product->category->name : '-' }}
                                </span>
                            </td>
                            <td>
                                @php
                                    $variant = $product->variants->first();
                                    $price = $variant ? ($variant->sale_price ?? $variant->price) : 0;
                                @endphp
                                <span class="d-block font-size-sm text-body">
                                    ‚Çπ{{ number_format($price, 2) }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="trending-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_trending"
                                           data-value="{{ $product->is_trending ? 0 : 1 }}"
                                           id="trending-{{ $product->id }}" {{ $product->is_trending ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="latest-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_latest"
                                           data-value="{{ $product->is_latest ? 0 : 1 }}"
                                           id="latest-{{ $product->id }}" {{ $product->is_latest ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="express-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_express_30"
                                           data-value="{{ $product->is_express_30 ? 0 : 1 }}"
                                           id="express-{{ $product->id }}" {{ $product->is_express_30 ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $product->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this product?"
                                           data-title-off="Want to deactivate this product?"
                                           id="status-{{ $product->id }}" {{ $product->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.products.status') }}" method="post" id="status-{{ $product->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $product->id }}">
                                    <input type="hidden" name="status" value="{{ $product->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.products.edit', $product->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="product-{{ $product->id }}" 
                                       data-form-id="product-{{ $product->id }}"
                                       data-message="Want to delete this product?" 
                                       data-title="Delete Product"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.products.destroy', $product->id) }}"
                                            method="post" id="product-{{ $product->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @endforeach
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                <div class="mt-3">
                    {{ $products->links() }}
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: true,
            info: true,
            order: [],
            orderCellsTop: true,
            dom: "<'row'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'f>>rt<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
                lengthMenu: "Show _MENU_ entries",
                search: "Search:",
                info: "Showing _START_ to _END_ of _TOTAL_ entries",
                infoEmpty: "Showing 0 to 0 of 0 entries",
                infoFiltered: "(filtered from _MAX_ total entries)",
            },
            initComplete: function() {
                if (typeof PageLoader !== 'undefined') {
                    setTimeout(function() {
                        PageLoader.hide();
                    }, 300);
                }
            }
        });
        
        table.on('draw', function () {
            var info = table.page.info();
            $('#product-count').text(info.recordsTotal);
        });
        
        setTimeout(function() {
            $('.dataTables_length').css({'display': 'block', 'visibility': 'visible'});
            $('.dataTables_filter').css({'display': 'block', 'visibility': 'visible'});
            $('.dataTables_info').css({'display': 'block', 'visibility': 'visible'});
        }, 200);
        
        // Handle flag toggles
        $(document).on('change', '.flag-toggle', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $checkbox = $(this);
            var productId = $checkbox.data('id');
            var flag = $checkbox.data('flag');
            var value = $checkbox.data('value');
            
            $.ajax({
                url: '{{ route('admin.products.flag') }}',
                method: 'POST',
                data: {
                    _token: '{{ csrf_token() }}',
                    id: productId,
                    flag: flag,
                    value: value
                },
                success: function(response) {
                    // Update the data-value for next toggle
                    $checkbox.data('value', value == 1 ? 0 : 1);
                },
                error: function(xhr) {
                    // Revert checkbox
                    $checkbox.prop('checked', !$checkbox.prop('checked'));
                    alert('Failed to update flag. Please try again.');
                }
            });
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        $(window).on('load', function() {
            setTimeout(function() {
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.hide();
                }
            }, 500);
        });
    });
</script>
@endpush

```


Creating the product create and edit views. Due to length, creating them in parts:


```blade
@extends('layouts.admin.app')

@section('title', translate('messages.add_product'))

@push('css_or_js')
<style>
    .card {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075), 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        border: 1px solid rgba(0, 0, 0, 0.125);
        border-radius: 0.5rem;
    }
    .card-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .card-footer {
        background-color: #f8f9fa;
        border-top: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .image-preview-container {
        margin-top: 15px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    .image-preview-item {
        position: relative;
        width: 120px;
        height: 120px;
    }
    .image-preview-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 8px;
        border: 2px solid #e4e6ef;
    }
    .image-preview-item .remove-image {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #dc3545;
        color: white;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 14px;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-add-circle"></i>
                </span>
                <span>
                    {{ translate('messages.add_product') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">{{ translate('messages.add_product') }}</h5>
                    </div>
                    <form action="{{ route('admin.products.store') }}" method="post" enctype="multipart/form-data" id="product-form">
                        @csrf
                        <div class="card-body">
                            <div class="row">
                                <!-- Basic Info -->
                                <div class="col-md-12">
                                    <h5 class="mb-3">Basic Information</h5>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="name">Product Name <span class="text-danger">*</span></label>
                                        <input type="text" name="name" id="name" class="form-control" placeholder="Enter product name" value="{{ old('name') }}" required maxlength="255">
                                        @error('name')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="category_id">Category <span class="text-danger">*</span></label>
                                        <select name="category_id" id="category_id" class="form-control" required>
                                            <option value="">Select Category</option>
                                            @foreach($categories as $category)
                                                <option value="{{ $category->id }}" {{ old('category_id') == $category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('category_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="brand_id">Brand</label>
                                        <select name="brand_id" id="brand_id" class="form-control">
                                            <option value="">Select Brand</option>
                                            @foreach($brands as $brand)
                                                <option value="{{ $brand->id }}" {{ old('brand_id') == $brand->id ? 'selected' : '' }}>{{ $brand->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('brand_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="status">Status <span class="text-danger">*</span></label>
                                        <select name="status" id="status" class="form-control" required>
                                            <option value="active" {{ old('status', 'active') == 'active' ? 'selected' : '' }}>Active</option>
                                            <option value="inactive" {{ old('status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                        </select>
                                        @error('status')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="short_description">Short Description</label>
                                        <textarea name="short_description" id="short_description" class="form-control" rows="2" placeholder="Enter short description (max 500 characters)" maxlength="500">{{ old('short_description') }}</textarea>
                                        @error('short_description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="description">Description</label>
                                        <textarea name="description" id="description" class="form-control" rows="4" placeholder="Enter product description">{{ old('description') }}</textarea>
                                        @error('description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Pricing -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Pricing (Default Variant)</h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_sku">SKU <span class="text-danger">*</span></label>
                                        <input type="text" name="variant_sku" id="variant_sku" class="form-control" placeholder="Enter SKU" value="{{ old('variant_sku') }}" required maxlength="255">
                                        @error('variant_sku')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_price">Price <span class="text-danger">*</span></label>
                                        <input type="number" name="variant_price" id="variant_price" class="form-control" placeholder="0.00" value="{{ old('variant_price') }}" step="0.01" min="0" required>
                                        @error('variant_price')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_sale_price">Sale Price</label>
                                        <input type="number" name="variant_sale_price" id="variant_sale_price" class="form-control" placeholder="0.00" value="{{ old('variant_sale_price') }}" step="0.01" min="0">
                                        @error('variant_sale_price')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_status">Variant Status <span class="text-danger">*</span></label>
                                        <select name="variant_status" id="variant_status" class="form-control" required>
                                            <option value="active" {{ old('variant_status', 'active') == 'active' ? 'selected' : '' }}>Active</option>
                                            <option value="inactive" {{ old('variant_status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                        </select>
                                        @error('variant_status')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Images -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Images</h5>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="images">Images</label>
                                        <input type="file" name="images[]" id="images" class="form-control" accept="image/*" multiple onchange="previewImages(this)">
                                        <small class="text-muted">Accepted formats: JPG, PNG, GIF, WEBP (Max: 2MB each). You can select multiple images.</small>
                                        <div class="image-preview-container" id="image-preview-container"></div>
                                        @error('images.*')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Flags -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Flags</h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Trending</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_trending" id="is_trending" value="1" {{ old('is_trending') ? 'checked' : '' }} switch="bool">
                                            <label for="is_trending" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls trending_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Latest</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_latest" id="is_latest" value="1" {{ old('is_latest') ? 'checked' : '' }} switch="bool">
                                            <label for="is_latest" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls latest_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Express-30</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_express_30" id="is_express_30" value="1" {{ old('is_express_30') ? 'checked' : '' }} switch="bool">
                                            <label for="is_express_30" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls /api/express-30/products</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="btn--container justify-content-end">
                                <a href="{{ route('admin.products.index') }}" class="btn btn--reset">{{ translate('messages.cancel') }}</a>
                                <button type="submit" class="btn btn--primary">{{ translate('messages.submit') }}</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    var imageFiles = [];
    
    function previewImages(input) {
        var container = document.getElementById('image-preview-container');
        container.innerHTML = '';
        
        if (input.files && input.files.length > 0) {
            for (var i = 0; i < input.files.length; i++) {
                var file = input.files[i];
                imageFiles.push(file);
                
                var reader = new FileReader();
                reader.onload = function(e) {
                    var div = document.createElement('div');
                    div.className = 'image-preview-item';
                    div.innerHTML = '<img src="' + e.target.result + '" alt="Preview">';
                    container.appendChild(div);
                };
                reader.readAsDataURL(file);
            }
        }
    }
</script>
@endpush

```


Creating the product edit view:


```blade
@extends('layouts.admin.app')

@section('title', translate('messages.edit_product'))

@push('css_or_js')
<style>
    .card {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075), 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        border: 1px solid rgba(0, 0, 0, 0.125);
        border-radius: 0.5rem;
    }
    .card-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .card-footer {
        background-color: #f8f9fa;
        border-top: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .image-preview-container {
        margin-top: 15px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    .image-preview-item {
        position: relative;
        width: 120px;
        height: 120px;
    }
    .image-preview-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 8px;
        border: 2px solid #e4e6ef;
    }
    .image-preview-item .remove-image {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #dc3545;
        color: white;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 14px;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-edit"></i>
                </span>
                <span>
                    {{ translate('messages.edit_product') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">{{ translate('messages.edit_product') }}</h5>
                    </div>
                    <form action="{{ route('admin.products.update', $product->id) }}" method="post" enctype="multipart/form-data" id="product-form">
                        @csrf
                        @method('PUT')
                        <div class="card-body">
                            <div class="row">
                                <!-- Basic Info -->
                                <div class="col-md-12">
                                    <h5 class="mb-3">Basic Information</h5>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="name">Product Name <span class="text-danger">*</span></label>
                                        <input type="text" name="name" id="name" class="form-control" placeholder="Enter product name" value="{{ old('name', $product->name) }}" required maxlength="255">
                                        @error('name')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="category_id">Category <span class="text-danger">*</span></label>
                                        <select name="category_id" id="category_id" class="form-control" required>
                                            <option value="">Select Category</option>
                                            @foreach($categories as $category)
                                                <option value="{{ $category->id }}" {{ old('category_id', $product->category_id) == $category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('category_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="brand_id">Brand</label>
                                        <select name="brand_id" id="brand_id" class="form-control">
                                            <option value="">Select Brand</option>
                                            @foreach($brands as $brand)
                                                <option value="{{ $brand->id }}" {{ old('brand_id', $product->brand_id) == $brand->id ? 'selected' : '' }}>{{ $brand->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('brand_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="status">Status <span class="text-danger">*</span></label>
                                        <select name="status" id="status" class="form-control" required>
                                            <option value="active" {{ old('status', $product->status) == 'active' ? 'selected' : '' }}>Active</option>
                                            <option value="inactive" {{ old('status', $product->status) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                        </select>
                                        @error('status')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="short_description">Short Description</label>
                                        <textarea name="short_description" id="short_description" class="form-control" rows="2" placeholder="Enter short description (max 500 characters)" maxlength="500">{{ old('short_description', $product->short_description) }}</textarea>
                                        @error('short_description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="description">Description</label>
                                        <textarea name="description" id="description" class="form-control" rows="4" placeholder="Enter product description">{{ old('description', $product->description) }}</textarea>
                                        @error('description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Images -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Images</h5>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="images">Add New Images</label>
                                        <input type="file" name="images[]" id="images" class="form-control" accept="image/*" multiple onchange="previewImages(this)">
                                        <small class="text-muted">Accepted formats: JPG, PNG, GIF, WEBP (Max: 2MB each). You can select multiple images.</small>
                                        <div class="image-preview-container" id="image-preview-container"></div>
                                        @error('images.*')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label">Existing Images</label>
                                        <div class="image-preview-container">
                                            @foreach($product->images as $image)
                                                <div class="image-preview-item">
                                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $image->image_url, \App\CentralLogics\Helpers::getDisk()) }}" alt="Product Image">
                                                    <a href="{{ route('admin.products.delete-image', $image->id) }}" 
                                                       class="remove-image" 
                                                       onclick="return confirm('Are you sure you want to delete this image?')"
                                                       title="Delete Image">
                                                        <i class="tio-delete-outlined"></i>
                                                    </a>
                                                </div>
                                            @endforeach
                                        </div>
                                    </div>
                                </div>

                                <!-- Flags -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Flags</h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Trending</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_trending" id="is_trending" value="1" {{ old('is_trending', $product->is_trending) ? 'checked' : '' }} switch="bool">
                                            <label for="is_trending" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls trending_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Latest</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_latest" id="is_latest" value="1" {{ old('is_latest', $product->is_latest) ? 'checked' : '' }} switch="bool">
                                            <label for="is_latest" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls latest_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Express-30</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_express_30" id="is_express_30" value="1" {{ old('is_express_30', $product->is_express_30) ? 'checked' : '' }} switch="bool">
                                            <label for="is_express_30" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls /api/express-30/products</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="btn--container justify-content-end">
                                <a href="{{ route('admin.products.index') }}" class="btn btn--reset">{{ translate('messages.cancel') }}</a>
                                <button type="submit" class="btn btn--primary">{{ translate('messages.submit') }}</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    function previewImages(input) {
        var container = document.getElementById('image-preview-container');
        
        if (input.files && input.files.length > 0) {
            for (var i = 0; i < input.files.length; i++) {
                var file = input.files[i];
                var reader = new FileReader();
                reader.onload = function(e) {
                    var div = document.createElement('div');
                    div.className = 'image-preview-item';
                    div.innerHTML = '<img src="' + e.target.result + '" alt="Preview">';
                    container.appendChild(div);
                };
                reader.readAsDataURL(file);
            }
        }
    }
</script>
@endpush

```


Adding routes, then updating the sidebar and translations:


```php
<?php

use Illuminate\Support\Facades\Route;
use App\Http\Controllers\Admin\DashboardController;

Route::get('/', function () {
    return redirect()->route('login');
});

// Login Routes
Route::get('login', [App\Http\Controllers\LoginController::class, 'login'])->name('login');
Route::post('login', [App\Http\Controllers\LoginController::class, 'submit'])->name('login.post');
Route::post('logout', [App\Http\Controllers\LoginController::class, 'logout'])->name('logout');
Route::get('logout', [App\Http\Controllers\LoginController::class, 'logout'])->name('logout'); // Fallback for GET requests
Route::get('reload-captcha', [App\Http\Controllers\LoginController::class, 'reloadCaptcha'])->name('reload-captcha');
Route::get('reset-password', [App\Http\Controllers\LoginController::class, 'reset_password'])->name('reset-password');

// Admin routes - protected by auth middleware
Route::group(['prefix' => 'admin', 'as' => 'admin.', 'middleware' => ['auth']], function () {
    Route::get('/', [App\Http\Controllers\Admin\DashboardController::class, 'dashboard'])->name('dashboard');
    Route::get('dashboard', [App\Http\Controllers\Admin\DashboardController::class, 'dashboard'])->name('dashboard');
    
    // Dashboard stats routes
    Route::group(['prefix' => 'dashboard-stats', 'as' => 'dashboard-stats.'], function () {
        Route::post('order', [App\Http\Controllers\Admin\DashboardController::class, 'order'])->name('order');
        Route::post('zone', [App\Http\Controllers\Admin\DashboardController::class, 'zone'])->name('zone');
        Route::post('user-overview', [App\Http\Controllers\Admin\DashboardController::class, 'user_overview'])->name('user-overview');
        Route::post('commission-overview', [App\Http\Controllers\Admin\DashboardController::class, 'commission_overview'])->name('commission-overview');
    });
    
    // Logistics Routes
    Route::group(['prefix' => 'logistics', 'as' => 'logistics.'], function () {
        Route::get('warehouse', [App\Http\Controllers\Admin\Logistics\WarehouseController::class, 'index'])->name('warehouse.index');
        Route::get('warehouse/create', [App\Http\Controllers\Admin\Logistics\WarehouseController::class, 'create'])->name('warehouse.create');
        Route::post('warehouse', [App\Http\Controllers\Admin\Logistics\WarehouseController::class, 'store'])->name('warehouse.store');
        Route::get('warehouse/{id}/edit', [App\Http\Controllers\Admin\Logistics\WarehouseController::class, 'edit'])->name('warehouse.edit');
        Route::put('warehouse/{id}', [App\Http\Controllers\Admin\Logistics\WarehouseController::class, 'update'])->name('warehouse.update');
        Route::delete('warehouse/{id}', [App\Http\Controllers\Admin\Logistics\WarehouseController::class, 'destroy'])->name('warehouse.destroy');
        Route::post('warehouse/status', [App\Http\Controllers\Admin\Logistics\WarehouseController::class, 'status'])->name('warehouse.status');
        
        Route::get('miniwarehouse', [App\Http\Controllers\Admin\Logistics\MiniwarehouseController::class, 'index'])->name('miniwarehouse.index');
        Route::get('miniwarehouse/create', [App\Http\Controllers\Admin\Logistics\MiniwarehouseController::class, 'create'])->name('miniwarehouse.create');
        Route::post('miniwarehouse', [App\Http\Controllers\Admin\Logistics\MiniwarehouseController::class, 'store'])->name('miniwarehouse.store');
        Route::get('miniwarehouse/{id}/edit', [App\Http\Controllers\Admin\Logistics\MiniwarehouseController::class, 'edit'])->name('miniwarehouse.edit');
        Route::put('miniwarehouse/{id}', [App\Http\Controllers\Admin\Logistics\MiniwarehouseController::class, 'update'])->name('miniwarehouse.update');
        Route::delete('miniwarehouse/{id}', [App\Http\Controllers\Admin\Logistics\MiniwarehouseController::class, 'destroy'])->name('miniwarehouse.destroy');
        Route::post('miniwarehouse/status', [App\Http\Controllers\Admin\Logistics\MiniwarehouseController::class, 'status'])->name('miniwarehouse.status');
        
        Route::get('lm-center', [App\Http\Controllers\Admin\Logistics\LmCenterController::class, 'index'])->name('lm-center.index');
        Route::get('lm-center/create', [App\Http\Controllers\Admin\Logistics\LmCenterController::class, 'create'])->name('lm-center.create');
        Route::post('lm-center', [App\Http\Controllers\Admin\Logistics\LmCenterController::class, 'store'])->name('lm-center.store');
        Route::get('lm-center/{id}/edit', [App\Http\Controllers\Admin\Logistics\LmCenterController::class, 'edit'])->name('lm-center.edit');
        Route::put('lm-center/{id}', [App\Http\Controllers\Admin\Logistics\LmCenterController::class, 'update'])->name('lm-center.update');
        Route::delete('lm-center/{id}', [App\Http\Controllers\Admin\Logistics\LmCenterController::class, 'destroy'])->name('lm-center.destroy');
        Route::post('lm-center/status', [App\Http\Controllers\Admin\Logistics\LmCenterController::class, 'status'])->name('lm-center.status');
        Route::post('lm-center/verify-document', [App\Http\Controllers\Admin\Logistics\LmCenterController::class, 'verifyDocument'])->name('lm-center.verify-document');
        
        Route::get('fm-rt-center', [App\Http\Controllers\Admin\Logistics\FmRtCenterController::class, 'index'])->name('fm-rt-center.index');
        Route::get('fm-rt-center/create', [App\Http\Controllers\Admin\Logistics\FmRtCenterController::class, 'create'])->name('fm-rt-center.create');
        Route::post('fm-rt-center', [App\Http\Controllers\Admin\Logistics\FmRtCenterController::class, 'store'])->name('fm-rt-center.store');
        Route::get('fm-rt-center/{id}/edit', [App\Http\Controllers\Admin\Logistics\FmRtCenterController::class, 'edit'])->name('fm-rt-center.edit');
        Route::put('fm-rt-center/{id}', [App\Http\Controllers\Admin\Logistics\FmRtCenterController::class, 'update'])->name('fm-rt-center.update');
        Route::delete('fm-rt-center/{id}', [App\Http\Controllers\Admin\Logistics\FmRtCenterController::class, 'destroy'])->name('fm-rt-center.destroy');
        Route::post('fm-rt-center/status', [App\Http\Controllers\Admin\Logistics\FmRtCenterController::class, 'status'])->name('fm-rt-center.status');
        
        Route::get('pending-mapping', [App\Http\Controllers\Admin\Logistics\PendingMappingController::class, 'index'])->name('pending-mapping.index');
    });
    
    // Banner Routes
    Route::resource('banner', App\Http\Controllers\Admin\BannerController::class);
    Route::post('banner/status', [App\Http\Controllers\Admin\BannerController::class, 'statusToggle'])->name('banner.status');
    
    // Category Routes
    Route::resource('categories', App\Http\Controllers\Admin\CategoryController::class);
    Route::post('categories/status', [App\Http\Controllers\Admin\CategoryController::class, 'statusToggle'])->name('categories.status');
    
    // Product Routes
    Route::resource('products', App\Http\Controllers\Admin\ProductController::class);
    Route::post('products/status', [App\Http\Controllers\Admin\ProductController::class, 'statusToggle'])->name('products.status');
    Route::post('products/flag', [App\Http\Controllers\Admin\ProductController::class, 'flagToggle'])->name('products.flag');
    Route::delete('products/image/{id}', [App\Http\Controllers\Admin\ProductController::class, 'deleteImage'])->name('products.delete-image');
});

```


Adding the Product Management menu to the sidebar after Item Management:



Adding the Product Management menu after Item Management:


```blade
<div id="sidebarMain" class="d-none">
    <aside
        class="js-navbar-vertical-aside navbar navbar-vertical-aside navbar-vertical navbar-vertical-fixed navbar-expand-xl navbar-bordered  ">
        <div class="navbar-vertical-container">
            <div class="navbar-brand-wrapper justify-content-between">
                <!-- Logo -->
                @php($store_logo = \App\Models\BusinessSetting::where(['key' => 'logo'])->first())
                @php($storage_type = isset($store_logo) && isset($store_logo->storage) && is_array($store_logo->storage) && isset($store_logo->storage[0]) ? $store_logo->storage[0]->value : 'public')
                <a class="navbar-brand" href="{{ route('admin.dashboard') }}" aria-label="Front">
                    <img class="navbar-brand-logo initial--36 onerror-image onerror-image"
                        data-onerror-image="{{ asset('assets/admin/img/160x160/img2.jpg') }}"
                        src="{{ \App\CentralLogics\Helpers::get_full_url('business', $store_logo?->value ?? '', $storage_type, 'favicon') }}"
                        alt="Logo">
                    <img class="navbar-brand-logo-mini initial--36 onerror-image onerror-image"
                        data-onerror-image="{{ asset('assets/admin/img/160x160/img2.jpg') }}"
                        src="{{ \App\CentralLogics\Helpers::get_full_url('business', $store_logo?->value ?? '', $storage_type, 'favicon') }}"
                        alt="Logo">
                </a>
                <!-- End Logo -->

                <!-- Navbar Vertical Toggle -->
                <button type="button"
                    class="js-navbar-vertical-aside-toggle-invoker navbar-vertical-aside-toggle btn btn-icon btn-xs btn-ghost-dark">
                    <i class="tio-clear tio-lg"></i>
                </button>
                <!-- End Navbar Vertical Toggle -->

                <div class="navbar-nav-wrap-content-left">
                    <!-- Navbar Vertical Toggle -->
                    <button type="button" class="js-navbar-vertical-aside-toggle-invoker close">
                        <i class="tio-first-page navbar-vertical-aside-toggle-short-align" data-toggle="tooltip"
                            data-placement="right" title="Collapse"></i>
                        <i class="tio-last-page navbar-vertical-aside-toggle-full-align"
                            data-template='<div class="tooltip d-none d-sm-block" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>'></i>
                    </button>
                    <!-- End Navbar Vertical Toggle -->
                </div>

            </div>

            <!-- Content -->
            <div class="navbar-vertical-content bg--005555" id="navbar-vertical-content">
                <ul class="navbar-nav navbar-nav-lg nav-tabs">
                    <!-- Dashboards -->
                    <li class="navbar-vertical-aside-has-menu {{ Request::is('admin') ? 'show active' : '' }}">
                        <a class="js-navbar-vertical-aside-menu-link nav-link" href="{{ route('admin.dashboard') }}"
                            title="{{ translate('messages.dashboard') }}">
                            <i class="tio-home-vs-1-outlined nav-icon"></i>
                            <span class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">
                                {{ translate('messages.dashboard') }}
                            </span>
                        </a>
                    </li>
                    <!-- End Dashboards -->

                    <!-- Marketing section -->
                    <li class="nav-item">
                        <small class="nav-subtitle"
                            title="{{ translate('messages.employee_handle') }}">{{ translate('pos section') }}</small>
                        <small class="tio-more-horizontal nav-subtitle-replacer"></small>
                    </li>
                    <!-- Pos -->
                    @if (true)
                        <li class="navbar-vertical-aside-has-menu {{ Request::is('admin/pos*') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link "
                                href="{{ route('admin.dashboard') }}" title="{{ translate('New Sale') }}">
                                <i class="tio-shopping-basket-outlined nav-icon"></i>
                                <span class="text-truncate">{{ translate('New Sale') }}</span>
                            </a>
                        </li>
                    @endif
                    <!-- Pos -->

                    <li class="nav-item">
                        <small class="nav-subtitle"
                            title="{{ translate('messages.module_section') }}">{{ translate('messages.module_management') }}</small>
                        <small class="tio-more-horizontal nav-subtitle-replacer"></small>
                    </li>

                    @if (true)
                        <li class="navbar-vertical-aside-has-menu {{ Request::is('admin/zone*') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link"
                                href="{{ route('admin.dashboard') }}" title="{{ translate('messages.zone_setup') }}">
                                <i class="tio-city nav-icon"></i>
                                <span class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">
                                    {{ translate('messages.zone_setup') }} </span>
                            </a>
                        </li>
                    @endif

                    @if (true)
                        <li class="navbar-vertical-aside-has-menu {{ Request::is('admin/module') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link nav-link-toggle" href="javascript:"
                                title="{{ translate('messages.system_module_setup') }}">
                                <i class="tio-globe nav-icon"></i>
                                <span class="text-truncate">{{ translate('messages.system_module_setup') }}</span>
                            </a>
                            <ul class="js-navbar-vertical-aside-submenu nav nav-sub"
                                style="display:{{ Request::is('admin/module*') ? 'block' : 'none' }}">
                                <li
                                    class="navbar-vertical-aside-has-menu {{ Request::is('admin/module/create') ? 'active' : '' }}">
                                    <a class="js-navbar-vertical-aside-menu-link nav-link"
                                        href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.add_module') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate">
                                            {{ translate('messages.add_module') }}
                                        </span>
                                    </a>
                                </li>
                                <li
                                    class="navbar-vertical-aside-has-menu {{ Request::is('admin/module') ? 'active' : '' }}">
                                    <a class="js-navbar-vertical-aside-menu-link nav-link"
                                        href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.modules') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate">
                                            {{ translate('messages.modules') }}
                                        </span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                    @endif

                    <!-- Marketing section -->
                    <li class="nav-item">
                        <small class="nav-subtitle"
                            title="{{ translate('messages.employee_handle') }}">{{ translate('Promotions') }}</small>
                        <small class="tio-more-horizontal nav-subtitle-replacer"></small>
                    </li>
                    <!-- Campaign -->
                    @if (true)
                        <li class="navbar-vertical-aside-has-menu {{ Request::is('admin/campaign') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link nav-link-toggle" href="javascript:"
                                title="{{ translate('messages.campaigns') }}">
                                <i class="tio-layers-outlined nav-icon"></i>
                                <span
                                    class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">{{ translate('messages.campaigns') }}</span>
                            </a>
                            <ul class="js-navbar-vertical-aside-submenu nav nav-sub"
                                style="display:{{ Request::is('admin/campaign*') ? 'block' : 'none' }}">

                                <li class="nav-item {{ Request::is('admin/campaign/basic/*') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.basic_campaigns') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate">{{ translate('messages.basic_campaigns') }}</span>
                                    </a>
                                </li>
                                <li class="nav-item {{ Request::is('admin/campaign/item/*') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.item_campaigns') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate">{{ translate('messages.item_campaigns') }}</span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                    @endif
                    <!-- End Campaign -->
                    <!-- Banner -->
                    @if (true)
                        <li class="navbar-vertical-aside-has-menu {{ Request::is('admin/banner*') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link"
                                href="{{ route('admin.banner.index') }}"
                                title="{{ translate('messages.banners') }}">
                                <i class="tio-image nav-icon"></i>
                                <span
                                    class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">{{ translate('messages.banners') }}</span>
                            </a>
                        </li>
                    @endif
                    <!-- End Banner -->
                    <!-- Coupon -->
                    @if (true)
                        <li class="navbar-vertical-aside-has-menu {{ Request::is('admin/coupon*') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link"
                                href="{{ route('admin.dashboard') }}" title="{{ translate('messages.coupons') }}">
                                <i class="tio-gift nav-icon"></i>
                                <span
                                    class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">{{ translate('messages.coupons') }}</span>
                            </a>
                        </li>
                    @endif
                    <!-- End Coupon -->
                    @if (true)
                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/cashback*') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link"
                                href="{{ route('admin.dashboard') }}" title="{{ translate('messages.cashback') }}">
                                <i class="tio-settings-back nav-icon"></i>
                                <span
                                    class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">{{ translate('messages.cashback') }}</span>
                            </a>
                        </li>
                    @endif
                    <!-- Notification -->
                    @if (true)
                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/notification*') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link"
                                href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.push_notification') }}">
                                <i class="tio-notifications nav-icon"></i>
                                <span class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">
                                    {{ translate('messages.push_notification') }}
                                </span>
                            </a>
                        </li>
                    @endif
                    <!-- End Notification -->

                    <!-- End marketing section -->
                    <!-- Orders -->
                    @if (true)
                        <li class="nav-item">
                            <small class="nav-subtitle">{{ translate('messages.order_management') }}</small>
                            <small class="tio-more-horizontal nav-subtitle-replacer"></small>
                        </li>

                        <li class="navbar-vertical-aside-has-menu {{ Request::is('admin/order') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link nav-link-toggle" href="javascript:"
                                title="{{ translate('messages.orders') }}">
                                <i class="tio-shopping-cart nav-icon"></i>
                                <span class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">
                                    {{ translate('messages.orders') }}
                                </span>
                            </a>
                            <ul class="js-navbar-vertical-aside-submenu nav nav-sub"
                                style="display:{{ Request::is('admin/order*') ? 'block' : 'none' }}">
                                <li class="nav-item {{ Request::is('admin/order/list/all') ? 'active' : '' }}">
                                    <a class="nav-link" href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.all_orders') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate sidebar--badge-container">
                                            {{ translate('messages.all') }}
                                            <span class="badge badge-soft-info badge-pill ml-1">
                                                0
                                            </span>
                                        </span>
                                    </a>
                                </li>
                                <li class="nav-item {{ Request::is('admin/order/list/scheduled') ? 'active' : '' }}">
                                    <a class="nav-link" href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.scheduled_orders') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate sidebar--badge-container">
                                            {{ translate('messages.scheduled') }}
                                            <span class="badge badge-soft-info badge-pill ml-1">
                                                0
                                            </span>
                                        </span>
                                    </a>
                                </li>
                                <li class="nav-item {{ Request::is('admin/order/list/pending') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.pending_orders') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate sidebar--badge-container">
                                            {{ translate('messages.pending') }}
                                            <span class="badge badge-soft-info badge-pill ml-1">
                                                0
                                            </span>
                                        </span>
                                    </a>
                                </li>

                                <li class="nav-item {{ Request::is('admin/order/list/accepted') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.accepted_orders') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate sidebar--badge-container">
                                            {{ translate('messages.accepted') }}
                                            <span class="badge badge-soft-success badge-pill ml-1">
                                                0
                                            </span>
                                        </span>
                                    </a>
                                </li>
                                <li class="nav-item {{ Request::is('admin/order/list/processing') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.processing_orders') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate sidebar--badge-container">
                                            {{ translate('messages.processing') }}
                                            <span class="badge badge-soft-warning badge-pill ml-1">
                                                0
                                            </span>
                                        </span>
                                    </a>
                                </li>
                                <li
                                    class="nav-item {{ Request::is('admin/order/list/item_on_the_way') ? 'active' : '' }}">
                                    <a class="nav-link text-capitalize" href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.order_on_the_way') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate sidebar--badge-container">
                                            {{ translate('messages.order_on_the_way') }}
                                            <span class="badge badge-soft-warning badge-pill ml-1">
                                                0
                                            </span>
                                        </span>
                                    </a>
                                </li>
                                <li class="nav-item {{ Request::is('admin/order/list/delivered') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.delivered_orders') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate sidebar--badge-container">
                                            {{ translate('messages.delivered') }}
                                            <span class="badge badge-soft-success badge-pill ml-1">
                                                0
                                            </span>
                                        </span>
                                    </a>
                                </li>
                                <li class="nav-item {{ Request::is('admin/order/list/canceled') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.canceled_orders') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate sidebar--badge-container">
                                            {{ translate('messages.canceled') }}
                                            <span class="badge badge-soft-warning bg-light badge-pill ml-1">
                                                0
                                            </span>
                                        </span>
                                    </a>
                                </li>
                                <li class="nav-item {{ Request::is('admin/order/list/failed') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.payment_failed_orders') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate sidebar--badge-container text-capitalize">
                                            {{ translate('messages.payment_failed') }}
                                            <span class="badge badge-soft-danger bg-light badge-pill ml-1">
                                                0
                                            </span>
                                        </span>
                                    </a>
                                </li>
                                <li class="nav-item {{ Request::is('admin/order/list/refunded') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.refunded_orders') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate sidebar--badge-container">
                                            {{ translate('messages.refunded') }}
                                            <span class="badge badge-soft-danger bg-light badge-pill ml-1">
                                                0
                                            </span>
                                        </span>
                                    </a>
                                </li>
                                <li
                                    class="nav-item {{ Request::is('admin/order/offline/payment/list*') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('Offline_Payments') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate sidebar--badge-container">
                                            {{ translate('messages.Offline_Payments') }}
                                            <span class="badge badge-soft-danger bg-light badge-pill ml-1">
                                                0
                                            </span>
                                        </span>
                                    </a>
                                </li>
                            </ul>
                        </li>

                        <!-- Order refund -->
                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/refund/*') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link nav-link-toggle" href="javascript:"
                                title="{{ translate('Order Refunds') }}">
                                <i class="tio-receipt nav-icon"></i>
                                <span class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">
                                    {{ translate('Order Refunds') }}
                                </span>
                            </a>
                            <ul class="js-navbar-vertical-aside-submenu nav nav-sub"
                                style="display: {{ Request::is('admin/refund*') ? 'block' : 'none' }}">

                                <li
                                    class="nav-item {{ Request::is('admin/refund/requested') || Request::is('admin/refund/rejected') || Request::is('admin/refund/refunded') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('Refund Requests') }} ">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate sidebar--badge-container">
                                            {{ translate('Refund Requests') }}
                                            <span class="badge badge-soft-danger badge-pill ml-1">
                                                0
                                            </span>
                                        </span>
                                    </a>
                                </li>

                                {{-- <li class="nav-item {{ Request::is('admin/refund/settings') ? 'active' : '' }}">
                            <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                title="{{ translate('refund_settings') }}">
                                <span class="tio-circle nav-indicator-icon"></span>
                                <span class="text-truncate sidebar--badge-container">
                                    {{ translate('refund_settings') }}

                                </span>
                            </a>
                        </li> --}}
                            </ul>
                        </li>
                        <!-- Order refund End-->

                        <!-- Order dispachment -->
                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/dispatch/*') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link nav-link-toggle" href="javascript:"
                                title="{{ translate('messages.dispatch') }}">
                                <i class="tio-clock nav-icon"></i>
                                <span class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">
                                    {{ translate('messages.dispatch') }}
                                </span>
                            </a>
                            <ul class="js-navbar-vertical-aside-submenu nav nav-sub"
                                style="{{ Request::is('admin/dispatch*') ? 'display-block' : 'display-none' }}">
                                <li
                                    class="nav-item {{ Request::is('admin/dispatch/list/searching_for_deliverymen') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.unassigned_orders') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate sidebar--badge-container">
                                            {{ translate('messages.unassigned_orders') }}
                                            <span class="badge badge-soft-info badge-pill ml-1">
                                                0
                                            </span>
                                        </span>
                                    </a>
                                </li>
                                <li
                                    class="nav-item {{ Request::is('admin/dispatch/list/on_going') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.ongoingOrders') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate sidebar--badge-container">
                                            {{ translate('messages.ongoingOrders') }}
                                            <span class="badge badge-soft-light badge-pill ml-1">
                                                0
                                            </span>
                                        </span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <!-- Order dispachment End-->
                    @endif
                    <!-- End Orders -->



                    <!-- Parcel Section -->
                    <li class="nav-item">
                        <small class="nav-subtitle"
                            title="{{ translate('messages.parcel_section') }}">{{ translate('messages.parcel_management') }}</small>
                        <small class="tio-more-horizontal nav-subtitle-replacer"></small>
                    </li>

                    @if (\App\CentralLogics\Helpers::module_permission_check('parcel'))
                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/parcel*') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link nav-link-toggle" href="javascript:"
                                title="{{ translate('messages.parcel') }}">
                                <i class="tio-bus nav-icon"></i>
                                <span
                                    class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">{{ translate('messages.parcel') }}</span>
                            </a>
                            <ul class="js-navbar-vertical-aside-submenu nav nav-sub"
                                style="display:{{ Request::is('admin/parcel*') ? 'block' : 'none' }}">
                                <li
                                    class="navbar-vertical-aside-has-menu {{ Request::is('admin/parcel/category') ? 'active' : '' }}">
                                    <a class="js-navbar-vertical-aside-menu-link nav-link"
                                        href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.parcel_category') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate">
                                            {{ translate('messages.parcel_category') }}
                                        </span>
                                    </a>
                                </li>
                                <li
                                    class="navbar-vertical-aside-has-menu {{ Request::is('admin/parcel/orders*') ? 'active' : '' }}">
                                    <a class="js-navbar-vertical-aside-menu-link nav-link"
                                        href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.parcel_orders') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate">
                                            {{ translate('messages.parcel_orders') }}
                                        </span>
                                    </a>
                                </li>

                                <li
                                    class="navbar-vertical-aside-has-menu {{ Request::is('admin/parcel/settings') ? 'active' : '' }}">
                                    <a class="js-navbar-vertical-aside-menu-link nav-link"
                                        href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.parcel_settings') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate">
                                            {{ translate('messages.parcel_settings') }}
                                        </span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                    @endif
                    <!--End Parcel Section -->

                    <li class="nav-item">
                        <small class="nav-subtitle"
                            title="{{ translate('messages.item_section') }}">{{ translate('messages.item_management') }}</small>
                        <small class="tio-more-horizontal nav-subtitle-replacer"></small>
                    </li>

                    <!-- Category -->
                    @if (\App\CentralLogics\Helpers::module_permission_check('category'))
                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/category*') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link nav-link-toggle" href="javascript:"
                                title="{{ translate('messages.categories') }}">
                                <i class="tio-category nav-icon"></i>
                                <span
                                    class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">{{ translate('messages.categories') }}</span>
                            </a>
                            <ul class="js-navbar-vertical-aside-submenu nav nav-sub"
                                style="display:{{ Request::is('admin/category*') ? 'block' : 'none' }}">
                                <li
                                    class="nav-item @yield('main_category') {{ Request::is('admin/category/add') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.category') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate">{{ translate('messages.category') }}</span>
                                    </a>
                                </li>

                                <li
                                    class="nav-item @yield('sub_category') {{ Request::is('admin/category/add-sub-category') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.sub_category') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate">{{ translate('messages.sub_category') }}</span>
                                    </a>
                                </li>

                                {{-- <li class="nav-item {{Request::is('admin/category/add-sub-sub-category')?'active':''}}">
                            <a class="nav-link " href="{{route('admin.dashboard')}}" title="add new sub sub category">
                                <span class="tio-circle nav-indicator-icon"></span>
                                <span class="text-truncate">Sub-Sub-Category</span>
                            </a>
                        </li> --}}
                                <li class="nav-item {{ Request::is('admin/category/bulk-import') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.bulk_import') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span
                                            class="text-truncate text-capitalize">{{ translate('messages.bulk_import') }}</span>
                                    </a>
                                </li>
                                <li class="nav-item {{ Request::is('admin/category/bulk-export') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.bulk_export') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span
                                            class="text-truncate text-capitalize">{{ translate('messages.bulk_export') }}</span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                    @endif
                    <!-- End Category -->

                    <!-- Attributes -->
                    @if (\App\CentralLogics\Helpers::module_permission_check('attribute'))
                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/attribute*') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link"
                                href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.attributes') }}">
                                <i class="tio-apps nav-icon"></i>
                                <span class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">
                                    {{ translate('messages.attributes') }}
                                </span>
                            </a>
                        </li>
                    @endif
                    <!-- End Attributes -->

                    <!-- Unit -->
                    @if (\App\CentralLogics\Helpers::module_permission_check('unit'))
                        <li class="navbar-vertical-aside-has-menu {{ Request::is('admin/unit*') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link"
                                href="{{ route('admin.dashboard') }}" title="{{ translate('messages.units') }}">
                                <i class="tio-ruler nav-icon"></i>
                                <span
                                    class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate text-capitalize">
                                    {{ translate('messages.units') }}
                                </span>
                            </a>
                        </li>
                    @endif
                    <!-- End Unit -->

                    <!-- AddOn -->
                    @if (\App\CentralLogics\Helpers::module_permission_check('addon'))
                        <li class="navbar-vertical-aside-has-menu {{ Request::is('admin/addon*') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link nav-link-toggle" href="javascript:"
                                title="{{ translate('messages.addons') }}">
                                <i class="tio-add-circle-outlined nav-icon"></i>
                                <span
                                    class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">{{ translate('messages.addons') }}</span>
                            </a>
                            <ul class="js-navbar-vertical-aside-submenu nav nav-sub"
                                style="display:{{ Request::is('admin/addon*') ? 'block' : 'none' }}">
                                <li class="nav-item {{ Request::is('admin/addon/add-new') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.addon_list') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate">{{ translate('messages.list') }}</span>
                                    </a>
                                </li>

                                <li class="nav-item {{ Request::is('admin/addon/bulk-import') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.bulk_import') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span
                                            class="text-truncate text-capitalize">{{ translate('messages.bulk_import') }}</span>
                                    </a>
                                </li>
                                <li class="nav-item {{ Request::is('admin/addon/bulk-export') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.bulk_export') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span
                                            class="text-truncate text-capitalize">{{ translate('messages.bulk_export') }}</span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                    @endif
                    <!-- End AddOn -->
                    <!-- Food -->
                    @if (\App\CentralLogics\Helpers::module_permission_check('item'))
                        <li class="navbar-vertical-aside-has-menu {{ Request::is('admin/item*') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link nav-link-toggle" href="javascript:"
                                title="{{ translate('messages.items') }}">
                                <i class="tio-premium-outlined nav-icon"></i>
                                <span
                                    class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate text-capitalize">{{ translate('messages.items') }}</span>
                            </a>
                            <ul class="js-navbar-vertical-aside-submenu nav nav-sub"
                                style="display:{{ Request::is('admin/item*') ? 'block' : 'none' }}">
                                <li
                                    class="nav-item {{ Request::is('admin/item/add-new') || (Request::is('admin/item/edit/*') && strpos(request()->fullUrl(), 'product_gellary=1') !== false) ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.add_new') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate">{{ translate('messages.add_new') }}</span>
                                    </a>
                                </li>
                                <li
                                    class="nav-item {{ Request::is('admin/item/list') || (Request::is('admin/item/edit/*') && (strpos(request()->fullUrl(), 'temp_product=1') == false && strpos(request()->fullUrl(), 'product_gellary=1') == false)) ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.food_list') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate">{{ translate('messages.list') }}</span>
                                    </a>
                                </li>
                                {{-- @if (\App\CentralLogics\Helpers::get_mail_status('product_gallery')) --}}
                                <li class="nav-item {{ Request::is('admin/item/product-gallery') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.Product_Gallery') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span
                                            class="text-truncate">{{ translate('messages.Product_Gallery') }}</span>
                                    </a>
                                </li>
                                {{-- @endif --}}
                                @if (true)
                                    <li
                                        class="nav-item {{ Request::is('admin/item/new/item/list') || (Request::is('admin/item/edit/*') && strpos(request()->fullUrl(), 'temp_product=1') !== false) ? 'active' : '' }}">
                                        <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                            title="{{ translate('messages.New_Item_Request') }}">
                                            <span class="tio-circle nav-indicator-icon"></span>
                                            <span
                                                class="text-truncate">{{ translate('messages.New_Item_Request') }}</span>
                                        </a>
                                    </li>
                                @endif
                                <li class="nav-item {{ Request::is('admin/item/reviews') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.review_list') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate">{{ translate('messages.review') }}</span>
                                    </a>
                                </li>
                                <li class="nav-item {{ Request::is('admin/item/bulk-import') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.bulk_import') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span
                                            class="text-truncate text-capitalize">{{ translate('messages.bulk_import') }}</span>
                                    </a>
                                </li>
                                <li class="nav-item {{ Request::is('admin/item/bulk-export') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.bulk_export') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span
                                            class="text-truncate text-capitalize">{{ translate('messages.bulk_export') }}</span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                    @endif
                    <!-- End Food -->

                    <!-- Product Management -->
                    <li class="navbar-vertical-aside-has-menu {{ Request::is('admin/product*') || Request::is('admin/categories*') ? 'active' : '' }}">
                        <a class="js-navbar-vertical-aside-menu-link nav-link nav-link-toggle" href="javascript:void(0)"
                            title="{{ translate('messages.product_management') }}">
                            <i class="tio-shop nav-icon"></i>
                            <span class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">
                                {{ translate('messages.product_management') }}
                            </span>
                        </a>
                        <ul class="js-navbar-vertical-aside-submenu nav nav-sub"
                            style="display:{{ Request::is('admin/product*') || Request::is('admin/categories*') ? 'block' : 'none' }}">
                            <li class="nav-item">
                                <a class="nav-link {{ Request::is('admin/categories*') ? 'active' : '' }}"
                                   href="{{ route('admin.categories.index') }}">
                                    <span class="tio-circle nav-indicator-icon"></span>
                                    <span class="text-truncate">{{ translate('messages.categories') }}</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link {{ Request::is('admin/products*') ? 'active' : '' }}"
                                   href="{{ route('admin.products.index') }}">
                                    <span class="tio-circle nav-indicator-icon"></span>
                                    <span class="text-truncate">{{ translate('messages.products') }}</span>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <!-- End Product Management -->

                    <!-- Store Store -->
                    <li class="nav-item">
                        <small class="nav-subtitle"
                            title="{{ translate('messages.store_section') }}">{{ translate('messages.store_management') }}</small>
                        <small class="tio-more-horizontal nav-subtitle-replacer"></small>
                    </li>

                    @if (\App\CentralLogics\Helpers::module_permission_check('store'))
                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/store*') && !Request::is('admin/store/withdraw_list') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link nav-link-toggle" href="javascript:"
                                title="{{ translate('messages.stores') }}">
                                <i class="tio-filter-list nav-icon"></i>
                                <span
                                    class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">{{ translate('messages.stores') }}</span>
                            </a>
                            <ul class="js-navbar-vertical-aside-submenu nav nav-sub"
                                style="display:{{ Request::is('admin/store*') ? 'block' : 'none' }}">
                                <li
                                    class="navbar-vertical-aside-has-menu {{ Request::is('admin/store/add') ? 'active' : '' }}">
                                    <a class="js-navbar-vertical-aside-menu-link nav-link"
                                        href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.add_store') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate">
                                            {{ translate('messages.add_store') }}
                                        </span>
                                    </a>
                                </li>

                                <li
                                    class="navbar-item {{ Request::is('admin/store/list') || Request::is('admin/store/view/*') ? 'active' : '' }}">
                                    <a class="js-navbar-vertical-aside-menu-link nav-link"
                                        href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.stores_list') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate">{{ translate('messages.stores') }}
                                            {{ translate('list') }}</span>
                                    </a>
                                </li>
                                <li
                                    class="navbar-item {{ Request::is('admin/store/pending-requests') ? 'active' : '' }}">
                                    <a class="js-navbar-vertical-aside-menu-link nav-link"
                                        href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.pending_requests') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span
                                            class="text-truncate text-capitalize">{{ translate('new_joining_requests') }}</span>
                                    </a>
                                </li>

                                <li
                                    class="navbar-item {{ Request::is('admin/store/recommended-store') ? 'active' : '' }}">
                                    <a class="js-navbar-vertical-aside-menu-link nav-link"
                                        href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.pending_requests') }}">
                                        <span class="tio-hot"></span>
                                        <span
                                            class="text-truncate text-capitalize">{{ translate('Recommended_Store') }}</span>
                                    </a>
                                </li>


                                <li class="nav-item {{ Request::is('admin/store/bulk-import') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.bulk_import') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span
                                            class="text-truncate text-capitalize">{{ translate('messages.bulk_import') }}</span>
                                    </a>
                                </li>
                                <li class="nav-item {{ Request::is('admin/store/bulk-export') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.bulk_export') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span
                                            class="text-truncate text-capitalize">{{ translate('messages.bulk_export') }}</span>
                                    </a>
                                </li>

                            </ul>
                        </li>
                    @endif
                    <!-- End Store -->
                    <!-- DeliveryMan -->
                    @if (\App\CentralLogics\Helpers::module_permission_check('deliveryman'))
                        <li class="nav-item">
                            <small class="nav-subtitle"
                                title="{{ translate('messages.deliveryman_section') }}">{{ translate('messages.deliveryman_management') }}</small>
                            <small class="tio-more-horizontal nav-subtitle-replacer"></small>
                        </li>
                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/delivery-man/add') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link"
                                href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.add_delivery_man') }}">
                                <i class="tio-running nav-icon"></i>
                                <span class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">
                                    {{ translate('messages.add_delivery_man') }}
                                </span>
                            </a>
                        </li>

                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/delivery-man/new') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link text-capitalize"
                                href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.new_joining_requests') }}">
                                <i class="tio-man nav-icon"></i>
                                <span class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">
                                    {{ translate('messages.new_joining_requests') }}
                                </span>
                            </a>
                        </li>


                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/delivery-man/list') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link"
                                href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.deliveryman_list') }}">
                                <i class="tio-filter-list nav-icon"></i>
                                <span class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">
                                    {{ translate('messages.deliveryman_list') }}
                                </span>
                            </a>
                        </li>

                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/delivery-man/reviews/list') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link"
                                href="{{ route('admin.dashboard') }}" title="{{ translate('messages.reviews') }}">
                                <i class="tio-star-outlined nav-icon"></i>
                                <span class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">
                                    {{ translate('messages.reviews') }}
                                </span>
                            </a>
                        </li>
                    @endif
                    <!-- End DeliveryMan -->

                    <!-- Customer Section -->
                    @if (\App\CentralLogics\Helpers::module_permission_check('customer_management'))
                        <li class="nav-item">
                            <small class="nav-subtitle"
                                title="{{ translate('messages.customer_section') }}">{{ translate('messages.customer_management') }}</small>
                            <small class="tio-more-horizontal nav-subtitle-replacer"></small>
                        </li>
                        <!-- Custommer -->

                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/customer/list') || Request::is('admin/customer/view*') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link"
                                href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.customers') }}">
                                <i class="tio-poi-user nav-icon"></i>
                                <span class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">
                                    {{ translate('messages.customers') }}
                                </span>
                            </a>
                        </li>

                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/customer/wallet*') ? 'active' : '' }}">

                            <a class="js-navbar-vertical-aside-menu-link nav-link nav-link-toggle" href="javascript:"
                                title="{{ translate('messages.customer_wallet') }}">
                                <i class="tio-wallet nav-icon"></i>
                                <span
                                    class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate  text-capitalize">
                                    {{ translate('messages.customer_wallet') }}
                                </span>
                            </a>

                            <ul class="js-navbar-vertical-aside-submenu nav nav-sub"
                                style="display:{{ Request::is('admin/customer/wallet*') ? 'block' : 'none' }}">
                                <li
                                    class="nav-item {{ Request::is('admin/customer/wallet/add-fund') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.add_fund') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span
                                            class="text-truncate text-capitalize">{{ translate('messages.add_fund') }}</span>
                                    </a>
                                </li>

                                <li
                                    class="nav-item {{ Request::is('admin/customer/wallet/report*') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.report') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span
                                            class="text-truncate text-capitalize">{{ translate('messages.report') }}</span>
                                    </a>
                                </li>
                            </ul>
                        </li>

                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/customer/loyalty-point*') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link  nav-link-toggle" href="javascript:"
                                title="{{ translate('messages.customer_loyalty_point') }}">
                                <i class="tio-medal nav-icon"></i>
                                <span
                                    class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate  text-capitalize">
                                    {{ translate('messages.customer_loyalty_point') }}
                                </span>
                            </a>

                            <ul class="js-navbar-vertical-aside-submenu nav nav-sub"
                                style="display:{{ Request::is('admin/customer/loyalty-point*') ? 'block' : 'none' }}">
                                <li
                                    class="nav-item {{ Request::is('admin/customer/loyalty-point/report*') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.report') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span
                                            class="text-truncate text-capitalize">{{ translate('messages.report') }}</span>
                                    </a>
                                </li>
                            </ul>
                        </li>

                        <!-- End Custommer -->
                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/customer/subscribed') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link"
                                href="{{ route('admin.dashboard') }}"
                                title="{{ translate('subscribed_emails') }}">
                                <i class="tio-email-outlined nav-icon"></i>
                                <span class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">
                                    {{ translate('messages.subscribed_mail_list') }}
                                </span>
                            </a>
                        </li>
                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/contact/contact-list') ? 'active' : '' }}">
                            <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.contact_messages') }}">
                                <span class="tio-message nav-icon"></span>
                                <span class="text-truncate">{{ translate('messages.contact_messages') }}</span>
                            </a>
                        </li>
                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/customer/settings') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link"
                                href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.Customer_settings') }}">
                                <i class="tio-settings nav-icon"></i>
                                <span class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">
                                    {{ translate('messages.Customer_settings') }}
                                </span>
                            </a>
                        </li>
                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/message/list') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link"
                                href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.customer_chat') }}">
                                <i class="tio-chat nav-icon"></i>
                                <span class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">
                                    {{ translate('messages.Customer_Chat') }}
                                </span>
                            </a>
                        </li>
                    @endif
                    <!-- End customer Section -->

                    <!-- Business Section-->
                    <li class="nav-item">
                        <small class="nav-subtitle"
                            title="{{ translate('messages.business_section') }}">{{ translate('messages.business_management') }}</small>
                        <small class="tio-more-horizontal nav-subtitle-replacer"></small>
                    </li>

                    <!-- withdraw -->
                    @if (\App\CentralLogics\Helpers::module_permission_check('withdraw_list'))
                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/store/withdraw*') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link"
                                href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.store_withdraws') }}">
                                <i class="tio-table nav-icon"></i>
                                <span
                                    class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">{{ translate('messages.store_withdraws') }}</span>
                            </a>
                        </li>
                    @endif
                    <!-- End withdraw -->
                    <!-- account -->
                    @if (\App\CentralLogics\Helpers::module_permission_check('collect_cash'))
                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/account-transaction*') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link"
                                href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.collect_cash') }}">
                                <i class="tio-money nav-icon"></i>
                                <span
                                    class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">{{ translate('messages.collect_cash') }}</span>
                            </a>
                        </li>
                    @endif
                    <!-- End account -->

                    <!-- provide_dm_earning -->
                    @if (\App\CentralLogics\Helpers::module_permission_check('provide_dm_earning'))
                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/provide-deliveryman-earnings*') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link"
                                href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.deliverymen_earning_provide') }}">
                                <i class="tio-send nav-icon"></i>
                                <span
                                    class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">{{ translate('messages.deliverymen_earning_provide') }}</span>
                            </a>
                        </li>
                    @endif
                    <!-- End provide_dm_earning -->

                    <!-- Business Settings -->
                    @if (\App\CentralLogics\Helpers::module_permission_check('settings'))
                        <li class="nav-item">
                            <small class="nav-subtitle"
                                title="{{ translate('messages.business_settings') }}">{{ translate('messages.business_settings') }}</small>
                            <small class="tio-more-horizontal nav-subtitle-replacer"></small>
                        </li>
                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/business-settings/business-setup') ? 'active' : '' }}">
                            <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.business_setup') }}">
                                <span class="tio-settings nav-icon"></span>
                                <span class="text-truncate">{{ translate('messages.business_setup') }}</span>
                            </a>
                        </li>
                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/business-settings/social-media') ? 'active' : '' }}">
                            <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.Social Media') }}">
                                <span class="tio-facebook nav-icon"></span>
                                <span class="text-truncate">{{ translate('messages.Social Media') }}</span>
                            </a>
                        </li>
                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/business-settings/payment-method') ? 'active' : '' }}">
                            <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.payment_methods') }}">
                                <span class="tio-atm nav-icon"></span>
                                <span class="text-truncate">{{ translate('messages.payment_methods') }}</span>
                            </a>
                        </li>
                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/business-settings/mail-config') ? 'active' : '' }}">
                            <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.mail_config') }}">
                                <span class="tio-email nav-icon"></span>
                                <span class="text-truncate">{{ translate('messages.mail_config') }}</span>
                            </a>
                        </li>
                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/business-settings/sms-module') ? 'active' : '' }}">
                            <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.sms_system_module') }}">
                                <span class="tio-message nav-icon"></span>
                                <span class="text-truncate">{{ translate('messages.sms_system_module') }}</span>
                            </a>
                        </li>

                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/business-settings/fcm-index') ? 'active' : '' }}">
                            <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.notification_settings') }}">
                                <span class="tio-notifications nav-icon"></span>
                                <span class="text-truncate">{{ translate('messages.notification_settings') }}</span>
                            </a>
                        </li>
                    @endif
                    <!-- End Business Settings -->

                    <!-- web & adpp Settings -->
                    @if (\App\CentralLogics\Helpers::module_permission_check('settings'))
                        <li class="nav-item">
                            <small class="nav-subtitle"
                                title="{{ translate('messages.business_settings') }}">{{ translate('messages.web_and_app_settings') }}</small>
                            <small class="tio-more-horizontal nav-subtitle-replacer"></small>
                        </li>
                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/business-settings/app-settings*') ? 'active' : '' }}">
                            <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.app_settings') }}">
                                <span class="tio-android nav-icon"></span>
                                <span class="text-truncate">{{ translate('messages.app_settings') }}</span>
                            </a>
                        </li>
                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/business-settings/landing-page-settings*') ? 'active' : '' }}">
                            <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.landing_page_settings') }}">
                                <span class="tio-website nav-icon"></span>
                                <span class="text-truncate">{{ translate('messages.landing_page_settings') }}</span>
                            </a>
                        </li>
                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/business-settings/config*') ? 'active' : '' }}">
                            <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.third_party_apis') }}">
                                <span class="tio-key nav-icon"></span>
                                <span class="text-truncate">{{ translate('messages.third_party_apis') }}</span>
                            </a>
                        </li>

                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/business-settings/pages*') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link nav-link-toggle" href="javascript:"
                                title="{{ translate('messages.pages_setup') }}">
                                <i class="tio-pages nav-icon"></i>
                                <span
                                    class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">{{ translate('messages.pages_setup') }}</span>
                            </a>
                            <ul class="js-navbar-vertical-aside-submenu nav nav-sub"
                                style="display:{{ Request::is('admin/business-settings/pages*') ? 'block' : 'none' }}">

                                <li
                                    class="nav-item {{ Request::is('admin/business-settings/pages/terms-and-conditions') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.terms_and_condition') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span
                                            class="text-truncate">{{ translate('messages.terms_and_condition') }}</span>
                                    </a>
                                </li>

                                <li
                                    class="nav-item {{ Request::is('admin/business-settings/pages/privacy-policy') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.privacy_policy') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate">{{ translate('messages.privacy_policy') }}</span>
                                    </a>
                                </li>

                                <li
                                    class="nav-item {{ Request::is('admin/business-settings/pages/about-us') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.about_us') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate">{{ translate('messages.about_us') }}</span>
                                    </a>
                                </li>
                                <li
                                    class="nav-item {{ Request::is('admin/business-settings/pages/refund') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.Refund Policy') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate">{{ translate('Refund Policy') }}</span>
                                    </a>
                                </li>

                                <li
                                    class="nav-item {{ Request::is('admin/business-settings/pages/cancelation') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.Cancelation Policy') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate">{{ translate('Cancelation Policy') }}</span>
                                    </a>
                                </li>


                                <li
                                    class="nav-item {{ Request::is('admin/business-settings/pages/shipping-policy') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.shipping_policy') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate">{{ translate('Shipping Policy') }}</span>
                                    </a>
                                </li>
                            </ul>
                        </li>

                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/file-manager*') ? 'active' : '' }}">
                            <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.gallery') }}">
                                <span class="tio-album nav-icon"></span>
                                <span
                                    class="text-truncate text-capitalize">{{ translate('messages.gallery') }}</span>
                            </a>
                        </li>

                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/social-login/view') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link"
                                href="{{ route('admin.dashboard') }}">
                                <i class="tio-twitter nav-icon"></i>
                                <span class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">
                                    {{ translate('messages.social_login') }}
                                </span>
                            </a>
                        </li>

                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/business-settings/recaptcha*') ? 'active' : '' }}">
                            <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.reCaptcha') }}">
                                <span class="tio-top-security-outlined nav-icon"></span>
                                <span class="text-truncate">{{ translate('messages.reCaptcha') }}</span>
                            </a>
                        </li>

                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/business-settings/db-index') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link"
                                href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.clean_database') }}">
                                <i class="tio-cloud nav-icon"></i>
                                <span class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">
                                    {{ translate('messages.clean_database') }}
                                </span>
                            </a>
                        </li>
                    @endif
                    <!-- End web & adpp Settings -->

                    <!-- Report -->
                    @if (\App\CentralLogics\Helpers::module_permission_check('report'))
                        <li class="nav-item">
                            <small class="nav-subtitle"
                                title="{{ translate('messages.report_and_analytics') }}">{{ translate('messages.report_and_analytics') }}</small>
                            <small class="tio-more-horizontal nav-subtitle-replacer"></small>
                        </li>

                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/report/item-wise-report') ? 'active' : '' }}">
                            <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.item_report') }}">
                                <span class="tio-chart-bar-1 nav-icon"></span>
                                <span class="text-truncate">{{ translate('messages.item_report') }}</span>
                            </a>
                        </li>
                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/report/stock-report') ? 'active' : '' }}">
                            <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.limited_stock_item') }}">
                                <span class="tio-chart-bar-4 nav-icon"></span>
                                <span
                                    class="text-truncate text-capitalize">{{ translate('messages.limited_stock_item') }}</span>
                            </a>
                        </li>


                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/report/store-wise-report') ? 'active' : '' }}">
                            <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.store_wise_report') }}">
                                <span class="tio-home nav-icon"></span>
                                <span class="text-truncate">{{ translate('messages.store_report') }}</span>
                            </a>
                        </li>


                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/report/order-report') ? 'active' : '' }}">
                            <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.order_report') }}">
                                <span class="tio-voice nav-icon"></span>
                                <span
                                    class="text-truncate text-capitalize">{{ translate('messages.order_report') }}</span>
                            </a>
                        </li>

                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/report/transaction-report') ? 'active' : '' }}">
                            <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.transaction_report') }}">
                                <span class="tio-chart-pie-1 nav-icon"></span>
                                <span class="text-truncate">{{ translate('messages.transaction_report') }}</span>
                            </a>
                        </li>


                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/report/expense-report') ? 'active' : '' }}">
                            <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.expense_report') }}">
                                <span class="tio-money nav-icon"></span>
                                <span class="text-truncate">{{ translate('messages.expense_report') }}</span>
                            </a>
                        </li>
                    @endif

                    <!-- Employee-->

                    <li class="nav-item">
                        <small class="nav-subtitle"
                            title="{{ translate('messages.employee_handle') }}">{{ translate('messages.employee') }}
                            {{ translate('management') }}</small>
                        <small class="tio-more-horizontal nav-subtitle-replacer"></small>
                    </li>

                    @if (\App\CentralLogics\Helpers::module_permission_check('custom_role'))
                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/custom-role*') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link"
                                href="{{ route('admin.dashboard') }}"
                                title="{{ translate('messages.employee_Role') }}">
                                <i class="tio-incognito nav-icon"></i>
                                <span
                                    class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">{{ translate('messages.employee_Role') }}</span>
                            </a>
                        </li>
                    @endif

                    @if (\App\CentralLogics\Helpers::module_permission_check('employee'))
                        <li
                            class="navbar-vertical-aside-has-menu {{ Request::is('admin/employee*') ? 'active' : '' }}">
                            <a class="js-navbar-vertical-aside-menu-link nav-link nav-link-toggle" href="javascript:"
                                title="{{ translate('messages.Employee') }}">
                                <i class="tio-user nav-icon"></i>
                                <span
                                    class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate">{{ translate('messages.employees') }}</span>
                            </a>
                            <ul class="js-navbar-vertical-aside-submenu nav nav-sub"
                                style="display:{{ Request::is('admin/employee*') ? 'block' : 'none' }}">
                                <li class="nav-item {{ Request::is('admin/employee/add-new') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.add_new_Employee') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate">{{ translate('messages.add_new') }}</span>
                                    </a>
                                </li>
                                <li class="nav-item {{ Request::is('admin/employee/list') ? 'active' : '' }}">
                                    <a class="nav-link " href="{{ route('admin.dashboard') }}"
                                        title="{{ translate('messages.Employee_list') }}">
                                        <span class="tio-circle nav-indicator-icon"></span>
                                        <span class="text-truncate">{{ translate('messages.list') }}</span>
                                    </a>
                                </li>

                            </ul>
                        </li>
                    @endif
                    <!-- End Employee -->

                    <!-- Logistics Management -->
                    <li class="nav-item">
                        <small class="nav-subtitle">Logistics Management</small>
                        <small class="tio-more-horizontal nav-subtitle-replacer"></small>
                    </li>
                    <li
                        class="navbar-vertical-aside-has-menu {{ Request::is('admin/logistics/warehouse*') ? 'active' : '' }}">
                        <a class="js-navbar-vertical-aside-menu-link nav-link"
                            href="{{ route('admin.logistics.warehouse.index') }}" title="Warehouse Creation">
                            <i class="tio-shop-outlined nav-icon"></i>
                            <span
                                class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate text-capitalize">Warehouse
                                Creation</span>
                        </a>
                    </li>
                    <li
                        class="navbar-vertical-aside-has-menu {{ Request::is('admin/logistics/miniwarehouse*') ? 'active' : '' }}">
                        <a class="js-navbar-vertical-aside-menu-link nav-link"
                            href="{{ route('admin.logistics.miniwarehouse.index') }}"
                            title="Miniwarehouse Creation">
                            <i class="tio-shop-outlined nav-icon"></i>
                            <span
                                class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate text-capitalize">Miniwarehouse
                                Creation</span>
                        </a>
                    </li>
                    <li
                        class="navbar-vertical-aside-has-menu {{ Request::is('admin/logistics/lm-center*') ? 'active' : '' }}">
                        <a class="js-navbar-vertical-aside-menu-link nav-link"
                            href="{{ route('admin.logistics.lm-center.index') }}" title="LM Center Creation">
                            <i class="tio-map nav-icon"></i>
                            <span
                                class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate text-capitalize">LM
                                Center Creation</span>
                        </a>
                    </li>
                    <li
                        class="navbar-vertical-aside-has-menu {{ Request::is('admin/logistics/fm-rt-center*') ? 'active' : '' }}">
                        <a class="js-navbar-vertical-aside-menu-link nav-link"
                            href="{{ route('admin.logistics.fm-rt-center.index') }}" title="FM/RT Center Creation">
                            <i class="tio-map nav-icon"></i>
                            <span
                                class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate text-capitalize">FM/RT
                                Center Creation</span>
                        </a>
                    </li>
                    <li
                        class="navbar-vertical-aside-has-menu {{ Request::is('admin/logistics/pending-mapping*') ? 'active' : '' }}">
                        <a class="js-navbar-vertical-aside-menu-link nav-link"
                            href="{{ route('admin.logistics.pending-mapping.index') }}" title="Pending Mapping">
                            <i class="tio-shop-outlined nav-icon"></i>
                            <span
                                class="navbar-vertical-aside-mini-mode-hidden-elements text-truncate text-capitalize">Pending
                                Mapping</span>
                        </a>
                    </li>
                    <!-- End Logistics Management -->

                    <li class="nav-item py-5">

                    </li>


                    <li class="__sidebar-hs-unfold px-2" id="tourb-9">
                        <div class="hs-unfold w-100">
                            <a class="js-hs-unfold-invoker navbar-dropdown-account-wrapper" href="javascript:;"
                                data-hs-unfold-options='{
                                    "target": "#accountNavbarDropdown",
                                    "type": "css-animation"
                                }'>
                                <div class="cmn--media right-dropdown-icon d-flex align-items-center">
                                    <div class="avatar avatar-sm avatar-circle">
                                        <img class="avatar-img onerror-image"
                                            data-onerror-image="{{ asset('assets/admin/img/160x160/img1.jpg') }}"
                                            src="{{ auth()->user()->image ?? asset('assets/admin/img/160x160/img1.jpg') }}"
                                            alt="Image Description">
                                        <span class="avatar-status avatar-sm-status avatar-status-success"></span>
                                    </div>
                                    <div class="media-body pl-3">
                                        <span class="card-title h5">
                                            {{ auth()->user()->name ?? 'Admin' }}
                                        </span>
                                        <span
                                            class="card-text">{{ auth()->user()->email ?? 'admin@example.com' }}</span>
                                    </div>
                                </div>
                            </a>

                            <div id="accountNavbarDropdown"
                                class="hs-unfold-content dropdown-unfold dropdown-menu dropdown-menu-right navbar-dropdown-menu navbar-dropdown-account min--240">
                                <div class="dropdown-item-text">
                                    <div class="media align-items-center">
                                        <div class="avatar avatar-sm avatar-circle mr-2">
                                            <img class="avatar-img onerror-image"
                                                data-onerror-image="{{ asset('assets/admin/img/160x160/img1.jpg') }}"
                                                src="{{ auth()->user()->image ?? asset('assets/admin/img/160x160/img1.jpg') }}"
                                                alt="Image Description">
                                        </div>
                                        <div class="media-body">
                                            <span class="card-title h5">{{ auth()->user()->name ?? 'Admin' }}</span>
                                            <span
                                                class="card-text">{{ auth()->user()->email ?? 'admin@example.com' }}</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="dropdown-divider"></div>

                                <a class="dropdown-item" href="{{ route('admin.dashboard') }}">
                                    <span class="text-truncate pr-2"
                                        title="Settings">{{ translate('messages.settings') }}</span>
                                </a>

                                <div class="dropdown-divider"></div>

                                <a class="dropdown-item log-out" href="{{ route('logout') }}"
                                    onclick="event.preventDefault(); document.getElementById('logout-form').submit();">
                                    <span class="text-truncate pr-2"
                                        title="Sign out">{{ translate('messages.sign_out') }}</span>
                                </a>
                                <form id="logout-form" action="{{ route('logout') }}" method="POST"
                                    style="display: none;">
                                    @csrf
                                </form>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
            <!-- End Content -->
        </div>
    </aside>
</div>

<div id="sidebarCompact" class="d-none">

</div>


@push('script_2')
    <script>
        $(window).on('load', function() {
            if ($(".navbar-vertical-content li.active").length) {
                $('.navbar-vertical-content').animate({
                    scrollTop: $(".navbar-vertical-content li.active").offset().top - 150
                }, 10);
            }
        });
    </script>
@endpush

```


Adding translation keys. Checking where translations are stored:



Creating translation files for the admin panel messages:


```php
<?php

return [
    // Product Management
    'product_management' => 'Product Management',
    'products' => 'Products',
    'categories' => 'Categories',
    'add_product' => 'Add Product',
    'edit_product' => 'Edit Product',
    'add_category' => 'Add Category',
    'edit_category' => 'Edit Category',
    'trending' => 'Trending',
    'latest' => 'Latest',
    'express_30' => 'Express-30',
    'product_saved' => 'Product saved successfully',
    'category_saved' => 'Category saved successfully',
    
    // Common
    'sl' => 'SL',
    'status' => 'Status',
    'action' => 'Action',
    'cancel' => 'Cancel',
    'submit' => 'Submit',
    'edit' => 'Edit',
    'delete' => 'Delete',
    'no_data_found' => 'No data found',
    
    // Messages
    'category_added' => 'Category added successfully',
    'category_updated' => 'Category updated successfully',
    'category_deleted' => 'Category deleted successfully',
    'category_status_updated' => 'Category status updated successfully',
    'failed_to_add_category' => 'Failed to add category',
    'failed_to_update_category' => 'Failed to update category',
    'failed_to_delete_category' => 'Failed to delete category',
    'failed_to_update_status' => 'Failed to update status',
    'failed_to_upload_image' => 'Failed to upload image',
    'Cannot delete category with products' => 'Cannot delete category with products',
    'Cannot delete category with subcategories' => 'Cannot delete category with subcategories',
    
    'product_added' => 'Product added successfully',
    'product_updated' => 'Product updated successfully',
    'product_deleted' => 'Product deleted successfully',
    'product_status_updated' => 'Product status updated successfully',
    'product_flag_updated' => 'Product flag updated successfully',
    'failed_to_add_product' => 'Failed to add product',
    'failed_to_update_product' => 'Failed to update product',
    'failed_to_delete_product' => 'Failed to delete product',
    'failed_to_update_flag' => 'Failed to update flag',
    'image_deleted' => 'Image deleted successfully',
    'failed_to_delete_image' => 'Failed to delete image',
    'Invalid flag' => 'Invalid flag',
    'SKU already exists' => 'SKU already exists',
];

```

```php
<?php

return [
    // Product Management
    'product_management' => '‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§™‡•ç‡§∞‡§¨‡§Ç‡§ß‡§®',
    'products' => '‡§â‡§§‡•ç‡§™‡§æ‡§¶',
    'categories' => '‡§∂‡•ç‡§∞‡•á‡§£‡§ø‡§Ø‡§æ‡§Ç',
    'add_product' => '‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç',
    'edit_product' => '‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§∏‡§Ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç',
    'add_category' => '‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§ú‡•ã‡§°‡§º‡•á‡§Ç',
    'edit_category' => '‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§∏‡§Ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç',
    'trending' => '‡§ü‡•ç‡§∞‡•á‡§Ç‡§°‡§ø‡§Ç‡§ó',
    'latest' => '‡§®‡§µ‡•Ä‡§®‡§§‡§Æ',
    'express_30' => '‡§è‡§ï‡•ç‡§∏‡§™‡•ç‡§∞‡•á‡§∏-30',
    'product_saved' => '‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§∏‡§π‡•á‡§ú‡§æ ‡§ó‡§Ø‡§æ',
    'category_saved' => '‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§∏‡§π‡•á‡§ú‡•Ä ‡§ó‡§à',
    
    // Common
    'sl' => '‡§ï‡•ç‡§∞.',
    'status' => '‡§∏‡•ç‡§•‡§ø‡§§‡§ø',
    'action' => '‡§ï‡§æ‡§∞‡•ç‡§∞‡§µ‡§æ‡§à',
    'cancel' => '‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç',
    'submit' => '‡§∏‡§¨‡§Æ‡§ø‡§ü ‡§ï‡§∞‡•á‡§Ç',
    'edit' => '‡§∏‡§Ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç',
    'delete' => '‡§π‡§ü‡§æ‡§è‡§Ç',
    'no_data_found' => '‡§ï‡•ã‡§à ‡§°‡•á‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ',
    
    // Messages
    'category_added' => '‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§ú‡•ã‡§°‡§º‡•Ä ‡§ó‡§à',
    'category_updated' => '‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡•Ä ‡§ó‡§à',
    'category_deleted' => '‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§π‡§ü‡§æ‡§à ‡§ó‡§à',
    'category_status_updated' => '‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡•Ä ‡§ó‡§à',
    'failed_to_add_category' => '‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§ú‡•ã‡§°‡§º‡§®‡•á ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§´‡§≤',
    'failed_to_update_category' => '‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§´‡§≤',
    'failed_to_delete_category' => '‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§π‡§ü‡§æ‡§®‡•á ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§´‡§≤',
    'failed_to_update_status' => '‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§´‡§≤',
    'failed_to_upload_image' => '‡§õ‡§µ‡§ø ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§´‡§≤',
    'Cannot delete category with products' => '‡§â‡§§‡•ç‡§™‡§æ‡§¶‡•ã‡§Ç ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§π‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§∏‡§ï‡§§‡•á',
    'Cannot delete category with subcategories' => '‡§â‡§™‡§∂‡•ç‡§∞‡•á‡§£‡§ø‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∂‡•ç‡§∞‡•á‡§£‡•Ä ‡§π‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§∏‡§ï‡§§‡•á',
    
    'product_added' => '‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ',
    'product_updated' => '‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ',
    'product_deleted' => '‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§π‡§ü‡§æ‡§Ø‡§æ ‡§ó‡§Ø‡§æ',
    'product_status_updated' => '‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡•Ä ‡§ó‡§à',
    'product_flag_updated' => '‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§´‡•ç‡§≤‡•à‡§ó ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ',
    'failed_to_add_product' => '‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§ú‡•ã‡§°‡§º‡§®‡•á ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§´‡§≤',
    'failed_to_update_product' => '‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§´‡§≤',
    'failed_to_delete_product' => '‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§π‡§ü‡§æ‡§®‡•á ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§´‡§≤',
    'failed_to_update_flag' => '‡§´‡•ç‡§≤‡•à‡§ó ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§´‡§≤',
    'image_deleted' => '‡§õ‡§µ‡§ø ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§π‡§ü‡§æ‡§à ‡§ó‡§à',
    'failed_to_delete_image' => '‡§õ‡§µ‡§ø ‡§π‡§ü‡§æ‡§®‡•á ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§´‡§≤',
    'Invalid flag' => '‡§Ö‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§´‡•ç‡§≤‡•à‡§ó',
    'SKU already exists' => 'SKU ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§Æ‡•å‡§ú‡•Ç‡§¶ ‡§π‡•à',
];

```

```php
<?php

return [
    // Product Management
    'product_management' => '‡™â‡™§‡´ç‡™™‡™æ‡™¶‡™® ‡™µ‡´ç‡™Ø‡™µ‡™∏‡´ç‡™•‡™æ‡™™‡™®',
    'products' => '‡™â‡™§‡´ç‡™™‡™æ‡™¶‡™®‡´ã',
    'categories' => '‡™∂‡´ç‡™∞‡´á‡™£‡´Ä‡™ì',
    'add_product' => '‡™â‡™§‡´ç‡™™‡™æ‡™¶‡™® ‡™â‡™Æ‡´á‡™∞‡´ã',
    'edit_product' => '‡™â‡™§‡´ç‡™™‡™æ‡™¶‡™® ‡™∏‡™Ç‡™™‡™æ‡™¶‡™ø‡™§ ‡™ï‡™∞‡´ã',
    'add_category' => '‡™∂‡´ç‡™∞‡´á‡™£‡´Ä ‡™â‡™Æ‡´á‡™∞‡´ã',
    'edit_category' => '‡™∂‡´ç‡™∞‡´á‡™£‡´Ä ‡™∏‡™Ç‡™™‡™æ‡™¶‡™ø‡™§ ‡™ï‡™∞‡´ã',
    'trending' => '‡™ü‡´ç‡™∞‡´á‡™®‡´ç‡™°‡™ø‡™Ç‡™ó',
    'latest' => '‡™®‡™µ‡´Ä‡™®‡™§‡™Æ',
    'express_30' => '‡™è‡™ï‡´ç‡™∏‡™™‡´ç‡™∞‡´á‡™∏-30',
    'product_saved' => '‡™â‡™§‡´ç‡™™‡™æ‡™¶‡™® ‡™∏‡™´‡™≥‡™§‡™æ‡™™‡´Ç‡™∞‡´ç‡™µ‡™ï ‡™∏‡™æ‡™ö‡™µ‡´ç‡™Ø‡´Å‡™Ç',
    'category_saved' => '‡™∂‡´ç‡™∞‡´á‡™£‡´Ä ‡™∏‡™´‡™≥‡™§‡™æ‡™™‡´Ç‡™∞‡´ç‡™µ‡™ï ‡™∏‡™æ‡™ö‡™µ‡´Ä',
    
    // Common
    'sl' => '‡™ï‡´ç‡™∞.',
    'status' => '‡™∏‡´ç‡™•‡™ø‡™§‡™ø',
    'action' => '‡™ï‡´ç‡™∞‡™ø‡™Ø‡™æ',
    'cancel' => '‡™∞‡™¶ ‡™ï‡™∞‡´ã',
    'submit' => '‡™∏‡™¨‡™Æ‡™ø‡™ü ‡™ï‡™∞‡´ã',
    'edit' => '‡™∏‡™Ç‡™™‡™æ‡™¶‡™ø‡™§ ‡™ï‡™∞‡´ã',
    'delete' => '‡™ï‡™æ‡™¢‡´Ä ‡™®‡™æ‡™ñ‡´ã',
    'no_data_found' => '‡™ï‡´ã‡™à ‡™°‡´á‡™ü‡™æ ‡™Æ‡™≥‡´ç‡™Ø‡´ã ‡™®‡™•‡´Ä',
    
    // Messages
    'category_added' => '‡™∂‡´ç‡™∞‡´á‡™£‡´Ä ‡™∏‡™´‡™≥‡™§‡™æ‡™™‡´Ç‡™∞‡´ç‡™µ‡™ï ‡™â‡™Æ‡´á‡™∞‡´Ä',
    'category_updated' => '‡™∂‡´ç‡™∞‡´á‡™£‡´Ä ‡™∏‡™´‡™≥‡™§‡™æ‡™™‡´Ç‡™∞‡´ç‡™µ‡™ï ‡™Ö‡™™‡™°‡´á‡™ü ‡™ï‡™∞‡´Ä',
    'category_deleted' => '‡™∂‡´ç‡™∞‡´á‡™£‡´Ä ‡™∏‡™´‡™≥‡™§‡™æ‡™™‡´Ç‡™∞‡´ç‡™µ‡™ï ‡™ï‡™æ‡™¢‡´Ä ‡™®‡™æ‡™ñ‡´Ä',
    'category_status_updated' => '‡™∂‡´ç‡™∞‡´á‡™£‡´Ä ‡™∏‡´ç‡™•‡™ø‡™§‡™ø ‡™∏‡™´‡™≥‡™§‡™æ‡™™‡´Ç‡™∞‡´ç‡™µ‡™ï ‡™Ö‡™™‡™°‡´á‡™ü ‡™ï‡™∞‡´Ä',
    'failed_to_add_category' => '‡™∂‡´ç‡™∞‡´á‡™£‡´Ä ‡™â‡™Æ‡´á‡™∞‡™µ‡™æ‡™Æ‡™æ‡™Ç ‡™®‡™ø‡™∑‡´ç‡™´‡™≥',
    'failed_to_update_category' => '‡™∂‡´ç‡™∞‡´á‡™£‡´Ä ‡™Ö‡™™‡™°‡´á‡™ü ‡™ï‡™∞‡™µ‡™æ‡™Æ‡™æ‡™Ç ‡™®‡™ø‡™∑‡´ç‡™´‡™≥',
    'failed_to_delete_category' => '‡™∂‡´ç‡™∞‡´á‡™£‡´Ä ‡™ï‡™æ‡™¢‡™µ‡™æ‡™Æ‡™æ‡™Ç ‡™®‡™ø‡™∑‡´ç‡™´‡™≥',
    'failed_to_update_status' => '‡™∏‡´ç‡™•‡™ø‡™§‡™ø ‡™Ö‡™™‡™°‡´á‡™ü ‡™ï‡™∞‡™µ‡™æ‡™Æ‡™æ‡™Ç ‡™®‡™ø‡™∑‡´ç‡™´‡™≥',
    'failed_to_upload_image' => '‡™õ‡™¨‡´Ä ‡™Ö‡™™‡™≤‡´ã‡™° ‡™ï‡™∞‡™µ‡™æ‡™Æ‡™æ‡™Ç ‡™®‡™ø‡™∑‡´ç‡™´‡™≥',
    'Cannot delete category with products' => '‡™â‡™§‡´ç‡™™‡™æ‡™¶‡™®‡´ã ‡™∏‡™æ‡™•‡´á ‡™∂‡´ç‡™∞‡´á‡™£‡´Ä ‡™ï‡™æ‡™¢‡´Ä ‡™∂‡™ï‡™æ‡™§‡´Ä ‡™®‡™•‡´Ä',
    'Cannot delete category with subcategories' => '‡™â‡™™‡™∂‡´ç‡™∞‡´á‡™£‡´Ä‡™ì ‡™∏‡™æ‡™•‡´á ‡™∂‡´ç‡™∞‡´á‡™£‡´Ä ‡™ï‡™æ‡™¢‡´Ä ‡™∂‡™ï‡™æ‡™§‡´Ä ‡™®‡™•‡´Ä',
    
    'product_added' => '‡™â‡™§‡´ç‡™™‡™æ‡™¶‡™® ‡™∏‡™´‡™≥‡™§‡™æ‡™™‡´Ç‡™∞‡´ç‡™µ‡™ï ‡™â‡™Æ‡´á‡™∞‡´ç‡™Ø‡´Å‡™Ç',
    'product_updated' => '‡™â‡™§‡´ç‡™™‡™æ‡™¶‡™® ‡™∏‡™´‡™≥‡™§‡™æ‡™™‡´Ç‡™∞‡´ç‡™µ‡™ï ‡™Ö‡™™‡™°‡´á‡™ü ‡™ï‡™∞‡´ç‡™Ø‡´Å‡™Ç',
    'product_deleted' => '‡™â‡™§‡´ç‡™™‡™æ‡™¶‡™® ‡™∏‡™´‡™≥‡™§‡™æ‡™™‡´Ç‡™∞‡´ç‡™µ‡™ï ‡™ï‡™æ‡™¢‡´Ä ‡™®‡™æ‡™ñ‡´ç‡™Ø‡´Å‡™Ç',
    'product_status_updated' => '‡™â‡™§‡´ç‡™™‡™æ‡™¶‡™® ‡™∏‡´ç‡™•‡™ø‡™§‡™ø ‡™∏‡™´‡™≥‡™§‡™æ‡™™‡´Ç‡™∞‡´ç‡™µ‡™ï ‡™Ö‡™™‡™°‡´á‡™ü ‡™ï‡™∞‡´Ä',
    'product_flag_updated' => '‡™â‡™§‡´ç‡™™‡™æ‡™¶‡™® ‡™´‡´ç‡™≤‡´á‡™ó ‡™∏‡™´‡™≥‡™§‡™æ‡™™‡´Ç‡™∞‡´ç‡™µ‡™ï ‡™Ö‡™™‡™°‡´á‡™ü ‡™ï‡™∞‡´ç‡™Ø‡´ã',
    'failed_to_add_product' => '‡™â‡™§‡´ç‡™™‡™æ‡™¶‡™® ‡™â‡™Æ‡´á‡™∞‡™µ‡™æ‡™Æ‡™æ‡™Ç ‡™®‡™ø‡™∑‡´ç‡™´‡™≥',
    'failed_to_update_product' => '‡™â‡™§‡´ç‡™™‡™æ‡™¶‡™® ‡™Ö‡™™‡™°‡´á‡™ü ‡™ï‡™∞‡™µ‡™æ‡™Æ‡™æ‡™Ç ‡™®‡™ø‡™∑‡´ç‡™´‡™≥',
    'failed_to_delete_product' => '‡™â‡™§‡´ç‡™™‡™æ‡™¶‡™® ‡™ï‡™æ‡™¢‡™µ‡™æ‡™Æ‡™æ‡™Ç ‡™®‡™ø‡™∑‡´ç‡™´‡™≥',
    'failed_to_update_flag' => '‡™´‡´ç‡™≤‡´á‡™ó ‡™Ö‡™™‡™°‡´á‡™ü ‡™ï‡™∞‡™µ‡™æ‡™Æ‡™æ‡™Ç ‡™®‡™ø‡™∑‡´ç‡™´‡™≥',
    'image_deleted' => '‡™õ‡™¨‡´Ä ‡™∏‡™´‡™≥‡™§‡™æ‡™™‡´Ç‡™∞‡´ç‡™µ‡™ï ‡™ï‡™æ‡™¢‡´Ä ‡™®‡™æ‡™ñ‡´Ä',
    'failed_to_delete_image' => '‡™õ‡™¨‡´Ä ‡™ï‡™æ‡™¢‡™µ‡™æ‡™Æ‡™æ‡™Ç ‡™®‡™ø‡™∑‡´ç‡™´‡™≥',
    'Invalid flag' => '‡™Ö‡™Æ‡™æ‡™®‡´ç‡™Ø ‡™´‡´ç‡™≤‡´á‡™ó',
    'SKU already exists' => 'SKU ‡™™‡™π‡´á‡™≤‡´á‡™•‡´Ä ‡™Ö‡™∏‡´ç‡™§‡™ø‡™§‡´ç‡™µ‡™Æ‡™æ‡™Ç ‡™õ‡´á',
];

```


Running the migration to add the `is_latest` field:



## Summary

Product Management module created for the Admin Panel. Implemented:

### Completed tasks

1. Database migration: Added `is_latest` field to products table
2. Controllers:
   - `CategoryController` ‚Äî CRUD for categories
   - `ProductController` ‚Äî CRUD for products with flag toggles
3. Views:
   - Category: index, create, edit
   - Product: index, create, edit
4. Routes: Added admin routes for categories and products
5. Sidebar menu: Added "Product Management" menu after Item Management with Categories and Products submenus
6. Translations: Added translation keys in English, Hindi, and Gujarati
7. Model update: Updated Product model to include `is_latest` in fillable and casts

### Features

- Category management: Create, edit, delete categories with image/icon upload
- Product management: Full CRUD with multiple images, variant pricing, and flag management
- Product flags: Toggle switches for:
  - `is_trending` ‚Äî controls `/api/dashboard` trending_products
  - `is_latest` ‚Äî controls `/api/dashboard` latest_products
  - `is_express_30` ‚Äî controls `/api/express-30/products`
- UI: Follows existing admin theme patterns with DataTables, toggle switches, and pagination
- Permissions: Uses existing permission middleware structure

### Files created/modified

- Controllers: `CategoryController.php`, `ProductController.php`
- Views: `categories/index.blade.php`, `categories/create.blade.php`, `categories/edit.blade.php`, `products/index.blade.php`, `products/create.blade.php`, `products/edit.blade.php`
- Routes: Updated `routes/web.php`
- Sidebar: Updated `resources/views/layouts/admin/partials/_sidebar.blade.php`
- Translations: `lang/en/messages.php`, `lang/hi/messages.php`, `lang/gu/messages.php`
- Migration: `add_is_latest_to_products_table.php`
- Model: Updated `app/Models/Product.php`

The module is ready to use. The admin panel can manage products and categories, and the flags directly control the API responses without modifying the API logic.

---

**User**

In categories and product listing want to pagination in listing, also add filter beside of search box to find categorywise products from listing.
- In product listing design of search bar not proper make it to proper.

---

**Cursor**


Reviewing the current implementation, then adding pagination and a category filter, and fixing the search bar design.



Updating both views: fixing pagination, adding a category filter to the product listing, and fixing the search bar design.


```blade
@extends('layouts.admin.app')

@section('title', translate('messages.categories'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .dataTables_wrapper .dataTables_length label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .dataTables_wrapper .dataTables_length select {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 80px;
    }
    
    .dataTables_wrapper .dataTables_filter {
        text-align: right;
    }
    
    .dataTables_wrapper .dataTables_filter label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: flex-end;
    }
    
    .dataTables_wrapper .dataTables_filter input {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 200px;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-category"></i>
                </span>
                <span>
                    {{ translate('messages.categories') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.categories') }} <span class="badge badge-soft-dark ml-2" id="category-count">{{ $categories->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.categories.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_category') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <form method="GET" action="{{ route('admin.categories.index') }}" class="d-flex gap-2">
                            <div class="flex-grow-1">
                                <input type="text" name="search" class="form-control" placeholder="Search categories..." value="{{ request('search') }}">
                            </div>
                            <button type="submit" class="btn btn--primary">
                                <i class="tio-search"></i> Search
                            </button>
                            @if(request('search') || request('status') || request('parent_id'))
                                <a href="{{ route('admin.categories.index') }}" class="btn btn--reset">
                                    <i class="tio-clear"></i> Clear
                                </a>
                            @endif
                        </form>
                    </div>
                    <div class="col-md-6 text-right">
                        <form method="GET" action="{{ route('admin.categories.index') }}" class="d-flex gap-2 justify-content-end">
                            <input type="hidden" name="search" value="{{ request('search') }}">
                            <select name="status" class="form-control" style="max-width: 150px;" onchange="this.form.submit()">
                                <option value="">All Status</option>
                                <option value="active" {{ request('status') == 'active' ? 'selected' : '' }}>Active</option>
                                <option value="inactive" {{ request('status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                            </select>
                        </form>
                    </div>
                </div>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Name</th>
                        <th class="border-0">Parent</th>
                        <th class="border-0">Slug</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @foreach($categories as $key => $category)
                        <tr>
                            <td>{{ $categories->firstItem() + $key }}</td>
                            <td>
                                @if($category->image_url)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('category', $category->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $category->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/100x100/2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->name }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->parent ? $category->parent->name : '-' }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->slug }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $category->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $category->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this category?"
                                           data-title-off="Want to deactivate this category?"
                                           id="status-{{ $category->id }}" {{ $category->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.categories.status') }}" method="post" id="status-{{ $category->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $category->id }}">
                                    <input type="hidden" name="status" value="{{ $category->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.categories.edit', $category->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="category-{{ $category->id }}" 
                                       data-form-id="category-{{ $category->id }}"
                                       data-message="Want to delete this category?" 
                                       data-title="Delete Category"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.categories.destroy', $category->id) }}"
                                            method="post" id="category-{{ $category->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @endforeach
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                <div class="mt-3">
                    {{ $categories->links() }}
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: true,
            info: true,
            order: [],
            orderCellsTop: true,
            dom: "<'row'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'f>>rt<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
                lengthMenu: "Show _MENU_ entries",
                search: "Search:",
                info: "Showing _START_ to _END_ of _TOTAL_ entries",
                infoEmpty: "Showing 0 to 0 of 0 entries",
                infoFiltered: "(filtered from _MAX_ total entries)",
            },
            initComplete: function() {
                if (typeof PageLoader !== 'undefined') {
                    setTimeout(function() {
                        PageLoader.hide();
                    }, 300);
                }
            }
        });
        
        table.on('draw', function () {
            var info = table.page.info();
            $('#category-count').text(info.recordsTotal);
        });
        
        setTimeout(function() {
            $('.dataTables_length').css({'display': 'block', 'visibility': 'visible'});
            $('.dataTables_filter').css({'display': 'block', 'visibility': 'visible'});
            $('.dataTables_info').css({'display': 'block', 'visibility': 'visible'});
        }, 200);
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        $(window).on('load', function() {
            setTimeout(function() {
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.hide();
                }
            }, 500);
        });
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.categories'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .dataTables_wrapper .dataTables_length label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .dataTables_wrapper .dataTables_length select {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 80px;
    }
    
    .dataTables_wrapper .dataTables_filter {
        text-align: right;
    }
    
    .dataTables_wrapper .dataTables_filter label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: flex-end;
    }
    
    .dataTables_wrapper .dataTables_filter input {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 200px;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-category"></i>
                </span>
                <span>
                    {{ translate('messages.categories') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.categories') }} <span class="badge badge-soft-dark ml-2" id="category-count">{{ $categories->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.categories.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_category') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <form method="GET" action="{{ route('admin.categories.index') }}" class="d-flex gap-2">
                            <div class="flex-grow-1">
                                <input type="text" name="search" class="form-control" placeholder="Search categories..." value="{{ request('search') }}">
                            </div>
                            <button type="submit" class="btn btn--primary">
                                <i class="tio-search"></i> Search
                            </button>
                            @if(request('search') || request('status') || request('parent_id'))
                                <a href="{{ route('admin.categories.index') }}" class="btn btn--reset">
                                    <i class="tio-clear"></i> Clear
                                </a>
                            @endif
                        </form>
                    </div>
                    <div class="col-md-6 text-right">
                        <form method="GET" action="{{ route('admin.categories.index') }}" class="d-flex gap-2 justify-content-end">
                            <input type="hidden" name="search" value="{{ request('search') }}">
                            <select name="status" class="form-control" style="max-width: 150px;" onchange="this.form.submit()">
                                <option value="">All Status</option>
                                <option value="active" {{ request('status') == 'active' ? 'selected' : '' }}>Active</option>
                                <option value="inactive" {{ request('status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                            </select>
                        </form>
                    </div>
                </div>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Name</th>
                        <th class="border-0">Parent</th>
                        <th class="border-0">Slug</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @foreach($categories as $key => $category)
                        <tr>
                            <td>{{ $categories->firstItem() + $key }}</td>
                            <td>
                                @if($category->image_url)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('category', $category->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $category->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/100x100/2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->name }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->parent ? $category->parent->name : '-' }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->slug }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $category->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $category->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this category?"
                                           data-title-off="Want to deactivate this category?"
                                           id="status-{{ $category->id }}" {{ $category->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.categories.status') }}" method="post" id="status-{{ $category->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $category->id }}">
                                    <input type="hidden" name="status" value="{{ $category->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.categories.edit', $category->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="category-{{ $category->id }}" 
                                       data-form-id="category-{{ $category->id }}"
                                       data-message="Want to delete this category?" 
                                       data-title="Delete Category"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.categories.destroy', $category->id) }}"
                                            method="post" id="category-{{ $category->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @endforeach
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                <div class="mt-3">
                    {{ $categories->links() }}
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                if (typeof PageLoader !== 'undefined') {
                    setTimeout(function() {
                        PageLoader.hide();
                    }, 300);
                }
            }
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        $(window).on('load', function() {
            setTimeout(function() {
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.hide();
                }
            }, 500);
        });
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.products'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .badge-express {
        background-color: #f0ad4e;
        color: #fff;
    }
    
    .search-filter-wrapper {
        display: flex;
        gap: 10px;
        align-items: flex-end;
        flex-wrap: wrap;
    }
    
    .search-filter-wrapper .form-group {
        margin-bottom: 0;
        flex: 1;
        min-width: 200px;
    }
    
    .search-filter-wrapper .form-group label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 5px;
        font-size: 0.875rem;
    }
    
    .search-filter-wrapper .btn {
        white-space: nowrap;
        height: fit-content;
    }
    
    @media (max-width: 768px) {
        .search-filter-wrapper {
            flex-direction: column;
        }
        
        .search-filter-wrapper .form-group {
            width: 100%;
        }
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-shop"></i>
                </span>
                <span>
                    {{ translate('messages.products') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.products') }} <span class="badge badge-soft-dark ml-2" id="product-count">{{ $products->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.products.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_product') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": true,
                             "pageLength": 25,
                             "lengthMenu": [[10, 25, 50, 100, -1], [10, 25, 50, 100, "All"]],
                             "searching": true,
                             "info": true,
                             "dom": "<\"row\"<\"col-sm-12 col-md-6\"l><\"col-sm-12 col-md-6\"f>>rtip"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Product Name</th>
                        <th class="border-0">Category</th>
                        <th class="border-0">Price</th>
                        <th class="border-0 text-center">Trending</th>
                        <th class="border-0 text-center">Latest</th>
                        <th class="border-0 text-center">Express-30</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @foreach($products as $key => $product)
                        <tr>
                            <td>{{ $products->firstItem() + $key }}</td>
                            <td>
                                @php
                                    $primaryImage = $product->images->where('is_primary', true)->first() ?? $product->images->first();
                                @endphp
                                @if($primaryImage)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $primaryImage->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $product->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/160x160/img2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ Str::limit($product->name, 30, '...') }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $product->category ? $product->category->name : '-' }}
                                </span>
                            </td>
                            <td>
                                @php
                                    $variant = $product->variants->first();
                                    $price = $variant ? ($variant->sale_price ?? $variant->price) : 0;
                                @endphp
                                <span class="d-block font-size-sm text-body">
                                    ‚Çπ{{ number_format($price, 2) }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="trending-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_trending"
                                           data-value="{{ $product->is_trending ? 0 : 1 }}"
                                           id="trending-{{ $product->id }}" {{ $product->is_trending ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="latest-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_latest"
                                           data-value="{{ $product->is_latest ? 0 : 1 }}"
                                           id="latest-{{ $product->id }}" {{ $product->is_latest ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="express-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_express_30"
                                           data-value="{{ $product->is_express_30 ? 0 : 1 }}"
                                           id="express-{{ $product->id }}" {{ $product->is_express_30 ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $product->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this product?"
                                           data-title-off="Want to deactivate this product?"
                                           id="status-{{ $product->id }}" {{ $product->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.products.status') }}" method="post" id="status-{{ $product->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $product->id }}">
                                    <input type="hidden" name="status" value="{{ $product->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.products.edit', $product->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="product-{{ $product->id }}" 
                                       data-form-id="product-{{ $product->id }}"
                                       data-message="Want to delete this product?" 
                                       data-title="Delete Product"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.products.destroy', $product->id) }}"
                                            method="post" id="product-{{ $product->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @endforeach
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                <div class="mt-3">
                    {{ $products->links() }}
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: true,
            info: true,
            order: [],
            orderCellsTop: true,
            dom: "<'row'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'f>>rt<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
                lengthMenu: "Show _MENU_ entries",
                search: "Search:",
                info: "Showing _START_ to _END_ of _TOTAL_ entries",
                infoEmpty: "Showing 0 to 0 of 0 entries",
                infoFiltered: "(filtered from _MAX_ total entries)",
            },
            initComplete: function() {
                if (typeof PageLoader !== 'undefined') {
                    setTimeout(function() {
                        PageLoader.hide();
                    }, 300);
                }
            }
        });
        
        table.on('draw', function () {
            var info = table.page.info();
            $('#product-count').text(info.recordsTotal);
        });
        
        setTimeout(function() {
            $('.dataTables_length').css({'display': 'block', 'visibility': 'visible'});
            $('.dataTables_filter').css({'display': 'block', 'visibility': 'visible'});
            $('.dataTables_info').css({'display': 'block', 'visibility': 'visible'});
        }, 200);
        
        // Handle flag toggles
        $(document).on('change', '.flag-toggle', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $checkbox = $(this);
            var productId = $checkbox.data('id');
            var flag = $checkbox.data('flag');
            var value = $checkbox.data('value');
            
            $.ajax({
                url: '{{ route('admin.products.flag') }}',
                method: 'POST',
                data: {
                    _token: '{{ csrf_token() }}',
                    id: productId,
                    flag: flag,
                    value: value
                },
                success: function(response) {
                    // Update the data-value for next toggle
                    $checkbox.data('value', value == 1 ? 0 : 1);
                },
                error: function(xhr) {
                    // Revert checkbox
                    $checkbox.prop('checked', !$checkbox.prop('checked'));
                    alert('Failed to update flag. Please try again.');
                }
            });
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        $(window).on('load', function() {
            setTimeout(function() {
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.hide();
                }
            }, 500);
        });
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.products'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .badge-express {
        background-color: #f0ad4e;
        color: #fff;
    }
    
    .search-filter-wrapper {
        display: flex;
        gap: 10px;
        align-items: flex-end;
        flex-wrap: wrap;
    }
    
    .search-filter-wrapper .form-group {
        margin-bottom: 0;
        flex: 1;
        min-width: 200px;
    }
    
    .search-filter-wrapper .form-group label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 5px;
        font-size: 0.875rem;
    }
    
    .search-filter-wrapper .btn {
        white-space: nowrap;
        height: fit-content;
    }
    
    @media (max-width: 768px) {
        .search-filter-wrapper {
            flex-direction: column;
        }
        
        .search-filter-wrapper .form-group {
            width: 100%;
        }
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-shop"></i>
                </span>
                <span>
                    {{ translate('messages.products') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.products') }} <span class="badge badge-soft-dark ml-2" id="product-count">{{ $products->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.products.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_product') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.products.index') }}" class="mb-3">
                    <div class="search-filter-wrapper">
                        <div class="form-group">
                            <label for="search">Search Products</label>
                            <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or description..." value="{{ request('search') }}">
                        </div>
                        <div class="form-group">
                            <label for="category_id">Filter by Category</label>
                            <select name="category_id" id="category_id" class="form-control">
                                <option value="">All Categories</option>
                                @foreach($categories as $category)
                                    <option value="{{ $category->id }}" {{ request('category_id') == $category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                @endforeach
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status">Status</label>
                            <select name="status" id="status" class="form-control">
                                <option value="">All Status</option>
                                <option value="active" {{ request('status') == 'active' ? 'selected' : '' }}>Active</option>
                                <option value="inactive" {{ request('status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn--primary">
                                    <i class="tio-search"></i> Search
                                </button>
                                @if(request('search') || request('category_id') || request('status'))
                                    <a href="{{ route('admin.products.index') }}" class="btn btn--reset">
                                        <i class="tio-clear"></i> Clear
                                    </a>
                                @endif
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Product Name</th>
                        <th class="border-0">Category</th>
                        <th class="border-0">Price</th>
                        <th class="border-0 text-center">Trending</th>
                        <th class="border-0 text-center">Latest</th>
                        <th class="border-0 text-center">Express-30</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @foreach($products as $key => $product)
                        <tr>
                            <td>{{ $products->firstItem() + $key }}</td>
                            <td>
                                @php
                                    $primaryImage = $product->images->where('is_primary', true)->first() ?? $product->images->first();
                                @endphp
                                @if($primaryImage)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $primaryImage->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $product->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/160x160/img2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ Str::limit($product->name, 30, '...') }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $product->category ? $product->category->name : '-' }}
                                </span>
                            </td>
                            <td>
                                @php
                                    $variant = $product->variants->first();
                                    $price = $variant ? ($variant->sale_price ?? $variant->price) : 0;
                                @endphp
                                <span class="d-block font-size-sm text-body">
                                    ‚Çπ{{ number_format($price, 2) }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="trending-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_trending"
                                           data-value="{{ $product->is_trending ? 0 : 1 }}"
                                           id="trending-{{ $product->id }}" {{ $product->is_trending ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="latest-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_latest"
                                           data-value="{{ $product->is_latest ? 0 : 1 }}"
                                           id="latest-{{ $product->id }}" {{ $product->is_latest ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="express-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_express_30"
                                           data-value="{{ $product->is_express_30 ? 0 : 1 }}"
                                           id="express-{{ $product->id }}" {{ $product->is_express_30 ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $product->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this product?"
                                           data-title-off="Want to deactivate this product?"
                                           id="status-{{ $product->id }}" {{ $product->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.products.status') }}" method="post" id="status-{{ $product->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $product->id }}">
                                    <input type="hidden" name="status" value="{{ $product->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.products.edit', $product->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="product-{{ $product->id }}" 
                                       data-form-id="product-{{ $product->id }}"
                                       data-message="Want to delete this product?" 
                                       data-title="Delete Product"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.products.destroy', $product->id) }}"
                                            method="post" id="product-{{ $product->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @endforeach
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                <div class="mt-3">
                    {{ $products->links() }}
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: true,
            info: true,
            order: [],
            orderCellsTop: true,
            dom: "<'row'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'f>>rt<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
                lengthMenu: "Show _MENU_ entries",
                search: "Search:",
                info: "Showing _START_ to _END_ of _TOTAL_ entries",
                infoEmpty: "Showing 0 to 0 of 0 entries",
                infoFiltered: "(filtered from _MAX_ total entries)",
            },
            initComplete: function() {
                if (typeof PageLoader !== 'undefined') {
                    setTimeout(function() {
                        PageLoader.hide();
                    }, 300);
                }
            }
        });
        
        table.on('draw', function () {
            var info = table.page.info();
            $('#product-count').text(info.recordsTotal);
        });
        
        setTimeout(function() {
            $('.dataTables_length').css({'display': 'block', 'visibility': 'visible'});
            $('.dataTables_filter').css({'display': 'block', 'visibility': 'visible'});
            $('.dataTables_info').css({'display': 'block', 'visibility': 'visible'});
        }, 200);
        
        // Handle flag toggles
        $(document).on('change', '.flag-toggle', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $checkbox = $(this);
            var productId = $checkbox.data('id');
            var flag = $checkbox.data('flag');
            var value = $checkbox.data('value');
            
            $.ajax({
                url: '{{ route('admin.products.flag') }}',
                method: 'POST',
                data: {
                    _token: '{{ csrf_token() }}',
                    id: productId,
                    flag: flag,
                    value: value
                },
                success: function(response) {
                    // Update the data-value for next toggle
                    $checkbox.data('value', value == 1 ? 0 : 1);
                },
                error: function(xhr) {
                    // Revert checkbox
                    $checkbox.prop('checked', !$checkbox.prop('checked'));
                    alert('Failed to update flag. Please try again.');
                }
            });
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        $(window).on('load', function() {
            setTimeout(function() {
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.hide();
                }
            }, 500);
        });
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.products'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .badge-express {
        background-color: #f0ad4e;
        color: #fff;
    }
    
    .search-filter-wrapper {
        display: flex;
        gap: 10px;
        align-items: flex-end;
        flex-wrap: wrap;
    }
    
    .search-filter-wrapper .form-group {
        margin-bottom: 0;
        flex: 1;
        min-width: 200px;
    }
    
    .search-filter-wrapper .form-group label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 5px;
        font-size: 0.875rem;
    }
    
    .search-filter-wrapper .btn {
        white-space: nowrap;
        height: fit-content;
    }
    
    @media (max-width: 768px) {
        .search-filter-wrapper {
            flex-direction: column;
        }
        
        .search-filter-wrapper .form-group {
            width: 100%;
        }
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-shop"></i>
                </span>
                <span>
                    {{ translate('messages.products') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.products') }} <span class="badge badge-soft-dark ml-2" id="product-count">{{ $products->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.products.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_product') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.products.index') }}" class="mb-3">
                    <div class="search-filter-wrapper">
                        <div class="form-group">
                            <label for="search">Search Products</label>
                            <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or description..." value="{{ request('search') }}">
                        </div>
                        <div class="form-group">
                            <label for="category_id">Filter by Category</label>
                            <select name="category_id" id="category_id" class="form-control">
                                <option value="">All Categories</option>
                                @foreach($categories as $category)
                                    <option value="{{ $category->id }}" {{ request('category_id') == $category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                @endforeach
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status">Status</label>
                            <select name="status" id="status" class="form-control">
                                <option value="">All Status</option>
                                <option value="active" {{ request('status') == 'active' ? 'selected' : '' }}>Active</option>
                                <option value="inactive" {{ request('status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn--primary">
                                    <i class="tio-search"></i> Search
                                </button>
                                @if(request('search') || request('category_id') || request('status'))
                                    <a href="{{ route('admin.products.index') }}" class="btn btn--reset">
                                        <i class="tio-clear"></i> Clear
                                    </a>
                                @endif
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Product Name</th>
                        <th class="border-0">Category</th>
                        <th class="border-0">Price</th>
                        <th class="border-0 text-center">Trending</th>
                        <th class="border-0 text-center">Latest</th>
                        <th class="border-0 text-center">Express-30</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @foreach($products as $key => $product)
                        <tr>
                            <td>{{ $products->firstItem() + $key }}</td>
                            <td>
                                @php
                                    $primaryImage = $product->images->where('is_primary', true)->first() ?? $product->images->first();
                                @endphp
                                @if($primaryImage)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $primaryImage->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $product->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/160x160/img2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ Str::limit($product->name, 30, '...') }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $product->category ? $product->category->name : '-' }}
                                </span>
                            </td>
                            <td>
                                @php
                                    $variant = $product->variants->first();
                                    $price = $variant ? ($variant->sale_price ?? $variant->price) : 0;
                                @endphp
                                <span class="d-block font-size-sm text-body">
                                    ‚Çπ{{ number_format($price, 2) }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="trending-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_trending"
                                           data-value="{{ $product->is_trending ? 0 : 1 }}"
                                           id="trending-{{ $product->id }}" {{ $product->is_trending ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="latest-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_latest"
                                           data-value="{{ $product->is_latest ? 0 : 1 }}"
                                           id="latest-{{ $product->id }}" {{ $product->is_latest ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="express-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_express_30"
                                           data-value="{{ $product->is_express_30 ? 0 : 1 }}"
                                           id="express-{{ $product->id }}" {{ $product->is_express_30 ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $product->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this product?"
                                           data-title-off="Want to deactivate this product?"
                                           id="status-{{ $product->id }}" {{ $product->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.products.status') }}" method="post" id="status-{{ $product->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $product->id }}">
                                    <input type="hidden" name="status" value="{{ $product->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.products.edit', $product->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="product-{{ $product->id }}" 
                                       data-form-id="product-{{ $product->id }}"
                                       data-message="Want to delete this product?" 
                                       data-title="Delete Product"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.products.destroy', $product->id) }}"
                                            method="post" id="product-{{ $product->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @endforeach
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                <div class="mt-3">
                    {{ $products->links() }}
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                if (typeof PageLoader !== 'undefined') {
                    setTimeout(function() {
                        PageLoader.hide();
                    }, 300);
                }
            }
        });
        
        // Handle flag toggles
        $(document).on('change', '.flag-toggle', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $checkbox = $(this);
            var productId = $checkbox.data('id');
            var flag = $checkbox.data('flag');
            var value = $checkbox.data('value');
            
            $.ajax({
                url: '{{ route('admin.products.flag') }}',
                method: 'POST',
                data: {
                    _token: '{{ csrf_token() }}',
                    id: productId,
                    flag: flag,
                    value: value
                },
                success: function(response) {
                    // Update the data-value for next toggle
                    $checkbox.data('value', value == 1 ? 0 : 1);
                },
                error: function(xhr) {
                    // Revert checkbox
                    $checkbox.prop('checked', !$checkbox.prop('checked'));
                    alert('Failed to update flag. Please try again.');
                }
            });
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        $(window).on('load', function() {
            setTimeout(function() {
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.hide();
                }
            }, 500);
        });
    });
</script>
@endpush


```


Updating pagination links to preserve filter parameters. Checking the pagination implementation:


```blade
@extends('layouts.admin.app')

@section('title', translate('messages.categories'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .dataTables_wrapper .dataTables_length label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .dataTables_wrapper .dataTables_length select {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 80px;
    }
    
    .dataTables_wrapper .dataTables_filter {
        text-align: right;
    }
    
    .dataTables_wrapper .dataTables_filter label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: flex-end;
    }
    
    .dataTables_wrapper .dataTables_filter input {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 200px;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-category"></i>
                </span>
                <span>
                    {{ translate('messages.categories') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.categories') }} <span class="badge badge-soft-dark ml-2" id="category-count">{{ $categories->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.categories.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_category') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <form method="GET" action="{{ route('admin.categories.index') }}" class="d-flex gap-2">
                            <div class="flex-grow-1">
                                <input type="text" name="search" class="form-control" placeholder="Search categories..." value="{{ request('search') }}">
                            </div>
                            <button type="submit" class="btn btn--primary">
                                <i class="tio-search"></i> Search
                            </button>
                            @if(request('search') || request('status') || request('parent_id'))
                                <a href="{{ route('admin.categories.index') }}" class="btn btn--reset">
                                    <i class="tio-clear"></i> Clear
                                </a>
                            @endif
                        </form>
                    </div>
                    <div class="col-md-6 text-right">
                        <form method="GET" action="{{ route('admin.categories.index') }}" class="d-flex gap-2 justify-content-end">
                            <input type="hidden" name="search" value="{{ request('search') }}">
                            <select name="status" class="form-control" style="max-width: 150px;" onchange="this.form.submit()">
                                <option value="">All Status</option>
                                <option value="active" {{ request('status') == 'active' ? 'selected' : '' }}>Active</option>
                                <option value="inactive" {{ request('status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                            </select>
                        </form>
                    </div>
                </div>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Name</th>
                        <th class="border-0">Parent</th>
                        <th class="border-0">Slug</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @foreach($categories as $key => $category)
                        <tr>
                            <td>{{ $categories->firstItem() + $key }}</td>
                            <td>
                                @if($category->image_url)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('category', $category->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $category->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/100x100/2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->name }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->parent ? $category->parent->name : '-' }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->slug }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $category->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $category->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this category?"
                                           data-title-off="Want to deactivate this category?"
                                           id="status-{{ $category->id }}" {{ $category->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.categories.status') }}" method="post" id="status-{{ $category->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $category->id }}">
                                    <input type="hidden" name="status" value="{{ $category->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.categories.edit', $category->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="category-{{ $category->id }}" 
                                       data-form-id="category-{{ $category->id }}"
                                       data-message="Want to delete this category?" 
                                       data-title="Delete Category"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.categories.destroy', $category->id) }}"
                                            method="post" id="category-{{ $category->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @endforeach
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                <div class="mt-3">
                    {{ $categories->appends(request()->query())->links() }}
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                if (typeof PageLoader !== 'undefined') {
                    setTimeout(function() {
                        PageLoader.hide();
                    }, 300);
                }
            }
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        $(window).on('load', function() {
            setTimeout(function() {
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.hide();
                }
            }, 500);
        });
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.products'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .badge-express {
        background-color: #f0ad4e;
        color: #fff;
    }
    
    .search-filter-wrapper {
        display: flex;
        gap: 10px;
        align-items: flex-end;
        flex-wrap: wrap;
    }
    
    .search-filter-wrapper .form-group {
        margin-bottom: 0;
        flex: 1;
        min-width: 200px;
    }
    
    .search-filter-wrapper .form-group label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 5px;
        font-size: 0.875rem;
    }
    
    .search-filter-wrapper .btn {
        white-space: nowrap;
        height: fit-content;
    }
    
    @media (max-width: 768px) {
        .search-filter-wrapper {
            flex-direction: column;
        }
        
        .search-filter-wrapper .form-group {
            width: 100%;
        }
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-shop"></i>
                </span>
                <span>
                    {{ translate('messages.products') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.products') }} <span class="badge badge-soft-dark ml-2" id="product-count">{{ $products->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.products.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_product') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.products.index') }}" class="mb-3">
                    <div class="search-filter-wrapper">
                        <div class="form-group">
                            <label for="search">Search Products</label>
                            <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or description..." value="{{ request('search') }}">
                        </div>
                        <div class="form-group">
                            <label for="category_id">Filter by Category</label>
                            <select name="category_id" id="category_id" class="form-control">
                                <option value="">All Categories</option>
                                @foreach($categories as $category)
                                    <option value="{{ $category->id }}" {{ request('category_id') == $category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                @endforeach
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status">Status</label>
                            <select name="status" id="status" class="form-control">
                                <option value="">All Status</option>
                                <option value="active" {{ request('status') == 'active' ? 'selected' : '' }}>Active</option>
                                <option value="inactive" {{ request('status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn--primary">
                                    <i class="tio-search"></i> Search
                                </button>
                                @if(request('search') || request('category_id') || request('status'))
                                    <a href="{{ route('admin.products.index') }}" class="btn btn--reset">
                                        <i class="tio-clear"></i> Clear
                                    </a>
                                @endif
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Product Name</th>
                        <th class="border-0">Category</th>
                        <th class="border-0">Price</th>
                        <th class="border-0 text-center">Trending</th>
                        <th class="border-0 text-center">Latest</th>
                        <th class="border-0 text-center">Express-30</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @foreach($products as $key => $product)
                        <tr>
                            <td>{{ $products->firstItem() + $key }}</td>
                            <td>
                                @php
                                    $primaryImage = $product->images->where('is_primary', true)->first() ?? $product->images->first();
                                @endphp
                                @if($primaryImage)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $primaryImage->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $product->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/160x160/img2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ Str::limit($product->name, 30, '...') }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $product->category ? $product->category->name : '-' }}
                                </span>
                            </td>
                            <td>
                                @php
                                    $variant = $product->variants->first();
                                    $price = $variant ? ($variant->sale_price ?? $variant->price) : 0;
                                @endphp
                                <span class="d-block font-size-sm text-body">
                                    ‚Çπ{{ number_format($price, 2) }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="trending-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_trending"
                                           data-value="{{ $product->is_trending ? 0 : 1 }}"
                                           id="trending-{{ $product->id }}" {{ $product->is_trending ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="latest-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_latest"
                                           data-value="{{ $product->is_latest ? 0 : 1 }}"
                                           id="latest-{{ $product->id }}" {{ $product->is_latest ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="express-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_express_30"
                                           data-value="{{ $product->is_express_30 ? 0 : 1 }}"
                                           id="express-{{ $product->id }}" {{ $product->is_express_30 ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $product->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this product?"
                                           data-title-off="Want to deactivate this product?"
                                           id="status-{{ $product->id }}" {{ $product->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.products.status') }}" method="post" id="status-{{ $product->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $product->id }}">
                                    <input type="hidden" name="status" value="{{ $product->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.products.edit', $product->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="product-{{ $product->id }}" 
                                       data-form-id="product-{{ $product->id }}"
                                       data-message="Want to delete this product?" 
                                       data-title="Delete Product"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.products.destroy', $product->id) }}"
                                            method="post" id="product-{{ $product->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @endforeach
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                <div class="mt-3">
                    {{ $products->appends(request()->query())->links() }}
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                if (typeof PageLoader !== 'undefined') {
                    setTimeout(function() {
                        PageLoader.hide();
                    }, 300);
                }
            }
        });
        
        // Handle flag toggles
        $(document).on('change', '.flag-toggle', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $checkbox = $(this);
            var productId = $checkbox.data('id');
            var flag = $checkbox.data('flag');
            var value = $checkbox.data('value');
            
            $.ajax({
                url: '{{ route('admin.products.flag') }}',
                method: 'POST',
                data: {
                    _token: '{{ csrf_token() }}',
                    id: productId,
                    flag: flag,
                    value: value
                },
                success: function(response) {
                    // Update the data-value for next toggle
                    $checkbox.data('value', value == 1 ? 0 : 1);
                },
                error: function(xhr) {
                    // Revert checkbox
                    $checkbox.prop('checked', !$checkbox.prop('checked'));
                    alert('Failed to update flag. Please try again.');
                }
            });
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        $(window).on('load', function() {
            setTimeout(function() {
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.hide();
                }
            }, 500);
        });
    });
</script>
@endpush


```


Adding an empty state message when there are no results:


```blade
@extends('layouts.admin.app')

@section('title', translate('messages.categories'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .dataTables_wrapper .dataTables_length label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .dataTables_wrapper .dataTables_length select {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 80px;
    }
    
    .dataTables_wrapper .dataTables_filter {
        text-align: right;
    }
    
    .dataTables_wrapper .dataTables_filter label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: flex-end;
    }
    
    .dataTables_wrapper .dataTables_filter input {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 200px;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-category"></i>
                </span>
                <span>
                    {{ translate('messages.categories') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.categories') }} <span class="badge badge-soft-dark ml-2" id="category-count">{{ $categories->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.categories.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_category') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <form method="GET" action="{{ route('admin.categories.index') }}" class="d-flex gap-2">
                            <div class="flex-grow-1">
                                <input type="text" name="search" class="form-control" placeholder="Search categories..." value="{{ request('search') }}">
                            </div>
                            <button type="submit" class="btn btn--primary">
                                <i class="tio-search"></i> Search
                            </button>
                            @if(request('search') || request('status') || request('parent_id'))
                                <a href="{{ route('admin.categories.index') }}" class="btn btn--reset">
                                    <i class="tio-clear"></i> Clear
                                </a>
                            @endif
                        </form>
                    </div>
                    <div class="col-md-6 text-right">
                        <form method="GET" action="{{ route('admin.categories.index') }}" class="d-flex gap-2 justify-content-end">
                            <input type="hidden" name="search" value="{{ request('search') }}">
                            <select name="status" class="form-control" style="max-width: 150px;" onchange="this.form.submit()">
                                <option value="">All Status</option>
                                <option value="active" {{ request('status') == 'active' ? 'selected' : '' }}>Active</option>
                                <option value="inactive" {{ request('status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                            </select>
                        </form>
                    </div>
                </div>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Name</th>
                        <th class="border-0">Parent</th>
                        <th class="border-0">Slug</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($categories as $key => $category)
                        <tr>
                            <td>{{ $categories->firstItem() + $key }}</td>
                            <td>
                                @if($category->image_url)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('category', $category->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $category->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/100x100/2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->name }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->parent ? $category->parent->name : '-' }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->slug }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $category->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $category->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this category?"
                                           data-title-off="Want to deactivate this category?"
                                           id="status-{{ $category->id }}" {{ $category->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.categories.status') }}" method="post" id="status-{{ $category->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $category->id }}">
                                    <input type="hidden" name="status" value="{{ $category->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.categories.edit', $category->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="category-{{ $category->id }}" 
                                       data-form-id="category-{{ $category->id }}"
                                       data-message="Want to delete this category?" 
                                       data-title="Delete Category"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.categories.destroy', $category->id) }}"
                                            method="post" id="category-{{ $category->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @endforeach
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                <div class="mt-3">
                    {{ $categories->appends(request()->query())->links() }}
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                if (typeof PageLoader !== 'undefined') {
                    setTimeout(function() {
                        PageLoader.hide();
                    }, 300);
                }
            }
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        $(window).on('load', function() {
            setTimeout(function() {
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.hide();
                }
            }, 500);
        });
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.categories'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .dataTables_wrapper .dataTables_length label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .dataTables_wrapper .dataTables_length select {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 80px;
    }
    
    .dataTables_wrapper .dataTables_filter {
        text-align: right;
    }
    
    .dataTables_wrapper .dataTables_filter label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: flex-end;
    }
    
    .dataTables_wrapper .dataTables_filter input {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 200px;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-category"></i>
                </span>
                <span>
                    {{ translate('messages.categories') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.categories') }} <span class="badge badge-soft-dark ml-2" id="category-count">{{ $categories->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.categories.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_category') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <form method="GET" action="{{ route('admin.categories.index') }}" class="d-flex gap-2">
                            <div class="flex-grow-1">
                                <input type="text" name="search" class="form-control" placeholder="Search categories..." value="{{ request('search') }}">
                            </div>
                            <button type="submit" class="btn btn--primary">
                                <i class="tio-search"></i> Search
                            </button>
                            @if(request('search') || request('status') || request('parent_id'))
                                <a href="{{ route('admin.categories.index') }}" class="btn btn--reset">
                                    <i class="tio-clear"></i> Clear
                                </a>
                            @endif
                        </form>
                    </div>
                    <div class="col-md-6 text-right">
                        <form method="GET" action="{{ route('admin.categories.index') }}" class="d-flex gap-2 justify-content-end">
                            <input type="hidden" name="search" value="{{ request('search') }}">
                            <select name="status" class="form-control" style="max-width: 150px;" onchange="this.form.submit()">
                                <option value="">All Status</option>
                                <option value="active" {{ request('status') == 'active' ? 'selected' : '' }}>Active</option>
                                <option value="inactive" {{ request('status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                            </select>
                        </form>
                    </div>
                </div>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Name</th>
                        <th class="border-0">Parent</th>
                        <th class="border-0">Slug</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($categories as $key => $category)
                        <tr>
                            <td>{{ $categories->firstItem() + $key }}</td>
                            <td>
                                @if($category->image_url)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('category', $category->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $category->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/100x100/2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->name }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->parent ? $category->parent->name : '-' }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->slug }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $category->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $category->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this category?"
                                           data-title-off="Want to deactivate this category?"
                                           id="status-{{ $category->id }}" {{ $category->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.categories.status') }}" method="post" id="status-{{ $category->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $category->id }}">
                                    <input type="hidden" name="status" value="{{ $category->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.categories.edit', $category->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="category-{{ $category->id }}" 
                                       data-form-id="category-{{ $category->id }}"
                                       data-message="Want to delete this category?" 
                                       data-title="Delete Category"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.categories.destroy', $category->id) }}"
                                            method="post" id="category-{{ $category->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr>
                            <td colspan="7" class="text-center py-4">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5>{{ translate('no_data_found') }}</h5>
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                <div class="mt-3">
                    {{ $categories->appends(request()->query())->links() }}
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                if (typeof PageLoader !== 'undefined') {
                    setTimeout(function() {
                        PageLoader.hide();
                    }, 300);
                }
            }
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        $(window).on('load', function() {
            setTimeout(function() {
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.hide();
                }
            }, 500);
        });
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.products'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .badge-express {
        background-color: #f0ad4e;
        color: #fff;
    }
    
    .search-filter-wrapper {
        display: flex;
        gap: 10px;
        align-items: flex-end;
        flex-wrap: wrap;
    }
    
    .search-filter-wrapper .form-group {
        margin-bottom: 0;
        flex: 1;
        min-width: 200px;
    }
    
    .search-filter-wrapper .form-group label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 5px;
        font-size: 0.875rem;
    }
    
    .search-filter-wrapper .btn {
        white-space: nowrap;
        height: fit-content;
    }
    
    @media (max-width: 768px) {
        .search-filter-wrapper {
            flex-direction: column;
        }
        
        .search-filter-wrapper .form-group {
            width: 100%;
        }
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-shop"></i>
                </span>
                <span>
                    {{ translate('messages.products') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.products') }} <span class="badge badge-soft-dark ml-2" id="product-count">{{ $products->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.products.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_product') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.products.index') }}" class="mb-3">
                    <div class="search-filter-wrapper">
                        <div class="form-group">
                            <label for="search">Search Products</label>
                            <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or description..." value="{{ request('search') }}">
                        </div>
                        <div class="form-group">
                            <label for="category_id">Filter by Category</label>
                            <select name="category_id" id="category_id" class="form-control">
                                <option value="">All Categories</option>
                                @foreach($categories as $category)
                                    <option value="{{ $category->id }}" {{ request('category_id') == $category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                @endforeach
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status">Status</label>
                            <select name="status" id="status" class="form-control">
                                <option value="">All Status</option>
                                <option value="active" {{ request('status') == 'active' ? 'selected' : '' }}>Active</option>
                                <option value="inactive" {{ request('status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn--primary">
                                    <i class="tio-search"></i> Search
                                </button>
                                @if(request('search') || request('category_id') || request('status'))
                                    <a href="{{ route('admin.products.index') }}" class="btn btn--reset">
                                        <i class="tio-clear"></i> Clear
                                    </a>
                                @endif
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Product Name</th>
                        <th class="border-0">Category</th>
                        <th class="border-0">Price</th>
                        <th class="border-0 text-center">Trending</th>
                        <th class="border-0 text-center">Latest</th>
                        <th class="border-0 text-center">Express-30</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($products as $key => $product)
                        <tr>
                            <td>{{ $products->firstItem() + $key }}</td>
                            <td>
                                @php
                                    $primaryImage = $product->images->where('is_primary', true)->first() ?? $product->images->first();
                                @endphp
                                @if($primaryImage)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $primaryImage->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $product->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/160x160/img2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ Str::limit($product->name, 30, '...') }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $product->category ? $product->category->name : '-' }}
                                </span>
                            </td>
                            <td>
                                @php
                                    $variant = $product->variants->first();
                                    $price = $variant ? ($variant->sale_price ?? $variant->price) : 0;
                                @endphp
                                <span class="d-block font-size-sm text-body">
                                    ‚Çπ{{ number_format($price, 2) }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="trending-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_trending"
                                           data-value="{{ $product->is_trending ? 0 : 1 }}"
                                           id="trending-{{ $product->id }}" {{ $product->is_trending ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="latest-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_latest"
                                           data-value="{{ $product->is_latest ? 0 : 1 }}"
                                           id="latest-{{ $product->id }}" {{ $product->is_latest ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="express-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_express_30"
                                           data-value="{{ $product->is_express_30 ? 0 : 1 }}"
                                           id="express-{{ $product->id }}" {{ $product->is_express_30 ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $product->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this product?"
                                           data-title-off="Want to deactivate this product?"
                                           id="status-{{ $product->id }}" {{ $product->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.products.status') }}" method="post" id="status-{{ $product->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $product->id }}">
                                    <input type="hidden" name="status" value="{{ $product->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.products.edit', $product->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="product-{{ $product->id }}" 
                                       data-form-id="product-{{ $product->id }}"
                                       data-message="Want to delete this product?" 
                                       data-title="Delete Product"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.products.destroy', $product->id) }}"
                                            method="post" id="product-{{ $product->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @endforeach
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                <div class="mt-3">
                    {{ $products->appends(request()->query())->links() }}
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                if (typeof PageLoader !== 'undefined') {
                    setTimeout(function() {
                        PageLoader.hide();
                    }, 300);
                }
            }
        });
        
        // Handle flag toggles
        $(document).on('change', '.flag-toggle', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $checkbox = $(this);
            var productId = $checkbox.data('id');
            var flag = $checkbox.data('flag');
            var value = $checkbox.data('value');
            
            $.ajax({
                url: '{{ route('admin.products.flag') }}',
                method: 'POST',
                data: {
                    _token: '{{ csrf_token() }}',
                    id: productId,
                    flag: flag,
                    value: value
                },
                success: function(response) {
                    // Update the data-value for next toggle
                    $checkbox.data('value', value == 1 ? 0 : 1);
                },
                error: function(xhr) {
                    // Revert checkbox
                    $checkbox.prop('checked', !$checkbox.prop('checked'));
                    alert('Failed to update flag. Please try again.');
                }
            });
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        $(window).on('load', function() {
            setTimeout(function() {
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.hide();
                }
            }, 500);
        });
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.products'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .badge-express {
        background-color: #f0ad4e;
        color: #fff;
    }
    
    .search-filter-wrapper {
        display: flex;
        gap: 10px;
        align-items: flex-end;
        flex-wrap: wrap;
    }
    
    .search-filter-wrapper .form-group {
        margin-bottom: 0;
        flex: 1;
        min-width: 200px;
    }
    
    .search-filter-wrapper .form-group label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 5px;
        font-size: 0.875rem;
    }
    
    .search-filter-wrapper .btn {
        white-space: nowrap;
        height: fit-content;
    }
    
    @media (max-width: 768px) {
        .search-filter-wrapper {
            flex-direction: column;
        }
        
        .search-filter-wrapper .form-group {
            width: 100%;
        }
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-shop"></i>
                </span>
                <span>
                    {{ translate('messages.products') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.products') }} <span class="badge badge-soft-dark ml-2" id="product-count">{{ $products->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.products.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_product') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.products.index') }}" class="mb-3">
                    <div class="search-filter-wrapper">
                        <div class="form-group">
                            <label for="search">Search Products</label>
                            <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or description..." value="{{ request('search') }}">
                        </div>
                        <div class="form-group">
                            <label for="category_id">Filter by Category</label>
                            <select name="category_id" id="category_id" class="form-control">
                                <option value="">All Categories</option>
                                @foreach($categories as $category)
                                    <option value="{{ $category->id }}" {{ request('category_id') == $category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                @endforeach
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status">Status</label>
                            <select name="status" id="status" class="form-control">
                                <option value="">All Status</option>
                                <option value="active" {{ request('status') == 'active' ? 'selected' : '' }}>Active</option>
                                <option value="inactive" {{ request('status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn--primary">
                                    <i class="tio-search"></i> Search
                                </button>
                                @if(request('search') || request('category_id') || request('status'))
                                    <a href="{{ route('admin.products.index') }}" class="btn btn--reset">
                                        <i class="tio-clear"></i> Clear
                                    </a>
                                @endif
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Product Name</th>
                        <th class="border-0">Category</th>
                        <th class="border-0">Price</th>
                        <th class="border-0 text-center">Trending</th>
                        <th class="border-0 text-center">Latest</th>
                        <th class="border-0 text-center">Express-30</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($products as $key => $product)
                        <tr>
                            <td>{{ $products->firstItem() + $key }}</td>
                            <td>
                                @php
                                    $primaryImage = $product->images->where('is_primary', true)->first() ?? $product->images->first();
                                @endphp
                                @if($primaryImage)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $primaryImage->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $product->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/160x160/img2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ Str::limit($product->name, 30, '...') }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $product->category ? $product->category->name : '-' }}
                                </span>
                            </td>
                            <td>
                                @php
                                    $variant = $product->variants->first();
                                    $price = $variant ? ($variant->sale_price ?? $variant->price) : 0;
                                @endphp
                                <span class="d-block font-size-sm text-body">
                                    ‚Çπ{{ number_format($price, 2) }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="trending-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_trending"
                                           data-value="{{ $product->is_trending ? 0 : 1 }}"
                                           id="trending-{{ $product->id }}" {{ $product->is_trending ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="latest-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_latest"
                                           data-value="{{ $product->is_latest ? 0 : 1 }}"
                                           id="latest-{{ $product->id }}" {{ $product->is_latest ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="express-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_express_30"
                                           data-value="{{ $product->is_express_30 ? 0 : 1 }}"
                                           id="express-{{ $product->id }}" {{ $product->is_express_30 ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $product->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this product?"
                                           data-title-off="Want to deactivate this product?"
                                           id="status-{{ $product->id }}" {{ $product->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.products.status') }}" method="post" id="status-{{ $product->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $product->id }}">
                                    <input type="hidden" name="status" value="{{ $product->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.products.edit', $product->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="product-{{ $product->id }}" 
                                       data-form-id="product-{{ $product->id }}"
                                       data-message="Want to delete this product?" 
                                       data-title="Delete Product"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.products.destroy', $product->id) }}"
                                            method="post" id="product-{{ $product->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr>
                            <td colspan="10" class="text-center py-4">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5>{{ translate('no_data_found') }}</h5>
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                <div class="mt-3">
                    {{ $products->appends(request()->query())->links() }}
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                if (typeof PageLoader !== 'undefined') {
                    setTimeout(function() {
                        PageLoader.hide();
                    }, 300);
                }
            }
        });
        
        // Handle flag toggles
        $(document).on('change', '.flag-toggle', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $checkbox = $(this);
            var productId = $checkbox.data('id');
            var flag = $checkbox.data('flag');
            var value = $checkbox.data('value');
            
            $.ajax({
                url: '{{ route('admin.products.flag') }}',
                method: 'POST',
                data: {
                    _token: '{{ csrf_token() }}',
                    id: productId,
                    flag: flag,
                    value: value
                },
                success: function(response) {
                    // Update the data-value for next toggle
                    $checkbox.data('value', value == 1 ? 0 : 1);
                },
                error: function(xhr) {
                    // Revert checkbox
                    $checkbox.prop('checked', !$checkbox.prop('checked'));
                    alert('Failed to update flag. Please try again.');
                }
            });
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        $(window).on('load', function() {
            setTimeout(function() {
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.hide();
                }
            }, 500);
        });
    });
</script>
@endpush


```


## Changes Made

### 1. Pagination
- Using Laravel pagination with `appends()` to preserve filter parameters
- Disabled DataTables pagination to avoid conflicts
- Pagination links maintain search and filter values

### 2. Category filter in product listing
- Added a category dropdown filter next to the search box
- Filter works with search and status filters
- Clear button resets all filters

### 3. Search bar design
- Redesigned search/filter section with:
  - Labeled form fields
  - Responsive layout (stacks on mobile)
  - Consistent spacing and styling
  - Search, Category, and Status filters in one row
  - Clear button to reset filters

### 4. Additional improvements
- Added empty state messages when no results are found
- Improved responsive design for mobile devices
- Better visual hierarchy with proper labels

### Features
- Categories listing: Search + Status filter + Pagination
- Products listing: Search + Category filter + Status filter + Pagination
- All filters work together and persist across pagination
- Clean, consistent UI matching the admin theme

The listings now have proper pagination and filtering, and the search bar design is consistent and functional.

---

**User**

In both categories and products filter not working, means filter wise data not getting fix it

---

**Cursor**


Checking the filter implementation in the controllers and views to identify and fix the issue.



Fixing the filters: combining the search and filter forms so they work together, and updating the controller logic to handle empty values correctly.


```blade
@extends('layouts.admin.app')

@section('title', translate('messages.categories'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .dataTables_wrapper .dataTables_length label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .dataTables_wrapper .dataTables_length select {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 80px;
    }
    
    .dataTables_wrapper .dataTables_filter {
        text-align: right;
    }
    
    .dataTables_wrapper .dataTables_filter label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: flex-end;
    }
    
    .dataTables_wrapper .dataTables_filter input {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 200px;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-category"></i>
                </span>
                <span>
                    {{ translate('messages.categories') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.categories') }} <span class="badge badge-soft-dark ml-2" id="category-count">{{ $categories->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.categories.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_category') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.categories.index') }}" class="mb-3">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="search">Search Categories</label>
                                <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or slug..." value="{{ request('search') }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="status">Status</label>
                                <select name="status" id="status" class="form-control">
                                    <option value="">All Status</option>
                                    <option value="active" {{ request('status') == 'active' ? 'selected' : '' }}>Active</option>
                                    <option value="inactive" {{ request('status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="parent_id">Parent Category</label>
                                <select name="parent_id" id="parent_id" class="form-control">
                                    <option value="">All Categories</option>
                                    <option value="null" {{ request('parent_id') == 'null' ? 'selected' : '' }}>Main Categories Only</option>
                                    @foreach($parentCategories as $parent)
                                        <option value="{{ $parent->id }}" {{ request('parent_id') == $parent->id ? 'selected' : '' }}>{{ $parent->name }}</option>
                                    @endforeach
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <div class="d-flex gap-2">
                                    <button type="submit" class="btn btn--primary w-100">
                                        <i class="tio-search"></i> Filter
                                    </button>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--reset">
                                            <i class="tio-clear"></i>
                                        </a>
                                    @endif
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Name</th>
                        <th class="border-0">Parent</th>
                        <th class="border-0">Slug</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($categories as $key => $category)
                        <tr>
                            <td>{{ $categories->firstItem() + $key }}</td>
                            <td>
                                @if($category->image_url)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('category', $category->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $category->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/100x100/2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->name }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->parent ? $category->parent->name : '-' }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->slug }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $category->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $category->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this category?"
                                           data-title-off="Want to deactivate this category?"
                                           id="status-{{ $category->id }}" {{ $category->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.categories.status') }}" method="post" id="status-{{ $category->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $category->id }}">
                                    <input type="hidden" name="status" value="{{ $category->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.categories.edit', $category->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="category-{{ $category->id }}" 
                                       data-form-id="category-{{ $category->id }}"
                                       data-message="Want to delete this category?" 
                                       data-title="Delete Category"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.categories.destroy', $category->id) }}"
                                            method="post" id="category-{{ $category->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr>
                            <td colspan="7" class="text-center py-4">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5>{{ translate('no_data_found') }}</h5>
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                <div class="mt-3">
                    {{ $categories->appends(request()->query())->links() }}
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                if (typeof PageLoader !== 'undefined') {
                    setTimeout(function() {
                        PageLoader.hide();
                    }, 300);
                }
            }
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        $(window).on('load', function() {
            setTimeout(function() {
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.hide();
                }
            }, 500);
        });
    });
</script>
@endpush


```

```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Category;
use Illuminate\Http\Request;
use App\CentralLogics\ToastrWrapper as Toastr;
use App\CentralLogics\Helpers;
use Illuminate\Support\Str;

class CategoryController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index(Request $request)
    {
        $query = Category::query();
        
        // Search
        if ($request->filled('search')) {
            $search = $request->search;
            $query->where(function ($q) use ($search) {
                $q->where('name', 'like', "%{$search}%")
                    ->orWhere('slug', 'like', "%{$search}%");
            });
        }
        
        // Filter by status
        if ($request->filled('status')) {
            $query->where('status', $request->status);
        }
        
        // Filter by parent
        if ($request->filled('parent_id')) {
            if ($request->parent_id === 'null') {
                $query->whereNull('parent_id');
            } else {
                $query->where('parent_id', $request->parent_id);
            }
        }
        
        $categories = $query->with('parent')->orderBy('name', 'asc')->paginate(25);
        $parentCategories = Category::whereNull('parent_id')->where('status', 'active')->orderBy('name', 'asc')->get();
        
        return view('admin-views.categories.index', compact('categories', 'parentCategories'));
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        $parentCategories = Category::whereNull('parent_id')->where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.categories.create', compact('parentCategories'));
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'parent_id' => 'nullable|exists:categories,id',
                'image' => 'nullable|image|mimes:jpeg,jpg,png,gif,webp|max:2048',
                'icon' => 'nullable|image|mimes:jpeg,jpg,png,gif,webp|max:2048',
                'status' => 'required|in:active,inactive',
            ], [
                'name.required' => translate('messages.Category name is required!'),
                'parent_id.exists' => translate('messages.Parent category not found!'),
                'image.image' => translate('messages.Please upload image files only!'),
                'image.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'image.max' => translate('messages.Image size should be less than 2MB!'),
                'icon.image' => translate('messages.Please upload image files only!'),
                'icon.mimes' => translate('messages.Icon must be jpeg, jpg, png, gif, or webp!'),
                'icon.max' => translate('messages.Icon size should be less than 2MB!'),
                'status.required' => translate('messages.Status is required!'),
                'status.in' => translate('messages.Invalid status!'),
            ]);

            $category = new Category();
            $category->name = $request->name;
            $category->slug = Str::slug($request->name);
            $category->parent_id = $request->parent_id ?? null;
            $category->status = $request->status;

            // Handle image upload
            if ($request->hasFile('image')) {
                $image = $request->file('image');
                if ($image && $image->isValid()) {
                    try {
                        $extension = $image->getClientOriginalExtension();
                        $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                        $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                        
                        $imageName = Helpers::upload('category/', $format, $image);
                        
                        if ($imageName && $imageName !== 'def.png') {
                            $category->image_url = $imageName;
                        }
                    } catch (\Exception $e) {
                        \Log::error('Category image upload error: ' . $e->getMessage());
                        Toastr::error(translate('messages.failed_to_upload_image') . ': ' . $e->getMessage());
                        return back()->withInput();
                    }
                }
            }

            // Handle icon upload
            if ($request->hasFile('icon')) {
                $icon = $request->file('icon');
                if ($icon && $icon->isValid()) {
                    try {
                        $extension = $icon->getClientOriginalExtension();
                        $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                        $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                        
                        $iconName = Helpers::upload('category/', $format, $icon);
                        
                        if ($iconName && $iconName !== 'def.png') {
                            $category->icon_url = $iconName;
                        }
                    } catch (\Exception $e) {
                        \Log::error('Category icon upload error: ' . $e->getMessage());
                        Toastr::error(translate('messages.failed_to_upload_image') . ': ' . $e->getMessage());
                        return back()->withInput();
                    }
                }
            }

            $category->save();

            Toastr::success(translate('messages.category_added'));
            return redirect()->route('admin.categories.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_add_category') . ': ' . $e->getMessage());
            \Log::error('Category creation error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit($id)
    {
        $category = Category::findOrFail($id);
        $parentCategories = Category::whereNull('parent_id')
            ->where('status', 'active')
            ->where('id', '!=', $id)
            ->orderBy('name', 'asc')
            ->get();
        return view('admin-views.categories.edit', compact('category', 'parentCategories'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, $id)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'parent_id' => 'nullable|exists:categories,id|not_in:' . $id,
                'image' => 'nullable|image|mimes:jpeg,jpg,png,gif,webp|max:2048',
                'icon' => 'nullable|image|mimes:jpeg,jpg,png,gif,webp|max:2048',
                'status' => 'required|in:active,inactive',
            ], [
                'name.required' => translate('messages.Category name is required!'),
                'parent_id.exists' => translate('messages.Parent category not found!'),
                'parent_id.not_in' => translate('messages.Category cannot be its own parent!'),
                'image.image' => translate('messages.Please upload image files only!'),
                'image.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'image.max' => translate('messages.Image size should be less than 2MB!'),
                'icon.image' => translate('messages.Please upload image files only!'),
                'icon.mimes' => translate('messages.Icon must be jpeg, jpg, png, gif, or webp!'),
                'icon.max' => translate('messages.Icon size should be less than 2MB!'),
                'status.required' => translate('messages.Status is required!'),
                'status.in' => translate('messages.Invalid status!'),
            ]);

            $category = Category::findOrFail($id);
            $category->name = $request->name;
            $category->slug = Str::slug($request->name);
            $category->parent_id = $request->parent_id ?? null;
            $category->status = $request->status;

            // Handle image upload
            if ($request->hasFile('image')) {
                $image = $request->file('image');
                if ($image && $image->isValid()) {
                    try {
                        $extension = $image->getClientOriginalExtension();
                        $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                        $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                        
                        $imageName = Helpers::upload('category/', $format, $image);
                        
                        if ($imageName && $imageName !== 'def.png') {
                            // Delete old image if exists
                            if ($category->image_url) {
                                try {
                                    $storageType = Helpers::getDisk();
                                    if ($storageType === 's3') {
                                        \Storage::disk('s3')->delete('category/' . $category->image_url);
                                    } else {
                                        \Storage::disk('public')->delete('category/' . $category->image_url);
                                    }
                                } catch (\Exception $e) {
                                    \Log::warning('Failed to delete old category image: ' . $e->getMessage());
                                }
                            }
                            $category->image_url = $imageName;
                        }
                    } catch (\Exception $e) {
                        \Log::error('Category image upload error: ' . $e->getMessage());
                        Toastr::error(translate('messages.failed_to_upload_image') . ': ' . $e->getMessage());
                        return back()->withInput();
                    }
                }
            }

            // Handle icon upload
            if ($request->hasFile('icon')) {
                $icon = $request->file('icon');
                if ($icon && $icon->isValid()) {
                    try {
                        $extension = $icon->getClientOriginalExtension();
                        $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                        $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                        
                        $iconName = Helpers::upload('category/', $format, $icon);
                        
                        if ($iconName && $iconName !== 'def.png') {
                            // Delete old icon if exists
                            if ($category->icon_url) {
                                try {
                                    $storageType = Helpers::getDisk();
                                    if ($storageType === 's3') {
                                        \Storage::disk('s3')->delete('category/' . $category->icon_url);
                                    } else {
                                        \Storage::disk('public')->delete('category/' . $category->icon_url);
                                    }
                                } catch (\Exception $e) {
                                    \Log::warning('Failed to delete old category icon: ' . $e->getMessage());
                                }
                            }
                            $category->icon_url = $iconName;
                        }
                    } catch (\Exception $e) {
                        \Log::error('Category icon upload error: ' . $e->getMessage());
                        Toastr::error(translate('messages.failed_to_upload_image') . ': ' . $e->getMessage());
                        return back()->withInput();
                    }
                }
            }

            $category->save();

            Toastr::success(translate('messages.category_updated'));
            return redirect()->route('admin.categories.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_category') . ': ' . $e->getMessage());
            \Log::error('Category update error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy($id)
    {
        try {
            $category = Category::findOrFail($id);
            
            // Check if category has products
            if ($category->products()->count() > 0) {
                Toastr::error(translate('messages.Cannot delete category with products!'));
                return back();
            }
            
            // Check if category has children
            if ($category->children()->count() > 0) {
                Toastr::error(translate('messages.Cannot delete category with subcategories!'));
                return back();
            }
            
            // Delete images
            if ($category->image_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('category/' . $category->image_url);
                    } else {
                        \Storage::disk('public')->delete('category/' . $category->image_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete category image: ' . $e->getMessage());
                }
            }
            
            if ($category->icon_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('category/' . $category->icon_url);
                    } else {
                        \Storage::disk('public')->delete('category/' . $category->icon_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete category icon: ' . $e->getMessage());
                }
            }
            
            $category->delete();
            
            Toastr::success(translate('messages.category_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_category') . ': ' . $e->getMessage());
            \Log::error('Category deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle category status
     */
    public function statusToggle(Request $request)
    {
        try {
            $category = Category::findOrFail($request->id);
            $category->status = $request->status;
            $category->save();
            Toastr::success(translate('messages.category_status_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_status') . ': ' . $e->getMessage());
            \Log::error('Category status update error: ' . $e->getMessage());
            return back();
        }
    }
}


```

```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Product;
use App\Models\Category;
use App\Models\Brand;
use App\Models\ProductVariant;
use App\Models\ProductImage;
use Illuminate\Http\Request;
use App\CentralLogics\ToastrWrapper as Toastr;
use App\CentralLogics\Helpers;
use Illuminate\Support\Str;

class ProductController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index(Request $request)
    {
        $query = Product::with(['category', 'brand', 'variants', 'images']);
        
        // Search
        if ($request->filled('search')) {
            $search = $request->search;
            $query->where(function ($q) use ($search) {
                $q->where('name', 'like', "%{$search}%")
                    ->orWhere('description', 'like', "%{$search}%");
            });
        }
        
        // Filter by status
        if ($request->filled('status')) {
            $query->where('status', $request->status);
        }
        
        // Filter by category
        if ($request->filled('category_id')) {
            $query->where('category_id', $request->category_id);
        }
        
        // Filter by trending
        if ($request->filled('is_trending')) {
            $query->where('is_trending', $request->is_trending);
        }
        
        // Filter by latest
        if ($request->filled('is_latest')) {
            $query->where('is_latest', $request->is_latest);
        }
        
        // Filter by express_30
        if ($request->filled('is_express_30')) {
            $query->where('is_express_30', $request->is_express_30);
        }
        
        $products = $query->orderBy('created_at', 'desc')->paginate(25);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        
        return view('admin-views.products.index', compact('products', 'categories'));
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.create', compact('categories', 'brands'));
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Variant fields
                'variant_sku' => 'required|string|max:255',
                'variant_price' => 'required|numeric|min:0',
                'variant_sale_price' => 'nullable|numeric|min:0',
                'variant_status' => 'required|in:active,inactive',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:2048',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'variant_sku.required' => translate('messages.SKU is required!'),
                'variant_price.required' => translate('messages.Price is required!'),
                'variant_price.numeric' => translate('messages.Price must be a number!'),
                'variant_price.min' => translate('messages.Price must be greater than or equal to 0!'),
                'variant_sale_price.numeric' => translate('messages.Sale price must be a number!'),
                'variant_sale_price.min' => translate('messages.Sale price must be greater than or equal to 0!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 2MB!'),
            ]);

            // Check if SKU already exists
            if (ProductVariant::where('sku', $request->variant_sku)->exists()) {
                Toastr::error(translate('messages.SKU already exists!'));
                return back()->withInput();
            }

            // Create product
            $product = new Product();
            $product->name = $request->name;
            $product->slug = Str::slug($request->name) . '-' . uniqid();
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Create default variant
            $variant = new ProductVariant();
            $variant->product_id = $product->id;
            $variant->sku = $request->variant_sku;
            $variant->price = $request->variant_price;
            $variant->sale_price = $request->variant_sale_price ?? null;
            $variant->status = $request->variant_status;
            $variant->save();

            // Handle images
            if ($request->hasFile('images')) {
                $sortOrder = 0;
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant->id;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = ($sortOrder === 0) ? true : false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_added'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_add_product') . ': ' . $e->getMessage());
            \Log::error('Product creation error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit($id)
    {
        $product = Product::with(['category', 'brand', 'variants', 'images'])->findOrFail($id);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.edit', compact('product', 'categories', 'brands'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, $id)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:2048',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 2MB!'),
            ]);

            $product = Product::findOrFail($id);
            $product->name = $request->name;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Handle new images
            if ($request->hasFile('images')) {
                $existingImages = ProductImage::where('product_id', $product->id)->count();
                $sortOrder = $existingImages;
                
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $variant = $product->variants->first();
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant ? $variant->id : null;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_updated'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_product') . ': ' . $e->getMessage());
            \Log::error('Product update error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy($id)
    {
        try {
            $product = Product::findOrFail($id);
            
            // Delete product images
            foreach ($product->images as $image) {
                if ($image->image_url) {
                    try {
                        $storageType = Helpers::getDisk();
                        if ($storageType === 's3') {
                            \Storage::disk('s3')->delete('product/' . $image->image_url);
                        } else {
                            \Storage::disk('public')->delete('product/' . $image->image_url);
                        }
                    } catch (\Exception $e) {
                        \Log::warning('Failed to delete product image: ' . $e->getMessage());
                    }
                }
                $image->delete();
            }
            
            // Delete variants (this will cascade delete related data)
            $product->variants()->delete();
            
            $product->delete();
            
            Toastr::success(translate('messages.product_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_product') . ': ' . $e->getMessage());
            \Log::error('Product deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product status
     */
    public function statusToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $product->status = $request->status;
            $product->save();
            Toastr::success(translate('messages.product_status_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_status') . ': ' . $e->getMessage());
            \Log::error('Product status update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product flag (trending, latest, express_30)
     */
    public function flagToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $flag = $request->flag; // is_trending, is_latest, is_express_30
            
            if (!in_array($flag, ['is_trending', 'is_latest', 'is_express_30'])) {
                Toastr::error(translate('messages.Invalid flag!'));
                return back();
            }
            
            $product->$flag = $request->value;
            $product->save();
            
            Toastr::success(translate('messages.product_flag_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_flag') . ': ' . $e->getMessage());
            \Log::error('Product flag update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Delete product image
     */
    public function deleteImage($id)
    {
        try {
            $image = ProductImage::findOrFail($id);
            
            // Delete file
            if ($image->image_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('product/' . $image->image_url);
                    } else {
                        \Storage::disk('public')->delete('product/' . $image->image_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete product image file: ' . $e->getMessage());
                }
            }
            
            $image->delete();
            
            Toastr::success(translate('messages.image_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_image') . ': ' . $e->getMessage());
            \Log::error('Image deletion error: ' . $e->getMessage());
            return back();
        }
    }
}


```


Fixing the category_id comparison in the products view to handle type differences:


```blade
@extends('layouts.admin.app')

@section('title', translate('messages.products'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .badge-express {
        background-color: #f0ad4e;
        color: #fff;
    }
    
    .search-filter-wrapper {
        display: flex;
        gap: 10px;
        align-items: flex-end;
        flex-wrap: wrap;
    }
    
    .search-filter-wrapper .form-group {
        margin-bottom: 0;
        flex: 1;
        min-width: 200px;
    }
    
    .search-filter-wrapper .form-group label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 5px;
        font-size: 0.875rem;
    }
    
    .search-filter-wrapper .btn {
        white-space: nowrap;
        height: fit-content;
    }
    
    @media (max-width: 768px) {
        .search-filter-wrapper {
            flex-direction: column;
        }
        
        .search-filter-wrapper .form-group {
            width: 100%;
        }
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-shop"></i>
                </span>
                <span>
                    {{ translate('messages.products') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.products') }} <span class="badge badge-soft-dark ml-2" id="product-count">{{ $products->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.products.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_product') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.products.index') }}" class="mb-3">
                    <div class="search-filter-wrapper">
                        <div class="form-group">
                            <label for="search">Search Products</label>
                            <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or description..." value="{{ request('search') }}">
                        </div>
                        <div class="form-group">
                            <label for="category_id">Filter by Category</label>
                            <select name="category_id" id="category_id" class="form-control">
                                <option value="">All Categories</option>
                                @foreach($categories as $category)
                                    <option value="{{ $category->id }}" {{ request('category_id') == $category->id || (string)request('category_id') === (string)$category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                @endforeach
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status">Status</label>
                            <select name="status" id="status" class="form-control">
                                <option value="">All Status</option>
                                <option value="active" {{ request('status') == 'active' ? 'selected' : '' }}>Active</option>
                                <option value="inactive" {{ request('status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn--primary">
                                    <i class="tio-search"></i> Search
                                </button>
                                @if(request('search') || request('category_id') || request('status'))
                                    <a href="{{ route('admin.products.index') }}" class="btn btn--reset">
                                        <i class="tio-clear"></i> Clear
                                    </a>
                                @endif
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Product Name</th>
                        <th class="border-0">Category</th>
                        <th class="border-0">Price</th>
                        <th class="border-0 text-center">Trending</th>
                        <th class="border-0 text-center">Latest</th>
                        <th class="border-0 text-center">Express-30</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($products as $key => $product)
                        <tr>
                            <td>{{ $products->firstItem() + $key }}</td>
                            <td>
                                @php
                                    $primaryImage = $product->images->where('is_primary', true)->first() ?? $product->images->first();
                                @endphp
                                @if($primaryImage)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $primaryImage->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $product->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/160x160/img2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ Str::limit($product->name, 30, '...') }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $product->category ? $product->category->name : '-' }}
                                </span>
                            </td>
                            <td>
                                @php
                                    $variant = $product->variants->first();
                                    $price = $variant ? ($variant->sale_price ?? $variant->price) : 0;
                                @endphp
                                <span class="d-block font-size-sm text-body">
                                    ‚Çπ{{ number_format($price, 2) }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="trending-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_trending"
                                           data-value="{{ $product->is_trending ? 0 : 1 }}"
                                           id="trending-{{ $product->id }}" {{ $product->is_trending ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="latest-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_latest"
                                           data-value="{{ $product->is_latest ? 0 : 1 }}"
                                           id="latest-{{ $product->id }}" {{ $product->is_latest ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="express-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_express_30"
                                           data-value="{{ $product->is_express_30 ? 0 : 1 }}"
                                           id="express-{{ $product->id }}" {{ $product->is_express_30 ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $product->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this product?"
                                           data-title-off="Want to deactivate this product?"
                                           id="status-{{ $product->id }}" {{ $product->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.products.status') }}" method="post" id="status-{{ $product->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $product->id }}">
                                    <input type="hidden" name="status" value="{{ $product->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.products.edit', $product->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="product-{{ $product->id }}" 
                                       data-form-id="product-{{ $product->id }}"
                                       data-message="Want to delete this product?" 
                                       data-title="Delete Product"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.products.destroy', $product->id) }}"
                                            method="post" id="product-{{ $product->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr>
                            <td colspan="10" class="text-center py-4">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5>{{ translate('no_data_found') }}</h5>
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                <div class="mt-3">
                    {{ $products->appends(request()->query())->links() }}
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                if (typeof PageLoader !== 'undefined') {
                    setTimeout(function() {
                        PageLoader.hide();
                    }, 300);
                }
            }
        });
        
        // Handle flag toggles
        $(document).on('change', '.flag-toggle', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $checkbox = $(this);
            var productId = $checkbox.data('id');
            var flag = $checkbox.data('flag');
            var value = $checkbox.data('value');
            
            $.ajax({
                url: '{{ route('admin.products.flag') }}',
                method: 'POST',
                data: {
                    _token: '{{ csrf_token() }}',
                    id: productId,
                    flag: flag,
                    value: value
                },
                success: function(response) {
                    // Update the data-value for next toggle
                    $checkbox.data('value', value == 1 ? 0 : 1);
                },
                error: function(xhr) {
                    // Revert checkbox
                    $checkbox.prop('checked', !$checkbox.prop('checked'));
                    alert('Failed to update flag. Please try again.');
                }
            });
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        $(window).on('load', function() {
            setTimeout(function() {
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.hide();
                }
            }, 500);
        });
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.categories'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .dataTables_wrapper .dataTables_length label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .dataTables_wrapper .dataTables_length select {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 80px;
    }
    
    .dataTables_wrapper .dataTables_filter {
        text-align: right;
    }
    
    .dataTables_wrapper .dataTables_filter label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: flex-end;
    }
    
    .dataTables_wrapper .dataTables_filter input {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 200px;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-category"></i>
                </span>
                <span>
                    {{ translate('messages.categories') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.categories') }} <span class="badge badge-soft-dark ml-2" id="category-count">{{ $categories->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.categories.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_category') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.categories.index') }}" class="mb-3">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="search">Search Categories</label>
                                <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or slug..." value="{{ request('search') }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="status">Status</label>
                                <select name="status" id="status" class="form-control">
                                    <option value="">All Status</option>
                                    <option value="active" {{ request('status') == 'active' ? 'selected' : '' }}>Active</option>
                                    <option value="inactive" {{ request('status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="parent_id">Parent Category</label>
                                <select name="parent_id" id="parent_id" class="form-control">
                                    <option value="">All Categories</option>
                                    <option value="null" {{ request('parent_id') == 'null' ? 'selected' : '' }}>Main Categories Only</option>
                                    @foreach($parentCategories as $parent)
                                        <option value="{{ $parent->id }}" {{ request('parent_id') == $parent->id || (string)request('parent_id') === (string)$parent->id ? 'selected' : '' }}>{{ $parent->name }}</option>
                                    @endforeach
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <div class="d-flex gap-2">
                                    <button type="submit" class="btn btn--primary w-100">
                                        <i class="tio-search"></i> Filter
                                    </button>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--reset">
                                            <i class="tio-clear"></i>
                                        </a>
                                    @endif
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Name</th>
                        <th class="border-0">Parent</th>
                        <th class="border-0">Slug</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($categories as $key => $category)
                        <tr>
                            <td>{{ $categories->firstItem() + $key }}</td>
                            <td>
                                @if($category->image_url)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('category', $category->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $category->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/100x100/2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->name }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->parent ? $category->parent->name : '-' }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->slug }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $category->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $category->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this category?"
                                           data-title-off="Want to deactivate this category?"
                                           id="status-{{ $category->id }}" {{ $category->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.categories.status') }}" method="post" id="status-{{ $category->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $category->id }}">
                                    <input type="hidden" name="status" value="{{ $category->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.categories.edit', $category->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="category-{{ $category->id }}" 
                                       data-form-id="category-{{ $category->id }}"
                                       data-message="Want to delete this category?" 
                                       data-title="Delete Category"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.categories.destroy', $category->id) }}"
                                            method="post" id="category-{{ $category->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr>
                            <td colspan="7" class="text-center py-4">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5>{{ translate('no_data_found') }}</h5>
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                <div class="mt-3">
                    {{ $categories->appends(request()->query())->links() }}
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                if (typeof PageLoader !== 'undefined') {
                    setTimeout(function() {
                        PageLoader.hide();
                    }, 300);
                }
            }
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        $(window).on('load', function() {
            setTimeout(function() {
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.hide();
                }
            }, 500);
        });
    });
</script>
@endpush


```


Verifying the form structure and adding a test to ensure filters work. Also checking if we need to handle the category_id as an integer in the controller:


```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Product;
use App\Models\Category;
use App\Models\Brand;
use App\Models\ProductVariant;
use App\Models\ProductImage;
use Illuminate\Http\Request;
use App\CentralLogics\ToastrWrapper as Toastr;
use App\CentralLogics\Helpers;
use Illuminate\Support\Str;

class ProductController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index(Request $request)
    {
        $query = Product::with(['category', 'brand', 'variants', 'images']);
        
        // Search
        if ($request->filled('search')) {
            $search = $request->search;
            $query->where(function ($q) use ($search) {
                $q->where('name', 'like', "%{$search}%")
                    ->orWhere('description', 'like', "%{$search}%");
            });
        }
        
        // Filter by status
        if ($request->filled('status')) {
            $query->where('status', $request->status);
        }
        
        // Filter by category
        if ($request->filled('category_id')) {
            $query->where('category_id', (int)$request->category_id);
        }
        
        // Filter by trending
        if ($request->filled('is_trending')) {
            $query->where('is_trending', $request->is_trending);
        }
        
        // Filter by latest
        if ($request->filled('is_latest')) {
            $query->where('is_latest', $request->is_latest);
        }
        
        // Filter by express_30
        if ($request->filled('is_express_30')) {
            $query->where('is_express_30', $request->is_express_30);
        }
        
        $products = $query->orderBy('created_at', 'desc')->paginate(25);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        
        return view('admin-views.products.index', compact('products', 'categories'));
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.create', compact('categories', 'brands'));
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Variant fields
                'variant_sku' => 'required|string|max:255',
                'variant_price' => 'required|numeric|min:0',
                'variant_sale_price' => 'nullable|numeric|min:0',
                'variant_status' => 'required|in:active,inactive',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:2048',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'variant_sku.required' => translate('messages.SKU is required!'),
                'variant_price.required' => translate('messages.Price is required!'),
                'variant_price.numeric' => translate('messages.Price must be a number!'),
                'variant_price.min' => translate('messages.Price must be greater than or equal to 0!'),
                'variant_sale_price.numeric' => translate('messages.Sale price must be a number!'),
                'variant_sale_price.min' => translate('messages.Sale price must be greater than or equal to 0!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 2MB!'),
            ]);

            // Check if SKU already exists
            if (ProductVariant::where('sku', $request->variant_sku)->exists()) {
                Toastr::error(translate('messages.SKU already exists!'));
                return back()->withInput();
            }

            // Create product
            $product = new Product();
            $product->name = $request->name;
            $product->slug = Str::slug($request->name) . '-' . uniqid();
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Create default variant
            $variant = new ProductVariant();
            $variant->product_id = $product->id;
            $variant->sku = $request->variant_sku;
            $variant->price = $request->variant_price;
            $variant->sale_price = $request->variant_sale_price ?? null;
            $variant->status = $request->variant_status;
            $variant->save();

            // Handle images
            if ($request->hasFile('images')) {
                $sortOrder = 0;
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant->id;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = ($sortOrder === 0) ? true : false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_added'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_add_product') . ': ' . $e->getMessage());
            \Log::error('Product creation error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit($id)
    {
        $product = Product::with(['category', 'brand', 'variants', 'images'])->findOrFail($id);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.edit', compact('product', 'categories', 'brands'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, $id)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:2048',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 2MB!'),
            ]);

            $product = Product::findOrFail($id);
            $product->name = $request->name;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Handle new images
            if ($request->hasFile('images')) {
                $existingImages = ProductImage::where('product_id', $product->id)->count();
                $sortOrder = $existingImages;
                
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $variant = $product->variants->first();
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant ? $variant->id : null;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_updated'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_product') . ': ' . $e->getMessage());
            \Log::error('Product update error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy($id)
    {
        try {
            $product = Product::findOrFail($id);
            
            // Delete product images
            foreach ($product->images as $image) {
                if ($image->image_url) {
                    try {
                        $storageType = Helpers::getDisk();
                        if ($storageType === 's3') {
                            \Storage::disk('s3')->delete('product/' . $image->image_url);
                        } else {
                            \Storage::disk('public')->delete('product/' . $image->image_url);
                        }
                    } catch (\Exception $e) {
                        \Log::warning('Failed to delete product image: ' . $e->getMessage());
                    }
                }
                $image->delete();
            }
            
            // Delete variants (this will cascade delete related data)
            $product->variants()->delete();
            
            $product->delete();
            
            Toastr::success(translate('messages.product_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_product') . ': ' . $e->getMessage());
            \Log::error('Product deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product status
     */
    public function statusToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $product->status = $request->status;
            $product->save();
            Toastr::success(translate('messages.product_status_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_status') . ': ' . $e->getMessage());
            \Log::error('Product status update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product flag (trending, latest, express_30)
     */
    public function flagToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $flag = $request->flag; // is_trending, is_latest, is_express_30
            
            if (!in_array($flag, ['is_trending', 'is_latest', 'is_express_30'])) {
                Toastr::error(translate('messages.Invalid flag!'));
                return back();
            }
            
            $product->$flag = $request->value;
            $product->save();
            
            Toastr::success(translate('messages.product_flag_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_flag') . ': ' . $e->getMessage());
            \Log::error('Product flag update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Delete product image
     */
    public function deleteImage($id)
    {
        try {
            $image = ProductImage::findOrFail($id);
            
            // Delete file
            if ($image->image_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('product/' . $image->image_url);
                    } else {
                        \Storage::disk('public')->delete('product/' . $image->image_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete product image file: ' . $e->getMessage());
                }
            }
            
            $image->delete();
            
            Toastr::success(translate('messages.image_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_image') . ': ' . $e->getMessage());
            \Log::error('Image deletion error: ' . $e->getMessage());
            return back();
        }
    }
}


```

```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Category;
use Illuminate\Http\Request;
use App\CentralLogics\ToastrWrapper as Toastr;
use App\CentralLogics\Helpers;
use Illuminate\Support\Str;

class CategoryController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index(Request $request)
    {
        $query = Category::query();
        
        // Search
        if ($request->filled('search')) {
            $search = $request->search;
            $query->where(function ($q) use ($search) {
                $q->where('name', 'like', "%{$search}%")
                    ->orWhere('slug', 'like', "%{$search}%");
            });
        }
        
        // Filter by status
        if ($request->filled('status')) {
            $query->where('status', $request->status);
        }
        
        // Filter by parent
        if ($request->filled('parent_id')) {
            if ($request->parent_id === 'null') {
                $query->whereNull('parent_id');
            } else {
                $query->where('parent_id', (int)$request->parent_id);
            }
        }
        
        $categories = $query->with('parent')->orderBy('name', 'asc')->paginate(25);
        $parentCategories = Category::whereNull('parent_id')->where('status', 'active')->orderBy('name', 'asc')->get();
        
        return view('admin-views.categories.index', compact('categories', 'parentCategories'));
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        $parentCategories = Category::whereNull('parent_id')->where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.categories.create', compact('parentCategories'));
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'parent_id' => 'nullable|exists:categories,id',
                'image' => 'nullable|image|mimes:jpeg,jpg,png,gif,webp|max:2048',
                'icon' => 'nullable|image|mimes:jpeg,jpg,png,gif,webp|max:2048',
                'status' => 'required|in:active,inactive',
            ], [
                'name.required' => translate('messages.Category name is required!'),
                'parent_id.exists' => translate('messages.Parent category not found!'),
                'image.image' => translate('messages.Please upload image files only!'),
                'image.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'image.max' => translate('messages.Image size should be less than 2MB!'),
                'icon.image' => translate('messages.Please upload image files only!'),
                'icon.mimes' => translate('messages.Icon must be jpeg, jpg, png, gif, or webp!'),
                'icon.max' => translate('messages.Icon size should be less than 2MB!'),
                'status.required' => translate('messages.Status is required!'),
                'status.in' => translate('messages.Invalid status!'),
            ]);

            $category = new Category();
            $category->name = $request->name;
            $category->slug = Str::slug($request->name);
            $category->parent_id = $request->parent_id ?? null;
            $category->status = $request->status;

            // Handle image upload
            if ($request->hasFile('image')) {
                $image = $request->file('image');
                if ($image && $image->isValid()) {
                    try {
                        $extension = $image->getClientOriginalExtension();
                        $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                        $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                        
                        $imageName = Helpers::upload('category/', $format, $image);
                        
                        if ($imageName && $imageName !== 'def.png') {
                            $category->image_url = $imageName;
                        }
                    } catch (\Exception $e) {
                        \Log::error('Category image upload error: ' . $e->getMessage());
                        Toastr::error(translate('messages.failed_to_upload_image') . ': ' . $e->getMessage());
                        return back()->withInput();
                    }
                }
            }

            // Handle icon upload
            if ($request->hasFile('icon')) {
                $icon = $request->file('icon');
                if ($icon && $icon->isValid()) {
                    try {
                        $extension = $icon->getClientOriginalExtension();
                        $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                        $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                        
                        $iconName = Helpers::upload('category/', $format, $icon);
                        
                        if ($iconName && $iconName !== 'def.png') {
                            $category->icon_url = $iconName;
                        }
                    } catch (\Exception $e) {
                        \Log::error('Category icon upload error: ' . $e->getMessage());
                        Toastr::error(translate('messages.failed_to_upload_image') . ': ' . $e->getMessage());
                        return back()->withInput();
                    }
                }
            }

            $category->save();

            Toastr::success(translate('messages.category_added'));
            return redirect()->route('admin.categories.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_add_category') . ': ' . $e->getMessage());
            \Log::error('Category creation error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit($id)
    {
        $category = Category::findOrFail($id);
        $parentCategories = Category::whereNull('parent_id')
            ->where('status', 'active')
            ->where('id', '!=', $id)
            ->orderBy('name', 'asc')
            ->get();
        return view('admin-views.categories.edit', compact('category', 'parentCategories'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, $id)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'parent_id' => 'nullable|exists:categories,id|not_in:' . $id,
                'image' => 'nullable|image|mimes:jpeg,jpg,png,gif,webp|max:2048',
                'icon' => 'nullable|image|mimes:jpeg,jpg,png,gif,webp|max:2048',
                'status' => 'required|in:active,inactive',
            ], [
                'name.required' => translate('messages.Category name is required!'),
                'parent_id.exists' => translate('messages.Parent category not found!'),
                'parent_id.not_in' => translate('messages.Category cannot be its own parent!'),
                'image.image' => translate('messages.Please upload image files only!'),
                'image.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'image.max' => translate('messages.Image size should be less than 2MB!'),
                'icon.image' => translate('messages.Please upload image files only!'),
                'icon.mimes' => translate('messages.Icon must be jpeg, jpg, png, gif, or webp!'),
                'icon.max' => translate('messages.Icon size should be less than 2MB!'),
                'status.required' => translate('messages.Status is required!'),
                'status.in' => translate('messages.Invalid status!'),
            ]);

            $category = Category::findOrFail($id);
            $category->name = $request->name;
            $category->slug = Str::slug($request->name);
            $category->parent_id = $request->parent_id ?? null;
            $category->status = $request->status;

            // Handle image upload
            if ($request->hasFile('image')) {
                $image = $request->file('image');
                if ($image && $image->isValid()) {
                    try {
                        $extension = $image->getClientOriginalExtension();
                        $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                        $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                        
                        $imageName = Helpers::upload('category/', $format, $image);
                        
                        if ($imageName && $imageName !== 'def.png') {
                            // Delete old image if exists
                            if ($category->image_url) {
                                try {
                                    $storageType = Helpers::getDisk();
                                    if ($storageType === 's3') {
                                        \Storage::disk('s3')->delete('category/' . $category->image_url);
                                    } else {
                                        \Storage::disk('public')->delete('category/' . $category->image_url);
                                    }
                                } catch (\Exception $e) {
                                    \Log::warning('Failed to delete old category image: ' . $e->getMessage());
                                }
                            }
                            $category->image_url = $imageName;
                        }
                    } catch (\Exception $e) {
                        \Log::error('Category image upload error: ' . $e->getMessage());
                        Toastr::error(translate('messages.failed_to_upload_image') . ': ' . $e->getMessage());
                        return back()->withInput();
                    }
                }
            }

            // Handle icon upload
            if ($request->hasFile('icon')) {
                $icon = $request->file('icon');
                if ($icon && $icon->isValid()) {
                    try {
                        $extension = $icon->getClientOriginalExtension();
                        $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                        $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                        
                        $iconName = Helpers::upload('category/', $format, $icon);
                        
                        if ($iconName && $iconName !== 'def.png') {
                            // Delete old icon if exists
                            if ($category->icon_url) {
                                try {
                                    $storageType = Helpers::getDisk();
                                    if ($storageType === 's3') {
                                        \Storage::disk('s3')->delete('category/' . $category->icon_url);
                                    } else {
                                        \Storage::disk('public')->delete('category/' . $category->icon_url);
                                    }
                                } catch (\Exception $e) {
                                    \Log::warning('Failed to delete old category icon: ' . $e->getMessage());
                                }
                            }
                            $category->icon_url = $iconName;
                        }
                    } catch (\Exception $e) {
                        \Log::error('Category icon upload error: ' . $e->getMessage());
                        Toastr::error(translate('messages.failed_to_upload_image') . ': ' . $e->getMessage());
                        return back()->withInput();
                    }
                }
            }

            $category->save();

            Toastr::success(translate('messages.category_updated'));
            return redirect()->route('admin.categories.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_category') . ': ' . $e->getMessage());
            \Log::error('Category update error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy($id)
    {
        try {
            $category = Category::findOrFail($id);
            
            // Check if category has products
            if ($category->products()->count() > 0) {
                Toastr::error(translate('messages.Cannot delete category with products!'));
                return back();
            }
            
            // Check if category has children
            if ($category->children()->count() > 0) {
                Toastr::error(translate('messages.Cannot delete category with subcategories!'));
                return back();
            }
            
            // Delete images
            if ($category->image_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('category/' . $category->image_url);
                    } else {
                        \Storage::disk('public')->delete('category/' . $category->image_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete category image: ' . $e->getMessage());
                }
            }
            
            if ($category->icon_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('category/' . $category->icon_url);
                    } else {
                        \Storage::disk('public')->delete('category/' . $category->icon_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete category icon: ' . $e->getMessage());
                }
            }
            
            $category->delete();
            
            Toastr::success(translate('messages.category_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_category') . ': ' . $e->getMessage());
            \Log::error('Category deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle category status
     */
    public function statusToggle(Request $request)
    {
        try {
            $category = Category::findOrFail($request->id);
            $category->status = $request->status;
            $category->save();
            Toastr::success(translate('messages.category_status_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_status') . ': ' . $e->getMessage());
            \Log::error('Category status update error: ' . $e->getMessage());
            return back();
        }
    }
}


```


## Fixes applied

### 1. Controller logic
- Changed `$request->has()` to `$request->filled()` in both controllers
  - `has()` returns true even for empty strings
  - `filled()` only returns true when the value is present and not empty
- Added type casting for category_id and parent_id to ensure integer comparison

### 2. Categories filter
- Combined search and status filter into a single form
- Added parent category filter
- All filters work together and preserve values on submit

### 3. Products filter
- Form structure is correct
- Fixed category_id comparison in the view to handle string/int differences
- All filters (search, category, status) work together

### 4. Form improvements
- Single form for all filters
- Clear button appears when any filter is active
- Filter values persist after form submission
- Pagination preserves filter parameters

### Changes made

**CategoryController.php:**
- Changed `$request->has('search')` ‚Üí `$request->filled('search')`
- Changed `$request->has('status')` ‚Üí `$request->filled('status')`
- Changed `$request->has('parent_id')` ‚Üí `$request->filled('parent_id')`
- Added `(int)` casting for parent_id

**ProductController.php:**
- Changed all `$request->has()` ‚Üí `$request->filled()`
- Added `(int)` casting for category_id

**Categories Index View:**
- Combined search and filter into one form
- Added parent category filter dropdown
- Improved layout and styling

**Products Index View:**
- Fixed category_id comparison to handle type differences

Filters should now work correctly. The main issue was using `has()` instead of `filled()`, which caused filters to apply even with empty values.

---

**User**

Still filters not working fix it

---

**Cursor**


Reviewing the implementation to identify why filters aren't working. Checking the code flow:



Adding debug logging and fixing the filter logic. Checking how the request parameters are handled:


```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Category;
use Illuminate\Http\Request;
use App\CentralLogics\ToastrWrapper as Toastr;
use App\CentralLogics\Helpers;
use Illuminate\Support\Str;

class CategoryController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index(Request $request)
    {
        $query = Category::query();
        
        // Search
        $search = $request->input('search');
        if (!empty($search) && trim($search) !== '') {
            $search = trim($search);
            $query->where(function ($q) use ($search) {
                $q->where('name', 'like', "%{$search}%")
                    ->orWhere('slug', 'like', "%{$search}%");
            });
        }
        
        // Filter by status
        $status = $request->input('status');
        if (!empty($status) && $status !== '') {
            $query->where('status', $status);
        }
        
        // Filter by parent
        $parentId = $request->input('parent_id');
        if (!empty($parentId) && $parentId !== '') {
            if ($parentId === 'null') {
                $query->whereNull('parent_id');
            } else {
                $query->where('parent_id', (int)$parentId);
            }
        }
        
        $categories = $query->with('parent')->orderBy('name', 'asc')->paginate(25);
        $parentCategories = Category::whereNull('parent_id')->where('status', 'active')->orderBy('name', 'asc')->get();
        
        return view('admin-views.categories.index', compact('categories', 'parentCategories'));
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        $parentCategories = Category::whereNull('parent_id')->where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.categories.create', compact('parentCategories'));
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'parent_id' => 'nullable|exists:categories,id',
                'image' => 'nullable|image|mimes:jpeg,jpg,png,gif,webp|max:2048',
                'icon' => 'nullable|image|mimes:jpeg,jpg,png,gif,webp|max:2048',
                'status' => 'required|in:active,inactive',
            ], [
                'name.required' => translate('messages.Category name is required!'),
                'parent_id.exists' => translate('messages.Parent category not found!'),
                'image.image' => translate('messages.Please upload image files only!'),
                'image.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'image.max' => translate('messages.Image size should be less than 2MB!'),
                'icon.image' => translate('messages.Please upload image files only!'),
                'icon.mimes' => translate('messages.Icon must be jpeg, jpg, png, gif, or webp!'),
                'icon.max' => translate('messages.Icon size should be less than 2MB!'),
                'status.required' => translate('messages.Status is required!'),
                'status.in' => translate('messages.Invalid status!'),
            ]);

            $category = new Category();
            $category->name = $request->name;
            $category->slug = Str::slug($request->name);
            $category->parent_id = $request->parent_id ?? null;
            $category->status = $request->status;

            // Handle image upload
            if ($request->hasFile('image')) {
                $image = $request->file('image');
                if ($image && $image->isValid()) {
                    try {
                        $extension = $image->getClientOriginalExtension();
                        $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                        $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                        
                        $imageName = Helpers::upload('category/', $format, $image);
                        
                        if ($imageName && $imageName !== 'def.png') {
                            $category->image_url = $imageName;
                        }
                    } catch (\Exception $e) {
                        \Log::error('Category image upload error: ' . $e->getMessage());
                        Toastr::error(translate('messages.failed_to_upload_image') . ': ' . $e->getMessage());
                        return back()->withInput();
                    }
                }
            }

            // Handle icon upload
            if ($request->hasFile('icon')) {
                $icon = $request->file('icon');
                if ($icon && $icon->isValid()) {
                    try {
                        $extension = $icon->getClientOriginalExtension();
                        $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                        $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                        
                        $iconName = Helpers::upload('category/', $format, $icon);
                        
                        if ($iconName && $iconName !== 'def.png') {
                            $category->icon_url = $iconName;
                        }
                    } catch (\Exception $e) {
                        \Log::error('Category icon upload error: ' . $e->getMessage());
                        Toastr::error(translate('messages.failed_to_upload_image') . ': ' . $e->getMessage());
                        return back()->withInput();
                    }
                }
            }

            $category->save();

            Toastr::success(translate('messages.category_added'));
            return redirect()->route('admin.categories.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_add_category') . ': ' . $e->getMessage());
            \Log::error('Category creation error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit($id)
    {
        $category = Category::findOrFail($id);
        $parentCategories = Category::whereNull('parent_id')
            ->where('status', 'active')
            ->where('id', '!=', $id)
            ->orderBy('name', 'asc')
            ->get();
        return view('admin-views.categories.edit', compact('category', 'parentCategories'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, $id)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'parent_id' => 'nullable|exists:categories,id|not_in:' . $id,
                'image' => 'nullable|image|mimes:jpeg,jpg,png,gif,webp|max:2048',
                'icon' => 'nullable|image|mimes:jpeg,jpg,png,gif,webp|max:2048',
                'status' => 'required|in:active,inactive',
            ], [
                'name.required' => translate('messages.Category name is required!'),
                'parent_id.exists' => translate('messages.Parent category not found!'),
                'parent_id.not_in' => translate('messages.Category cannot be its own parent!'),
                'image.image' => translate('messages.Please upload image files only!'),
                'image.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'image.max' => translate('messages.Image size should be less than 2MB!'),
                'icon.image' => translate('messages.Please upload image files only!'),
                'icon.mimes' => translate('messages.Icon must be jpeg, jpg, png, gif, or webp!'),
                'icon.max' => translate('messages.Icon size should be less than 2MB!'),
                'status.required' => translate('messages.Status is required!'),
                'status.in' => translate('messages.Invalid status!'),
            ]);

            $category = Category::findOrFail($id);
            $category->name = $request->name;
            $category->slug = Str::slug($request->name);
            $category->parent_id = $request->parent_id ?? null;
            $category->status = $request->status;

            // Handle image upload
            if ($request->hasFile('image')) {
                $image = $request->file('image');
                if ($image && $image->isValid()) {
                    try {
                        $extension = $image->getClientOriginalExtension();
                        $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                        $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                        
                        $imageName = Helpers::upload('category/', $format, $image);
                        
                        if ($imageName && $imageName !== 'def.png') {
                            // Delete old image if exists
                            if ($category->image_url) {
                                try {
                                    $storageType = Helpers::getDisk();
                                    if ($storageType === 's3') {
                                        \Storage::disk('s3')->delete('category/' . $category->image_url);
                                    } else {
                                        \Storage::disk('public')->delete('category/' . $category->image_url);
                                    }
                                } catch (\Exception $e) {
                                    \Log::warning('Failed to delete old category image: ' . $e->getMessage());
                                }
                            }
                            $category->image_url = $imageName;
                        }
                    } catch (\Exception $e) {
                        \Log::error('Category image upload error: ' . $e->getMessage());
                        Toastr::error(translate('messages.failed_to_upload_image') . ': ' . $e->getMessage());
                        return back()->withInput();
                    }
                }
            }

            // Handle icon upload
            if ($request->hasFile('icon')) {
                $icon = $request->file('icon');
                if ($icon && $icon->isValid()) {
                    try {
                        $extension = $icon->getClientOriginalExtension();
                        $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                        $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                        
                        $iconName = Helpers::upload('category/', $format, $icon);
                        
                        if ($iconName && $iconName !== 'def.png') {
                            // Delete old icon if exists
                            if ($category->icon_url) {
                                try {
                                    $storageType = Helpers::getDisk();
                                    if ($storageType === 's3') {
                                        \Storage::disk('s3')->delete('category/' . $category->icon_url);
                                    } else {
                                        \Storage::disk('public')->delete('category/' . $category->icon_url);
                                    }
                                } catch (\Exception $e) {
                                    \Log::warning('Failed to delete old category icon: ' . $e->getMessage());
                                }
                            }
                            $category->icon_url = $iconName;
                        }
                    } catch (\Exception $e) {
                        \Log::error('Category icon upload error: ' . $e->getMessage());
                        Toastr::error(translate('messages.failed_to_upload_image') . ': ' . $e->getMessage());
                        return back()->withInput();
                    }
                }
            }

            $category->save();

            Toastr::success(translate('messages.category_updated'));
            return redirect()->route('admin.categories.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_category') . ': ' . $e->getMessage());
            \Log::error('Category update error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy($id)
    {
        try {
            $category = Category::findOrFail($id);
            
            // Check if category has products
            if ($category->products()->count() > 0) {
                Toastr::error(translate('messages.Cannot delete category with products!'));
                return back();
            }
            
            // Check if category has children
            if ($category->children()->count() > 0) {
                Toastr::error(translate('messages.Cannot delete category with subcategories!'));
                return back();
            }
            
            // Delete images
            if ($category->image_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('category/' . $category->image_url);
                    } else {
                        \Storage::disk('public')->delete('category/' . $category->image_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete category image: ' . $e->getMessage());
                }
            }
            
            if ($category->icon_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('category/' . $category->icon_url);
                    } else {
                        \Storage::disk('public')->delete('category/' . $category->icon_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete category icon: ' . $e->getMessage());
                }
            }
            
            $category->delete();
            
            Toastr::success(translate('messages.category_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_category') . ': ' . $e->getMessage());
            \Log::error('Category deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle category status
     */
    public function statusToggle(Request $request)
    {
        try {
            $category = Category::findOrFail($request->id);
            $category->status = $request->status;
            $category->save();
            Toastr::success(translate('messages.category_status_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_status') . ': ' . $e->getMessage());
            \Log::error('Category status update error: ' . $e->getMessage());
            return back();
        }
    }
}


```

```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Product;
use App\Models\Category;
use App\Models\Brand;
use App\Models\ProductVariant;
use App\Models\ProductImage;
use Illuminate\Http\Request;
use App\CentralLogics\ToastrWrapper as Toastr;
use App\CentralLogics\Helpers;
use Illuminate\Support\Str;

class ProductController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index(Request $request)
    {
        $query = Product::with(['category', 'brand', 'variants', 'images']);
        
        // Search
        $search = $request->input('search');
        if (!empty($search) && trim($search) !== '') {
            $search = trim($search);
            $query->where(function ($q) use ($search) {
                $q->where('name', 'like', "%{$search}%")
                    ->orWhere('description', 'like', "%{$search}%");
            });
        }
        
        // Filter by status
        $status = $request->input('status');
        if (!empty($status) && $status !== '') {
            $query->where('status', $status);
        }
        
        // Filter by category
        $categoryId = $request->input('category_id');
        if (!empty($categoryId) && $categoryId !== '') {
            $query->where('category_id', (int)$categoryId);
        }
        
        // Filter by trending
        $isTrending = $request->input('is_trending');
        if ($isTrending !== null && $isTrending !== '') {
            $query->where('is_trending', (bool)$isTrending);
        }
        
        // Filter by latest
        $isLatest = $request->input('is_latest');
        if ($isLatest !== null && $isLatest !== '') {
            $query->where('is_latest', (bool)$isLatest);
        }
        
        // Filter by express_30
        $isExpress30 = $request->input('is_express_30');
        if ($isExpress30 !== null && $isExpress30 !== '') {
            $query->where('is_express_30', (bool)$isExpress30);
        }
        
        $products = $query->orderBy('created_at', 'desc')->paginate(25);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        
        return view('admin-views.products.index', compact('products', 'categories'));
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.create', compact('categories', 'brands'));
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Variant fields
                'variant_sku' => 'required|string|max:255',
                'variant_price' => 'required|numeric|min:0',
                'variant_sale_price' => 'nullable|numeric|min:0',
                'variant_status' => 'required|in:active,inactive',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:2048',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'variant_sku.required' => translate('messages.SKU is required!'),
                'variant_price.required' => translate('messages.Price is required!'),
                'variant_price.numeric' => translate('messages.Price must be a number!'),
                'variant_price.min' => translate('messages.Price must be greater than or equal to 0!'),
                'variant_sale_price.numeric' => translate('messages.Sale price must be a number!'),
                'variant_sale_price.min' => translate('messages.Sale price must be greater than or equal to 0!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 2MB!'),
            ]);

            // Check if SKU already exists
            if (ProductVariant::where('sku', $request->variant_sku)->exists()) {
                Toastr::error(translate('messages.SKU already exists!'));
                return back()->withInput();
            }

            // Create product
            $product = new Product();
            $product->name = $request->name;
            $product->slug = Str::slug($request->name) . '-' . uniqid();
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Create default variant
            $variant = new ProductVariant();
            $variant->product_id = $product->id;
            $variant->sku = $request->variant_sku;
            $variant->price = $request->variant_price;
            $variant->sale_price = $request->variant_sale_price ?? null;
            $variant->status = $request->variant_status;
            $variant->save();

            // Handle images
            if ($request->hasFile('images')) {
                $sortOrder = 0;
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant->id;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = ($sortOrder === 0) ? true : false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_added'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_add_product') . ': ' . $e->getMessage());
            \Log::error('Product creation error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit($id)
    {
        $product = Product::with(['category', 'brand', 'variants', 'images'])->findOrFail($id);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.edit', compact('product', 'categories', 'brands'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, $id)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:2048',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 2MB!'),
            ]);

            $product = Product::findOrFail($id);
            $product->name = $request->name;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Handle new images
            if ($request->hasFile('images')) {
                $existingImages = ProductImage::where('product_id', $product->id)->count();
                $sortOrder = $existingImages;
                
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $variant = $product->variants->first();
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant ? $variant->id : null;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_updated'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_product') . ': ' . $e->getMessage());
            \Log::error('Product update error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy($id)
    {
        try {
            $product = Product::findOrFail($id);
            
            // Delete product images
            foreach ($product->images as $image) {
                if ($image->image_url) {
                    try {
                        $storageType = Helpers::getDisk();
                        if ($storageType === 's3') {
                            \Storage::disk('s3')->delete('product/' . $image->image_url);
                        } else {
                            \Storage::disk('public')->delete('product/' . $image->image_url);
                        }
                    } catch (\Exception $e) {
                        \Log::warning('Failed to delete product image: ' . $e->getMessage());
                    }
                }
                $image->delete();
            }
            
            // Delete variants (this will cascade delete related data)
            $product->variants()->delete();
            
            $product->delete();
            
            Toastr::success(translate('messages.product_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_product') . ': ' . $e->getMessage());
            \Log::error('Product deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product status
     */
    public function statusToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $product->status = $request->status;
            $product->save();
            Toastr::success(translate('messages.product_status_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_status') . ': ' . $e->getMessage());
            \Log::error('Product status update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product flag (trending, latest, express_30)
     */
    public function flagToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $flag = $request->flag; // is_trending, is_latest, is_express_30
            
            if (!in_array($flag, ['is_trending', 'is_latest', 'is_express_30'])) {
                Toastr::error(translate('messages.Invalid flag!'));
                return back();
            }
            
            $product->$flag = $request->value;
            $product->save();
            
            Toastr::success(translate('messages.product_flag_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_flag') . ': ' . $e->getMessage());
            \Log::error('Product flag update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Delete product image
     */
    public function deleteImage($id)
    {
        try {
            $image = ProductImage::findOrFail($id);
            
            // Delete file
            if ($image->image_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('product/' . $image->image_url);
                    } else {
                        \Storage::disk('public')->delete('product/' . $image->image_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete product image file: ' . $e->getMessage());
                }
            }
            
            $image->delete();
            
            Toastr::success(translate('messages.image_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_image') . ': ' . $e->getMessage());
            \Log::error('Image deletion error: ' . $e->getMessage());
            return back();
        }
    }
}


```


Verifying the form structure and adding a test to ensure it submits correctly. Checking for JavaScript that might interfere:



The JavaScript only prevents default on delete buttons, not form submission. Adding a simple test to verify the filter logic and ensuring the form submits correctly:


```blade
@extends('layouts.admin.app')

@section('title', translate('messages.categories'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .dataTables_wrapper .dataTables_length label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .dataTables_wrapper .dataTables_length select {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 80px;
    }
    
    .dataTables_wrapper .dataTables_filter {
        text-align: right;
    }
    
    .dataTables_wrapper .dataTables_filter label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: flex-end;
    }
    
    .dataTables_wrapper .dataTables_filter input {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 200px;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-category"></i>
                </span>
                <span>
                    {{ translate('messages.categories') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.categories') }} <span class="badge badge-soft-dark ml-2" id="category-count">{{ $categories->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.categories.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_category') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.categories.index') }}" id="category-filter-form" class="mb-3">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="search">Search Categories</label>
                                <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or slug..." value="{{ old('search', request('search')) }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="status">Status</label>
                                <select name="status" id="status" class="form-control">
                                    <option value="">All Status</option>
                                    <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                    <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="parent_id">Parent Category</label>
                                <select name="parent_id" id="parent_id" class="form-control">
                                    <option value="">All Categories</option>
                                    <option value="null" {{ old('parent_id', request('parent_id')) == 'null' ? 'selected' : '' }}>Main Categories Only</option>
                                    @foreach($parentCategories as $parent)
                                        <option value="{{ $parent->id }}" {{ old('parent_id', request('parent_id')) == $parent->id || (string)old('parent_id', request('parent_id')) === (string)$parent->id ? 'selected' : '' }}>{{ $parent->name }}</option>
                                    @endforeach
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <div class="d-flex gap-2">
                                    <button type="submit" class="btn btn--primary w-100">
                                        <i class="tio-search"></i> Filter
                                    </button>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--reset">
                                            <i class="tio-clear"></i>
                                        </a>
                                    @endif
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Name</th>
                        <th class="border-0">Parent</th>
                        <th class="border-0">Slug</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($categories as $key => $category)
                        <tr>
                            <td>{{ $categories->firstItem() + $key }}</td>
                            <td>
                                @if($category->image_url)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('category', $category->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $category->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/100x100/2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->name }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->parent ? $category->parent->name : '-' }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->slug }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $category->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $category->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this category?"
                                           data-title-off="Want to deactivate this category?"
                                           id="status-{{ $category->id }}" {{ $category->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.categories.status') }}" method="post" id="status-{{ $category->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $category->id }}">
                                    <input type="hidden" name="status" value="{{ $category->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.categories.edit', $category->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="category-{{ $category->id }}" 
                                       data-form-id="category-{{ $category->id }}"
                                       data-message="Want to delete this category?" 
                                       data-title="Delete Category"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.categories.destroy', $category->id) }}"
                                            method="post" id="category-{{ $category->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr>
                            <td colspan="7" class="text-center py-4">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5>{{ translate('no_data_found') }}</h5>
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                <div class="mt-3">
                    {{ $categories->appends(request()->query())->links() }}
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                if (typeof PageLoader !== 'undefined') {
                    setTimeout(function() {
                        PageLoader.hide();
                    }, 300);
                }
            }
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        $(window).on('load', function() {
            setTimeout(function() {
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.hide();
                }
            }, 500);
        });
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.products'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .badge-express {
        background-color: #f0ad4e;
        color: #fff;
    }
    
    .search-filter-wrapper {
        display: flex;
        gap: 10px;
        align-items: flex-end;
        flex-wrap: wrap;
    }
    
    .search-filter-wrapper .form-group {
        margin-bottom: 0;
        flex: 1;
        min-width: 200px;
    }
    
    .search-filter-wrapper .form-group label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 5px;
        font-size: 0.875rem;
    }
    
    .search-filter-wrapper .btn {
        white-space: nowrap;
        height: fit-content;
    }
    
    @media (max-width: 768px) {
        .search-filter-wrapper {
            flex-direction: column;
        }
        
        .search-filter-wrapper .form-group {
            width: 100%;
        }
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-shop"></i>
                </span>
                <span>
                    {{ translate('messages.products') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.products') }} <span class="badge badge-soft-dark ml-2" id="product-count">{{ $products->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.products.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_product') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.products.index') }}" id="product-filter-form" class="mb-3">
                    <div class="search-filter-wrapper">
                        <div class="form-group">
                            <label for="search">Search Products</label>
                            <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or description..." value="{{ old('search', request('search')) }}">
                        </div>
                        <div class="form-group">
                            <label for="category_id">Filter by Category</label>
                            <select name="category_id" id="category_id" class="form-control">
                                <option value="">All Categories</option>
                                @foreach($categories as $category)
                                    <option value="{{ $category->id }}" {{ old('category_id', request('category_id')) == $category->id || (string)old('category_id', request('category_id')) === (string)$category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                @endforeach
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status">Status</label>
                            <select name="status" id="status" class="form-control">
                                <option value="">All Status</option>
                                <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn--primary">
                                    <i class="tio-search"></i> Search
                                </button>
                                @if(request('search') || request('category_id') || request('status'))
                                    <a href="{{ route('admin.products.index') }}" class="btn btn--reset">
                                        <i class="tio-clear"></i> Clear
                                    </a>
                                @endif
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Product Name</th>
                        <th class="border-0">Category</th>
                        <th class="border-0">Price</th>
                        <th class="border-0 text-center">Trending</th>
                        <th class="border-0 text-center">Latest</th>
                        <th class="border-0 text-center">Express-30</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($products as $key => $product)
                        <tr>
                            <td>{{ $products->firstItem() + $key }}</td>
                            <td>
                                @php
                                    $primaryImage = $product->images->where('is_primary', true)->first() ?? $product->images->first();
                                @endphp
                                @if($primaryImage)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $primaryImage->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $product->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/160x160/img2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ Str::limit($product->name, 30, '...') }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $product->category ? $product->category->name : '-' }}
                                </span>
                            </td>
                            <td>
                                @php
                                    $variant = $product->variants->first();
                                    $price = $variant ? ($variant->sale_price ?? $variant->price) : 0;
                                @endphp
                                <span class="d-block font-size-sm text-body">
                                    ‚Çπ{{ number_format($price, 2) }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="trending-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_trending"
                                           data-value="{{ $product->is_trending ? 0 : 1 }}"
                                           id="trending-{{ $product->id }}" {{ $product->is_trending ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="latest-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_latest"
                                           data-value="{{ $product->is_latest ? 0 : 1 }}"
                                           id="latest-{{ $product->id }}" {{ $product->is_latest ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="express-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_express_30"
                                           data-value="{{ $product->is_express_30 ? 0 : 1 }}"
                                           id="express-{{ $product->id }}" {{ $product->is_express_30 ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $product->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this product?"
                                           data-title-off="Want to deactivate this product?"
                                           id="status-{{ $product->id }}" {{ $product->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.products.status') }}" method="post" id="status-{{ $product->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $product->id }}">
                                    <input type="hidden" name="status" value="{{ $product->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.products.edit', $product->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="product-{{ $product->id }}" 
                                       data-form-id="product-{{ $product->id }}"
                                       data-message="Want to delete this product?" 
                                       data-title="Delete Product"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.products.destroy', $product->id) }}"
                                            method="post" id="product-{{ $product->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr>
                            <td colspan="10" class="text-center py-4">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5>{{ translate('no_data_found') }}</h5>
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                <div class="mt-3">
                    {{ $products->appends(request()->query())->links() }}
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                if (typeof PageLoader !== 'undefined') {
                    setTimeout(function() {
                        PageLoader.hide();
                    }, 300);
                }
            }
        });
        
        // Handle flag toggles
        $(document).on('change', '.flag-toggle', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $checkbox = $(this);
            var productId = $checkbox.data('id');
            var flag = $checkbox.data('flag');
            var value = $checkbox.data('value');
            
            $.ajax({
                url: '{{ route('admin.products.flag') }}',
                method: 'POST',
                data: {
                    _token: '{{ csrf_token() }}',
                    id: productId,
                    flag: flag,
                    value: value
                },
                success: function(response) {
                    // Update the data-value for next toggle
                    $checkbox.data('value', value == 1 ? 0 : 1);
                },
                error: function(xhr) {
                    // Revert checkbox
                    $checkbox.prop('checked', !$checkbox.prop('checked'));
                    alert('Failed to update flag. Please try again.');
                }
            });
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        $(window).on('load', function() {
            setTimeout(function() {
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.hide();
                }
            }, 500);
        });
    });
</script>
@endpush


```


Adding a simple debug output to verify the filters are applied. Also ensuring empty string values are handled correctly:


```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Category;
use Illuminate\Http\Request;
use App\CentralLogics\ToastrWrapper as Toastr;
use App\CentralLogics\Helpers;
use Illuminate\Support\Str;

class CategoryController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index(Request $request)
    {
        $query = Category::query();
        
        // Search
        $search = trim($request->input('search', ''));
        if ($search !== '') {
            $query->where(function ($q) use ($search) {
                $q->where('name', 'like', "%{$search}%")
                    ->orWhere('slug', 'like', "%{$search}%");
            });
        }
        
        // Filter by status
        $status = $request->input('status');
        if ($status !== null && $status !== '') {
            $query->where('status', $status);
        }
        
        // Filter by parent
        $parentId = $request->input('parent_id');
        if ($parentId !== null && $parentId !== '') {
            if ($parentId === 'null') {
                $query->whereNull('parent_id');
            } else {
                $query->where('parent_id', (int)$parentId);
            }
        }
        
        $categories = $query->with('parent')->orderBy('name', 'asc')->paginate(25);
        $parentCategories = Category::whereNull('parent_id')->where('status', 'active')->orderBy('name', 'asc')->get();
        
        return view('admin-views.categories.index', compact('categories', 'parentCategories'));
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        $parentCategories = Category::whereNull('parent_id')->where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.categories.create', compact('parentCategories'));
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'parent_id' => 'nullable|exists:categories,id',
                'image' => 'nullable|image|mimes:jpeg,jpg,png,gif,webp|max:2048',
                'icon' => 'nullable|image|mimes:jpeg,jpg,png,gif,webp|max:2048',
                'status' => 'required|in:active,inactive',
            ], [
                'name.required' => translate('messages.Category name is required!'),
                'parent_id.exists' => translate('messages.Parent category not found!'),
                'image.image' => translate('messages.Please upload image files only!'),
                'image.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'image.max' => translate('messages.Image size should be less than 2MB!'),
                'icon.image' => translate('messages.Please upload image files only!'),
                'icon.mimes' => translate('messages.Icon must be jpeg, jpg, png, gif, or webp!'),
                'icon.max' => translate('messages.Icon size should be less than 2MB!'),
                'status.required' => translate('messages.Status is required!'),
                'status.in' => translate('messages.Invalid status!'),
            ]);

            $category = new Category();
            $category->name = $request->name;
            $category->slug = Str::slug($request->name);
            $category->parent_id = $request->parent_id ?? null;
            $category->status = $request->status;

            // Handle image upload
            if ($request->hasFile('image')) {
                $image = $request->file('image');
                if ($image && $image->isValid()) {
                    try {
                        $extension = $image->getClientOriginalExtension();
                        $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                        $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                        
                        $imageName = Helpers::upload('category/', $format, $image);
                        
                        if ($imageName && $imageName !== 'def.png') {
                            $category->image_url = $imageName;
                        }
                    } catch (\Exception $e) {
                        \Log::error('Category image upload error: ' . $e->getMessage());
                        Toastr::error(translate('messages.failed_to_upload_image') . ': ' . $e->getMessage());
                        return back()->withInput();
                    }
                }
            }

            // Handle icon upload
            if ($request->hasFile('icon')) {
                $icon = $request->file('icon');
                if ($icon && $icon->isValid()) {
                    try {
                        $extension = $icon->getClientOriginalExtension();
                        $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                        $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                        
                        $iconName = Helpers::upload('category/', $format, $icon);
                        
                        if ($iconName && $iconName !== 'def.png') {
                            $category->icon_url = $iconName;
                        }
                    } catch (\Exception $e) {
                        \Log::error('Category icon upload error: ' . $e->getMessage());
                        Toastr::error(translate('messages.failed_to_upload_image') . ': ' . $e->getMessage());
                        return back()->withInput();
                    }
                }
            }

            $category->save();

            Toastr::success(translate('messages.category_added'));
            return redirect()->route('admin.categories.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_add_category') . ': ' . $e->getMessage());
            \Log::error('Category creation error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit($id)
    {
        $category = Category::findOrFail($id);
        $parentCategories = Category::whereNull('parent_id')
            ->where('status', 'active')
            ->where('id', '!=', $id)
            ->orderBy('name', 'asc')
            ->get();
        return view('admin-views.categories.edit', compact('category', 'parentCategories'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, $id)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'parent_id' => 'nullable|exists:categories,id|not_in:' . $id,
                'image' => 'nullable|image|mimes:jpeg,jpg,png,gif,webp|max:2048',
                'icon' => 'nullable|image|mimes:jpeg,jpg,png,gif,webp|max:2048',
                'status' => 'required|in:active,inactive',
            ], [
                'name.required' => translate('messages.Category name is required!'),
                'parent_id.exists' => translate('messages.Parent category not found!'),
                'parent_id.not_in' => translate('messages.Category cannot be its own parent!'),
                'image.image' => translate('messages.Please upload image files only!'),
                'image.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'image.max' => translate('messages.Image size should be less than 2MB!'),
                'icon.image' => translate('messages.Please upload image files only!'),
                'icon.mimes' => translate('messages.Icon must be jpeg, jpg, png, gif, or webp!'),
                'icon.max' => translate('messages.Icon size should be less than 2MB!'),
                'status.required' => translate('messages.Status is required!'),
                'status.in' => translate('messages.Invalid status!'),
            ]);

            $category = Category::findOrFail($id);
            $category->name = $request->name;
            $category->slug = Str::slug($request->name);
            $category->parent_id = $request->parent_id ?? null;
            $category->status = $request->status;

            // Handle image upload
            if ($request->hasFile('image')) {
                $image = $request->file('image');
                if ($image && $image->isValid()) {
                    try {
                        $extension = $image->getClientOriginalExtension();
                        $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                        $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                        
                        $imageName = Helpers::upload('category/', $format, $image);
                        
                        if ($imageName && $imageName !== 'def.png') {
                            // Delete old image if exists
                            if ($category->image_url) {
                                try {
                                    $storageType = Helpers::getDisk();
                                    if ($storageType === 's3') {
                                        \Storage::disk('s3')->delete('category/' . $category->image_url);
                                    } else {
                                        \Storage::disk('public')->delete('category/' . $category->image_url);
                                    }
                                } catch (\Exception $e) {
                                    \Log::warning('Failed to delete old category image: ' . $e->getMessage());
                                }
                            }
                            $category->image_url = $imageName;
                        }
                    } catch (\Exception $e) {
                        \Log::error('Category image upload error: ' . $e->getMessage());
                        Toastr::error(translate('messages.failed_to_upload_image') . ': ' . $e->getMessage());
                        return back()->withInput();
                    }
                }
            }

            // Handle icon upload
            if ($request->hasFile('icon')) {
                $icon = $request->file('icon');
                if ($icon && $icon->isValid()) {
                    try {
                        $extension = $icon->getClientOriginalExtension();
                        $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                        $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                        
                        $iconName = Helpers::upload('category/', $format, $icon);
                        
                        if ($iconName && $iconName !== 'def.png') {
                            // Delete old icon if exists
                            if ($category->icon_url) {
                                try {
                                    $storageType = Helpers::getDisk();
                                    if ($storageType === 's3') {
                                        \Storage::disk('s3')->delete('category/' . $category->icon_url);
                                    } else {
                                        \Storage::disk('public')->delete('category/' . $category->icon_url);
                                    }
                                } catch (\Exception $e) {
                                    \Log::warning('Failed to delete old category icon: ' . $e->getMessage());
                                }
                            }
                            $category->icon_url = $iconName;
                        }
                    } catch (\Exception $e) {
                        \Log::error('Category icon upload error: ' . $e->getMessage());
                        Toastr::error(translate('messages.failed_to_upload_image') . ': ' . $e->getMessage());
                        return back()->withInput();
                    }
                }
            }

            $category->save();

            Toastr::success(translate('messages.category_updated'));
            return redirect()->route('admin.categories.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_category') . ': ' . $e->getMessage());
            \Log::error('Category update error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy($id)
    {
        try {
            $category = Category::findOrFail($id);
            
            // Check if category has products
            if ($category->products()->count() > 0) {
                Toastr::error(translate('messages.Cannot delete category with products!'));
                return back();
            }
            
            // Check if category has children
            if ($category->children()->count() > 0) {
                Toastr::error(translate('messages.Cannot delete category with subcategories!'));
                return back();
            }
            
            // Delete images
            if ($category->image_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('category/' . $category->image_url);
                    } else {
                        \Storage::disk('public')->delete('category/' . $category->image_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete category image: ' . $e->getMessage());
                }
            }
            
            if ($category->icon_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('category/' . $category->icon_url);
                    } else {
                        \Storage::disk('public')->delete('category/' . $category->icon_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete category icon: ' . $e->getMessage());
                }
            }
            
            $category->delete();
            
            Toastr::success(translate('messages.category_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_category') . ': ' . $e->getMessage());
            \Log::error('Category deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle category status
     */
    public function statusToggle(Request $request)
    {
        try {
            $category = Category::findOrFail($request->id);
            $category->status = $request->status;
            $category->save();
            Toastr::success(translate('messages.category_status_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_status') . ': ' . $e->getMessage());
            \Log::error('Category status update error: ' . $e->getMessage());
            return back();
        }
    }
}


```

```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Product;
use App\Models\Category;
use App\Models\Brand;
use App\Models\ProductVariant;
use App\Models\ProductImage;
use Illuminate\Http\Request;
use App\CentralLogics\ToastrWrapper as Toastr;
use App\CentralLogics\Helpers;
use Illuminate\Support\Str;

class ProductController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index(Request $request)
    {
        $query = Product::with(['category', 'brand', 'variants', 'images']);
        
        // Search
        $search = trim($request->input('search', ''));
        if ($search !== '') {
            $query->where(function ($q) use ($search) {
                $q->where('name', 'like', "%{$search}%")
                    ->orWhere('description', 'like', "%{$search}%");
            });
        }
        
        // Filter by status
        $status = $request->input('status');
        if ($status !== null && $status !== '') {
            $query->where('status', $status);
        }
        
        // Filter by category
        $categoryId = $request->input('category_id');
        if ($categoryId !== null && $categoryId !== '') {
            $query->where('category_id', (int)$categoryId);
        }
        
        // Filter by trending
        $isTrending = $request->input('is_trending');
        if ($isTrending !== null && $isTrending !== '') {
            $query->where('is_trending', (bool)$isTrending);
        }
        
        // Filter by latest
        $isLatest = $request->input('is_latest');
        if ($isLatest !== null && $isLatest !== '') {
            $query->where('is_latest', (bool)$isLatest);
        }
        
        // Filter by express_30
        $isExpress30 = $request->input('is_express_30');
        if ($isExpress30 !== null && $isExpress30 !== '') {
            $query->where('is_express_30', (bool)$isExpress30);
        }
        
        $products = $query->orderBy('created_at', 'desc')->paginate(25);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        
        return view('admin-views.products.index', compact('products', 'categories'));
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.create', compact('categories', 'brands'));
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Variant fields
                'variant_sku' => 'required|string|max:255',
                'variant_price' => 'required|numeric|min:0',
                'variant_sale_price' => 'nullable|numeric|min:0',
                'variant_status' => 'required|in:active,inactive',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:2048',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'variant_sku.required' => translate('messages.SKU is required!'),
                'variant_price.required' => translate('messages.Price is required!'),
                'variant_price.numeric' => translate('messages.Price must be a number!'),
                'variant_price.min' => translate('messages.Price must be greater than or equal to 0!'),
                'variant_sale_price.numeric' => translate('messages.Sale price must be a number!'),
                'variant_sale_price.min' => translate('messages.Sale price must be greater than or equal to 0!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 2MB!'),
            ]);

            // Check if SKU already exists
            if (ProductVariant::where('sku', $request->variant_sku)->exists()) {
                Toastr::error(translate('messages.SKU already exists!'));
                return back()->withInput();
            }

            // Create product
            $product = new Product();
            $product->name = $request->name;
            $product->slug = Str::slug($request->name) . '-' . uniqid();
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Create default variant
            $variant = new ProductVariant();
            $variant->product_id = $product->id;
            $variant->sku = $request->variant_sku;
            $variant->price = $request->variant_price;
            $variant->sale_price = $request->variant_sale_price ?? null;
            $variant->status = $request->variant_status;
            $variant->save();

            // Handle images
            if ($request->hasFile('images')) {
                $sortOrder = 0;
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant->id;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = ($sortOrder === 0) ? true : false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_added'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_add_product') . ': ' . $e->getMessage());
            \Log::error('Product creation error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit($id)
    {
        $product = Product::with(['category', 'brand', 'variants', 'images'])->findOrFail($id);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.edit', compact('product', 'categories', 'brands'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, $id)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:2048',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 2MB!'),
            ]);

            $product = Product::findOrFail($id);
            $product->name = $request->name;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Handle new images
            if ($request->hasFile('images')) {
                $existingImages = ProductImage::where('product_id', $product->id)->count();
                $sortOrder = $existingImages;
                
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $variant = $product->variants->first();
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant ? $variant->id : null;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_updated'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_product') . ': ' . $e->getMessage());
            \Log::error('Product update error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy($id)
    {
        try {
            $product = Product::findOrFail($id);
            
            // Delete product images
            foreach ($product->images as $image) {
                if ($image->image_url) {
                    try {
                        $storageType = Helpers::getDisk();
                        if ($storageType === 's3') {
                            \Storage::disk('s3')->delete('product/' . $image->image_url);
                        } else {
                            \Storage::disk('public')->delete('product/' . $image->image_url);
                        }
                    } catch (\Exception $e) {
                        \Log::warning('Failed to delete product image: ' . $e->getMessage());
                    }
                }
                $image->delete();
            }
            
            // Delete variants (this will cascade delete related data)
            $product->variants()->delete();
            
            $product->delete();
            
            Toastr::success(translate('messages.product_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_product') . ': ' . $e->getMessage());
            \Log::error('Product deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product status
     */
    public function statusToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $product->status = $request->status;
            $product->save();
            Toastr::success(translate('messages.product_status_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_status') . ': ' . $e->getMessage());
            \Log::error('Product status update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product flag (trending, latest, express_30)
     */
    public function flagToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $flag = $request->flag; // is_trending, is_latest, is_express_30
            
            if (!in_array($flag, ['is_trending', 'is_latest', 'is_express_30'])) {
                Toastr::error(translate('messages.Invalid flag!'));
                return back();
            }
            
            $product->$flag = $request->value;
            $product->save();
            
            Toastr::success(translate('messages.product_flag_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_flag') . ': ' . $e->getMessage());
            \Log::error('Product flag update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Delete product image
     */
    public function deleteImage($id)
    {
        try {
            $image = ProductImage::findOrFail($id);
            
            // Delete file
            if ($image->image_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('product/' . $image->image_url);
                    } else {
                        \Storage::disk('public')->delete('product/' . $image->image_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete product image file: ' . $e->getMessage());
                }
            }
            
            $image->delete();
            
            Toastr::success(translate('messages.image_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_image') . ': ' . $e->getMessage());
            \Log::error('Image deletion error: ' . $e->getMessage());
            return back();
        }
    }
}


```


## Fixes applied

### 1. Controller filter logic
- Replaced `filled()` with explicit checks using `$request->input()`
- Added null checks and empty string handling
- Trimmed search input to remove whitespace
- Type casting for IDs and booleans

### 2. Form structure
- Added form IDs for easier debugging
- Used `old()` helper as fallback for form values
- Ensured all form fields have proper names

### 3. Filter conditions
- Search: only applies if the trimmed value is not empty
- Status: only applies if not null and not empty string
- Category ID: only applies if not null and not empty string
- Parent ID: handles both 'null' string and numeric values

### Changes summary

**CategoryController:**
```php
// Before: if ($request->filled('search'))
// After: $search = trim($request->input('search', '')); if ($search !== '')
```

**ProductController:**
```php
// Same pattern - explicit checks instead of filled()
```

The filters should now work correctly. The main issue was using `filled()` which can be unreliable with form submissions. The new approach uses explicit checks that handle:
- Empty strings from select dropdowns
- Null values
- Whitespace in search inputs
- Type casting for proper database queries

Test the filters; they should filter the data correctly. If issues persist, share the specific filter and what you're seeing.

```php
// Before: if ($request->filled('search'))
// After: $search = trim($request->input('search', '')); if ($search !== '')
```

```php
// Same pattern - explicit checks instead of filled()
```

---

**User**

Fix the category-wise filter search issue in Admin ‚Üí Products Listing where products are not displaying correctly when category filter is applied.
Do NOT change any UI design, routes, API logic, or database structure.
Only fix the filtering logic.

---

**Cursor**


Checking the category filter implementation in the Products Listing to fix the issue.



Reviewing the category filter logic and fixing it:



Fixing the category filter logic to handle edge cases:


```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Product;
use App\Models\Category;
use App\Models\Brand;
use App\Models\ProductVariant;
use App\Models\ProductImage;
use Illuminate\Http\Request;
use App\CentralLogics\ToastrWrapper as Toastr;
use App\CentralLogics\Helpers;
use Illuminate\Support\Str;

class ProductController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index(Request $request)
    {
        $query = Product::with(['category', 'brand', 'variants', 'images']);
        
        // Search
        $search = trim($request->input('search', ''));
        if ($search !== '') {
            $query->where(function ($q) use ($search) {
                $q->where('name', 'like', "%{$search}%")
                    ->orWhere('description', 'like', "%{$search}%");
            });
        }
        
        // Filter by status
        $status = $request->input('status');
        if ($status !== null && $status !== '') {
            $query->where('status', $status);
        }
        
        // Filter by category
        $categoryId = $request->input('category_id');
        if ($categoryId !== null && $categoryId !== '' && $categoryId !== '0') {
            $categoryId = (int)$categoryId;
            if ($categoryId > 0) {
                $query->where('category_id', $categoryId);
            }
        }
        
        // Filter by trending
        $isTrending = $request->input('is_trending');
        if ($isTrending !== null && $isTrending !== '') {
            $query->where('is_trending', (bool)$isTrending);
        }
        
        // Filter by latest
        $isLatest = $request->input('is_latest');
        if ($isLatest !== null && $isLatest !== '') {
            $query->where('is_latest', (bool)$isLatest);
        }
        
        // Filter by express_30
        $isExpress30 = $request->input('is_express_30');
        if ($isExpress30 !== null && $isExpress30 !== '') {
            $query->where('is_express_30', (bool)$isExpress30);
        }
        
        $products = $query->orderBy('created_at', 'desc')->paginate(25);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        
        return view('admin-views.products.index', compact('products', 'categories'));
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.create', compact('categories', 'brands'));
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Variant fields
                'variant_sku' => 'required|string|max:255',
                'variant_price' => 'required|numeric|min:0',
                'variant_sale_price' => 'nullable|numeric|min:0',
                'variant_status' => 'required|in:active,inactive',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:2048',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'variant_sku.required' => translate('messages.SKU is required!'),
                'variant_price.required' => translate('messages.Price is required!'),
                'variant_price.numeric' => translate('messages.Price must be a number!'),
                'variant_price.min' => translate('messages.Price must be greater than or equal to 0!'),
                'variant_sale_price.numeric' => translate('messages.Sale price must be a number!'),
                'variant_sale_price.min' => translate('messages.Sale price must be greater than or equal to 0!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 2MB!'),
            ]);

            // Check if SKU already exists
            if (ProductVariant::where('sku', $request->variant_sku)->exists()) {
                Toastr::error(translate('messages.SKU already exists!'));
                return back()->withInput();
            }

            // Create product
            $product = new Product();
            $product->name = $request->name;
            $product->slug = Str::slug($request->name) . '-' . uniqid();
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Create default variant
            $variant = new ProductVariant();
            $variant->product_id = $product->id;
            $variant->sku = $request->variant_sku;
            $variant->price = $request->variant_price;
            $variant->sale_price = $request->variant_sale_price ?? null;
            $variant->status = $request->variant_status;
            $variant->save();

            // Handle images
            if ($request->hasFile('images')) {
                $sortOrder = 0;
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant->id;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = ($sortOrder === 0) ? true : false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_added'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_add_product') . ': ' . $e->getMessage());
            \Log::error('Product creation error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit($id)
    {
        $product = Product::with(['category', 'brand', 'variants', 'images'])->findOrFail($id);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.edit', compact('product', 'categories', 'brands'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, $id)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:2048',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 2MB!'),
            ]);

            $product = Product::findOrFail($id);
            $product->name = $request->name;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Handle new images
            if ($request->hasFile('images')) {
                $existingImages = ProductImage::where('product_id', $product->id)->count();
                $sortOrder = $existingImages;
                
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $variant = $product->variants->first();
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant ? $variant->id : null;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_updated'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_product') . ': ' . $e->getMessage());
            \Log::error('Product update error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy($id)
    {
        try {
            $product = Product::findOrFail($id);
            
            // Delete product images
            foreach ($product->images as $image) {
                if ($image->image_url) {
                    try {
                        $storageType = Helpers::getDisk();
                        if ($storageType === 's3') {
                            \Storage::disk('s3')->delete('product/' . $image->image_url);
                        } else {
                            \Storage::disk('public')->delete('product/' . $image->image_url);
                        }
                    } catch (\Exception $e) {
                        \Log::warning('Failed to delete product image: ' . $e->getMessage());
                    }
                }
                $image->delete();
            }
            
            // Delete variants (this will cascade delete related data)
            $product->variants()->delete();
            
            $product->delete();
            
            Toastr::success(translate('messages.product_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_product') . ': ' . $e->getMessage());
            \Log::error('Product deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product status
     */
    public function statusToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $product->status = $request->status;
            $product->save();
            Toastr::success(translate('messages.product_status_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_status') . ': ' . $e->getMessage());
            \Log::error('Product status update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product flag (trending, latest, express_30)
     */
    public function flagToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $flag = $request->flag; // is_trending, is_latest, is_express_30
            
            if (!in_array($flag, ['is_trending', 'is_latest', 'is_express_30'])) {
                Toastr::error(translate('messages.Invalid flag!'));
                return back();
            }
            
            $product->$flag = $request->value;
            $product->save();
            
            Toastr::success(translate('messages.product_flag_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_flag') . ': ' . $e->getMessage());
            \Log::error('Product flag update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Delete product image
     */
    public function deleteImage($id)
    {
        try {
            $image = ProductImage::findOrFail($id);
            
            // Delete file
            if ($image->image_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('product/' . $image->image_url);
                    } else {
                        \Storage::disk('public')->delete('product/' . $image->image_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete product image file: ' . $e->getMessage());
                }
            }
            
            $image->delete();
            
            Toastr::success(translate('messages.image_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_image') . ': ' . $e->getMessage());
            \Log::error('Image deletion error: ' . $e->getMessage());
            return back();
        }
    }
}


```


Verifying the fix and ensuring the query is built correctly. Adding a more robust check:



Simplifying and fixing the category filter logic:


```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Product;
use App\Models\Category;
use App\Models\Brand;
use App\Models\ProductVariant;
use App\Models\ProductImage;
use Illuminate\Http\Request;
use App\CentralLogics\ToastrWrapper as Toastr;
use App\CentralLogics\Helpers;
use Illuminate\Support\Str;

class ProductController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index(Request $request)
    {
        $query = Product::with(['category', 'brand', 'variants', 'images']);
        
        // Search
        $search = trim($request->input('search', ''));
        if ($search !== '') {
            $query->where(function ($q) use ($search) {
                $q->where('name', 'like', "%{$search}%")
                    ->orWhere('description', 'like', "%{$search}%");
            });
        }
        
        // Filter by status
        $status = $request->input('status');
        if ($status !== null && $status !== '') {
            $query->where('status', $status);
        }
        
        // Filter by category
        $categoryId = $request->input('category_id');
        if (!empty($categoryId) && is_numeric($categoryId)) {
            $categoryId = (int)$categoryId;
            $query->where('category_id', $categoryId);
        }
        
        // Filter by trending
        $isTrending = $request->input('is_trending');
        if ($isTrending !== null && $isTrending !== '') {
            $query->where('is_trending', (bool)$isTrending);
        }
        
        // Filter by latest
        $isLatest = $request->input('is_latest');
        if ($isLatest !== null && $isLatest !== '') {
            $query->where('is_latest', (bool)$isLatest);
        }
        
        // Filter by express_30
        $isExpress30 = $request->input('is_express_30');
        if ($isExpress30 !== null && $isExpress30 !== '') {
            $query->where('is_express_30', (bool)$isExpress30);
        }
        
        $products = $query->orderBy('created_at', 'desc')->paginate(25);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        
        return view('admin-views.products.index', compact('products', 'categories'));
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.create', compact('categories', 'brands'));
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Variant fields
                'variant_sku' => 'required|string|max:255',
                'variant_price' => 'required|numeric|min:0',
                'variant_sale_price' => 'nullable|numeric|min:0',
                'variant_status' => 'required|in:active,inactive',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:2048',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'variant_sku.required' => translate('messages.SKU is required!'),
                'variant_price.required' => translate('messages.Price is required!'),
                'variant_price.numeric' => translate('messages.Price must be a number!'),
                'variant_price.min' => translate('messages.Price must be greater than or equal to 0!'),
                'variant_sale_price.numeric' => translate('messages.Sale price must be a number!'),
                'variant_sale_price.min' => translate('messages.Sale price must be greater than or equal to 0!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 2MB!'),
            ]);

            // Check if SKU already exists
            if (ProductVariant::where('sku', $request->variant_sku)->exists()) {
                Toastr::error(translate('messages.SKU already exists!'));
                return back()->withInput();
            }

            // Create product
            $product = new Product();
            $product->name = $request->name;
            $product->slug = Str::slug($request->name) . '-' . uniqid();
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Create default variant
            $variant = new ProductVariant();
            $variant->product_id = $product->id;
            $variant->sku = $request->variant_sku;
            $variant->price = $request->variant_price;
            $variant->sale_price = $request->variant_sale_price ?? null;
            $variant->status = $request->variant_status;
            $variant->save();

            // Handle images
            if ($request->hasFile('images')) {
                $sortOrder = 0;
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant->id;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = ($sortOrder === 0) ? true : false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_added'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_add_product') . ': ' . $e->getMessage());
            \Log::error('Product creation error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit($id)
    {
        $product = Product::with(['category', 'brand', 'variants', 'images'])->findOrFail($id);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.edit', compact('product', 'categories', 'brands'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, $id)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:2048',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 2MB!'),
            ]);

            $product = Product::findOrFail($id);
            $product->name = $request->name;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Handle new images
            if ($request->hasFile('images')) {
                $existingImages = ProductImage::where('product_id', $product->id)->count();
                $sortOrder = $existingImages;
                
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $variant = $product->variants->first();
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant ? $variant->id : null;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_updated'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_product') . ': ' . $e->getMessage());
            \Log::error('Product update error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy($id)
    {
        try {
            $product = Product::findOrFail($id);
            
            // Delete product images
            foreach ($product->images as $image) {
                if ($image->image_url) {
                    try {
                        $storageType = Helpers::getDisk();
                        if ($storageType === 's3') {
                            \Storage::disk('s3')->delete('product/' . $image->image_url);
                        } else {
                            \Storage::disk('public')->delete('product/' . $image->image_url);
                        }
                    } catch (\Exception $e) {
                        \Log::warning('Failed to delete product image: ' . $e->getMessage());
                    }
                }
                $image->delete();
            }
            
            // Delete variants (this will cascade delete related data)
            $product->variants()->delete();
            
            $product->delete();
            
            Toastr::success(translate('messages.product_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_product') . ': ' . $e->getMessage());
            \Log::error('Product deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product status
     */
    public function statusToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $product->status = $request->status;
            $product->save();
            Toastr::success(translate('messages.product_status_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_status') . ': ' . $e->getMessage());
            \Log::error('Product status update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product flag (trending, latest, express_30)
     */
    public function flagToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $flag = $request->flag; // is_trending, is_latest, is_express_30
            
            if (!in_array($flag, ['is_trending', 'is_latest', 'is_express_30'])) {
                Toastr::error(translate('messages.Invalid flag!'));
                return back();
            }
            
            $product->$flag = $request->value;
            $product->save();
            
            Toastr::success(translate('messages.product_flag_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_flag') . ': ' . $e->getMessage());
            \Log::error('Product flag update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Delete product image
     */
    public function deleteImage($id)
    {
        try {
            $image = ProductImage::findOrFail($id);
            
            // Delete file
            if ($image->image_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('product/' . $image->image_url);
                    } else {
                        \Storage::disk('public')->delete('product/' . $image->image_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete product image file: ' . $e->getMessage());
                }
            }
            
            $image->delete();
            
            Toastr::success(translate('messages.image_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_image') . ': ' . $e->getMessage());
            \Log::error('Image deletion error: ' . $e->getMessage());
            return back();
        }
    }
}


```


Verifying the complete filtering logic in the index method:



Adding a safety check to ensure the category ID is greater than 0:


```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Product;
use App\Models\Category;
use App\Models\Brand;
use App\Models\ProductVariant;
use App\Models\ProductImage;
use Illuminate\Http\Request;
use App\CentralLogics\ToastrWrapper as Toastr;
use App\CentralLogics\Helpers;
use Illuminate\Support\Str;

class ProductController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index(Request $request)
    {
        $query = Product::with(['category', 'brand', 'variants', 'images']);
        
        // Search
        $search = trim($request->input('search', ''));
        if ($search !== '') {
            $query->where(function ($q) use ($search) {
                $q->where('name', 'like', "%{$search}%")
                    ->orWhere('description', 'like', "%{$search}%");
            });
        }
        
        // Filter by status
        $status = $request->input('status');
        if ($status !== null && $status !== '') {
            $query->where('status', $status);
        }
        
        // Filter by category
        $categoryId = $request->input('category_id');
        if (!empty($categoryId) && is_numeric($categoryId) && (int)$categoryId > 0) {
            $query->where('category_id', (int)$categoryId);
        }
        
        // Filter by trending
        $isTrending = $request->input('is_trending');
        if ($isTrending !== null && $isTrending !== '') {
            $query->where('is_trending', (bool)$isTrending);
        }
        
        // Filter by latest
        $isLatest = $request->input('is_latest');
        if ($isLatest !== null && $isLatest !== '') {
            $query->where('is_latest', (bool)$isLatest);
        }
        
        // Filter by express_30
        $isExpress30 = $request->input('is_express_30');
        if ($isExpress30 !== null && $isExpress30 !== '') {
            $query->where('is_express_30', (bool)$isExpress30);
        }
        
        $products = $query->orderBy('created_at', 'desc')->paginate(25);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        
        return view('admin-views.products.index', compact('products', 'categories'));
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.create', compact('categories', 'brands'));
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Variant fields
                'variant_sku' => 'required|string|max:255',
                'variant_price' => 'required|numeric|min:0',
                'variant_sale_price' => 'nullable|numeric|min:0',
                'variant_status' => 'required|in:active,inactive',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:2048',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'variant_sku.required' => translate('messages.SKU is required!'),
                'variant_price.required' => translate('messages.Price is required!'),
                'variant_price.numeric' => translate('messages.Price must be a number!'),
                'variant_price.min' => translate('messages.Price must be greater than or equal to 0!'),
                'variant_sale_price.numeric' => translate('messages.Sale price must be a number!'),
                'variant_sale_price.min' => translate('messages.Sale price must be greater than or equal to 0!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 2MB!'),
            ]);

            // Check if SKU already exists
            if (ProductVariant::where('sku', $request->variant_sku)->exists()) {
                Toastr::error(translate('messages.SKU already exists!'));
                return back()->withInput();
            }

            // Create product
            $product = new Product();
            $product->name = $request->name;
            $product->slug = Str::slug($request->name) . '-' . uniqid();
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Create default variant
            $variant = new ProductVariant();
            $variant->product_id = $product->id;
            $variant->sku = $request->variant_sku;
            $variant->price = $request->variant_price;
            $variant->sale_price = $request->variant_sale_price ?? null;
            $variant->status = $request->variant_status;
            $variant->save();

            // Handle images
            if ($request->hasFile('images')) {
                $sortOrder = 0;
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant->id;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = ($sortOrder === 0) ? true : false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_added'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_add_product') . ': ' . $e->getMessage());
            \Log::error('Product creation error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit($id)
    {
        $product = Product::with(['category', 'brand', 'variants', 'images'])->findOrFail($id);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.edit', compact('product', 'categories', 'brands'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, $id)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:2048',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 2MB!'),
            ]);

            $product = Product::findOrFail($id);
            $product->name = $request->name;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Handle new images
            if ($request->hasFile('images')) {
                $existingImages = ProductImage::where('product_id', $product->id)->count();
                $sortOrder = $existingImages;
                
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $variant = $product->variants->first();
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant ? $variant->id : null;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_updated'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_product') . ': ' . $e->getMessage());
            \Log::error('Product update error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy($id)
    {
        try {
            $product = Product::findOrFail($id);
            
            // Delete product images
            foreach ($product->images as $image) {
                if ($image->image_url) {
                    try {
                        $storageType = Helpers::getDisk();
                        if ($storageType === 's3') {
                            \Storage::disk('s3')->delete('product/' . $image->image_url);
                        } else {
                            \Storage::disk('public')->delete('product/' . $image->image_url);
                        }
                    } catch (\Exception $e) {
                        \Log::warning('Failed to delete product image: ' . $e->getMessage());
                    }
                }
                $image->delete();
            }
            
            // Delete variants (this will cascade delete related data)
            $product->variants()->delete();
            
            $product->delete();
            
            Toastr::success(translate('messages.product_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_product') . ': ' . $e->getMessage());
            \Log::error('Product deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product status
     */
    public function statusToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $product->status = $request->status;
            $product->save();
            Toastr::success(translate('messages.product_status_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_status') . ': ' . $e->getMessage());
            \Log::error('Product status update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product flag (trending, latest, express_30)
     */
    public function flagToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $flag = $request->flag; // is_trending, is_latest, is_express_30
            
            if (!in_array($flag, ['is_trending', 'is_latest', 'is_express_30'])) {
                Toastr::error(translate('messages.Invalid flag!'));
                return back();
            }
            
            $product->$flag = $request->value;
            $product->save();
            
            Toastr::success(translate('messages.product_flag_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_flag') . ': ' . $e->getMessage());
            \Log::error('Product flag update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Delete product image
     */
    public function deleteImage($id)
    {
        try {
            $image = ProductImage::findOrFail($id);
            
            // Delete file
            if ($image->image_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('product/' . $image->image_url);
                    } else {
                        \Storage::disk('public')->delete('product/' . $image->image_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete product image file: ' . $e->getMessage());
                }
            }
            
            $image->delete();
            
            Toastr::success(translate('messages.image_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_image') . ': ' . $e->getMessage());
            \Log::error('Image deletion error: ' . $e->getMessage());
            return back();
        }
    }
}


```


Fixed the category filter logic in the ProductController. Summary of changes:

## Fix applied

**File:** `app/Http/Controllers/Admin/ProductController.php`

**Changed the category filter logic from:**
```php
$categoryId = $request->input('category_id');
if ($categoryId !== null && $categoryId !== '' && $categoryId !== '0') {
    $categoryId = (int)$categoryId;
    if ($categoryId > 0) {
        $query->where('category_id', $categoryId);
    }
}
```

**To:**
```php
$categoryId = $request->input('category_id');
if (!empty($categoryId) && is_numeric($categoryId) && (int)$categoryId > 0) {
    $query->where('category_id', (int)$categoryId);
}
```

## What this fixes

1. Validates the category ID: checks for empty, numeric, and > 0
2. Handles edge cases: ignores empty strings, null, "0", and non-numeric values
3. Applies the filter only when a valid category ID is provided

The filter now:
- Works when a category is selected
- Ignores when "All Categories" is selected (empty value)
- Handles invalid or edge case values
- Works with search and status filters

No UI, routes, API logic, or database structure changes were made‚Äîonly the filtering logic was updated.

```php
$categoryId = $request->input('category_id');
if ($categoryId !== null && $categoryId !== '' && $categoryId !== '0') {
    $categoryId = (int)$categoryId;
    if ($categoryId > 0) {
        $query->where('category_id', $categoryId);
    }
}
```

```php
$categoryId = $request->input('category_id');
if (!empty($categoryId) && is_numeric($categoryId) && (int)$categoryId > 0) {
    $query->where('category_id', (int)$categoryId);
}
```

---

**User**

Working but only getting issue when 0 data found in search, handle with not data found display

---

**Cursor**


Checking the empty state implementation and fixing the "no data found" display when filters return 0 results.



Checking the table structure to ensure the empty state colspan matches the number of columns:



Fixing the empty state display. DataTables may be interfering. Ensuring it shows correctly when there are no results:


```blade
@extends('layouts.admin.app')

@section('title', translate('messages.products'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .badge-express {
        background-color: #f0ad4e;
        color: #fff;
    }
    
    .search-filter-wrapper {
        display: flex;
        gap: 10px;
        align-items: flex-end;
        flex-wrap: wrap;
    }
    
    .search-filter-wrapper .form-group {
        margin-bottom: 0;
        flex: 1;
        min-width: 200px;
    }
    
    .search-filter-wrapper .form-group label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 5px;
        font-size: 0.875rem;
    }
    
    .search-filter-wrapper .btn {
        white-space: nowrap;
        height: fit-content;
    }
    
    @media (max-width: 768px) {
        .search-filter-wrapper {
            flex-direction: column;
        }
        
        .search-filter-wrapper .form-group {
            width: 100%;
        }
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-shop"></i>
                </span>
                <span>
                    {{ translate('messages.products') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.products') }} <span class="badge badge-soft-dark ml-2" id="product-count">{{ $products->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.products.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_product') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.products.index') }}" id="product-filter-form" class="mb-3">
                    <div class="search-filter-wrapper">
                        <div class="form-group">
                            <label for="search">Search Products</label>
                            <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or description..." value="{{ old('search', request('search')) }}">
                        </div>
                        <div class="form-group">
                            <label for="category_id">Filter by Category</label>
                            <select name="category_id" id="category_id" class="form-control">
                                <option value="">All Categories</option>
                                @foreach($categories as $category)
                                    <option value="{{ $category->id }}" {{ old('category_id', request('category_id')) == $category->id || (string)old('category_id', request('category_id')) === (string)$category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                @endforeach
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status">Status</label>
                            <select name="status" id="status" class="form-control">
                                <option value="">All Status</option>
                                <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn--primary">
                                    <i class="tio-search"></i> Search
                                </button>
                                @if(request('search') || request('category_id') || request('status'))
                                    <a href="{{ route('admin.products.index') }}" class="btn btn--reset">
                                        <i class="tio-clear"></i> Clear
                                    </a>
                                @endif
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Product Name</th>
                        <th class="border-0">Category</th>
                        <th class="border-0">Price</th>
                        <th class="border-0 text-center">Trending</th>
                        <th class="border-0 text-center">Latest</th>
                        <th class="border-0 text-center">Express-30</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($products as $key => $product)
                        <tr>
                            <td>{{ ($products->currentPage() - 1) * $products->perPage() + $key + 1 }}</td>
                            <td>
                                @php
                                    $primaryImage = $product->images->where('is_primary', true)->first() ?? $product->images->first();
                                @endphp
                                @if($primaryImage)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $primaryImage->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $product->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/160x160/img2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ Str::limit($product->name, 30, '...') }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $product->category ? $product->category->name : '-' }}
                                </span>
                            </td>
                            <td>
                                @php
                                    $variant = $product->variants->first();
                                    $price = $variant ? ($variant->sale_price ?? $variant->price) : 0;
                                @endphp
                                <span class="d-block font-size-sm text-body">
                                    ‚Çπ{{ number_format($price, 2) }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="trending-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_trending"
                                           data-value="{{ $product->is_trending ? 0 : 1 }}"
                                           id="trending-{{ $product->id }}" {{ $product->is_trending ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="latest-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_latest"
                                           data-value="{{ $product->is_latest ? 0 : 1 }}"
                                           id="latest-{{ $product->id }}" {{ $product->is_latest ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="express-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_express_30"
                                           data-value="{{ $product->is_express_30 ? 0 : 1 }}"
                                           id="express-{{ $product->id }}" {{ $product->is_express_30 ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $product->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this product?"
                                           data-title-off="Want to deactivate this product?"
                                           id="status-{{ $product->id }}" {{ $product->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.products.status') }}" method="post" id="status-{{ $product->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $product->id }}">
                                    <input type="hidden" name="status" value="{{ $product->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.products.edit', $product->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="product-{{ $product->id }}" 
                                       data-form-id="product-{{ $product->id }}"
                                       data-message="Want to delete this product?" 
                                       data-title="Delete Product"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.products.destroy', $product->id) }}"
                                            method="post" id="product-{{ $product->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr>
                            <td colspan="10" class="text-center py-4">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5>{{ translate('no_data_found') }}</h5>
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                <div class="mt-3">
                    {{ $products->appends(request()->query())->links() }}
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                if (typeof PageLoader !== 'undefined') {
                    setTimeout(function() {
                        PageLoader.hide();
                    }, 300);
                }
            }
        });
        
        // Handle flag toggles
        $(document).on('change', '.flag-toggle', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $checkbox = $(this);
            var productId = $checkbox.data('id');
            var flag = $checkbox.data('flag');
            var value = $checkbox.data('value');
            
            $.ajax({
                url: '{{ route('admin.products.flag') }}',
                method: 'POST',
                data: {
                    _token: '{{ csrf_token() }}',
                    id: productId,
                    flag: flag,
                    value: value
                },
                success: function(response) {
                    // Update the data-value for next toggle
                    $checkbox.data('value', value == 1 ? 0 : 1);
                },
                error: function(xhr) {
                    // Revert checkbox
                    $checkbox.prop('checked', !$checkbox.prop('checked'));
                    alert('Failed to update flag. Please try again.');
                }
            });
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        $(window).on('load', function() {
            setTimeout(function() {
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.hide();
                }
            }, 500);
        });
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.products'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .badge-express {
        background-color: #f0ad4e;
        color: #fff;
    }
    
    .search-filter-wrapper {
        display: flex;
        gap: 10px;
        align-items: flex-end;
        flex-wrap: wrap;
    }
    
    .search-filter-wrapper .form-group {
        margin-bottom: 0;
        flex: 1;
        min-width: 200px;
    }
    
    .search-filter-wrapper .form-group label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 5px;
        font-size: 0.875rem;
    }
    
    .search-filter-wrapper .btn {
        white-space: nowrap;
        height: fit-content;
    }
    
    @media (max-width: 768px) {
        .search-filter-wrapper {
            flex-direction: column;
        }
        
        .search-filter-wrapper .form-group {
            width: 100%;
        }
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-shop"></i>
                </span>
                <span>
                    {{ translate('messages.products') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.products') }} <span class="badge badge-soft-dark ml-2" id="product-count">{{ $products->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.products.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_product') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.products.index') }}" id="product-filter-form" class="mb-3">
                    <div class="search-filter-wrapper">
                        <div class="form-group">
                            <label for="search">Search Products</label>
                            <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or description..." value="{{ old('search', request('search')) }}">
                        </div>
                        <div class="form-group">
                            <label for="category_id">Filter by Category</label>
                            <select name="category_id" id="category_id" class="form-control">
                                <option value="">All Categories</option>
                                @foreach($categories as $category)
                                    <option value="{{ $category->id }}" {{ old('category_id', request('category_id')) == $category->id || (string)old('category_id', request('category_id')) === (string)$category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                @endforeach
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status">Status</label>
                            <select name="status" id="status" class="form-control">
                                <option value="">All Status</option>
                                <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn--primary">
                                    <i class="tio-search"></i> Search
                                </button>
                                @if(request('search') || request('category_id') || request('status'))
                                    <a href="{{ route('admin.products.index') }}" class="btn btn--reset">
                                        <i class="tio-clear"></i> Clear
                                    </a>
                                @endif
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Product Name</th>
                        <th class="border-0">Category</th>
                        <th class="border-0">Price</th>
                        <th class="border-0 text-center">Trending</th>
                        <th class="border-0 text-center">Latest</th>
                        <th class="border-0 text-center">Express-30</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($products as $key => $product)
                        <tr>
                            <td>{{ ($products->currentPage() - 1) * $products->perPage() + $key + 1 }}</td>
                            <td>
                                @php
                                    $primaryImage = $product->images->where('is_primary', true)->first() ?? $product->images->first();
                                @endphp
                                @if($primaryImage)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $primaryImage->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $product->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/160x160/img2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ Str::limit($product->name, 30, '...') }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $product->category ? $product->category->name : '-' }}
                                </span>
                            </td>
                            <td>
                                @php
                                    $variant = $product->variants->first();
                                    $price = $variant ? ($variant->sale_price ?? $variant->price) : 0;
                                @endphp
                                <span class="d-block font-size-sm text-body">
                                    ‚Çπ{{ number_format($price, 2) }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="trending-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_trending"
                                           data-value="{{ $product->is_trending ? 0 : 1 }}"
                                           id="trending-{{ $product->id }}" {{ $product->is_trending ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="latest-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_latest"
                                           data-value="{{ $product->is_latest ? 0 : 1 }}"
                                           id="latest-{{ $product->id }}" {{ $product->is_latest ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="express-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_express_30"
                                           data-value="{{ $product->is_express_30 ? 0 : 1 }}"
                                           id="express-{{ $product->id }}" {{ $product->is_express_30 ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $product->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this product?"
                                           data-title-off="Want to deactivate this product?"
                                           id="status-{{ $product->id }}" {{ $product->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.products.status') }}" method="post" id="status-{{ $product->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $product->id }}">
                                    <input type="hidden" name="status" value="{{ $product->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.products.edit', $product->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="product-{{ $product->id }}" 
                                       data-form-id="product-{{ $product->id }}"
                                       data-message="Want to delete this product?" 
                                       data-title="Delete Product"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.products.destroy', $product->id) }}"
                                            method="post" id="product-{{ $product->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr class="no-data-row">
                            <td colspan="10" class="text-center py-5">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5 class="mb-2">{{ translate('no_data_found') }}</h5>
                                    @if(request('search') || request('category_id') || request('status'))
                                        <p class="text-muted">Try adjusting your search or filter criteria.</p>
                                        <a href="{{ route('admin.products.index') }}" class="btn btn--primary btn-sm mt-2">
                                            <i class="tio-clear"></i> Clear Filters
                                        </a>
                                    @endif
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                <div class="mt-3">
                    {{ $products->appends(request()->query())->links() }}
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                if (typeof PageLoader !== 'undefined') {
                    setTimeout(function() {
                        PageLoader.hide();
                    }, 300);
                }
            }
        });
        
        // Handle flag toggles
        $(document).on('change', '.flag-toggle', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $checkbox = $(this);
            var productId = $checkbox.data('id');
            var flag = $checkbox.data('flag');
            var value = $checkbox.data('value');
            
            $.ajax({
                url: '{{ route('admin.products.flag') }}',
                method: 'POST',
                data: {
                    _token: '{{ csrf_token() }}',
                    id: productId,
                    flag: flag,
                    value: value
                },
                success: function(response) {
                    // Update the data-value for next toggle
                    $checkbox.data('value', value == 1 ? 0 : 1);
                },
                error: function(xhr) {
                    // Revert checkbox
                    $checkbox.prop('checked', !$checkbox.prop('checked'));
                    alert('Failed to update flag. Please try again.');
                }
            });
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        $(window).on('load', function() {
            setTimeout(function() {
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.hide();
                }
            }, 500);
        });
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.categories'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .dataTables_wrapper .dataTables_length label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .dataTables_wrapper .dataTables_length select {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 80px;
    }
    
    .dataTables_wrapper .dataTables_filter {
        text-align: right;
    }
    
    .dataTables_wrapper .dataTables_filter label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: flex-end;
    }
    
    .dataTables_wrapper .dataTables_filter input {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 200px;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-category"></i>
                </span>
                <span>
                    {{ translate('messages.categories') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.categories') }} <span class="badge badge-soft-dark ml-2" id="category-count">{{ $categories->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.categories.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_category') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.categories.index') }}" id="category-filter-form" class="mb-3">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="search">Search Categories</label>
                                <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or slug..." value="{{ old('search', request('search')) }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="status">Status</label>
                                <select name="status" id="status" class="form-control">
                                    <option value="">All Status</option>
                                    <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                    <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="parent_id">Parent Category</label>
                                <select name="parent_id" id="parent_id" class="form-control">
                                    <option value="">All Categories</option>
                                    <option value="null" {{ old('parent_id', request('parent_id')) == 'null' ? 'selected' : '' }}>Main Categories Only</option>
                                    @foreach($parentCategories as $parent)
                                        <option value="{{ $parent->id }}" {{ old('parent_id', request('parent_id')) == $parent->id || (string)old('parent_id', request('parent_id')) === (string)$parent->id ? 'selected' : '' }}>{{ $parent->name }}</option>
                                    @endforeach
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <div class="d-flex gap-2">
                                    <button type="submit" class="btn btn--primary w-100">
                                        <i class="tio-search"></i> Filter
                                    </button>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--reset">
                                            <i class="tio-clear"></i>
                                        </a>
                                    @endif
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Name</th>
                        <th class="border-0">Parent</th>
                        <th class="border-0">Slug</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($categories as $key => $category)
                        <tr>
                            <td>{{ ($categories->currentPage() - 1) * $categories->perPage() + $key + 1 }}</td>
                            <td>
                                @if($category->image_url)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('category', $category->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $category->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/100x100/2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->name }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->parent ? $category->parent->name : '-' }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->slug }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $category->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $category->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this category?"
                                           data-title-off="Want to deactivate this category?"
                                           id="status-{{ $category->id }}" {{ $category->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.categories.status') }}" method="post" id="status-{{ $category->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $category->id }}">
                                    <input type="hidden" name="status" value="{{ $category->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.categories.edit', $category->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="category-{{ $category->id }}" 
                                       data-form-id="category-{{ $category->id }}"
                                       data-message="Want to delete this category?" 
                                       data-title="Delete Category"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.categories.destroy', $category->id) }}"
                                            method="post" id="category-{{ $category->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr>
                            <td colspan="7" class="text-center py-4">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5>{{ translate('no_data_found') }}</h5>
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                <div class="mt-3">
                    {{ $categories->appends(request()->query())->links() }}
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                if (typeof PageLoader !== 'undefined') {
                    setTimeout(function() {
                        PageLoader.hide();
                    }, 300);
                }
            }
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        $(window).on('load', function() {
            setTimeout(function() {
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.hide();
                }
            }, 500);
        });
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.categories'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .dataTables_wrapper .dataTables_length label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .dataTables_wrapper .dataTables_length select {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 80px;
    }
    
    .dataTables_wrapper .dataTables_filter {
        text-align: right;
    }
    
    .dataTables_wrapper .dataTables_filter label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: flex-end;
    }
    
    .dataTables_wrapper .dataTables_filter input {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 200px;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-category"></i>
                </span>
                <span>
                    {{ translate('messages.categories') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.categories') }} <span class="badge badge-soft-dark ml-2" id="category-count">{{ $categories->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.categories.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_category') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.categories.index') }}" id="category-filter-form" class="mb-3">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="search">Search Categories</label>
                                <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or slug..." value="{{ old('search', request('search')) }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="status">Status</label>
                                <select name="status" id="status" class="form-control">
                                    <option value="">All Status</option>
                                    <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                    <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="parent_id">Parent Category</label>
                                <select name="parent_id" id="parent_id" class="form-control">
                                    <option value="">All Categories</option>
                                    <option value="null" {{ old('parent_id', request('parent_id')) == 'null' ? 'selected' : '' }}>Main Categories Only</option>
                                    @foreach($parentCategories as $parent)
                                        <option value="{{ $parent->id }}" {{ old('parent_id', request('parent_id')) == $parent->id || (string)old('parent_id', request('parent_id')) === (string)$parent->id ? 'selected' : '' }}>{{ $parent->name }}</option>
                                    @endforeach
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <div class="d-flex gap-2">
                                    <button type="submit" class="btn btn--primary w-100">
                                        <i class="tio-search"></i> Filter
                                    </button>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--reset">
                                            <i class="tio-clear"></i>
                                        </a>
                                    @endif
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Name</th>
                        <th class="border-0">Parent</th>
                        <th class="border-0">Slug</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($categories as $key => $category)
                        <tr>
                            <td>{{ ($categories->currentPage() - 1) * $categories->perPage() + $key + 1 }}</td>
                            <td>
                                @if($category->image_url)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('category', $category->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $category->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/100x100/2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->name }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->parent ? $category->parent->name : '-' }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->slug }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $category->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $category->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this category?"
                                           data-title-off="Want to deactivate this category?"
                                           id="status-{{ $category->id }}" {{ $category->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.categories.status') }}" method="post" id="status-{{ $category->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $category->id }}">
                                    <input type="hidden" name="status" value="{{ $category->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.categories.edit', $category->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="category-{{ $category->id }}" 
                                       data-form-id="category-{{ $category->id }}"
                                       data-message="Want to delete this category?" 
                                       data-title="Delete Category"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.categories.destroy', $category->id) }}"
                                            method="post" id="category-{{ $category->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr class="no-data-row">
                            <td colspan="7" class="text-center py-5">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5 class="mb-2">{{ translate('no_data_found') }}</h5>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <p class="text-muted">Try adjusting your search or filter criteria.</p>
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--primary btn-sm mt-2">
                                            <i class="tio-clear"></i> Clear Filters
                                        </a>
                                    @endif
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                <div class="mt-3">
                    {{ $categories->appends(request()->query())->links() }}
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                if (typeof PageLoader !== 'undefined') {
                    setTimeout(function() {
                        PageLoader.hide();
                    }, 300);
                }
            }
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        $(window).on('load', function() {
            setTimeout(function() {
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.hide();
                }
            }, 500);
        });
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.products'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .badge-express {
        background-color: #f0ad4e;
        color: #fff;
    }
    
    .search-filter-wrapper {
        display: flex;
        gap: 10px;
        align-items: flex-end;
        flex-wrap: wrap;
    }
    
    .search-filter-wrapper .form-group {
        margin-bottom: 0;
        flex: 1;
        min-width: 200px;
    }
    
    .search-filter-wrapper .form-group label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 5px;
        font-size: 0.875rem;
    }
    
    .search-filter-wrapper .btn {
        white-space: nowrap;
        height: fit-content;
    }
    
    @media (max-width: 768px) {
        .search-filter-wrapper {
            flex-direction: column;
        }
        
        .search-filter-wrapper .form-group {
            width: 100%;
        }
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-shop"></i>
                </span>
                <span>
                    {{ translate('messages.products') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.products') }} <span class="badge badge-soft-dark ml-2" id="product-count">{{ $products->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.products.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_product') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.products.index') }}" id="product-filter-form" class="mb-3">
                    <div class="search-filter-wrapper">
                        <div class="form-group">
                            <label for="search">Search Products</label>
                            <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or description..." value="{{ old('search', request('search')) }}">
                        </div>
                        <div class="form-group">
                            <label for="category_id">Filter by Category</label>
                            <select name="category_id" id="category_id" class="form-control">
                                <option value="">All Categories</option>
                                @foreach($categories as $category)
                                    <option value="{{ $category->id }}" {{ old('category_id', request('category_id')) == $category->id || (string)old('category_id', request('category_id')) === (string)$category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                @endforeach
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status">Status</label>
                            <select name="status" id="status" class="form-control">
                                <option value="">All Status</option>
                                <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn--primary">
                                    <i class="tio-search"></i> Search
                                </button>
                                @if(request('search') || request('category_id') || request('status'))
                                    <a href="{{ route('admin.products.index') }}" class="btn btn--reset">
                                        <i class="tio-clear"></i> Clear
                                    </a>
                                @endif
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Product Name</th>
                        <th class="border-0">Category</th>
                        <th class="border-0">Price</th>
                        <th class="border-0 text-center">Trending</th>
                        <th class="border-0 text-center">Latest</th>
                        <th class="border-0 text-center">Express-30</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($products as $key => $product)
                        <tr>
                            <td>{{ ($products->currentPage() - 1) * $products->perPage() + $key + 1 }}</td>
                            <td>
                                @php
                                    $primaryImage = $product->images->where('is_primary', true)->first() ?? $product->images->first();
                                @endphp
                                @if($primaryImage)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $primaryImage->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $product->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/160x160/img2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ Str::limit($product->name, 30, '...') }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $product->category ? $product->category->name : '-' }}
                                </span>
                            </td>
                            <td>
                                @php
                                    $variant = $product->variants->first();
                                    $price = $variant ? ($variant->sale_price ?? $variant->price) : 0;
                                @endphp
                                <span class="d-block font-size-sm text-body">
                                    ‚Çπ{{ number_format($price, 2) }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="trending-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_trending"
                                           data-value="{{ $product->is_trending ? 0 : 1 }}"
                                           id="trending-{{ $product->id }}" {{ $product->is_trending ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="latest-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_latest"
                                           data-value="{{ $product->is_latest ? 0 : 1 }}"
                                           id="latest-{{ $product->id }}" {{ $product->is_latest ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="express-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_express_30"
                                           data-value="{{ $product->is_express_30 ? 0 : 1 }}"
                                           id="express-{{ $product->id }}" {{ $product->is_express_30 ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $product->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this product?"
                                           data-title-off="Want to deactivate this product?"
                                           id="status-{{ $product->id }}" {{ $product->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.products.status') }}" method="post" id="status-{{ $product->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $product->id }}">
                                    <input type="hidden" name="status" value="{{ $product->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.products.edit', $product->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="product-{{ $product->id }}" 
                                       data-form-id="product-{{ $product->id }}"
                                       data-message="Want to delete this product?" 
                                       data-title="Delete Product"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.products.destroy', $product->id) }}"
                                            method="post" id="product-{{ $product->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr class="no-data-row">
                            <td colspan="10" class="text-center py-5">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5 class="mb-2">{{ translate('no_data_found') }}</h5>
                                    @if(request('search') || request('category_id') || request('status'))
                                        <p class="text-muted">Try adjusting your search or filter criteria.</p>
                                        <a href="{{ route('admin.products.index') }}" class="btn btn--primary btn-sm mt-2">
                                            <i class="tio-clear"></i> Clear Filters
                                        </a>
                                    @endif
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                <div class="mt-3">
                    {{ $products->appends(request()->query())->links() }}
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                // Ensure empty state row is visible
                $('.no-data-row').show();
                if (typeof PageLoader !== 'undefined') {
                    setTimeout(function() {
                        PageLoader.hide();
                    }, 300);
                }
            }
        });
        
        // Ensure empty state is always visible when table is empty
        if (table.rows().count() === 0) {
            $('.no-data-row').show();
        }
        
        // Handle flag toggles
        $(document).on('change', '.flag-toggle', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $checkbox = $(this);
            var productId = $checkbox.data('id');
            var flag = $checkbox.data('flag');
            var value = $checkbox.data('value');
            
            $.ajax({
                url: '{{ route('admin.products.flag') }}',
                method: 'POST',
                data: {
                    _token: '{{ csrf_token() }}',
                    id: productId,
                    flag: flag,
                    value: value
                },
                success: function(response) {
                    // Update the data-value for next toggle
                    $checkbox.data('value', value == 1 ? 0 : 1);
                },
                error: function(xhr) {
                    // Revert checkbox
                    $checkbox.prop('checked', !$checkbox.prop('checked'));
                    alert('Failed to update flag. Please try again.');
                }
            });
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        $(window).on('load', function() {
            setTimeout(function() {
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.hide();
                }
            }, 500);
        });
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.categories'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .dataTables_wrapper .dataTables_length label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .dataTables_wrapper .dataTables_length select {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 80px;
    }
    
    .dataTables_wrapper .dataTables_filter {
        text-align: right;
    }
    
    .dataTables_wrapper .dataTables_filter label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: flex-end;
    }
    
    .dataTables_wrapper .dataTables_filter input {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 200px;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-category"></i>
                </span>
                <span>
                    {{ translate('messages.categories') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.categories') }} <span class="badge badge-soft-dark ml-2" id="category-count">{{ $categories->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.categories.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_category') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.categories.index') }}" id="category-filter-form" class="mb-3">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="search">Search Categories</label>
                                <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or slug..." value="{{ old('search', request('search')) }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="status">Status</label>
                                <select name="status" id="status" class="form-control">
                                    <option value="">All Status</option>
                                    <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                    <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="parent_id">Parent Category</label>
                                <select name="parent_id" id="parent_id" class="form-control">
                                    <option value="">All Categories</option>
                                    <option value="null" {{ old('parent_id', request('parent_id')) == 'null' ? 'selected' : '' }}>Main Categories Only</option>
                                    @foreach($parentCategories as $parent)
                                        <option value="{{ $parent->id }}" {{ old('parent_id', request('parent_id')) == $parent->id || (string)old('parent_id', request('parent_id')) === (string)$parent->id ? 'selected' : '' }}>{{ $parent->name }}</option>
                                    @endforeach
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <div class="d-flex gap-2">
                                    <button type="submit" class="btn btn--primary w-100">
                                        <i class="tio-search"></i> Filter
                                    </button>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--reset">
                                            <i class="tio-clear"></i>
                                        </a>
                                    @endif
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Name</th>
                        <th class="border-0">Parent</th>
                        <th class="border-0">Slug</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($categories as $key => $category)
                        <tr>
                            <td>{{ ($categories->currentPage() - 1) * $categories->perPage() + $key + 1 }}</td>
                            <td>
                                @if($category->image_url)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('category', $category->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $category->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/100x100/2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->name }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->parent ? $category->parent->name : '-' }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->slug }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $category->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $category->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this category?"
                                           data-title-off="Want to deactivate this category?"
                                           id="status-{{ $category->id }}" {{ $category->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.categories.status') }}" method="post" id="status-{{ $category->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $category->id }}">
                                    <input type="hidden" name="status" value="{{ $category->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.categories.edit', $category->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="category-{{ $category->id }}" 
                                       data-form-id="category-{{ $category->id }}"
                                       data-message="Want to delete this category?" 
                                       data-title="Delete Category"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.categories.destroy', $category->id) }}"
                                            method="post" id="category-{{ $category->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr class="no-data-row">
                            <td colspan="7" class="text-center py-5">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5 class="mb-2">{{ translate('no_data_found') }}</h5>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <p class="text-muted">Try adjusting your search or filter criteria.</p>
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--primary btn-sm mt-2">
                                            <i class="tio-clear"></i> Clear Filters
                                        </a>
                                    @endif
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                <div class="mt-3">
                    {{ $categories->appends(request()->query())->links() }}
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                // Ensure empty state row is visible
                $('.no-data-row').show();
                if (typeof PageLoader !== 'undefined') {
                    setTimeout(function() {
                        PageLoader.hide();
                    }, 300);
                }
            }
        });
        
        // Ensure empty state is always visible when table is empty
        if (table.rows().count() === 0) {
            $('.no-data-row').show();
        }
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        $(window).on('load', function() {
            setTimeout(function() {
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.hide();
                }
            }, 500);
        });
    });
</script>
@endpush


```


Adding CSS to ensure the empty state is always visible:


```blade
@extends('layouts.admin.app')

@section('title', translate('messages.products'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .badge-express {
        background-color: #f0ad4e;
        color: #fff;
    }
    
    .no-data-row {
        display: table-row !important;
    }
    
    .no-data-row td {
        padding: 3rem 1rem !important;
    }
    
    .search-filter-wrapper {
        display: flex;
        gap: 10px;
        align-items: flex-end;
        flex-wrap: wrap;
    }
    
    .search-filter-wrapper .form-group {
        margin-bottom: 0;
        flex: 1;
        min-width: 200px;
    }
    
    .search-filter-wrapper .form-group label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 5px;
        font-size: 0.875rem;
    }
    
    .search-filter-wrapper .btn {
        white-space: nowrap;
        height: fit-content;
    }
    
    @media (max-width: 768px) {
        .search-filter-wrapper {
            flex-direction: column;
        }
        
        .search-filter-wrapper .form-group {
            width: 100%;
        }
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-shop"></i>
                </span>
                <span>
                    {{ translate('messages.products') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.products') }} <span class="badge badge-soft-dark ml-2" id="product-count">{{ $products->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.products.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_product') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.products.index') }}" id="product-filter-form" class="mb-3">
                    <div class="search-filter-wrapper">
                        <div class="form-group">
                            <label for="search">Search Products</label>
                            <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or description..." value="{{ old('search', request('search')) }}">
                        </div>
                        <div class="form-group">
                            <label for="category_id">Filter by Category</label>
                            <select name="category_id" id="category_id" class="form-control">
                                <option value="">All Categories</option>
                                @foreach($categories as $category)
                                    <option value="{{ $category->id }}" {{ old('category_id', request('category_id')) == $category->id || (string)old('category_id', request('category_id')) === (string)$category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                @endforeach
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status">Status</label>
                            <select name="status" id="status" class="form-control">
                                <option value="">All Status</option>
                                <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn--primary">
                                    <i class="tio-search"></i> Search
                                </button>
                                @if(request('search') || request('category_id') || request('status'))
                                    <a href="{{ route('admin.products.index') }}" class="btn btn--reset">
                                        <i class="tio-clear"></i> Clear
                                    </a>
                                @endif
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Product Name</th>
                        <th class="border-0">Category</th>
                        <th class="border-0">Price</th>
                        <th class="border-0 text-center">Trending</th>
                        <th class="border-0 text-center">Latest</th>
                        <th class="border-0 text-center">Express-30</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($products as $key => $product)
                        <tr>
                            <td>{{ ($products->currentPage() - 1) * $products->perPage() + $key + 1 }}</td>
                            <td>
                                @php
                                    $primaryImage = $product->images->where('is_primary', true)->first() ?? $product->images->first();
                                @endphp
                                @if($primaryImage)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $primaryImage->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $product->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/160x160/img2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ Str::limit($product->name, 30, '...') }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $product->category ? $product->category->name : '-' }}
                                </span>
                            </td>
                            <td>
                                @php
                                    $variant = $product->variants->first();
                                    $price = $variant ? ($variant->sale_price ?? $variant->price) : 0;
                                @endphp
                                <span class="d-block font-size-sm text-body">
                                    ‚Çπ{{ number_format($price, 2) }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="trending-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_trending"
                                           data-value="{{ $product->is_trending ? 0 : 1 }}"
                                           id="trending-{{ $product->id }}" {{ $product->is_trending ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="latest-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_latest"
                                           data-value="{{ $product->is_latest ? 0 : 1 }}"
                                           id="latest-{{ $product->id }}" {{ $product->is_latest ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="express-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_express_30"
                                           data-value="{{ $product->is_express_30 ? 0 : 1 }}"
                                           id="express-{{ $product->id }}" {{ $product->is_express_30 ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $product->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this product?"
                                           data-title-off="Want to deactivate this product?"
                                           id="status-{{ $product->id }}" {{ $product->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.products.status') }}" method="post" id="status-{{ $product->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $product->id }}">
                                    <input type="hidden" name="status" value="{{ $product->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.products.edit', $product->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="product-{{ $product->id }}" 
                                       data-form-id="product-{{ $product->id }}"
                                       data-message="Want to delete this product?" 
                                       data-title="Delete Product"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.products.destroy', $product->id) }}"
                                            method="post" id="product-{{ $product->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr class="no-data-row">
                            <td colspan="10" class="text-center py-5">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5 class="mb-2">{{ translate('no_data_found') }}</h5>
                                    @if(request('search') || request('category_id') || request('status'))
                                        <p class="text-muted">Try adjusting your search or filter criteria.</p>
                                        <a href="{{ route('admin.products.index') }}" class="btn btn--primary btn-sm mt-2">
                                            <i class="tio-clear"></i> Clear Filters
                                        </a>
                                    @endif
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                <div class="mt-3">
                    {{ $products->appends(request()->query())->links() }}
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                // Ensure empty state row is visible
                $('.no-data-row').show();
                if (typeof PageLoader !== 'undefined') {
                    setTimeout(function() {
                        PageLoader.hide();
                    }, 300);
                }
            }
        });
        
        // Ensure empty state is always visible when table is empty
        if (table.rows().count() === 0) {
            $('.no-data-row').show();
        }
        
        // Handle flag toggles
        $(document).on('change', '.flag-toggle', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $checkbox = $(this);
            var productId = $checkbox.data('id');
            var flag = $checkbox.data('flag');
            var value = $checkbox.data('value');
            
            $.ajax({
                url: '{{ route('admin.products.flag') }}',
                method: 'POST',
                data: {
                    _token: '{{ csrf_token() }}',
                    id: productId,
                    flag: flag,
                    value: value
                },
                success: function(response) {
                    // Update the data-value for next toggle
                    $checkbox.data('value', value == 1 ? 0 : 1);
                },
                error: function(xhr) {
                    // Revert checkbox
                    $checkbox.prop('checked', !$checkbox.prop('checked'));
                    alert('Failed to update flag. Please try again.');
                }
            });
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        $(window).on('load', function() {
            setTimeout(function() {
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.hide();
                }
            }, 500);
        });
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.categories'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .dataTables_wrapper .dataTables_length label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .dataTables_wrapper .dataTables_length select {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 80px;
    }
    
    .dataTables_wrapper .dataTables_filter {
        text-align: right;
    }
    
    .dataTables_wrapper .dataTables_filter label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: flex-end;
    }
    
    .dataTables_wrapper .dataTables_filter input {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 200px;
    }
    
    .no-data-row {
        display: table-row !important;
    }
    
    .no-data-row td {
        padding: 3rem 1rem !important;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-category"></i>
                </span>
                <span>
                    {{ translate('messages.categories') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.categories') }} <span class="badge badge-soft-dark ml-2" id="category-count">{{ $categories->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.categories.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_category') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.categories.index') }}" id="category-filter-form" class="mb-3">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="search">Search Categories</label>
                                <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or slug..." value="{{ old('search', request('search')) }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="status">Status</label>
                                <select name="status" id="status" class="form-control">
                                    <option value="">All Status</option>
                                    <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                    <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="parent_id">Parent Category</label>
                                <select name="parent_id" id="parent_id" class="form-control">
                                    <option value="">All Categories</option>
                                    <option value="null" {{ old('parent_id', request('parent_id')) == 'null' ? 'selected' : '' }}>Main Categories Only</option>
                                    @foreach($parentCategories as $parent)
                                        <option value="{{ $parent->id }}" {{ old('parent_id', request('parent_id')) == $parent->id || (string)old('parent_id', request('parent_id')) === (string)$parent->id ? 'selected' : '' }}>{{ $parent->name }}</option>
                                    @endforeach
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <div class="d-flex gap-2">
                                    <button type="submit" class="btn btn--primary w-100">
                                        <i class="tio-search"></i> Filter
                                    </button>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--reset">
                                            <i class="tio-clear"></i>
                                        </a>
                                    @endif
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Name</th>
                        <th class="border-0">Parent</th>
                        <th class="border-0">Slug</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($categories as $key => $category)
                        <tr>
                            <td>{{ ($categories->currentPage() - 1) * $categories->perPage() + $key + 1 }}</td>
                            <td>
                                @if($category->image_url)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('category', $category->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $category->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/100x100/2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->name }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->parent ? $category->parent->name : '-' }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->slug }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $category->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $category->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this category?"
                                           data-title-off="Want to deactivate this category?"
                                           id="status-{{ $category->id }}" {{ $category->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.categories.status') }}" method="post" id="status-{{ $category->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $category->id }}">
                                    <input type="hidden" name="status" value="{{ $category->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.categories.edit', $category->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="category-{{ $category->id }}" 
                                       data-form-id="category-{{ $category->id }}"
                                       data-message="Want to delete this category?" 
                                       data-title="Delete Category"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.categories.destroy', $category->id) }}"
                                            method="post" id="category-{{ $category->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr class="no-data-row">
                            <td colspan="7" class="text-center py-5">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5 class="mb-2">{{ translate('no_data_found') }}</h5>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <p class="text-muted">Try adjusting your search or filter criteria.</p>
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--primary btn-sm mt-2">
                                            <i class="tio-clear"></i> Clear Filters
                                        </a>
                                    @endif
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                <div class="mt-3">
                    {{ $categories->appends(request()->query())->links() }}
                </div>
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                // Ensure empty state row is visible
                $('.no-data-row').show();
                if (typeof PageLoader !== 'undefined') {
                    setTimeout(function() {
                        PageLoader.hide();
                    }, 300);
                }
            }
        });
        
        // Ensure empty state is always visible when table is empty
        if (table.rows().count() === 0) {
            $('.no-data-row').show();
        }
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        $(window).on('load', function() {
            setTimeout(function() {
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.hide();
                }
            }, 500);
        });
    });
</script>
@endpush


```


Hiding pagination when there are no results:


```blade
@extends('layouts.admin.app')

@section('title', translate('messages.products'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .badge-express {
        background-color: #f0ad4e;
        color: #fff;
    }
    
    .no-data-row {
        display: table-row !important;
    }
    
    .no-data-row td {
        padding: 3rem 1rem !important;
    }
    
    .search-filter-wrapper {
        display: flex;
        gap: 10px;
        align-items: flex-end;
        flex-wrap: wrap;
    }
    
    .search-filter-wrapper .form-group {
        margin-bottom: 0;
        flex: 1;
        min-width: 200px;
    }
    
    .search-filter-wrapper .form-group label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 5px;
        font-size: 0.875rem;
    }
    
    .search-filter-wrapper .btn {
        white-space: nowrap;
        height: fit-content;
    }
    
    @media (max-width: 768px) {
        .search-filter-wrapper {
            flex-direction: column;
        }
        
        .search-filter-wrapper .form-group {
            width: 100%;
        }
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-shop"></i>
                </span>
                <span>
                    {{ translate('messages.products') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.products') }} <span class="badge badge-soft-dark ml-2" id="product-count">{{ $products->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.products.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_product') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.products.index') }}" id="product-filter-form" class="mb-3">
                    <div class="search-filter-wrapper">
                        <div class="form-group">
                            <label for="search">Search Products</label>
                            <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or description..." value="{{ old('search', request('search')) }}">
                        </div>
                        <div class="form-group">
                            <label for="category_id">Filter by Category</label>
                            <select name="category_id" id="category_id" class="form-control">
                                <option value="">All Categories</option>
                                @foreach($categories as $category)
                                    <option value="{{ $category->id }}" {{ old('category_id', request('category_id')) == $category->id || (string)old('category_id', request('category_id')) === (string)$category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                @endforeach
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status">Status</label>
                            <select name="status" id="status" class="form-control">
                                <option value="">All Status</option>
                                <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn--primary">
                                    <i class="tio-search"></i> Search
                                </button>
                                @if(request('search') || request('category_id') || request('status'))
                                    <a href="{{ route('admin.products.index') }}" class="btn btn--reset">
                                        <i class="tio-clear"></i> Clear
                                    </a>
                                @endif
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Product Name</th>
                        <th class="border-0">Category</th>
                        <th class="border-0">Price</th>
                        <th class="border-0 text-center">Trending</th>
                        <th class="border-0 text-center">Latest</th>
                        <th class="border-0 text-center">Express-30</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($products as $key => $product)
                        <tr>
                            <td>{{ ($products->currentPage() - 1) * $products->perPage() + $key + 1 }}</td>
                            <td>
                                @php
                                    $primaryImage = $product->images->where('is_primary', true)->first() ?? $product->images->first();
                                @endphp
                                @if($primaryImage)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $primaryImage->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $product->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/160x160/img2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ Str::limit($product->name, 30, '...') }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $product->category ? $product->category->name : '-' }}
                                </span>
                            </td>
                            <td>
                                @php
                                    $variant = $product->variants->first();
                                    $price = $variant ? ($variant->sale_price ?? $variant->price) : 0;
                                @endphp
                                <span class="d-block font-size-sm text-body">
                                    ‚Çπ{{ number_format($price, 2) }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="trending-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_trending"
                                           data-value="{{ $product->is_trending ? 0 : 1 }}"
                                           id="trending-{{ $product->id }}" {{ $product->is_trending ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="latest-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_latest"
                                           data-value="{{ $product->is_latest ? 0 : 1 }}"
                                           id="latest-{{ $product->id }}" {{ $product->is_latest ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="express-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_express_30"
                                           data-value="{{ $product->is_express_30 ? 0 : 1 }}"
                                           id="express-{{ $product->id }}" {{ $product->is_express_30 ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $product->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this product?"
                                           data-title-off="Want to deactivate this product?"
                                           id="status-{{ $product->id }}" {{ $product->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.products.status') }}" method="post" id="status-{{ $product->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $product->id }}">
                                    <input type="hidden" name="status" value="{{ $product->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.products.edit', $product->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="product-{{ $product->id }}" 
                                       data-form-id="product-{{ $product->id }}"
                                       data-message="Want to delete this product?" 
                                       data-title="Delete Product"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.products.destroy', $product->id) }}"
                                            method="post" id="product-{{ $product->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr class="no-data-row">
                            <td colspan="10" class="text-center py-5">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5 class="mb-2">{{ translate('no_data_found') }}</h5>
                                    @if(request('search') || request('category_id') || request('status'))
                                        <p class="text-muted">Try adjusting your search or filter criteria.</p>
                                        <a href="{{ route('admin.products.index') }}" class="btn btn--primary btn-sm mt-2">
                                            <i class="tio-clear"></i> Clear Filters
                                        </a>
                                    @endif
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                @if($products->hasPages() && $products->total() > 0)
                    <div class="mt-3">
                        {{ $products->appends(request()->query())->links() }}
                    </div>
                @endif
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                // Ensure empty state row is visible
                $('.no-data-row').show();
                if (typeof PageLoader !== 'undefined') {
                    setTimeout(function() {
                        PageLoader.hide();
                    }, 300);
                }
            }
        });
        
        // Ensure empty state is always visible when table is empty
        if (table.rows().count() === 0) {
            $('.no-data-row').show();
        }
        
        // Handle flag toggles
        $(document).on('change', '.flag-toggle', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $checkbox = $(this);
            var productId = $checkbox.data('id');
            var flag = $checkbox.data('flag');
            var value = $checkbox.data('value');
            
            $.ajax({
                url: '{{ route('admin.products.flag') }}',
                method: 'POST',
                data: {
                    _token: '{{ csrf_token() }}',
                    id: productId,
                    flag: flag,
                    value: value
                },
                success: function(response) {
                    // Update the data-value for next toggle
                    $checkbox.data('value', value == 1 ? 0 : 1);
                },
                error: function(xhr) {
                    // Revert checkbox
                    $checkbox.prop('checked', !$checkbox.prop('checked'));
                    alert('Failed to update flag. Please try again.');
                }
            });
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        $(window).on('load', function() {
            setTimeout(function() {
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.hide();
                }
            }, 500);
        });
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.categories'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .dataTables_wrapper .dataTables_length label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .dataTables_wrapper .dataTables_length select {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 80px;
    }
    
    .dataTables_wrapper .dataTables_filter {
        text-align: right;
    }
    
    .dataTables_wrapper .dataTables_filter label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: flex-end;
    }
    
    .dataTables_wrapper .dataTables_filter input {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 200px;
    }
    
    .no-data-row {
        display: table-row !important;
    }
    
    .no-data-row td {
        padding: 3rem 1rem !important;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-category"></i>
                </span>
                <span>
                    {{ translate('messages.categories') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.categories') }} <span class="badge badge-soft-dark ml-2" id="category-count">{{ $categories->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.categories.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_category') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.categories.index') }}" id="category-filter-form" class="mb-3">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="search">Search Categories</label>
                                <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or slug..." value="{{ old('search', request('search')) }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="status">Status</label>
                                <select name="status" id="status" class="form-control">
                                    <option value="">All Status</option>
                                    <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                    <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="parent_id">Parent Category</label>
                                <select name="parent_id" id="parent_id" class="form-control">
                                    <option value="">All Categories</option>
                                    <option value="null" {{ old('parent_id', request('parent_id')) == 'null' ? 'selected' : '' }}>Main Categories Only</option>
                                    @foreach($parentCategories as $parent)
                                        <option value="{{ $parent->id }}" {{ old('parent_id', request('parent_id')) == $parent->id || (string)old('parent_id', request('parent_id')) === (string)$parent->id ? 'selected' : '' }}>{{ $parent->name }}</option>
                                    @endforeach
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <div class="d-flex gap-2">
                                    <button type="submit" class="btn btn--primary w-100">
                                        <i class="tio-search"></i> Filter
                                    </button>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--reset">
                                            <i class="tio-clear"></i>
                                        </a>
                                    @endif
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Name</th>
                        <th class="border-0">Parent</th>
                        <th class="border-0">Slug</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($categories as $key => $category)
                        <tr>
                            <td>{{ ($categories->currentPage() - 1) * $categories->perPage() + $key + 1 }}</td>
                            <td>
                                @if($category->image_url)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('category', $category->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $category->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/100x100/2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->name }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->parent ? $category->parent->name : '-' }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->slug }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $category->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $category->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this category?"
                                           data-title-off="Want to deactivate this category?"
                                           id="status-{{ $category->id }}" {{ $category->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.categories.status') }}" method="post" id="status-{{ $category->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $category->id }}">
                                    <input type="hidden" name="status" value="{{ $category->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.categories.edit', $category->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="category-{{ $category->id }}" 
                                       data-form-id="category-{{ $category->id }}"
                                       data-message="Want to delete this category?" 
                                       data-title="Delete Category"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.categories.destroy', $category->id) }}"
                                            method="post" id="category-{{ $category->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr class="no-data-row">
                            <td colspan="7" class="text-center py-5">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5 class="mb-2">{{ translate('no_data_found') }}</h5>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <p class="text-muted">Try adjusting your search or filter criteria.</p>
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--primary btn-sm mt-2">
                                            <i class="tio-clear"></i> Clear Filters
                                        </a>
                                    @endif
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                @if($categories->hasPages() && $categories->total() > 0)
                    <div class="mt-3">
                        {{ $categories->appends(request()->query())->links() }}
                    </div>
                @endif
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                // Ensure empty state row is visible
                $('.no-data-row').show();
                if (typeof PageLoader !== 'undefined') {
                    setTimeout(function() {
                        PageLoader.hide();
                    }, 300);
                }
            }
        });
        
        // Ensure empty state is always visible when table is empty
        if (table.rows().count() === 0) {
            $('.no-data-row').show();
        }
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        $(window).on('load', function() {
            setTimeout(function() {
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.hide();
                }
            }, 500);
        });
    });
</script>
@endpush


```


Fixed the "no data found" display when filters return 0 results. Changes:

## Fixes applied

### 1. Fixed row numbering
- Changed from `$products->firstItem() + $key` to a calculation that works even with 0 results
- Prevents errors when `firstItem()` returns null on empty collections

### 2. Enhanced empty state display
- Added CSS class `no-data-row` for better visibility
- Improved styling with more padding and spacing
- Added a helpful message when filters are active
- Added a "Clear Filters" button when filters are applied

### 3. DataTables compatibility
- Added JavaScript to ensure the empty state row is always visible
- Added check to show empty state when DataTables has 0 rows

### 4. Pagination handling
- Hide pagination when there are no results
- Only show pagination when there are pages and results exist

### Changes summary

**Products & Categories Index Views:**
- Fixed row numbering calculation
- Enhanced empty state with better styling
- Added "Clear Filters" button when filters are active
- Added CSS to ensure empty state visibility
- Added JavaScript to handle DataTables empty state
- Hide pagination when no results

When filters return 0 results, you'll see:
- A clear "No data found" message
- An image illustration
- A helpful message suggesting to adjust filters
- A "Clear Filters" button (when filters are active)
- No pagination controls

The empty state now displays correctly when search or filters return no results.

---

**User**

Working on no data found but loader not hide fix it

---

**Cursor**


Checking the loader implementation and ensuring it hides when there are no results.



Fixing the loader so it hides even when there are no results:


```blade
@extends('layouts.admin.app')

@section('title', translate('messages.products'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .badge-express {
        background-color: #f0ad4e;
        color: #fff;
    }
    
    .no-data-row {
        display: table-row !important;
    }
    
    .no-data-row td {
        padding: 3rem 1rem !important;
    }
    
    .search-filter-wrapper {
        display: flex;
        gap: 10px;
        align-items: flex-end;
        flex-wrap: wrap;
    }
    
    .search-filter-wrapper .form-group {
        margin-bottom: 0;
        flex: 1;
        min-width: 200px;
    }
    
    .search-filter-wrapper .form-group label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 5px;
        font-size: 0.875rem;
    }
    
    .search-filter-wrapper .btn {
        white-space: nowrap;
        height: fit-content;
    }
    
    @media (max-width: 768px) {
        .search-filter-wrapper {
            flex-direction: column;
        }
        
        .search-filter-wrapper .form-group {
            width: 100%;
        }
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-shop"></i>
                </span>
                <span>
                    {{ translate('messages.products') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.products') }} <span class="badge badge-soft-dark ml-2" id="product-count">{{ $products->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.products.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_product') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.products.index') }}" id="product-filter-form" class="mb-3">
                    <div class="search-filter-wrapper">
                        <div class="form-group">
                            <label for="search">Search Products</label>
                            <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or description..." value="{{ old('search', request('search')) }}">
                        </div>
                        <div class="form-group">
                            <label for="category_id">Filter by Category</label>
                            <select name="category_id" id="category_id" class="form-control">
                                <option value="">All Categories</option>
                                @foreach($categories as $category)
                                    <option value="{{ $category->id }}" {{ old('category_id', request('category_id')) == $category->id || (string)old('category_id', request('category_id')) === (string)$category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                @endforeach
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status">Status</label>
                            <select name="status" id="status" class="form-control">
                                <option value="">All Status</option>
                                <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn--primary">
                                    <i class="tio-search"></i> Search
                                </button>
                                @if(request('search') || request('category_id') || request('status'))
                                    <a href="{{ route('admin.products.index') }}" class="btn btn--reset">
                                        <i class="tio-clear"></i> Clear
                                    </a>
                                @endif
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Product Name</th>
                        <th class="border-0">Category</th>
                        <th class="border-0">Price</th>
                        <th class="border-0 text-center">Trending</th>
                        <th class="border-0 text-center">Latest</th>
                        <th class="border-0 text-center">Express-30</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($products as $key => $product)
                        <tr>
                            <td>{{ ($products->currentPage() - 1) * $products->perPage() + $key + 1 }}</td>
                            <td>
                                @php
                                    $primaryImage = $product->images->where('is_primary', true)->first() ?? $product->images->first();
                                @endphp
                                @if($primaryImage)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $primaryImage->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $product->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/160x160/img2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ Str::limit($product->name, 30, '...') }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $product->category ? $product->category->name : '-' }}
                                </span>
                            </td>
                            <td>
                                @php
                                    $variant = $product->variants->first();
                                    $price = $variant ? ($variant->sale_price ?? $variant->price) : 0;
                                @endphp
                                <span class="d-block font-size-sm text-body">
                                    ‚Çπ{{ number_format($price, 2) }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="trending-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_trending"
                                           data-value="{{ $product->is_trending ? 0 : 1 }}"
                                           id="trending-{{ $product->id }}" {{ $product->is_trending ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="latest-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_latest"
                                           data-value="{{ $product->is_latest ? 0 : 1 }}"
                                           id="latest-{{ $product->id }}" {{ $product->is_latest ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="express-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_express_30"
                                           data-value="{{ $product->is_express_30 ? 0 : 1 }}"
                                           id="express-{{ $product->id }}" {{ $product->is_express_30 ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $product->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this product?"
                                           data-title-off="Want to deactivate this product?"
                                           id="status-{{ $product->id }}" {{ $product->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.products.status') }}" method="post" id="status-{{ $product->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $product->id }}">
                                    <input type="hidden" name="status" value="{{ $product->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.products.edit', $product->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="product-{{ $product->id }}" 
                                       data-form-id="product-{{ $product->id }}"
                                       data-message="Want to delete this product?" 
                                       data-title="Delete Product"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.products.destroy', $product->id) }}"
                                            method="post" id="product-{{ $product->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr class="no-data-row">
                            <td colspan="10" class="text-center py-5">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5 class="mb-2">{{ translate('no_data_found') }}</h5>
                                    @if(request('search') || request('category_id') || request('status'))
                                        <p class="text-muted">Try adjusting your search or filter criteria.</p>
                                        <a href="{{ route('admin.products.index') }}" class="btn btn--primary btn-sm mt-2">
                                            <i class="tio-clear"></i> Clear Filters
                                        </a>
                                    @endif
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                @if($products->hasPages() && $products->total() > 0)
                    <div class="mt-3">
                        {{ $products->appends(request()->query())->links() }}
                    </div>
                @endif
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                // Ensure empty state row is visible
                $('.no-data-row').show();
                // Hide loader immediately after DataTables initialization
                hideLoader();
            }
        });
        
        // Function to hide loader
        function hideLoader() {
            if (typeof PageLoader !== 'undefined') {
                PageLoader.hide();
            }
        }
        
        // Ensure empty state is always visible when table is empty
        if (table.rows().count() === 0) {
            $('.no-data-row').show();
            hideLoader();
        }
        
        // Fallback: Hide loader after a short delay to ensure it's hidden
        setTimeout(function() {
            hideLoader();
        }, 500);
        
        // Handle flag toggles
        $(document).on('change', '.flag-toggle', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $checkbox = $(this);
            var productId = $checkbox.data('id');
            var flag = $checkbox.data('flag');
            var value = $checkbox.data('value');
            
            $.ajax({
                url: '{{ route('admin.products.flag') }}',
                method: 'POST',
                data: {
                    _token: '{{ csrf_token() }}',
                    id: productId,
                    flag: flag,
                    value: value
                },
                success: function(response) {
                    // Update the data-value for next toggle
                    $checkbox.data('value', value == 1 ? 0 : 1);
                },
                error: function(xhr) {
                    // Revert checkbox
                    $checkbox.prop('checked', !$checkbox.prop('checked'));
                    alert('Failed to update flag. Please try again.');
                }
            });
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        $(window).on('load', function() {
            setTimeout(function() {
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.hide();
                }
            }, 500);
        });
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.products'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .badge-express {
        background-color: #f0ad4e;
        color: #fff;
    }
    
    .no-data-row {
        display: table-row !important;
    }
    
    .no-data-row td {
        padding: 3rem 1rem !important;
    }
    
    .search-filter-wrapper {
        display: flex;
        gap: 10px;
        align-items: flex-end;
        flex-wrap: wrap;
    }
    
    .search-filter-wrapper .form-group {
        margin-bottom: 0;
        flex: 1;
        min-width: 200px;
    }
    
    .search-filter-wrapper .form-group label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 5px;
        font-size: 0.875rem;
    }
    
    .search-filter-wrapper .btn {
        white-space: nowrap;
        height: fit-content;
    }
    
    @media (max-width: 768px) {
        .search-filter-wrapper {
            flex-direction: column;
        }
        
        .search-filter-wrapper .form-group {
            width: 100%;
        }
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-shop"></i>
                </span>
                <span>
                    {{ translate('messages.products') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.products') }} <span class="badge badge-soft-dark ml-2" id="product-count">{{ $products->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.products.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_product') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.products.index') }}" id="product-filter-form" class="mb-3">
                    <div class="search-filter-wrapper">
                        <div class="form-group">
                            <label for="search">Search Products</label>
                            <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or description..." value="{{ old('search', request('search')) }}">
                        </div>
                        <div class="form-group">
                            <label for="category_id">Filter by Category</label>
                            <select name="category_id" id="category_id" class="form-control">
                                <option value="">All Categories</option>
                                @foreach($categories as $category)
                                    <option value="{{ $category->id }}" {{ old('category_id', request('category_id')) == $category->id || (string)old('category_id', request('category_id')) === (string)$category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                @endforeach
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status">Status</label>
                            <select name="status" id="status" class="form-control">
                                <option value="">All Status</option>
                                <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn--primary">
                                    <i class="tio-search"></i> Search
                                </button>
                                @if(request('search') || request('category_id') || request('status'))
                                    <a href="{{ route('admin.products.index') }}" class="btn btn--reset">
                                        <i class="tio-clear"></i> Clear
                                    </a>
                                @endif
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Product Name</th>
                        <th class="border-0">Category</th>
                        <th class="border-0">Price</th>
                        <th class="border-0 text-center">Trending</th>
                        <th class="border-0 text-center">Latest</th>
                        <th class="border-0 text-center">Express-30</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($products as $key => $product)
                        <tr>
                            <td>{{ ($products->currentPage() - 1) * $products->perPage() + $key + 1 }}</td>
                            <td>
                                @php
                                    $primaryImage = $product->images->where('is_primary', true)->first() ?? $product->images->first();
                                @endphp
                                @if($primaryImage)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $primaryImage->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $product->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/160x160/img2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ Str::limit($product->name, 30, '...') }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $product->category ? $product->category->name : '-' }}
                                </span>
                            </td>
                            <td>
                                @php
                                    $variant = $product->variants->first();
                                    $price = $variant ? ($variant->sale_price ?? $variant->price) : 0;
                                @endphp
                                <span class="d-block font-size-sm text-body">
                                    ‚Çπ{{ number_format($price, 2) }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="trending-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_trending"
                                           data-value="{{ $product->is_trending ? 0 : 1 }}"
                                           id="trending-{{ $product->id }}" {{ $product->is_trending ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="latest-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_latest"
                                           data-value="{{ $product->is_latest ? 0 : 1 }}"
                                           id="latest-{{ $product->id }}" {{ $product->is_latest ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="express-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_express_30"
                                           data-value="{{ $product->is_express_30 ? 0 : 1 }}"
                                           id="express-{{ $product->id }}" {{ $product->is_express_30 ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $product->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this product?"
                                           data-title-off="Want to deactivate this product?"
                                           id="status-{{ $product->id }}" {{ $product->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.products.status') }}" method="post" id="status-{{ $product->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $product->id }}">
                                    <input type="hidden" name="status" value="{{ $product->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.products.edit', $product->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="product-{{ $product->id }}" 
                                       data-form-id="product-{{ $product->id }}"
                                       data-message="Want to delete this product?" 
                                       data-title="Delete Product"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.products.destroy', $product->id) }}"
                                            method="post" id="product-{{ $product->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr class="no-data-row">
                            <td colspan="10" class="text-center py-5">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5 class="mb-2">{{ translate('no_data_found') }}</h5>
                                    @if(request('search') || request('category_id') || request('status'))
                                        <p class="text-muted">Try adjusting your search or filter criteria.</p>
                                        <a href="{{ route('admin.products.index') }}" class="btn btn--primary btn-sm mt-2">
                                            <i class="tio-clear"></i> Clear Filters
                                        </a>
                                    @endif
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                @if($products->hasPages() && $products->total() > 0)
                    <div class="mt-3">
                        {{ $products->appends(request()->query())->links() }}
                    </div>
                @endif
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                // Ensure empty state row is visible
                $('.no-data-row').show();
                // Hide loader immediately after DataTables initialization
                hideLoader();
            }
        });
        
        // Function to hide loader
        function hideLoader() {
            if (typeof PageLoader !== 'undefined') {
                PageLoader.hide();
            }
        }
        
        // Ensure empty state is always visible when table is empty
        if (table.rows().count() === 0) {
            $('.no-data-row').show();
            hideLoader();
        }
        
        // Fallback: Hide loader after a short delay to ensure it's hidden
        setTimeout(function() {
            hideLoader();
        }, 500);
        
        // Handle flag toggles
        $(document).on('change', '.flag-toggle', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $checkbox = $(this);
            var productId = $checkbox.data('id');
            var flag = $checkbox.data('flag');
            var value = $checkbox.data('value');
            
            $.ajax({
                url: '{{ route('admin.products.flag') }}',
                method: 'POST',
                data: {
                    _token: '{{ csrf_token() }}',
                    id: productId,
                    flag: flag,
                    value: value
                },
                success: function(response) {
                    // Update the data-value for next toggle
                    $checkbox.data('value', value == 1 ? 0 : 1);
                },
                error: function(xhr) {
                    // Revert checkbox
                    $checkbox.prop('checked', !$checkbox.prop('checked'));
                    alert('Failed to update flag. Please try again.');
                }
            });
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        // Hide loader on window load as final fallback
        $(window).on('load', function() {
            setTimeout(function() {
                hideLoader();
            }, 300);
        });
        
        // Also hide loader when document is ready (immediate fallback)
        setTimeout(function() {
            hideLoader();
        }, 1000);
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.categories'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .dataTables_wrapper .dataTables_length label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .dataTables_wrapper .dataTables_length select {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 80px;
    }
    
    .dataTables_wrapper .dataTables_filter {
        text-align: right;
    }
    
    .dataTables_wrapper .dataTables_filter label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: flex-end;
    }
    
    .dataTables_wrapper .dataTables_filter input {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 200px;
    }
    
    .no-data-row {
        display: table-row !important;
    }
    
    .no-data-row td {
        padding: 3rem 1rem !important;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-category"></i>
                </span>
                <span>
                    {{ translate('messages.categories') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.categories') }} <span class="badge badge-soft-dark ml-2" id="category-count">{{ $categories->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.categories.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_category') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.categories.index') }}" id="category-filter-form" class="mb-3">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="search">Search Categories</label>
                                <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or slug..." value="{{ old('search', request('search')) }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="status">Status</label>
                                <select name="status" id="status" class="form-control">
                                    <option value="">All Status</option>
                                    <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                    <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="parent_id">Parent Category</label>
                                <select name="parent_id" id="parent_id" class="form-control">
                                    <option value="">All Categories</option>
                                    <option value="null" {{ old('parent_id', request('parent_id')) == 'null' ? 'selected' : '' }}>Main Categories Only</option>
                                    @foreach($parentCategories as $parent)
                                        <option value="{{ $parent->id }}" {{ old('parent_id', request('parent_id')) == $parent->id || (string)old('parent_id', request('parent_id')) === (string)$parent->id ? 'selected' : '' }}>{{ $parent->name }}</option>
                                    @endforeach
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <div class="d-flex gap-2">
                                    <button type="submit" class="btn btn--primary w-100">
                                        <i class="tio-search"></i> Filter
                                    </button>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--reset">
                                            <i class="tio-clear"></i>
                                        </a>
                                    @endif
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Name</th>
                        <th class="border-0">Parent</th>
                        <th class="border-0">Slug</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($categories as $key => $category)
                        <tr>
                            <td>{{ ($categories->currentPage() - 1) * $categories->perPage() + $key + 1 }}</td>
                            <td>
                                @if($category->image_url)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('category', $category->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $category->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/100x100/2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->name }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->parent ? $category->parent->name : '-' }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->slug }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $category->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $category->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this category?"
                                           data-title-off="Want to deactivate this category?"
                                           id="status-{{ $category->id }}" {{ $category->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.categories.status') }}" method="post" id="status-{{ $category->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $category->id }}">
                                    <input type="hidden" name="status" value="{{ $category->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.categories.edit', $category->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="category-{{ $category->id }}" 
                                       data-form-id="category-{{ $category->id }}"
                                       data-message="Want to delete this category?" 
                                       data-title="Delete Category"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.categories.destroy', $category->id) }}"
                                            method="post" id="category-{{ $category->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr class="no-data-row">
                            <td colspan="7" class="text-center py-5">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5 class="mb-2">{{ translate('no_data_found') }}</h5>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <p class="text-muted">Try adjusting your search or filter criteria.</p>
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--primary btn-sm mt-2">
                                            <i class="tio-clear"></i> Clear Filters
                                        </a>
                                    @endif
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                @if($categories->hasPages() && $categories->total() > 0)
                    <div class="mt-3">
                        {{ $categories->appends(request()->query())->links() }}
                    </div>
                @endif
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                // Ensure empty state row is visible
                $('.no-data-row').show();
                // Hide loader immediately after DataTables initialization
                hideLoader();
            }
        });
        
        // Function to hide loader
        function hideLoader() {
            if (typeof PageLoader !== 'undefined') {
                PageLoader.hide();
            }
        }
        
        // Ensure empty state is always visible when table is empty
        if (table.rows().count() === 0) {
            $('.no-data-row').show();
            hideLoader();
        }
        
        // Fallback: Hide loader after a short delay to ensure it's hidden
        setTimeout(function() {
            hideLoader();
        }, 500);
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        $(window).on('load', function() {
            setTimeout(function() {
                if (typeof PageLoader !== 'undefined') {
                    PageLoader.hide();
                }
            }, 500);
        });
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.categories'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .dataTables_wrapper .dataTables_length label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .dataTables_wrapper .dataTables_length select {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 80px;
    }
    
    .dataTables_wrapper .dataTables_filter {
        text-align: right;
    }
    
    .dataTables_wrapper .dataTables_filter label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: flex-end;
    }
    
    .dataTables_wrapper .dataTables_filter input {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 200px;
    }
    
    .no-data-row {
        display: table-row !important;
    }
    
    .no-data-row td {
        padding: 3rem 1rem !important;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-category"></i>
                </span>
                <span>
                    {{ translate('messages.categories') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.categories') }} <span class="badge badge-soft-dark ml-2" id="category-count">{{ $categories->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.categories.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_category') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.categories.index') }}" id="category-filter-form" class="mb-3">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="search">Search Categories</label>
                                <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or slug..." value="{{ old('search', request('search')) }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="status">Status</label>
                                <select name="status" id="status" class="form-control">
                                    <option value="">All Status</option>
                                    <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                    <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="parent_id">Parent Category</label>
                                <select name="parent_id" id="parent_id" class="form-control">
                                    <option value="">All Categories</option>
                                    <option value="null" {{ old('parent_id', request('parent_id')) == 'null' ? 'selected' : '' }}>Main Categories Only</option>
                                    @foreach($parentCategories as $parent)
                                        <option value="{{ $parent->id }}" {{ old('parent_id', request('parent_id')) == $parent->id || (string)old('parent_id', request('parent_id')) === (string)$parent->id ? 'selected' : '' }}>{{ $parent->name }}</option>
                                    @endforeach
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <div class="d-flex gap-2">
                                    <button type="submit" class="btn btn--primary w-100">
                                        <i class="tio-search"></i> Filter
                                    </button>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--reset">
                                            <i class="tio-clear"></i>
                                        </a>
                                    @endif
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Name</th>
                        <th class="border-0">Parent</th>
                        <th class="border-0">Slug</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($categories as $key => $category)
                        <tr>
                            <td>{{ ($categories->currentPage() - 1) * $categories->perPage() + $key + 1 }}</td>
                            <td>
                                @if($category->image_url)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('category', $category->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $category->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/100x100/2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->name }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->parent ? $category->parent->name : '-' }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->slug }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $category->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $category->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this category?"
                                           data-title-off="Want to deactivate this category?"
                                           id="status-{{ $category->id }}" {{ $category->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.categories.status') }}" method="post" id="status-{{ $category->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $category->id }}">
                                    <input type="hidden" name="status" value="{{ $category->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.categories.edit', $category->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="category-{{ $category->id }}" 
                                       data-form-id="category-{{ $category->id }}"
                                       data-message="Want to delete this category?" 
                                       data-title="Delete Category"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.categories.destroy', $category->id) }}"
                                            method="post" id="category-{{ $category->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr class="no-data-row">
                            <td colspan="7" class="text-center py-5">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5 class="mb-2">{{ translate('no_data_found') }}</h5>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <p class="text-muted">Try adjusting your search or filter criteria.</p>
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--primary btn-sm mt-2">
                                            <i class="tio-clear"></i> Clear Filters
                                        </a>
                                    @endif
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                @if($categories->hasPages() && $categories->total() > 0)
                    <div class="mt-3">
                        {{ $categories->appends(request()->query())->links() }}
                    </div>
                @endif
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                // Ensure empty state row is visible
                $('.no-data-row').show();
                // Hide loader immediately after DataTables initialization
                hideLoader();
            }
        });
        
        // Function to hide loader
        function hideLoader() {
            if (typeof PageLoader !== 'undefined') {
                PageLoader.hide();
            }
        }
        
        // Ensure empty state is always visible when table is empty
        if (table.rows().count() === 0) {
            $('.no-data-row').show();
            hideLoader();
        }
        
        // Fallback: Hide loader after a short delay to ensure it's hidden
        setTimeout(function() {
            hideLoader();
        }, 500);
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        // Hide loader on window load as final fallback
        $(window).on('load', function() {
            setTimeout(function() {
                hideLoader();
            }, 300);
        });
        
        // Also hide loader when document is ready (immediate fallback)
        setTimeout(function() {
            hideLoader();
        }, 1000);
    });
</script>
@endpush


```


Fixed the loader so it hides when there are no results. Changes:

## Fixes applied

### 1. Created centralized loader hide function
- Added a `hideLoader()` function to centralize the logic
- Makes it easier to call from multiple places

### 2. Multiple hide triggers
- DataTables `initComplete` callback ‚Äî hides after DataTables initializes
- Empty table check ‚Äî hides immediately if table has 0 rows
- Short delay fallback ‚Äî hides after 500ms as a safety net
- Window load fallback ‚Äî hides after window fully loads (300ms delay)
- Final fallback ‚Äî hides after 1 second as a last resort

### 3. Improved timing
- Removed the 300ms delay in `initComplete` and hide immediately
- Added multiple fallback timeouts to ensure the loader hides

### Changes summary

**Both Products & Categories Index Views:**
- Created `hideLoader()` function
- Hide loader in `initComplete` callback
- Hide loader when table is empty
- Added 500ms fallback timeout
- Added window load fallback (300ms)
- Added final 1-second fallback timeout

The loader now hides in these cases:
- When DataTables finishes initializing
- When the table has no results
- After a short delay (fallback)
- When the window fully loads (fallback)
- After 1 second (final fallback)

The loader should now hide correctly even when filters return 0 results.

---

**User**

Still below loader not hide
<div class="loader-content">
        <div class="loader-spinner-wrapper">
            <div class="loader-spinner"></div>
            <div class="loader-logo">
                                <img src="http://127.0.0.1:8004/assets/admin/img/favicon.png" alt="Logo" class="loader-logo-img" onerror="this.src='http://127.0.0.1:8004/assets/admin/img/160x160/img2.jpg'">
            </div>
        </div>
        <div class="loader-text">Loading...</div>
    </div>
fix it

---

**Cursor**


Checking the loader implementation and hiding it directly via JavaScript:



Updating the code to directly hide the loader element and ensure it hides even when there are no results:


```blade
@extends('layouts.admin.app')

@section('title', translate('messages.products'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .badge-express {
        background-color: #f0ad4e;
        color: #fff;
    }
    
    .no-data-row {
        display: table-row !important;
    }
    
    .no-data-row td {
        padding: 3rem 1rem !important;
    }
    
    .search-filter-wrapper {
        display: flex;
        gap: 10px;
        align-items: flex-end;
        flex-wrap: wrap;
    }
    
    .search-filter-wrapper .form-group {
        margin-bottom: 0;
        flex: 1;
        min-width: 200px;
    }
    
    .search-filter-wrapper .form-group label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 5px;
        font-size: 0.875rem;
    }
    
    .search-filter-wrapper .btn {
        white-space: nowrap;
        height: fit-content;
    }
    
    @media (max-width: 768px) {
        .search-filter-wrapper {
            flex-direction: column;
        }
        
        .search-filter-wrapper .form-group {
            width: 100%;
        }
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-shop"></i>
                </span>
                <span>
                    {{ translate('messages.products') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.products') }} <span class="badge badge-soft-dark ml-2" id="product-count">{{ $products->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.products.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_product') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.products.index') }}" id="product-filter-form" class="mb-3">
                    <div class="search-filter-wrapper">
                        <div class="form-group">
                            <label for="search">Search Products</label>
                            <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or description..." value="{{ old('search', request('search')) }}">
                        </div>
                        <div class="form-group">
                            <label for="category_id">Filter by Category</label>
                            <select name="category_id" id="category_id" class="form-control">
                                <option value="">All Categories</option>
                                @foreach($categories as $category)
                                    <option value="{{ $category->id }}" {{ old('category_id', request('category_id')) == $category->id || (string)old('category_id', request('category_id')) === (string)$category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                @endforeach
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status">Status</label>
                            <select name="status" id="status" class="form-control">
                                <option value="">All Status</option>
                                <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn--primary">
                                    <i class="tio-search"></i> Search
                                </button>
                                @if(request('search') || request('category_id') || request('status'))
                                    <a href="{{ route('admin.products.index') }}" class="btn btn--reset">
                                        <i class="tio-clear"></i> Clear
                                    </a>
                                @endif
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Product Name</th>
                        <th class="border-0">Category</th>
                        <th class="border-0">Price</th>
                        <th class="border-0 text-center">Trending</th>
                        <th class="border-0 text-center">Latest</th>
                        <th class="border-0 text-center">Express-30</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($products as $key => $product)
                        <tr>
                            <td>{{ ($products->currentPage() - 1) * $products->perPage() + $key + 1 }}</td>
                            <td>
                                @php
                                    $primaryImage = $product->images->where('is_primary', true)->first() ?? $product->images->first();
                                @endphp
                                @if($primaryImage)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $primaryImage->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $product->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/160x160/img2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ Str::limit($product->name, 30, '...') }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $product->category ? $product->category->name : '-' }}
                                </span>
                            </td>
                            <td>
                                @php
                                    $variant = $product->variants->first();
                                    $price = $variant ? ($variant->sale_price ?? $variant->price) : 0;
                                @endphp
                                <span class="d-block font-size-sm text-body">
                                    ‚Çπ{{ number_format($price, 2) }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="trending-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_trending"
                                           data-value="{{ $product->is_trending ? 0 : 1 }}"
                                           id="trending-{{ $product->id }}" {{ $product->is_trending ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="latest-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_latest"
                                           data-value="{{ $product->is_latest ? 0 : 1 }}"
                                           id="latest-{{ $product->id }}" {{ $product->is_latest ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="express-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_express_30"
                                           data-value="{{ $product->is_express_30 ? 0 : 1 }}"
                                           id="express-{{ $product->id }}" {{ $product->is_express_30 ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $product->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this product?"
                                           data-title-off="Want to deactivate this product?"
                                           id="status-{{ $product->id }}" {{ $product->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.products.status') }}" method="post" id="status-{{ $product->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $product->id }}">
                                    <input type="hidden" name="status" value="{{ $product->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.products.edit', $product->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="product-{{ $product->id }}" 
                                       data-form-id="product-{{ $product->id }}"
                                       data-message="Want to delete this product?" 
                                       data-title="Delete Product"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.products.destroy', $product->id) }}"
                                            method="post" id="product-{{ $product->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr class="no-data-row">
                            <td colspan="10" class="text-center py-5">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5 class="mb-2">{{ translate('no_data_found') }}</h5>
                                    @if(request('search') || request('category_id') || request('status'))
                                        <p class="text-muted">Try adjusting your search or filter criteria.</p>
                                        <a href="{{ route('admin.products.index') }}" class="btn btn--primary btn-sm mt-2">
                                            <i class="tio-clear"></i> Clear Filters
                                        </a>
                                    @endif
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                @if($products->hasPages() && $products->total() > 0)
                    <div class="mt-3">
                        {{ $products->appends(request()->query())->links() }}
                    </div>
                @endif
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                // Ensure empty state row is visible
                $('.no-data-row').show();
                // Hide loader immediately after DataTables initialization
                hideLoader();
            }
        });
        
        // Function to hide loader - multiple methods to ensure it works
        function hideLoader() {
            // Method 1: Use PageLoader object if available
            if (typeof PageLoader !== 'undefined' && PageLoader.hide) {
                PageLoader.hide();
            }
            // Method 2: Directly hide the loader element
            var loader = document.getElementById('page-loader');
            if (loader) {
                loader.classList.add('hide');
                loader.style.display = 'none';
            }
            // Method 3: jQuery fallback
            $('#page-loader').addClass('hide').hide();
        }
        
        // Ensure empty state is always visible when table is empty
        if (table.rows().count() === 0) {
            $('.no-data-row').show();
            hideLoader();
        }
        
        // Hide loader immediately after table initialization
        hideLoader();
        
        // Fallback: Hide loader after a short delay to ensure it's hidden
        setTimeout(function() {
            hideLoader();
        }, 300);
        
        // Additional fallback with longer delay
        setTimeout(function() {
            hideLoader();
        }, 800);
        
        // Handle flag toggles
        $(document).on('change', '.flag-toggle', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $checkbox = $(this);
            var productId = $checkbox.data('id');
            var flag = $checkbox.data('flag');
            var value = $checkbox.data('value');
            
            $.ajax({
                url: '{{ route('admin.products.flag') }}',
                method: 'POST',
                data: {
                    _token: '{{ csrf_token() }}',
                    id: productId,
                    flag: flag,
                    value: value
                },
                success: function(response) {
                    // Update the data-value for next toggle
                    $checkbox.data('value', value == 1 ? 0 : 1);
                },
                error: function(xhr) {
                    // Revert checkbox
                    $checkbox.prop('checked', !$checkbox.prop('checked'));
                    alert('Failed to update flag. Please try again.');
                }
            });
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        // Hide loader on window load as final fallback
        $(window).on('load', function() {
            setTimeout(function() {
                hideLoader();
            }, 300);
        });
        
        // Also hide loader when document is ready (immediate fallback)
        setTimeout(function() {
            hideLoader();
        }, 1000);
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.products'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .badge-express {
        background-color: #f0ad4e;
        color: #fff;
    }
    
    .no-data-row {
        display: table-row !important;
    }
    
    .no-data-row td {
        padding: 3rem 1rem !important;
    }
    
    .search-filter-wrapper {
        display: flex;
        gap: 10px;
        align-items: flex-end;
        flex-wrap: wrap;
    }
    
    .search-filter-wrapper .form-group {
        margin-bottom: 0;
        flex: 1;
        min-width: 200px;
    }
    
    .search-filter-wrapper .form-group label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 5px;
        font-size: 0.875rem;
    }
    
    .search-filter-wrapper .btn {
        white-space: nowrap;
        height: fit-content;
    }
    
    @media (max-width: 768px) {
        .search-filter-wrapper {
            flex-direction: column;
        }
        
        .search-filter-wrapper .form-group {
            width: 100%;
        }
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-shop"></i>
                </span>
                <span>
                    {{ translate('messages.products') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.products') }} <span class="badge badge-soft-dark ml-2" id="product-count">{{ $products->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.products.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_product') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.products.index') }}" id="product-filter-form" class="mb-3">
                    <div class="search-filter-wrapper">
                        <div class="form-group">
                            <label for="search">Search Products</label>
                            <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or description..." value="{{ old('search', request('search')) }}">
                        </div>
                        <div class="form-group">
                            <label for="category_id">Filter by Category</label>
                            <select name="category_id" id="category_id" class="form-control">
                                <option value="">All Categories</option>
                                @foreach($categories as $category)
                                    <option value="{{ $category->id }}" {{ old('category_id', request('category_id')) == $category->id || (string)old('category_id', request('category_id')) === (string)$category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                @endforeach
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status">Status</label>
                            <select name="status" id="status" class="form-control">
                                <option value="">All Status</option>
                                <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn--primary">
                                    <i class="tio-search"></i> Search
                                </button>
                                @if(request('search') || request('category_id') || request('status'))
                                    <a href="{{ route('admin.products.index') }}" class="btn btn--reset">
                                        <i class="tio-clear"></i> Clear
                                    </a>
                                @endif
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Product Name</th>
                        <th class="border-0">Category</th>
                        <th class="border-0">Price</th>
                        <th class="border-0 text-center">Trending</th>
                        <th class="border-0 text-center">Latest</th>
                        <th class="border-0 text-center">Express-30</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($products as $key => $product)
                        <tr>
                            <td>{{ ($products->currentPage() - 1) * $products->perPage() + $key + 1 }}</td>
                            <td>
                                @php
                                    $primaryImage = $product->images->where('is_primary', true)->first() ?? $product->images->first();
                                @endphp
                                @if($primaryImage)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $primaryImage->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $product->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/160x160/img2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ Str::limit($product->name, 30, '...') }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $product->category ? $product->category->name : '-' }}
                                </span>
                            </td>
                            <td>
                                @php
                                    $variant = $product->variants->first();
                                    $price = $variant ? ($variant->sale_price ?? $variant->price) : 0;
                                @endphp
                                <span class="d-block font-size-sm text-body">
                                    ‚Çπ{{ number_format($price, 2) }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="trending-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_trending"
                                           data-value="{{ $product->is_trending ? 0 : 1 }}"
                                           id="trending-{{ $product->id }}" {{ $product->is_trending ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="latest-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_latest"
                                           data-value="{{ $product->is_latest ? 0 : 1 }}"
                                           id="latest-{{ $product->id }}" {{ $product->is_latest ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="express-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_express_30"
                                           data-value="{{ $product->is_express_30 ? 0 : 1 }}"
                                           id="express-{{ $product->id }}" {{ $product->is_express_30 ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $product->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this product?"
                                           data-title-off="Want to deactivate this product?"
                                           id="status-{{ $product->id }}" {{ $product->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.products.status') }}" method="post" id="status-{{ $product->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $product->id }}">
                                    <input type="hidden" name="status" value="{{ $product->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.products.edit', $product->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="product-{{ $product->id }}" 
                                       data-form-id="product-{{ $product->id }}"
                                       data-message="Want to delete this product?" 
                                       data-title="Delete Product"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.products.destroy', $product->id) }}"
                                            method="post" id="product-{{ $product->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr class="no-data-row">
                            <td colspan="10" class="text-center py-5">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5 class="mb-2">{{ translate('no_data_found') }}</h5>
                                    @if(request('search') || request('category_id') || request('status'))
                                        <p class="text-muted">Try adjusting your search or filter criteria.</p>
                                        <a href="{{ route('admin.products.index') }}" class="btn btn--primary btn-sm mt-2">
                                            <i class="tio-clear"></i> Clear Filters
                                        </a>
                                    @endif
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                @if($products->hasPages() && $products->total() > 0)
                    <div class="mt-3">
                        {{ $products->appends(request()->query())->links() }}
                    </div>
                @endif
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                // Ensure empty state row is visible
                $('.no-data-row').show();
                // Hide loader immediately after DataTables initialization
                hideLoader();
            }
        });
        
        // Function to hide loader - multiple methods to ensure it works
        function hideLoader() {
            // Method 1: Use PageLoader object if available
            if (typeof PageLoader !== 'undefined' && PageLoader.hide) {
                PageLoader.hide();
            }
            // Method 2: Directly hide the loader element
            var loader = document.getElementById('page-loader');
            if (loader) {
                loader.classList.add('hide');
                loader.style.display = 'none';
            }
            // Method 3: jQuery fallback
            $('#page-loader').addClass('hide').hide();
        }
        
        // Ensure empty state is always visible when table is empty
        if (table.rows().count() === 0) {
            $('.no-data-row').show();
            hideLoader();
        }
        
        // Hide loader immediately after table initialization
        hideLoader();
        
        // Fallback: Hide loader after a short delay to ensure it's hidden
        setTimeout(function() {
            hideLoader();
        }, 300);
        
        // Additional fallback with longer delay
        setTimeout(function() {
            hideLoader();
        }, 800);
        
        // Handle flag toggles
        $(document).on('change', '.flag-toggle', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $checkbox = $(this);
            var productId = $checkbox.data('id');
            var flag = $checkbox.data('flag');
            var value = $checkbox.data('value');
            
            $.ajax({
                url: '{{ route('admin.products.flag') }}',
                method: 'POST',
                data: {
                    _token: '{{ csrf_token() }}',
                    id: productId,
                    flag: flag,
                    value: value
                },
                success: function(response) {
                    // Update the data-value for next toggle
                    $checkbox.data('value', value == 1 ? 0 : 1);
                },
                error: function(xhr) {
                    // Revert checkbox
                    $checkbox.prop('checked', !$checkbox.prop('checked'));
                    alert('Failed to update flag. Please try again.');
                }
            });
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        // Hide loader on window load as final fallback
        $(window).on('load', function() {
            hideLoader();
        });
        
        // Also hide loader when document is ready (immediate fallback)
        setTimeout(function() {
            hideLoader();
        }, 1000);
        
        // Force hide loader after page is fully interactive
        if (document.readyState === 'complete') {
            hideLoader();
        } else {
            window.addEventListener('load', function() {
                hideLoader();
            });
        }
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.categories'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .dataTables_wrapper .dataTables_length label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .dataTables_wrapper .dataTables_length select {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 80px;
    }
    
    .dataTables_wrapper .dataTables_filter {
        text-align: right;
    }
    
    .dataTables_wrapper .dataTables_filter label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: flex-end;
    }
    
    .dataTables_wrapper .dataTables_filter input {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 200px;
    }
    
    .no-data-row {
        display: table-row !important;
    }
    
    .no-data-row td {
        padding: 3rem 1rem !important;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-category"></i>
                </span>
                <span>
                    {{ translate('messages.categories') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.categories') }} <span class="badge badge-soft-dark ml-2" id="category-count">{{ $categories->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.categories.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_category') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.categories.index') }}" id="category-filter-form" class="mb-3">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="search">Search Categories</label>
                                <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or slug..." value="{{ old('search', request('search')) }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="status">Status</label>
                                <select name="status" id="status" class="form-control">
                                    <option value="">All Status</option>
                                    <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                    <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="parent_id">Parent Category</label>
                                <select name="parent_id" id="parent_id" class="form-control">
                                    <option value="">All Categories</option>
                                    <option value="null" {{ old('parent_id', request('parent_id')) == 'null' ? 'selected' : '' }}>Main Categories Only</option>
                                    @foreach($parentCategories as $parent)
                                        <option value="{{ $parent->id }}" {{ old('parent_id', request('parent_id')) == $parent->id || (string)old('parent_id', request('parent_id')) === (string)$parent->id ? 'selected' : '' }}>{{ $parent->name }}</option>
                                    @endforeach
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <div class="d-flex gap-2">
                                    <button type="submit" class="btn btn--primary w-100">
                                        <i class="tio-search"></i> Filter
                                    </button>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--reset">
                                            <i class="tio-clear"></i>
                                        </a>
                                    @endif
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Name</th>
                        <th class="border-0">Parent</th>
                        <th class="border-0">Slug</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($categories as $key => $category)
                        <tr>
                            <td>{{ ($categories->currentPage() - 1) * $categories->perPage() + $key + 1 }}</td>
                            <td>
                                @if($category->image_url)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('category', $category->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $category->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/100x100/2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->name }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->parent ? $category->parent->name : '-' }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->slug }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $category->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $category->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this category?"
                                           data-title-off="Want to deactivate this category?"
                                           id="status-{{ $category->id }}" {{ $category->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.categories.status') }}" method="post" id="status-{{ $category->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $category->id }}">
                                    <input type="hidden" name="status" value="{{ $category->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.categories.edit', $category->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="category-{{ $category->id }}" 
                                       data-form-id="category-{{ $category->id }}"
                                       data-message="Want to delete this category?" 
                                       data-title="Delete Category"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.categories.destroy', $category->id) }}"
                                            method="post" id="category-{{ $category->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr class="no-data-row">
                            <td colspan="7" class="text-center py-5">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5 class="mb-2">{{ translate('no_data_found') }}</h5>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <p class="text-muted">Try adjusting your search or filter criteria.</p>
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--primary btn-sm mt-2">
                                            <i class="tio-clear"></i> Clear Filters
                                        </a>
                                    @endif
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                @if($categories->hasPages() && $categories->total() > 0)
                    <div class="mt-3">
                        {{ $categories->appends(request()->query())->links() }}
                    </div>
                @endif
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                // Ensure empty state row is visible
                $('.no-data-row').show();
                // Hide loader immediately after DataTables initialization
                hideLoader();
            }
        });
        
        // Function to hide loader - multiple methods to ensure it works
        function hideLoader() {
            // Method 1: Use PageLoader object if available
            if (typeof PageLoader !== 'undefined' && PageLoader.hide) {
                PageLoader.hide();
            }
            // Method 2: Directly hide the loader element
            var loader = document.getElementById('page-loader');
            if (loader) {
                loader.classList.add('hide');
                loader.style.display = 'none';
            }
            // Method 3: jQuery fallback
            $('#page-loader').addClass('hide').hide();
        }
        
        // Ensure empty state is always visible when table is empty
        if (table.rows().count() === 0) {
            $('.no-data-row').show();
            hideLoader();
        }
        
        // Hide loader immediately after table initialization
        hideLoader();
        
        // Fallback: Hide loader after a short delay to ensure it's hidden
        setTimeout(function() {
            hideLoader();
        }, 300);
        
        // Additional fallback with longer delay
        setTimeout(function() {
            hideLoader();
        }, 800);
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        // Hide loader on window load as final fallback
        $(window).on('load', function() {
            setTimeout(function() {
                hideLoader();
            }, 300);
        });
        
        // Also hide loader when document is ready (immediate fallback)
        setTimeout(function() {
            hideLoader();
        }, 1000);
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.categories'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .dataTables_wrapper .dataTables_length label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .dataTables_wrapper .dataTables_length select {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 80px;
    }
    
    .dataTables_wrapper .dataTables_filter {
        text-align: right;
    }
    
    .dataTables_wrapper .dataTables_filter label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: flex-end;
    }
    
    .dataTables_wrapper .dataTables_filter input {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 200px;
    }
    
    .no-data-row {
        display: table-row !important;
    }
    
    .no-data-row td {
        padding: 3rem 1rem !important;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-category"></i>
                </span>
                <span>
                    {{ translate('messages.categories') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.categories') }} <span class="badge badge-soft-dark ml-2" id="category-count">{{ $categories->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.categories.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_category') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.categories.index') }}" id="category-filter-form" class="mb-3">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="search">Search Categories</label>
                                <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or slug..." value="{{ old('search', request('search')) }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="status">Status</label>
                                <select name="status" id="status" class="form-control">
                                    <option value="">All Status</option>
                                    <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                    <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="parent_id">Parent Category</label>
                                <select name="parent_id" id="parent_id" class="form-control">
                                    <option value="">All Categories</option>
                                    <option value="null" {{ old('parent_id', request('parent_id')) == 'null' ? 'selected' : '' }}>Main Categories Only</option>
                                    @foreach($parentCategories as $parent)
                                        <option value="{{ $parent->id }}" {{ old('parent_id', request('parent_id')) == $parent->id || (string)old('parent_id', request('parent_id')) === (string)$parent->id ? 'selected' : '' }}>{{ $parent->name }}</option>
                                    @endforeach
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <div class="d-flex gap-2">
                                    <button type="submit" class="btn btn--primary w-100">
                                        <i class="tio-search"></i> Filter
                                    </button>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--reset">
                                            <i class="tio-clear"></i>
                                        </a>
                                    @endif
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Name</th>
                        <th class="border-0">Parent</th>
                        <th class="border-0">Slug</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($categories as $key => $category)
                        <tr>
                            <td>{{ ($categories->currentPage() - 1) * $categories->perPage() + $key + 1 }}</td>
                            <td>
                                @if($category->image_url)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('category', $category->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $category->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/100x100/2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->name }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->parent ? $category->parent->name : '-' }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->slug }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $category->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $category->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this category?"
                                           data-title-off="Want to deactivate this category?"
                                           id="status-{{ $category->id }}" {{ $category->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.categories.status') }}" method="post" id="status-{{ $category->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $category->id }}">
                                    <input type="hidden" name="status" value="{{ $category->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.categories.edit', $category->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="category-{{ $category->id }}" 
                                       data-form-id="category-{{ $category->id }}"
                                       data-message="Want to delete this category?" 
                                       data-title="Delete Category"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.categories.destroy', $category->id) }}"
                                            method="post" id="category-{{ $category->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr class="no-data-row">
                            <td colspan="7" class="text-center py-5">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5 class="mb-2">{{ translate('no_data_found') }}</h5>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <p class="text-muted">Try adjusting your search or filter criteria.</p>
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--primary btn-sm mt-2">
                                            <i class="tio-clear"></i> Clear Filters
                                        </a>
                                    @endif
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                @if($categories->hasPages() && $categories->total() > 0)
                    <div class="mt-3">
                        {{ $categories->appends(request()->query())->links() }}
                    </div>
                @endif
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    $(document).ready(function () {
        if (typeof PageLoader !== 'undefined') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                // Ensure empty state row is visible
                $('.no-data-row').show();
                // Hide loader immediately after DataTables initialization
                hideLoader();
            }
        });
        
        // Function to hide loader - multiple methods to ensure it works
        function hideLoader() {
            // Method 1: Use PageLoader object if available
            if (typeof PageLoader !== 'undefined' && PageLoader.hide) {
                PageLoader.hide();
            }
            // Method 2: Directly hide the loader element
            var loader = document.getElementById('page-loader');
            if (loader) {
                loader.classList.add('hide');
                loader.style.display = 'none';
            }
            // Method 3: jQuery fallback
            $('#page-loader').addClass('hide').hide();
        }
        
        // Ensure empty state is always visible when table is empty
        if (table.rows().count() === 0) {
            $('.no-data-row').show();
            hideLoader();
        }
        
        // Hide loader immediately after table initialization
        hideLoader();
        
        // Fallback: Hide loader after a short delay to ensure it's hidden
        setTimeout(function() {
            hideLoader();
        }, 300);
        
        // Additional fallback with longer delay
        setTimeout(function() {
            hideLoader();
        }, 800);
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        // Hide loader on window load as final fallback
        $(window).on('load', function() {
            hideLoader();
        });
        
        // Also hide loader when document is ready (immediate fallback)
        setTimeout(function() {
            hideLoader();
        }, 1000);
        
        // Force hide loader after page is fully interactive
        if (document.readyState === 'complete') {
            hideLoader();
        } else {
            window.addEventListener('load', function() {
                hideLoader();
            });
        }
    });
</script>
@endpush


```


Updated the loader hide logic to use multiple methods. Changes:

## Fixes applied

### 1. Enhanced `hideLoader()` function
Uses three methods to hide the loader:
- Method 1: PageLoader object (if available)
- Method 2: Direct DOM manipulation ‚Äî adds `hide` class and sets `display: none`
- Method 3: jQuery fallback ‚Äî uses jQuery to hide the element

### 2. Multiple hide triggers
- Immediate hide after DataTables initialization
- Hide when table is empty (0 rows)
- 300ms fallback timeout
- 800ms additional fallback
- Window load event handler
- 1-second final fallback
- Document readyState check ‚Äî hides immediately if page is already loaded

### 3. Direct element manipulation
The function now directly:
- Adds the `hide` class to `#page-loader`
- Sets `display: none` on the element
- Uses jQuery as a fallback

### Changes summary

**Both Products & Categories Index Views:**
- Enhanced `hideLoader()` with 3 methods
- Immediate hide after table init
- Multiple timeout fallbacks (300ms, 800ms, 1000ms)
- Window load event handler
- Document readyState check
- Direct DOM manipulation as backup

The loader should now hide reliably, including when:
- There are 0 results from filters
- DataTables finishes initializing
- The page is already loaded
- Any edge case occurs

The loader element (`#page-loader`) is hidden using multiple methods to ensure it disappears even if one method fails.

---

**User**

Still this loader not hide on o record found

---

**Cursor**


Checking the current implementation and fixing the loader so it hides when there are 0 records:



Fixing the loader logic: it's being shown unnecessarily and not hiding properly. Updating it:


```blade
@extends('layouts.admin.app')

@section('title', translate('messages.products'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .badge-express {
        background-color: #f0ad4e;
        color: #fff;
    }
    
    .no-data-row {
        display: table-row !important;
    }
    
    .no-data-row td {
        padding: 3rem 1rem !important;
    }
    
    .search-filter-wrapper {
        display: flex;
        gap: 10px;
        align-items: flex-end;
        flex-wrap: wrap;
    }
    
    .search-filter-wrapper .form-group {
        margin-bottom: 0;
        flex: 1;
        min-width: 200px;
    }
    
    .search-filter-wrapper .form-group label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 5px;
        font-size: 0.875rem;
    }
    
    .search-filter-wrapper .btn {
        white-space: nowrap;
        height: fit-content;
    }
    
    @media (max-width: 768px) {
        .search-filter-wrapper {
            flex-direction: column;
        }
        
        .search-filter-wrapper .form-group {
            width: 100%;
        }
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-shop"></i>
                </span>
                <span>
                    {{ translate('messages.products') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.products') }} <span class="badge badge-soft-dark ml-2" id="product-count">{{ $products->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.products.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_product') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.products.index') }}" id="product-filter-form" class="mb-3">
                    <div class="search-filter-wrapper">
                        <div class="form-group">
                            <label for="search">Search Products</label>
                            <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or description..." value="{{ old('search', request('search')) }}">
                        </div>
                        <div class="form-group">
                            <label for="category_id">Filter by Category</label>
                            <select name="category_id" id="category_id" class="form-control">
                                <option value="">All Categories</option>
                                @foreach($categories as $category)
                                    <option value="{{ $category->id }}" {{ old('category_id', request('category_id')) == $category->id || (string)old('category_id', request('category_id')) === (string)$category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                @endforeach
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status">Status</label>
                            <select name="status" id="status" class="form-control">
                                <option value="">All Status</option>
                                <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn--primary">
                                    <i class="tio-search"></i> Search
                                </button>
                                @if(request('search') || request('category_id') || request('status'))
                                    <a href="{{ route('admin.products.index') }}" class="btn btn--reset">
                                        <i class="tio-clear"></i> Clear
                                    </a>
                                @endif
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Product Name</th>
                        <th class="border-0">Category</th>
                        <th class="border-0">Price</th>
                        <th class="border-0 text-center">Trending</th>
                        <th class="border-0 text-center">Latest</th>
                        <th class="border-0 text-center">Express-30</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($products as $key => $product)
                        <tr>
                            <td>{{ ($products->currentPage() - 1) * $products->perPage() + $key + 1 }}</td>
                            <td>
                                @php
                                    $primaryImage = $product->images->where('is_primary', true)->first() ?? $product->images->first();
                                @endphp
                                @if($primaryImage)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $primaryImage->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $product->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/160x160/img2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ Str::limit($product->name, 30, '...') }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $product->category ? $product->category->name : '-' }}
                                </span>
                            </td>
                            <td>
                                @php
                                    $variant = $product->variants->first();
                                    $price = $variant ? ($variant->sale_price ?? $variant->price) : 0;
                                @endphp
                                <span class="d-block font-size-sm text-body">
                                    ‚Çπ{{ number_format($price, 2) }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="trending-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_trending"
                                           data-value="{{ $product->is_trending ? 0 : 1 }}"
                                           id="trending-{{ $product->id }}" {{ $product->is_trending ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="latest-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_latest"
                                           data-value="{{ $product->is_latest ? 0 : 1 }}"
                                           id="latest-{{ $product->id }}" {{ $product->is_latest ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="express-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_express_30"
                                           data-value="{{ $product->is_express_30 ? 0 : 1 }}"
                                           id="express-{{ $product->id }}" {{ $product->is_express_30 ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $product->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this product?"
                                           data-title-off="Want to deactivate this product?"
                                           id="status-{{ $product->id }}" {{ $product->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.products.status') }}" method="post" id="status-{{ $product->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $product->id }}">
                                    <input type="hidden" name="status" value="{{ $product->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.products.edit', $product->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="product-{{ $product->id }}" 
                                       data-form-id="product-{{ $product->id }}"
                                       data-message="Want to delete this product?" 
                                       data-title="Delete Product"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.products.destroy', $product->id) }}"
                                            method="post" id="product-{{ $product->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr class="no-data-row">
                            <td colspan="10" class="text-center py-5">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5 class="mb-2">{{ translate('no_data_found') }}</h5>
                                    @if(request('search') || request('category_id') || request('status'))
                                        <p class="text-muted">Try adjusting your search or filter criteria.</p>
                                        <a href="{{ route('admin.products.index') }}" class="btn btn--primary btn-sm mt-2">
                                            <i class="tio-clear"></i> Clear Filters
                                        </a>
                                    @endif
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                @if($products->hasPages() && $products->total() > 0)
                    <div class="mt-3">
                        {{ $products->appends(request()->query())->links() }}
                    </div>
                @endif
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    // Function to hide loader - multiple methods to ensure it works
    function hideLoader() {
        // Method 1: Use PageLoader object if available
        if (typeof PageLoader !== 'undefined' && PageLoader.hide) {
            PageLoader.hide();
        }
        // Method 2: Directly hide the loader element
        var loader = document.getElementById('page-loader');
        if (loader) {
            loader.classList.add('hide');
            loader.style.display = 'none';
            loader.style.visibility = 'hidden';
            loader.style.opacity = '0';
        }
        // Method 3: jQuery fallback
        $('#page-loader').addClass('hide').hide().css({
            'display': 'none',
            'visibility': 'hidden',
            'opacity': '0'
        });
    }
    
    $(document).ready(function () {
        // Don't show loader if page is already loaded or if we're filtering
        var isFiltering = {{ request()->hasAny(['search', 'category_id', 'status']) ? 'true' : 'false' }};
        if (!isFiltering && typeof PageLoader !== 'undefined' && document.readyState !== 'complete') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                // Ensure empty state row is visible
                $('.no-data-row').show();
                // Hide loader immediately after DataTables initialization
                hideLoader();
            }
        });
        
        // Hide loader immediately after table initialization
        hideLoader();
        
        // Ensure empty state is always visible when table is empty
        setTimeout(function() {
            if (table.rows().count() === 0) {
                $('.no-data-row').show();
            }
            hideLoader();
        }, 100);
        
        // Fallback: Hide loader after a short delay to ensure it's hidden
        setTimeout(function() {
            hideLoader();
        }, 300);
        
        // Additional fallback with longer delay
        setTimeout(function() {
            hideLoader();
        }, 600);
        
        // Handle flag toggles
        $(document).on('change', '.flag-toggle', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $checkbox = $(this);
            var productId = $checkbox.data('id');
            var flag = $checkbox.data('flag');
            var value = $checkbox.data('value');
            
            $.ajax({
                url: '{{ route('admin.products.flag') }}',
                method: 'POST',
                data: {
                    _token: '{{ csrf_token() }}',
                    id: productId,
                    flag: flag,
                    value: value
                },
                success: function(response) {
                    // Update the data-value for next toggle
                    $checkbox.data('value', value == 1 ? 0 : 1);
                },
                error: function(xhr) {
                    // Revert checkbox
                    $checkbox.prop('checked', !$checkbox.prop('checked'));
                    alert('Failed to update flag. Please try again.');
                }
            });
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        // Hide loader on window load as final fallback
        $(window).on('load', function() {
            hideLoader();
        });
        
        // Also hide loader when document is ready (immediate fallback)
        setTimeout(function() {
            hideLoader();
        }, 1000);
        
        // Force hide loader after page is fully interactive
        if (document.readyState === 'complete') {
            hideLoader();
        } else {
            window.addEventListener('load', function() {
                hideLoader();
            });
        }
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.products'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .badge-express {
        background-color: #f0ad4e;
        color: #fff;
    }
    
    .no-data-row {
        display: table-row !important;
    }
    
    .no-data-row td {
        padding: 3rem 1rem !important;
    }
    
    .search-filter-wrapper {
        display: flex;
        gap: 10px;
        align-items: flex-end;
        flex-wrap: wrap;
    }
    
    .search-filter-wrapper .form-group {
        margin-bottom: 0;
        flex: 1;
        min-width: 200px;
    }
    
    .search-filter-wrapper .form-group label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 5px;
        font-size: 0.875rem;
    }
    
    .search-filter-wrapper .btn {
        white-space: nowrap;
        height: fit-content;
    }
    
    @media (max-width: 768px) {
        .search-filter-wrapper {
            flex-direction: column;
        }
        
        .search-filter-wrapper .form-group {
            width: 100%;
        }
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-shop"></i>
                </span>
                <span>
                    {{ translate('messages.products') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.products') }} <span class="badge badge-soft-dark ml-2" id="product-count">{{ $products->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.products.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_product') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.products.index') }}" id="product-filter-form" class="mb-3">
                    <div class="search-filter-wrapper">
                        <div class="form-group">
                            <label for="search">Search Products</label>
                            <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or description..." value="{{ old('search', request('search')) }}">
                        </div>
                        <div class="form-group">
                            <label for="category_id">Filter by Category</label>
                            <select name="category_id" id="category_id" class="form-control">
                                <option value="">All Categories</option>
                                @foreach($categories as $category)
                                    <option value="{{ $category->id }}" {{ old('category_id', request('category_id')) == $category->id || (string)old('category_id', request('category_id')) === (string)$category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                @endforeach
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status">Status</label>
                            <select name="status" id="status" class="form-control">
                                <option value="">All Status</option>
                                <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn--primary">
                                    <i class="tio-search"></i> Search
                                </button>
                                @if(request('search') || request('category_id') || request('status'))
                                    <a href="{{ route('admin.products.index') }}" class="btn btn--reset">
                                        <i class="tio-clear"></i> Clear
                                    </a>
                                @endif
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Product Name</th>
                        <th class="border-0">Category</th>
                        <th class="border-0">Price</th>
                        <th class="border-0 text-center">Trending</th>
                        <th class="border-0 text-center">Latest</th>
                        <th class="border-0 text-center">Express-30</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($products as $key => $product)
                        <tr>
                            <td>{{ ($products->currentPage() - 1) * $products->perPage() + $key + 1 }}</td>
                            <td>
                                @php
                                    $primaryImage = $product->images->where('is_primary', true)->first() ?? $product->images->first();
                                @endphp
                                @if($primaryImage)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $primaryImage->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $product->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/160x160/img2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ Str::limit($product->name, 30, '...') }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $product->category ? $product->category->name : '-' }}
                                </span>
                            </td>
                            <td>
                                @php
                                    $variant = $product->variants->first();
                                    $price = $variant ? ($variant->sale_price ?? $variant->price) : 0;
                                @endphp
                                <span class="d-block font-size-sm text-body">
                                    ‚Çπ{{ number_format($price, 2) }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="trending-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_trending"
                                           data-value="{{ $product->is_trending ? 0 : 1 }}"
                                           id="trending-{{ $product->id }}" {{ $product->is_trending ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="latest-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_latest"
                                           data-value="{{ $product->is_latest ? 0 : 1 }}"
                                           id="latest-{{ $product->id }}" {{ $product->is_latest ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="express-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_express_30"
                                           data-value="{{ $product->is_express_30 ? 0 : 1 }}"
                                           id="express-{{ $product->id }}" {{ $product->is_express_30 ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $product->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this product?"
                                           data-title-off="Want to deactivate this product?"
                                           id="status-{{ $product->id }}" {{ $product->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.products.status') }}" method="post" id="status-{{ $product->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $product->id }}">
                                    <input type="hidden" name="status" value="{{ $product->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.products.edit', $product->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="product-{{ $product->id }}" 
                                       data-form-id="product-{{ $product->id }}"
                                       data-message="Want to delete this product?" 
                                       data-title="Delete Product"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.products.destroy', $product->id) }}"
                                            method="post" id="product-{{ $product->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr class="no-data-row">
                            <td colspan="10" class="text-center py-5">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5 class="mb-2">{{ translate('no_data_found') }}</h5>
                                    @if(request('search') || request('category_id') || request('status'))
                                        <p class="text-muted">Try adjusting your search or filter criteria.</p>
                                        <a href="{{ route('admin.products.index') }}" class="btn btn--primary btn-sm mt-2">
                                            <i class="tio-clear"></i> Clear Filters
                                        </a>
                                    @endif
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                @if($products->hasPages() && $products->total() > 0)
                    <div class="mt-3">
                        {{ $products->appends(request()->query())->links() }}
                    </div>
                @endif
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    // Function to hide loader - multiple methods to ensure it works
    function hideLoader() {
        // Method 1: Use PageLoader object if available
        if (typeof PageLoader !== 'undefined' && PageLoader.hide) {
            PageLoader.hide();
        }
        // Method 2: Directly hide the loader element
        var loader = document.getElementById('page-loader');
        if (loader) {
            loader.classList.add('hide');
            loader.style.display = 'none';
            loader.style.visibility = 'hidden';
            loader.style.opacity = '0';
        }
        // Method 3: jQuery fallback
        $('#page-loader').addClass('hide').hide().css({
            'display': 'none',
            'visibility': 'hidden',
            'opacity': '0'
        });
    }
    
    $(document).ready(function () {
        // Don't show loader if page is already loaded or if we're filtering
        var isFiltering = {{ request()->hasAny(['search', 'category_id', 'status']) ? 'true' : 'false' }};
        if (!isFiltering && typeof PageLoader !== 'undefined' && document.readyState !== 'complete') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                // Ensure empty state row is visible
                $('.no-data-row').show();
                // Hide loader immediately after DataTables initialization
                hideLoader();
            }
        });
        
        // Hide loader immediately after table initialization
        hideLoader();
        
        // Ensure empty state is always visible when table is empty
        setTimeout(function() {
            if (table.rows().count() === 0) {
                $('.no-data-row').show();
            }
            hideLoader();
        }, 100);
        
        // Fallback: Hide loader after a short delay to ensure it's hidden
        setTimeout(function() {
            hideLoader();
        }, 300);
        
        // Additional fallback with longer delay
        setTimeout(function() {
            hideLoader();
        }, 600);
        
        // Handle flag toggles
        $(document).on('change', '.flag-toggle', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $checkbox = $(this);
            var productId = $checkbox.data('id');
            var flag = $checkbox.data('flag');
            var value = $checkbox.data('value');
            
            $.ajax({
                url: '{{ route('admin.products.flag') }}',
                method: 'POST',
                data: {
                    _token: '{{ csrf_token() }}',
                    id: productId,
                    flag: flag,
                    value: value
                },
                success: function(response) {
                    // Update the data-value for next toggle
                    $checkbox.data('value', value == 1 ? 0 : 1);
                },
                error: function(xhr) {
                    // Revert checkbox
                    $checkbox.prop('checked', !$checkbox.prop('checked'));
                    alert('Failed to update flag. Please try again.');
                }
            });
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        // Hide loader on window load as final fallback
        $(window).on('load', function() {
            hideLoader();
        });
        
        // Force hide loader immediately if page is already loaded
        if (document.readyState === 'complete') {
            hideLoader();
        }
        
        // Additional event listeners to ensure loader is hidden
        window.addEventListener('load', function() {
            hideLoader();
        });
        
        // Final fallback - hide after 1 second
        setTimeout(function() {
            hideLoader();
        }, 1000);
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.categories'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .dataTables_wrapper .dataTables_length label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .dataTables_wrapper .dataTables_length select {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 80px;
    }
    
    .dataTables_wrapper .dataTables_filter {
        text-align: right;
    }
    
    .dataTables_wrapper .dataTables_filter label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: flex-end;
    }
    
    .dataTables_wrapper .dataTables_filter input {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 200px;
    }
    
    .no-data-row {
        display: table-row !important;
    }
    
    .no-data-row td {
        padding: 3rem 1rem !important;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-category"></i>
                </span>
                <span>
                    {{ translate('messages.categories') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.categories') }} <span class="badge badge-soft-dark ml-2" id="category-count">{{ $categories->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.categories.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_category') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.categories.index') }}" id="category-filter-form" class="mb-3">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="search">Search Categories</label>
                                <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or slug..." value="{{ old('search', request('search')) }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="status">Status</label>
                                <select name="status" id="status" class="form-control">
                                    <option value="">All Status</option>
                                    <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                    <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="parent_id">Parent Category</label>
                                <select name="parent_id" id="parent_id" class="form-control">
                                    <option value="">All Categories</option>
                                    <option value="null" {{ old('parent_id', request('parent_id')) == 'null' ? 'selected' : '' }}>Main Categories Only</option>
                                    @foreach($parentCategories as $parent)
                                        <option value="{{ $parent->id }}" {{ old('parent_id', request('parent_id')) == $parent->id || (string)old('parent_id', request('parent_id')) === (string)$parent->id ? 'selected' : '' }}>{{ $parent->name }}</option>
                                    @endforeach
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <div class="d-flex gap-2">
                                    <button type="submit" class="btn btn--primary w-100">
                                        <i class="tio-search"></i> Filter
                                    </button>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--reset">
                                            <i class="tio-clear"></i>
                                        </a>
                                    @endif
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Name</th>
                        <th class="border-0">Parent</th>
                        <th class="border-0">Slug</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($categories as $key => $category)
                        <tr>
                            <td>{{ ($categories->currentPage() - 1) * $categories->perPage() + $key + 1 }}</td>
                            <td>
                                @if($category->image_url)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('category', $category->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $category->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/100x100/2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->name }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->parent ? $category->parent->name : '-' }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->slug }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $category->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $category->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this category?"
                                           data-title-off="Want to deactivate this category?"
                                           id="status-{{ $category->id }}" {{ $category->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.categories.status') }}" method="post" id="status-{{ $category->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $category->id }}">
                                    <input type="hidden" name="status" value="{{ $category->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.categories.edit', $category->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="category-{{ $category->id }}" 
                                       data-form-id="category-{{ $category->id }}"
                                       data-message="Want to delete this category?" 
                                       data-title="Delete Category"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.categories.destroy', $category->id) }}"
                                            method="post" id="category-{{ $category->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr class="no-data-row">
                            <td colspan="7" class="text-center py-5">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5 class="mb-2">{{ translate('no_data_found') }}</h5>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <p class="text-muted">Try adjusting your search or filter criteria.</p>
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--primary btn-sm mt-2">
                                            <i class="tio-clear"></i> Clear Filters
                                        </a>
                                    @endif
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                @if($categories->hasPages() && $categories->total() > 0)
                    <div class="mt-3">
                        {{ $categories->appends(request()->query())->links() }}
                    </div>
                @endif
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    // Function to hide loader - multiple methods to ensure it works
    function hideLoader() {
        // Method 1: Use PageLoader object if available
        if (typeof PageLoader !== 'undefined' && PageLoader.hide) {
            PageLoader.hide();
        }
        // Method 2: Directly hide the loader element
        var loader = document.getElementById('page-loader');
        if (loader) {
            loader.classList.add('hide');
            loader.style.display = 'none';
            loader.style.visibility = 'hidden';
            loader.style.opacity = '0';
        }
        // Method 3: jQuery fallback
        $('#page-loader').addClass('hide').hide().css({
            'display': 'none',
            'visibility': 'hidden',
            'opacity': '0'
        });
    }
    
    $(document).ready(function () {
        // Don't show loader if page is already loaded or if we're filtering
        var isFiltering = {{ request()->hasAny(['search', 'status', 'parent_id']) ? 'true' : 'false' }};
        if (!isFiltering && typeof PageLoader !== 'undefined' && document.readyState !== 'complete') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                // Ensure empty state row is visible
                $('.no-data-row').show();
                // Hide loader immediately after DataTables initialization
                hideLoader();
            }
        });
        
        // Hide loader immediately after table initialization
        hideLoader();
        
        // Ensure empty state is always visible when table is empty
        setTimeout(function() {
            if (table.rows().count() === 0) {
                $('.no-data-row').show();
            }
            hideLoader();
        }, 100);
        
        // Fallback: Hide loader after a short delay to ensure it's hidden
        setTimeout(function() {
            hideLoader();
        }, 300);
        
        // Additional fallback with longer delay
        setTimeout(function() {
            hideLoader();
        }, 600);
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        // Hide loader on window load as final fallback
        $(window).on('load', function() {
            hideLoader();
        });
        
        // Also hide loader when document is ready (immediate fallback)
        setTimeout(function() {
            hideLoader();
        }, 1000);
        
        // Force hide loader after page is fully interactive
        if (document.readyState === 'complete') {
            hideLoader();
        } else {
            window.addEventListener('load', function() {
                hideLoader();
            });
        }
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.categories'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .dataTables_wrapper .dataTables_length label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .dataTables_wrapper .dataTables_length select {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 80px;
    }
    
    .dataTables_wrapper .dataTables_filter {
        text-align: right;
    }
    
    .dataTables_wrapper .dataTables_filter label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: flex-end;
    }
    
    .dataTables_wrapper .dataTables_filter input {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 200px;
    }
    
    .no-data-row {
        display: table-row !important;
    }
    
    .no-data-row td {
        padding: 3rem 1rem !important;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-category"></i>
                </span>
                <span>
                    {{ translate('messages.categories') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.categories') }} <span class="badge badge-soft-dark ml-2" id="category-count">{{ $categories->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.categories.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_category') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.categories.index') }}" id="category-filter-form" class="mb-3">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="search">Search Categories</label>
                                <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or slug..." value="{{ old('search', request('search')) }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="status">Status</label>
                                <select name="status" id="status" class="form-control">
                                    <option value="">All Status</option>
                                    <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                    <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="parent_id">Parent Category</label>
                                <select name="parent_id" id="parent_id" class="form-control">
                                    <option value="">All Categories</option>
                                    <option value="null" {{ old('parent_id', request('parent_id')) == 'null' ? 'selected' : '' }}>Main Categories Only</option>
                                    @foreach($parentCategories as $parent)
                                        <option value="{{ $parent->id }}" {{ old('parent_id', request('parent_id')) == $parent->id || (string)old('parent_id', request('parent_id')) === (string)$parent->id ? 'selected' : '' }}>{{ $parent->name }}</option>
                                    @endforeach
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <div class="d-flex gap-2">
                                    <button type="submit" class="btn btn--primary w-100">
                                        <i class="tio-search"></i> Filter
                                    </button>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--reset">
                                            <i class="tio-clear"></i>
                                        </a>
                                    @endif
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Name</th>
                        <th class="border-0">Parent</th>
                        <th class="border-0">Slug</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($categories as $key => $category)
                        <tr>
                            <td>{{ ($categories->currentPage() - 1) * $categories->perPage() + $key + 1 }}</td>
                            <td>
                                @if($category->image_url)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('category', $category->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $category->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/100x100/2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->name }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->parent ? $category->parent->name : '-' }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->slug }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $category->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $category->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this category?"
                                           data-title-off="Want to deactivate this category?"
                                           id="status-{{ $category->id }}" {{ $category->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.categories.status') }}" method="post" id="status-{{ $category->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $category->id }}">
                                    <input type="hidden" name="status" value="{{ $category->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.categories.edit', $category->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="category-{{ $category->id }}" 
                                       data-form-id="category-{{ $category->id }}"
                                       data-message="Want to delete this category?" 
                                       data-title="Delete Category"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.categories.destroy', $category->id) }}"
                                            method="post" id="category-{{ $category->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr class="no-data-row">
                            <td colspan="7" class="text-center py-5">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5 class="mb-2">{{ translate('no_data_found') }}</h5>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <p class="text-muted">Try adjusting your search or filter criteria.</p>
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--primary btn-sm mt-2">
                                            <i class="tio-clear"></i> Clear Filters
                                        </a>
                                    @endif
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                @if($categories->hasPages() && $categories->total() > 0)
                    <div class="mt-3">
                        {{ $categories->appends(request()->query())->links() }}
                    </div>
                @endif
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    // Function to hide loader - multiple methods to ensure it works
    function hideLoader() {
        // Method 1: Use PageLoader object if available
        if (typeof PageLoader !== 'undefined' && PageLoader.hide) {
            PageLoader.hide();
        }
        // Method 2: Directly hide the loader element
        var loader = document.getElementById('page-loader');
        if (loader) {
            loader.classList.add('hide');
            loader.style.display = 'none';
            loader.style.visibility = 'hidden';
            loader.style.opacity = '0';
        }
        // Method 3: jQuery fallback
        $('#page-loader').addClass('hide').hide().css({
            'display': 'none',
            'visibility': 'hidden',
            'opacity': '0'
        });
    }
    
    $(document).ready(function () {
        // Don't show loader if page is already loaded or if we're filtering
        var isFiltering = {{ request()->hasAny(['search', 'status', 'parent_id']) ? 'true' : 'false' }};
        if (!isFiltering && typeof PageLoader !== 'undefined' && document.readyState !== 'complete') {
            PageLoader.show();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                // Ensure empty state row is visible
                $('.no-data-row').show();
                // Hide loader immediately after DataTables initialization
                hideLoader();
            }
        });
        
        // Hide loader immediately after table initialization
        hideLoader();
        
        // Ensure empty state is always visible when table is empty
        setTimeout(function() {
            if (table.rows().count() === 0) {
                $('.no-data-row').show();
            }
            hideLoader();
        }, 100);
        
        // Fallback: Hide loader after a short delay to ensure it's hidden
        setTimeout(function() {
            hideLoader();
        }, 300);
        
        // Additional fallback with longer delay
        setTimeout(function() {
            hideLoader();
        }, 600);
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        // Hide loader on window load as final fallback
        $(window).on('load', function() {
            hideLoader();
        });
        
        // Force hide loader immediately if page is already loaded
        if (document.readyState === 'complete') {
            hideLoader();
        }
        
        // Additional event listeners to ensure loader is hidden
        window.addEventListener('load', function() {
            hideLoader();
        });
        
        // Final fallback - hide after 1 second
        setTimeout(function() {
            hideLoader();
        }, 1000);
    });
</script>
@endpush


```


Fixing the Blade syntax issue and making the loader hide more reliably:


```blade
@extends('layouts.admin.app')

@section('title', translate('messages.products'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .badge-express {
        background-color: #f0ad4e;
        color: #fff;
    }
    
    .no-data-row {
        display: table-row !important;
    }
    
    .no-data-row td {
        padding: 3rem 1rem !important;
    }
    
    .search-filter-wrapper {
        display: flex;
        gap: 10px;
        align-items: flex-end;
        flex-wrap: wrap;
    }
    
    .search-filter-wrapper .form-group {
        margin-bottom: 0;
        flex: 1;
        min-width: 200px;
    }
    
    .search-filter-wrapper .form-group label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 5px;
        font-size: 0.875rem;
    }
    
    .search-filter-wrapper .btn {
        white-space: nowrap;
        height: fit-content;
    }
    
    @media (max-width: 768px) {
        .search-filter-wrapper {
            flex-direction: column;
        }
        
        .search-filter-wrapper .form-group {
            width: 100%;
        }
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-shop"></i>
                </span>
                <span>
                    {{ translate('messages.products') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.products') }} <span class="badge badge-soft-dark ml-2" id="product-count">{{ $products->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.products.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_product') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.products.index') }}" id="product-filter-form" class="mb-3">
                    <div class="search-filter-wrapper">
                        <div class="form-group">
                            <label for="search">Search Products</label>
                            <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or description..." value="{{ old('search', request('search')) }}">
                        </div>
                        <div class="form-group">
                            <label for="category_id">Filter by Category</label>
                            <select name="category_id" id="category_id" class="form-control">
                                <option value="">All Categories</option>
                                @foreach($categories as $category)
                                    <option value="{{ $category->id }}" {{ old('category_id', request('category_id')) == $category->id || (string)old('category_id', request('category_id')) === (string)$category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                @endforeach
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status">Status</label>
                            <select name="status" id="status" class="form-control">
                                <option value="">All Status</option>
                                <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn--primary">
                                    <i class="tio-search"></i> Search
                                </button>
                                @if(request('search') || request('category_id') || request('status'))
                                    <a href="{{ route('admin.products.index') }}" class="btn btn--reset">
                                        <i class="tio-clear"></i> Clear
                                    </a>
                                @endif
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Product Name</th>
                        <th class="border-0">Category</th>
                        <th class="border-0">Price</th>
                        <th class="border-0 text-center">Trending</th>
                        <th class="border-0 text-center">Latest</th>
                        <th class="border-0 text-center">Express-30</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($products as $key => $product)
                        <tr>
                            <td>{{ ($products->currentPage() - 1) * $products->perPage() + $key + 1 }}</td>
                            <td>
                                @php
                                    $primaryImage = $product->images->where('is_primary', true)->first() ?? $product->images->first();
                                @endphp
                                @if($primaryImage)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $primaryImage->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $product->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/160x160/img2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ Str::limit($product->name, 30, '...') }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $product->category ? $product->category->name : '-' }}
                                </span>
                            </td>
                            <td>
                                @php
                                    $variant = $product->variants->first();
                                    $price = $variant ? ($variant->sale_price ?? $variant->price) : 0;
                                @endphp
                                <span class="d-block font-size-sm text-body">
                                    ‚Çπ{{ number_format($price, 2) }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="trending-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_trending"
                                           data-value="{{ $product->is_trending ? 0 : 1 }}"
                                           id="trending-{{ $product->id }}" {{ $product->is_trending ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="latest-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_latest"
                                           data-value="{{ $product->is_latest ? 0 : 1 }}"
                                           id="latest-{{ $product->id }}" {{ $product->is_latest ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="express-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_express_30"
                                           data-value="{{ $product->is_express_30 ? 0 : 1 }}"
                                           id="express-{{ $product->id }}" {{ $product->is_express_30 ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $product->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this product?"
                                           data-title-off="Want to deactivate this product?"
                                           id="status-{{ $product->id }}" {{ $product->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.products.status') }}" method="post" id="status-{{ $product->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $product->id }}">
                                    <input type="hidden" name="status" value="{{ $product->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.products.edit', $product->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="product-{{ $product->id }}" 
                                       data-form-id="product-{{ $product->id }}"
                                       data-message="Want to delete this product?" 
                                       data-title="Delete Product"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.products.destroy', $product->id) }}"
                                            method="post" id="product-{{ $product->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr class="no-data-row">
                            <td colspan="10" class="text-center py-5">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5 class="mb-2">{{ translate('no_data_found') }}</h5>
                                    @if(request('search') || request('category_id') || request('status'))
                                        <p class="text-muted">Try adjusting your search or filter criteria.</p>
                                        <a href="{{ route('admin.products.index') }}" class="btn btn--primary btn-sm mt-2">
                                            <i class="tio-clear"></i> Clear Filters
                                        </a>
                                    @endif
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                @if($products->hasPages() && $products->total() > 0)
                    <div class="mt-3">
                        {{ $products->appends(request()->query())->links() }}
                    </div>
                @endif
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    // Function to hide loader - multiple methods to ensure it works
    function hideLoader() {
        // Method 1: Use PageLoader object if available
        if (typeof PageLoader !== 'undefined' && PageLoader.hide) {
            PageLoader.hide();
        }
        // Method 2: Directly hide the loader element
        var loader = document.getElementById('page-loader');
        if (loader) {
            loader.classList.add('hide');
            loader.style.display = 'none';
            loader.style.visibility = 'hidden';
            loader.style.opacity = '0';
        }
        // Method 3: jQuery fallback
        $('#page-loader').addClass('hide').hide().css({
            'display': 'none',
            'visibility': 'hidden',
            'opacity': '0'
        });
    }
    
    $(document).ready(function () {
        // Don't show loader if page is already loaded or if we're filtering
        var isFiltering = {{ (request()->has('search') || request()->has('category_id') || request()->has('status')) ? 'true' : 'false' }};
        if (!isFiltering && typeof PageLoader !== 'undefined' && document.readyState !== 'complete') {
            PageLoader.show();
        } else {
            // If filtering or page already loaded, hide loader immediately
            hideLoader();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                // Ensure empty state row is visible
                $('.no-data-row').show();
                // Hide loader immediately after DataTables initialization
                hideLoader();
            }
        });
        
        // Hide loader immediately after table initialization
        hideLoader();
        
        // Ensure empty state is always visible when table is empty
        setTimeout(function() {
            if (table.rows().count() === 0) {
                $('.no-data-row').show();
            }
            hideLoader();
        }, 100);
        
        // Fallback: Hide loader after a short delay to ensure it's hidden
        setTimeout(function() {
            hideLoader();
        }, 300);
        
        // Additional fallback with longer delay
        setTimeout(function() {
            hideLoader();
        }, 600);
        
        // Handle flag toggles
        $(document).on('change', '.flag-toggle', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $checkbox = $(this);
            var productId = $checkbox.data('id');
            var flag = $checkbox.data('flag');
            var value = $checkbox.data('value');
            
            $.ajax({
                url: '{{ route('admin.products.flag') }}',
                method: 'POST',
                data: {
                    _token: '{{ csrf_token() }}',
                    id: productId,
                    flag: flag,
                    value: value
                },
                success: function(response) {
                    // Update the data-value for next toggle
                    $checkbox.data('value', value == 1 ? 0 : 1);
                },
                error: function(xhr) {
                    // Revert checkbox
                    $checkbox.prop('checked', !$checkbox.prop('checked'));
                    alert('Failed to update flag. Please try again.');
                }
            });
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        // Hide loader on window load as final fallback
        $(window).on('load', function() {
            hideLoader();
        });
        
        // Force hide loader immediately if page is already loaded
        if (document.readyState === 'complete') {
            hideLoader();
        }
        
        // Additional event listeners to ensure loader is hidden
        window.addEventListener('load', function() {
            hideLoader();
        });
        
        // Final fallback - hide after 1 second
        setTimeout(function() {
            hideLoader();
        }, 1000);
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.categories'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .dataTables_wrapper .dataTables_length label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .dataTables_wrapper .dataTables_length select {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 80px;
    }
    
    .dataTables_wrapper .dataTables_filter {
        text-align: right;
    }
    
    .dataTables_wrapper .dataTables_filter label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: flex-end;
    }
    
    .dataTables_wrapper .dataTables_filter input {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 200px;
    }
    
    .no-data-row {
        display: table-row !important;
    }
    
    .no-data-row td {
        padding: 3rem 1rem !important;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-category"></i>
                </span>
                <span>
                    {{ translate('messages.categories') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.categories') }} <span class="badge badge-soft-dark ml-2" id="category-count">{{ $categories->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.categories.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_category') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.categories.index') }}" id="category-filter-form" class="mb-3">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="search">Search Categories</label>
                                <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or slug..." value="{{ old('search', request('search')) }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="status">Status</label>
                                <select name="status" id="status" class="form-control">
                                    <option value="">All Status</option>
                                    <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                    <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="parent_id">Parent Category</label>
                                <select name="parent_id" id="parent_id" class="form-control">
                                    <option value="">All Categories</option>
                                    <option value="null" {{ old('parent_id', request('parent_id')) == 'null' ? 'selected' : '' }}>Main Categories Only</option>
                                    @foreach($parentCategories as $parent)
                                        <option value="{{ $parent->id }}" {{ old('parent_id', request('parent_id')) == $parent->id || (string)old('parent_id', request('parent_id')) === (string)$parent->id ? 'selected' : '' }}>{{ $parent->name }}</option>
                                    @endforeach
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <div class="d-flex gap-2">
                                    <button type="submit" class="btn btn--primary w-100">
                                        <i class="tio-search"></i> Filter
                                    </button>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--reset">
                                            <i class="tio-clear"></i>
                                        </a>
                                    @endif
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Name</th>
                        <th class="border-0">Parent</th>
                        <th class="border-0">Slug</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($categories as $key => $category)
                        <tr>
                            <td>{{ ($categories->currentPage() - 1) * $categories->perPage() + $key + 1 }}</td>
                            <td>
                                @if($category->image_url)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('category', $category->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $category->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/100x100/2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->name }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->parent ? $category->parent->name : '-' }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->slug }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $category->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $category->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this category?"
                                           data-title-off="Want to deactivate this category?"
                                           id="status-{{ $category->id }}" {{ $category->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.categories.status') }}" method="post" id="status-{{ $category->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $category->id }}">
                                    <input type="hidden" name="status" value="{{ $category->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.categories.edit', $category->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="category-{{ $category->id }}" 
                                       data-form-id="category-{{ $category->id }}"
                                       data-message="Want to delete this category?" 
                                       data-title="Delete Category"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.categories.destroy', $category->id) }}"
                                            method="post" id="category-{{ $category->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr class="no-data-row">
                            <td colspan="7" class="text-center py-5">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5 class="mb-2">{{ translate('no_data_found') }}</h5>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <p class="text-muted">Try adjusting your search or filter criteria.</p>
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--primary btn-sm mt-2">
                                            <i class="tio-clear"></i> Clear Filters
                                        </a>
                                    @endif
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                @if($categories->hasPages() && $categories->total() > 0)
                    <div class="mt-3">
                        {{ $categories->appends(request()->query())->links() }}
                    </div>
                @endif
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    // Function to hide loader - multiple methods to ensure it works
    function hideLoader() {
        // Method 1: Use PageLoader object if available
        if (typeof PageLoader !== 'undefined' && PageLoader.hide) {
            PageLoader.hide();
        }
        // Method 2: Directly hide the loader element
        var loader = document.getElementById('page-loader');
        if (loader) {
            loader.classList.add('hide');
            loader.style.display = 'none';
            loader.style.visibility = 'hidden';
            loader.style.opacity = '0';
        }
        // Method 3: jQuery fallback
        $('#page-loader').addClass('hide').hide().css({
            'display': 'none',
            'visibility': 'hidden',
            'opacity': '0'
        });
    }
    
    $(document).ready(function () {
        // Don't show loader if page is already loaded or if we're filtering
        var isFiltering = {{ (request()->has('search') || request()->has('status') || request()->has('parent_id')) ? 'true' : 'false' }};
        if (!isFiltering && typeof PageLoader !== 'undefined' && document.readyState !== 'complete') {
            PageLoader.show();
        } else {
            // If filtering or page already loaded, hide loader immediately
            hideLoader();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                // Ensure empty state row is visible
                $('.no-data-row').show();
                // Hide loader immediately after DataTables initialization
                hideLoader();
            }
        });
        
        // Hide loader immediately after table initialization
        hideLoader();
        
        // Ensure empty state is always visible when table is empty
        setTimeout(function() {
            if (table.rows().count() === 0) {
                $('.no-data-row').show();
            }
            hideLoader();
        }, 100);
        
        // Fallback: Hide loader after a short delay to ensure it's hidden
        setTimeout(function() {
            hideLoader();
        }, 300);
        
        // Additional fallback with longer delay
        setTimeout(function() {
            hideLoader();
        }, 600);
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        // Hide loader on window load as final fallback
        $(window).on('load', function() {
            hideLoader();
        });
        
        // Force hide loader immediately if page is already loaded
        if (document.readyState === 'complete') {
            hideLoader();
        }
        
        // Additional event listeners to ensure loader is hidden
        window.addEventListener('load', function() {
            hideLoader();
        });
        
        // Final fallback - hide after 1 second
        setTimeout(function() {
            hideLoader();
        }, 1000);
    });
</script>
@endpush


```


## Fixes applied

### 1. Moved `hideLoader()` function definition
- Defined before use so it's available when called
- Uses multiple methods to hide the loader

### 2. Enhanced loader hiding
- Sets `display: none`
- Sets `visibility: hidden`
- Sets `opacity: 0`
- Adds `hide` class
- Uses jQuery as fallback

### 3. Conditional loader display
- Does not show loader when filtering (search/filter requests)
- Does not show if page is already loaded
- Hides immediately if filtering or page is already loaded

### 4. Multiple hide triggers
- Immediate hide after DataTables init
- Hide after 100ms (for empty table check)
- Hide after 300ms (fallback)
- Hide after 600ms (additional fallback)
- Hide on window load event
- Hide after 1 second (final fallback)
- Hide if document readyState is 'complete'

### Changes summary

**Both Products & Categories Index Views:**
- `hideLoader()` defined before use
- More aggressive hiding (display, visibility, opacity)
- Conditional loader display (doesn't show when filtering)
- Immediate hide when filtering or page already loaded
- Multiple fallback timeouts

The loader should now:
- Not show when filtering/searching
- Hide immediately when there are 0 results
- Hide using multiple methods to ensure it works
- Work even if PageLoader object fails

The loader should now hide correctly when filters return 0 results.

---

**User**

Hope you implement pagination for this products listing with next and prev button in product listing when millions of product will listed in this

---

**Cursor**


Checking the current pagination implementation and adding next/prev buttons for large datasets:



Enhancing pagination with proper next/prev buttons and styling for large datasets:


```blade
@extends('layouts.admin.app')

@section('title', translate('messages.products'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .badge-express {
        background-color: #f0ad4e;
        color: #fff;
    }
    
    .no-data-row {
        display: table-row !important;
    }
    
    .no-data-row td {
        padding: 3rem 1rem !important;
    }
    
    .search-filter-wrapper {
        display: flex;
        gap: 10px;
        align-items: flex-end;
        flex-wrap: wrap;
    }
    
    .search-filter-wrapper .form-group {
        margin-bottom: 0;
        flex: 1;
        min-width: 200px;
    }
    
    .search-filter-wrapper .form-group label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 5px;
        font-size: 0.875rem;
    }
    
    .search-filter-wrapper .btn {
        white-space: nowrap;
        height: fit-content;
    }
    
    @media (max-width: 768px) {
        .search-filter-wrapper {
            flex-direction: column;
        }
        
        .search-filter-wrapper .form-group {
            width: 100%;
        }
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-shop"></i>
                </span>
                <span>
                    {{ translate('messages.products') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.products') }} <span class="badge badge-soft-dark ml-2" id="product-count">{{ $products->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.products.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_product') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.products.index') }}" id="product-filter-form" class="mb-3">
                    <div class="search-filter-wrapper">
                        <div class="form-group">
                            <label for="search">Search Products</label>
                            <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or description..." value="{{ old('search', request('search')) }}">
                        </div>
                        <div class="form-group">
                            <label for="category_id">Filter by Category</label>
                            <select name="category_id" id="category_id" class="form-control">
                                <option value="">All Categories</option>
                                @foreach($categories as $category)
                                    <option value="{{ $category->id }}" {{ old('category_id', request('category_id')) == $category->id || (string)old('category_id', request('category_id')) === (string)$category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                @endforeach
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status">Status</label>
                            <select name="status" id="status" class="form-control">
                                <option value="">All Status</option>
                                <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn--primary">
                                    <i class="tio-search"></i> Search
                                </button>
                                @if(request('search') || request('category_id') || request('status'))
                                    <a href="{{ route('admin.products.index') }}" class="btn btn--reset">
                                        <i class="tio-clear"></i> Clear
                                    </a>
                                @endif
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Product Name</th>
                        <th class="border-0">Category</th>
                        <th class="border-0">Price</th>
                        <th class="border-0 text-center">Trending</th>
                        <th class="border-0 text-center">Latest</th>
                        <th class="border-0 text-center">Express-30</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($products as $key => $product)
                        <tr>
                            <td>{{ ($products->currentPage() - 1) * $products->perPage() + $key + 1 }}</td>
                            <td>
                                @php
                                    $primaryImage = $product->images->where('is_primary', true)->first() ?? $product->images->first();
                                @endphp
                                @if($primaryImage)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $primaryImage->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $product->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/160x160/img2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ Str::limit($product->name, 30, '...') }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $product->category ? $product->category->name : '-' }}
                                </span>
                            </td>
                            <td>
                                @php
                                    $variant = $product->variants->first();
                                    $price = $variant ? ($variant->sale_price ?? $variant->price) : 0;
                                @endphp
                                <span class="d-block font-size-sm text-body">
                                    ‚Çπ{{ number_format($price, 2) }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="trending-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_trending"
                                           data-value="{{ $product->is_trending ? 0 : 1 }}"
                                           id="trending-{{ $product->id }}" {{ $product->is_trending ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="latest-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_latest"
                                           data-value="{{ $product->is_latest ? 0 : 1 }}"
                                           id="latest-{{ $product->id }}" {{ $product->is_latest ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="express-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_express_30"
                                           data-value="{{ $product->is_express_30 ? 0 : 1 }}"
                                           id="express-{{ $product->id }}" {{ $product->is_express_30 ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $product->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this product?"
                                           data-title-off="Want to deactivate this product?"
                                           id="status-{{ $product->id }}" {{ $product->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.products.status') }}" method="post" id="status-{{ $product->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $product->id }}">
                                    <input type="hidden" name="status" value="{{ $product->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.products.edit', $product->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="product-{{ $product->id }}" 
                                       data-form-id="product-{{ $product->id }}"
                                       data-message="Want to delete this product?" 
                                       data-title="Delete Product"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.products.destroy', $product->id) }}"
                                            method="post" id="product-{{ $product->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr class="no-data-row">
                            <td colspan="10" class="text-center py-5">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5 class="mb-2">{{ translate('no_data_found') }}</h5>
                                    @if(request('search') || request('category_id') || request('status'))
                                        <p class="text-muted">Try adjusting your search or filter criteria.</p>
                                        <a href="{{ route('admin.products.index') }}" class="btn btn--primary btn-sm mt-2">
                                            <i class="tio-clear"></i> Clear Filters
                                        </a>
                                    @endif
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                @if($products->hasPages() && $products->total() > 0)
                    <div class="mt-4">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <div class="pagination-info">
                                    <p class="text-muted mb-0">
                                        Showing <strong>{{ $products->firstItem() ?? 0 }}</strong> to <strong>{{ $products->lastItem() ?? 0 }}</strong> of <strong>{{ number_format($products->total()) }}</strong> products
                                    </p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex justify-content-end">
                                    {{ $products->appends(request()->query())->links('pagination::bootstrap-4') }}
                                </div>
                            </div>
                        </div>
                    </div>
                @elseif($products->total() > 0)
                    <div class="mt-3">
                        <p class="text-muted mb-0">
                            Showing all <strong>{{ number_format($products->total()) }}</strong> products
                        </p>
                    </div>
                @endif
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    // Function to hide loader - multiple methods to ensure it works
    function hideLoader() {
        // Method 1: Use PageLoader object if available
        if (typeof PageLoader !== 'undefined' && PageLoader.hide) {
            PageLoader.hide();
        }
        // Method 2: Directly hide the loader element
        var loader = document.getElementById('page-loader');
        if (loader) {
            loader.classList.add('hide');
            loader.style.display = 'none';
            loader.style.visibility = 'hidden';
            loader.style.opacity = '0';
        }
        // Method 3: jQuery fallback
        $('#page-loader').addClass('hide').hide().css({
            'display': 'none',
            'visibility': 'hidden',
            'opacity': '0'
        });
    }
    
    $(document).ready(function () {
        // Don't show loader if page is already loaded or if we're filtering
        var isFiltering = {{ (request()->has('search') || request()->has('category_id') || request()->has('status')) ? 'true' : 'false' }};
        if (!isFiltering && typeof PageLoader !== 'undefined' && document.readyState !== 'complete') {
            PageLoader.show();
        } else {
            // If filtering or page already loaded, hide loader immediately
            hideLoader();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                // Ensure empty state row is visible
                $('.no-data-row').show();
                // Hide loader immediately after DataTables initialization
                hideLoader();
            }
        });
        
        // Hide loader immediately after table initialization
        hideLoader();
        
        // Ensure empty state is always visible when table is empty
        setTimeout(function() {
            if (table.rows().count() === 0) {
                $('.no-data-row').show();
            }
            hideLoader();
        }, 100);
        
        // Fallback: Hide loader after a short delay to ensure it's hidden
        setTimeout(function() {
            hideLoader();
        }, 300);
        
        // Additional fallback with longer delay
        setTimeout(function() {
            hideLoader();
        }, 600);
        
        // Handle flag toggles
        $(document).on('change', '.flag-toggle', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $checkbox = $(this);
            var productId = $checkbox.data('id');
            var flag = $checkbox.data('flag');
            var value = $checkbox.data('value');
            
            $.ajax({
                url: '{{ route('admin.products.flag') }}',
                method: 'POST',
                data: {
                    _token: '{{ csrf_token() }}',
                    id: productId,
                    flag: flag,
                    value: value
                },
                success: function(response) {
                    // Update the data-value for next toggle
                    $checkbox.data('value', value == 1 ? 0 : 1);
                },
                error: function(xhr) {
                    // Revert checkbox
                    $checkbox.prop('checked', !$checkbox.prop('checked'));
                    alert('Failed to update flag. Please try again.');
                }
            });
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        // Hide loader on window load as final fallback
        $(window).on('load', function() {
            hideLoader();
        });
        
        // Force hide loader immediately if page is already loaded
        if (document.readyState === 'complete') {
            hideLoader();
        }
        
        // Additional event listeners to ensure loader is hidden
        window.addEventListener('load', function() {
            hideLoader();
        });
        
        // Final fallback - hide after 1 second
        setTimeout(function() {
            hideLoader();
        }, 1000);
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.categories'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .dataTables_wrapper .dataTables_length label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .dataTables_wrapper .dataTables_length select {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 80px;
    }
    
    .dataTables_wrapper .dataTables_filter {
        text-align: right;
    }
    
    .dataTables_wrapper .dataTables_filter label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: flex-end;
    }
    
    .dataTables_wrapper .dataTables_filter input {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 200px;
    }
    
    .no-data-row {
        display: table-row !important;
    }
    
    .no-data-row td {
        padding: 3rem 1rem !important;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-category"></i>
                </span>
                <span>
                    {{ translate('messages.categories') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.categories') }} <span class="badge badge-soft-dark ml-2" id="category-count">{{ $categories->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.categories.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_category') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.categories.index') }}" id="category-filter-form" class="mb-3">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="search">Search Categories</label>
                                <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or slug..." value="{{ old('search', request('search')) }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="status">Status</label>
                                <select name="status" id="status" class="form-control">
                                    <option value="">All Status</option>
                                    <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                    <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="parent_id">Parent Category</label>
                                <select name="parent_id" id="parent_id" class="form-control">
                                    <option value="">All Categories</option>
                                    <option value="null" {{ old('parent_id', request('parent_id')) == 'null' ? 'selected' : '' }}>Main Categories Only</option>
                                    @foreach($parentCategories as $parent)
                                        <option value="{{ $parent->id }}" {{ old('parent_id', request('parent_id')) == $parent->id || (string)old('parent_id', request('parent_id')) === (string)$parent->id ? 'selected' : '' }}>{{ $parent->name }}</option>
                                    @endforeach
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <div class="d-flex gap-2">
                                    <button type="submit" class="btn btn--primary w-100">
                                        <i class="tio-search"></i> Filter
                                    </button>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--reset">
                                            <i class="tio-clear"></i>
                                        </a>
                                    @endif
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Name</th>
                        <th class="border-0">Parent</th>
                        <th class="border-0">Slug</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($categories as $key => $category)
                        <tr>
                            <td>{{ ($categories->currentPage() - 1) * $categories->perPage() + $key + 1 }}</td>
                            <td>
                                @if($category->image_url)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('category', $category->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $category->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/100x100/2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->name }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->parent ? $category->parent->name : '-' }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->slug }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $category->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $category->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this category?"
                                           data-title-off="Want to deactivate this category?"
                                           id="status-{{ $category->id }}" {{ $category->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.categories.status') }}" method="post" id="status-{{ $category->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $category->id }}">
                                    <input type="hidden" name="status" value="{{ $category->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.categories.edit', $category->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="category-{{ $category->id }}" 
                                       data-form-id="category-{{ $category->id }}"
                                       data-message="Want to delete this category?" 
                                       data-title="Delete Category"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.categories.destroy', $category->id) }}"
                                            method="post" id="category-{{ $category->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr class="no-data-row">
                            <td colspan="7" class="text-center py-5">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5 class="mb-2">{{ translate('no_data_found') }}</h5>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <p class="text-muted">Try adjusting your search or filter criteria.</p>
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--primary btn-sm mt-2">
                                            <i class="tio-clear"></i> Clear Filters
                                        </a>
                                    @endif
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                @if($categories->hasPages() && $categories->total() > 0)
                    <div class="mt-4">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <div class="pagination-info">
                                    <p class="text-muted mb-0">
                                        Showing <strong>{{ $categories->firstItem() ?? 0 }}</strong> to <strong>{{ $categories->lastItem() ?? 0 }}</strong> of <strong>{{ number_format($categories->total()) }}</strong> categories
                                    </p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex justify-content-end">
                                    {{ $categories->appends(request()->query())->links('pagination::bootstrap-4') }}
                                </div>
                            </div>
                        </div>
                    </div>
                @elseif($categories->total() > 0)
                    <div class="mt-3">
                        <p class="text-muted mb-0">
                            Showing all <strong>{{ number_format($categories->total()) }}</strong> categories
                        </p>
                    </div>
                @endif
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    // Function to hide loader - multiple methods to ensure it works
    function hideLoader() {
        // Method 1: Use PageLoader object if available
        if (typeof PageLoader !== 'undefined' && PageLoader.hide) {
            PageLoader.hide();
        }
        // Method 2: Directly hide the loader element
        var loader = document.getElementById('page-loader');
        if (loader) {
            loader.classList.add('hide');
            loader.style.display = 'none';
            loader.style.visibility = 'hidden';
            loader.style.opacity = '0';
        }
        // Method 3: jQuery fallback
        $('#page-loader').addClass('hide').hide().css({
            'display': 'none',
            'visibility': 'hidden',
            'opacity': '0'
        });
    }
    
    $(document).ready(function () {
        // Don't show loader if page is already loaded or if we're filtering
        var isFiltering = {{ (request()->has('search') || request()->has('status') || request()->has('parent_id')) ? 'true' : 'false' }};
        if (!isFiltering && typeof PageLoader !== 'undefined' && document.readyState !== 'complete') {
            PageLoader.show();
        } else {
            // If filtering or page already loaded, hide loader immediately
            hideLoader();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                // Ensure empty state row is visible
                $('.no-data-row').show();
                // Hide loader immediately after DataTables initialization
                hideLoader();
            }
        });
        
        // Hide loader immediately after table initialization
        hideLoader();
        
        // Ensure empty state is always visible when table is empty
        setTimeout(function() {
            if (table.rows().count() === 0) {
                $('.no-data-row').show();
            }
            hideLoader();
        }, 100);
        
        // Fallback: Hide loader after a short delay to ensure it's hidden
        setTimeout(function() {
            hideLoader();
        }, 300);
        
        // Additional fallback with longer delay
        setTimeout(function() {
            hideLoader();
        }, 600);
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        // Hide loader on window load as final fallback
        $(window).on('load', function() {
            hideLoader();
        });
        
        // Force hide loader immediately if page is already loaded
        if (document.readyState === 'complete') {
            hideLoader();
        }
        
        // Additional event listeners to ensure loader is hidden
        window.addEventListener('load', function() {
            hideLoader();
        });
        
        // Final fallback - hide after 1 second
        setTimeout(function() {
            hideLoader();
        }, 1000);
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.products'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .badge-express {
        background-color: #f0ad4e;
        color: #fff;
    }
    
    .no-data-row {
        display: table-row !important;
    }
    
    .no-data-row td {
        padding: 3rem 1rem !important;
    }
    
    .search-filter-wrapper {
        display: flex;
        gap: 10px;
        align-items: flex-end;
        flex-wrap: wrap;
    }
    
    .search-filter-wrapper .form-group {
        margin-bottom: 0;
        flex: 1;
        min-width: 200px;
    }
    
    .search-filter-wrapper .form-group label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 5px;
        font-size: 0.875rem;
    }
    
    .search-filter-wrapper .btn {
        white-space: nowrap;
        height: fit-content;
    }
    
    @media (max-width: 768px) {
        .search-filter-wrapper {
            flex-direction: column;
        }
        
    .search-filter-wrapper .form-group {
        width: 100%;
    }
    
    /* Pagination Styles */
    .pagination {
        margin-bottom: 0;
    }
    
    .pagination .page-link {
        color: #5e6278;
        border-color: #e4e6ef;
        padding: 0.5rem 0.75rem;
        font-weight: 500;
    }
    
    .pagination .page-link:hover {
        color: #009ef7;
        background-color: #f1faff;
        border-color: #009ef7;
    }
    
    .pagination .page-item.active .page-link {
        background-color: #009ef7;
        border-color: #009ef7;
        color: #fff;
    }
    
    .pagination .page-item.disabled .page-link {
        color: #b5b5c3;
        background-color: #f5f8fa;
        border-color: #e4e6ef;
        cursor: not-allowed;
    }
    
    .pagination-info {
        font-size: 0.875rem;
    }
    
    @media (max-width: 768px) {
        .pagination-info {
            text-align: center;
            margin-bottom: 1rem;
        }
        
        .pagination {
            justify-content: center;
        }
    }
}
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-shop"></i>
                </span>
                <span>
                    {{ translate('messages.products') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.products') }} <span class="badge badge-soft-dark ml-2" id="product-count">{{ $products->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.products.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_product') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.products.index') }}" id="product-filter-form" class="mb-3">
                    <div class="search-filter-wrapper">
                        <div class="form-group">
                            <label for="search">Search Products</label>
                            <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or description..." value="{{ old('search', request('search')) }}">
                        </div>
                        <div class="form-group">
                            <label for="category_id">Filter by Category</label>
                            <select name="category_id" id="category_id" class="form-control">
                                <option value="">All Categories</option>
                                @foreach($categories as $category)
                                    <option value="{{ $category->id }}" {{ old('category_id', request('category_id')) == $category->id || (string)old('category_id', request('category_id')) === (string)$category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                @endforeach
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status">Status</label>
                            <select name="status" id="status" class="form-control">
                                <option value="">All Status</option>
                                <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn--primary">
                                    <i class="tio-search"></i> Search
                                </button>
                                @if(request('search') || request('category_id') || request('status'))
                                    <a href="{{ route('admin.products.index') }}" class="btn btn--reset">
                                        <i class="tio-clear"></i> Clear
                                    </a>
                                @endif
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Product Name</th>
                        <th class="border-0">Category</th>
                        <th class="border-0">Price</th>
                        <th class="border-0 text-center">Trending</th>
                        <th class="border-0 text-center">Latest</th>
                        <th class="border-0 text-center">Express-30</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($products as $key => $product)
                        <tr>
                            <td>{{ ($products->currentPage() - 1) * $products->perPage() + $key + 1 }}</td>
                            <td>
                                @php
                                    $primaryImage = $product->images->where('is_primary', true)->first() ?? $product->images->first();
                                @endphp
                                @if($primaryImage)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $primaryImage->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $product->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/160x160/img2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ Str::limit($product->name, 30, '...') }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $product->category ? $product->category->name : '-' }}
                                </span>
                            </td>
                            <td>
                                @php
                                    $variant = $product->variants->first();
                                    $price = $variant ? ($variant->sale_price ?? $variant->price) : 0;
                                @endphp
                                <span class="d-block font-size-sm text-body">
                                    ‚Çπ{{ number_format($price, 2) }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="trending-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_trending"
                                           data-value="{{ $product->is_trending ? 0 : 1 }}"
                                           id="trending-{{ $product->id }}" {{ $product->is_trending ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="latest-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_latest"
                                           data-value="{{ $product->is_latest ? 0 : 1 }}"
                                           id="latest-{{ $product->id }}" {{ $product->is_latest ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="express-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_express_30"
                                           data-value="{{ $product->is_express_30 ? 0 : 1 }}"
                                           id="express-{{ $product->id }}" {{ $product->is_express_30 ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $product->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this product?"
                                           data-title-off="Want to deactivate this product?"
                                           id="status-{{ $product->id }}" {{ $product->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.products.status') }}" method="post" id="status-{{ $product->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $product->id }}">
                                    <input type="hidden" name="status" value="{{ $product->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.products.edit', $product->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="product-{{ $product->id }}" 
                                       data-form-id="product-{{ $product->id }}"
                                       data-message="Want to delete this product?" 
                                       data-title="Delete Product"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.products.destroy', $product->id) }}"
                                            method="post" id="product-{{ $product->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr class="no-data-row">
                            <td colspan="10" class="text-center py-5">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5 class="mb-2">{{ translate('no_data_found') }}</h5>
                                    @if(request('search') || request('category_id') || request('status'))
                                        <p class="text-muted">Try adjusting your search or filter criteria.</p>
                                        <a href="{{ route('admin.products.index') }}" class="btn btn--primary btn-sm mt-2">
                                            <i class="tio-clear"></i> Clear Filters
                                        </a>
                                    @endif
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                @if($products->hasPages() && $products->total() > 0)
                    <div class="mt-4">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <div class="pagination-info">
                                    <p class="text-muted mb-0">
                                        Showing <strong>{{ $products->firstItem() ?? 0 }}</strong> to <strong>{{ $products->lastItem() ?? 0 }}</strong> of <strong>{{ number_format($products->total()) }}</strong> products
                                    </p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex justify-content-end">
                                    {{ $products->appends(request()->query())->links('pagination::bootstrap-4') }}
                                </div>
                            </div>
                        </div>
                    </div>
                @elseif($products->total() > 0)
                    <div class="mt-3">
                        <p class="text-muted mb-0">
                            Showing all <strong>{{ number_format($products->total()) }}</strong> products
                        </p>
                    </div>
                @endif
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    // Function to hide loader - multiple methods to ensure it works
    function hideLoader() {
        // Method 1: Use PageLoader object if available
        if (typeof PageLoader !== 'undefined' && PageLoader.hide) {
            PageLoader.hide();
        }
        // Method 2: Directly hide the loader element
        var loader = document.getElementById('page-loader');
        if (loader) {
            loader.classList.add('hide');
            loader.style.display = 'none';
            loader.style.visibility = 'hidden';
            loader.style.opacity = '0';
        }
        // Method 3: jQuery fallback
        $('#page-loader').addClass('hide').hide().css({
            'display': 'none',
            'visibility': 'hidden',
            'opacity': '0'
        });
    }
    
    $(document).ready(function () {
        // Don't show loader if page is already loaded or if we're filtering
        var isFiltering = {{ (request()->has('search') || request()->has('category_id') || request()->has('status')) ? 'true' : 'false' }};
        if (!isFiltering && typeof PageLoader !== 'undefined' && document.readyState !== 'complete') {
            PageLoader.show();
        } else {
            // If filtering or page already loaded, hide loader immediately
            hideLoader();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                // Ensure empty state row is visible
                $('.no-data-row').show();
                // Hide loader immediately after DataTables initialization
                hideLoader();
            }
        });
        
        // Hide loader immediately after table initialization
        hideLoader();
        
        // Ensure empty state is always visible when table is empty
        setTimeout(function() {
            if (table.rows().count() === 0) {
                $('.no-data-row').show();
            }
            hideLoader();
        }, 100);
        
        // Fallback: Hide loader after a short delay to ensure it's hidden
        setTimeout(function() {
            hideLoader();
        }, 300);
        
        // Additional fallback with longer delay
        setTimeout(function() {
            hideLoader();
        }, 600);
        
        // Handle flag toggles
        $(document).on('change', '.flag-toggle', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $checkbox = $(this);
            var productId = $checkbox.data('id');
            var flag = $checkbox.data('flag');
            var value = $checkbox.data('value');
            
            $.ajax({
                url: '{{ route('admin.products.flag') }}',
                method: 'POST',
                data: {
                    _token: '{{ csrf_token() }}',
                    id: productId,
                    flag: flag,
                    value: value
                },
                success: function(response) {
                    // Update the data-value for next toggle
                    $checkbox.data('value', value == 1 ? 0 : 1);
                },
                error: function(xhr) {
                    // Revert checkbox
                    $checkbox.prop('checked', !$checkbox.prop('checked'));
                    alert('Failed to update flag. Please try again.');
                }
            });
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        // Hide loader on window load as final fallback
        $(window).on('load', function() {
            hideLoader();
        });
        
        // Force hide loader immediately if page is already loaded
        if (document.readyState === 'complete') {
            hideLoader();
        }
        
        // Additional event listeners to ensure loader is hidden
        window.addEventListener('load', function() {
            hideLoader();
        });
        
        // Final fallback - hide after 1 second
        setTimeout(function() {
            hideLoader();
        }, 1000);
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.categories'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .dataTables_wrapper .dataTables_length label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .dataTables_wrapper .dataTables_length select {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 80px;
    }
    
    .dataTables_wrapper .dataTables_filter {
        text-align: right;
    }
    
    .dataTables_wrapper .dataTables_filter label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: flex-end;
    }
    
    .dataTables_wrapper .dataTables_filter input {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 200px;
    }
    
    .no-data-row {
        display: table-row !important;
    }
    
    .no-data-row td {
        padding: 3rem 1rem !important;
    }
    
    /* Pagination Styles */
    .pagination {
        margin-bottom: 0;
    }
    
    .pagination .page-link {
        color: #5e6278;
        border-color: #e4e6ef;
        padding: 0.5rem 0.75rem;
        font-weight: 500;
    }
    
    .pagination .page-link:hover {
        color: #009ef7;
        background-color: #f1faff;
        border-color: #009ef7;
    }
    
    .pagination .page-item.active .page-link {
        background-color: #009ef7;
        border-color: #009ef7;
        color: #fff;
    }
    
    .pagination .page-item.disabled .page-link {
        color: #b5b5c3;
        background-color: #f5f8fa;
        border-color: #e4e6ef;
        cursor: not-allowed;
    }
    
    .pagination-info {
        font-size: 0.875rem;
    }
    
    @media (max-width: 768px) {
        .pagination-info {
            text-align: center;
            margin-bottom: 1rem;
        }
        
        .pagination {
            justify-content: center;
        }
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-category"></i>
                </span>
                <span>
                    {{ translate('messages.categories') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.categories') }} <span class="badge badge-soft-dark ml-2" id="category-count">{{ $categories->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.categories.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_category') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.categories.index') }}" id="category-filter-form" class="mb-3">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="search">Search Categories</label>
                                <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or slug..." value="{{ old('search', request('search')) }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="status">Status</label>
                                <select name="status" id="status" class="form-control">
                                    <option value="">All Status</option>
                                    <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                    <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="parent_id">Parent Category</label>
                                <select name="parent_id" id="parent_id" class="form-control">
                                    <option value="">All Categories</option>
                                    <option value="null" {{ old('parent_id', request('parent_id')) == 'null' ? 'selected' : '' }}>Main Categories Only</option>
                                    @foreach($parentCategories as $parent)
                                        <option value="{{ $parent->id }}" {{ old('parent_id', request('parent_id')) == $parent->id || (string)old('parent_id', request('parent_id')) === (string)$parent->id ? 'selected' : '' }}>{{ $parent->name }}</option>
                                    @endforeach
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <div class="d-flex gap-2">
                                    <button type="submit" class="btn btn--primary w-100">
                                        <i class="tio-search"></i> Filter
                                    </button>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--reset">
                                            <i class="tio-clear"></i>
                                        </a>
                                    @endif
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Name</th>
                        <th class="border-0">Parent</th>
                        <th class="border-0">Slug</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($categories as $key => $category)
                        <tr>
                            <td>{{ ($categories->currentPage() - 1) * $categories->perPage() + $key + 1 }}</td>
                            <td>
                                @if($category->image_url)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('category', $category->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $category->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/100x100/2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->name }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->parent ? $category->parent->name : '-' }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->slug }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $category->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $category->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this category?"
                                           data-title-off="Want to deactivate this category?"
                                           id="status-{{ $category->id }}" {{ $category->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.categories.status') }}" method="post" id="status-{{ $category->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $category->id }}">
                                    <input type="hidden" name="status" value="{{ $category->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.categories.edit', $category->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="category-{{ $category->id }}" 
                                       data-form-id="category-{{ $category->id }}"
                                       data-message="Want to delete this category?" 
                                       data-title="Delete Category"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.categories.destroy', $category->id) }}"
                                            method="post" id="category-{{ $category->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr class="no-data-row">
                            <td colspan="7" class="text-center py-5">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5 class="mb-2">{{ translate('no_data_found') }}</h5>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <p class="text-muted">Try adjusting your search or filter criteria.</p>
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--primary btn-sm mt-2">
                                            <i class="tio-clear"></i> Clear Filters
                                        </a>
                                    @endif
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                @if($categories->hasPages() && $categories->total() > 0)
                    <div class="mt-4">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <div class="pagination-info">
                                    <p class="text-muted mb-0">
                                        Showing <strong>{{ $categories->firstItem() ?? 0 }}</strong> to <strong>{{ $categories->lastItem() ?? 0 }}</strong> of <strong>{{ number_format($categories->total()) }}</strong> categories
                                    </p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex justify-content-end">
                                    {{ $categories->appends(request()->query())->links('pagination::bootstrap-4') }}
                                </div>
                            </div>
                        </div>
                    </div>
                @elseif($categories->total() > 0)
                    <div class="mt-3">
                        <p class="text-muted mb-0">
                            Showing all <strong>{{ number_format($categories->total()) }}</strong> categories
                        </p>
                    </div>
                @endif
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    // Function to hide loader - multiple methods to ensure it works
    function hideLoader() {
        // Method 1: Use PageLoader object if available
        if (typeof PageLoader !== 'undefined' && PageLoader.hide) {
            PageLoader.hide();
        }
        // Method 2: Directly hide the loader element
        var loader = document.getElementById('page-loader');
        if (loader) {
            loader.classList.add('hide');
            loader.style.display = 'none';
            loader.style.visibility = 'hidden';
            loader.style.opacity = '0';
        }
        // Method 3: jQuery fallback
        $('#page-loader').addClass('hide').hide().css({
            'display': 'none',
            'visibility': 'hidden',
            'opacity': '0'
        });
    }
    
    $(document).ready(function () {
        // Don't show loader if page is already loaded or if we're filtering
        var isFiltering = {{ (request()->has('search') || request()->has('status') || request()->has('parent_id')) ? 'true' : 'false' }};
        if (!isFiltering && typeof PageLoader !== 'undefined' && document.readyState !== 'complete') {
            PageLoader.show();
        } else {
            // If filtering or page already loaded, hide loader immediately
            hideLoader();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                // Ensure empty state row is visible
                $('.no-data-row').show();
                // Hide loader immediately after DataTables initialization
                hideLoader();
            }
        });
        
        // Hide loader immediately after table initialization
        hideLoader();
        
        // Ensure empty state is always visible when table is empty
        setTimeout(function() {
            if (table.rows().count() === 0) {
                $('.no-data-row').show();
            }
            hideLoader();
        }, 100);
        
        // Fallback: Hide loader after a short delay to ensure it's hidden
        setTimeout(function() {
            hideLoader();
        }, 300);
        
        // Additional fallback with longer delay
        setTimeout(function() {
            hideLoader();
        }, 600);
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        // Hide loader on window load as final fallback
        $(window).on('load', function() {
            hideLoader();
        });
        
        // Force hide loader immediately if page is already loaded
        if (document.readyState === 'complete') {
            hideLoader();
        }
        
        // Additional event listeners to ensure loader is hidden
        window.addEventListener('load', function() {
            hideLoader();
        });
        
        // Final fallback - hide after 1 second
        setTimeout(function() {
            hideLoader();
        }, 1000);
    });
</script>
@endpush


```


Checking if we need to customize the pagination view and ensuring it works correctly:


```blade
@extends('layouts.admin.app')

@section('title', translate('messages.products'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .badge-express {
        background-color: #f0ad4e;
        color: #fff;
    }
    
    .no-data-row {
        display: table-row !important;
    }
    
    .no-data-row td {
        padding: 3rem 1rem !important;
    }
    
    .search-filter-wrapper {
        display: flex;
        gap: 10px;
        align-items: flex-end;
        flex-wrap: wrap;
    }
    
    .search-filter-wrapper .form-group {
        margin-bottom: 0;
        flex: 1;
        min-width: 200px;
    }
    
    .search-filter-wrapper .form-group label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 5px;
        font-size: 0.875rem;
    }
    
    .search-filter-wrapper .btn {
        white-space: nowrap;
        height: fit-content;
    }
    
    @media (max-width: 768px) {
        .search-filter-wrapper {
            flex-direction: column;
        }
        
    .search-filter-wrapper .form-group {
        width: 100%;
    }
    
    /* Pagination Styles */
    .pagination {
        margin-bottom: 0;
    }
    
    .pagination .page-link {
        color: #5e6278;
        border-color: #e4e6ef;
        padding: 0.5rem 0.75rem;
        font-weight: 500;
    }
    
    .pagination .page-link:hover {
        color: #009ef7;
        background-color: #f1faff;
        border-color: #009ef7;
    }
    
    .pagination .page-item.active .page-link {
        background-color: #009ef7;
        border-color: #009ef7;
        color: #fff;
    }
    
    .pagination .page-item.disabled .page-link {
        color: #b5b5c3;
        background-color: #f5f8fa;
        border-color: #e4e6ef;
        cursor: not-allowed;
    }
    
    .pagination-info {
        font-size: 0.875rem;
    }
    
    @media (max-width: 768px) {
        .pagination-info {
            text-align: center;
            margin-bottom: 1rem;
        }
        
        .pagination {
            justify-content: center;
        }
    }
}
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-shop"></i>
                </span>
                <span>
                    {{ translate('messages.products') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.products') }} <span class="badge badge-soft-dark ml-2" id="product-count">{{ $products->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.products.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_product') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.products.index') }}" id="product-filter-form" class="mb-3">
                    <div class="search-filter-wrapper">
                        <div class="form-group">
                            <label for="search">Search Products</label>
                            <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or description..." value="{{ old('search', request('search')) }}">
                        </div>
                        <div class="form-group">
                            <label for="category_id">Filter by Category</label>
                            <select name="category_id" id="category_id" class="form-control">
                                <option value="">All Categories</option>
                                @foreach($categories as $category)
                                    <option value="{{ $category->id }}" {{ old('category_id', request('category_id')) == $category->id || (string)old('category_id', request('category_id')) === (string)$category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                @endforeach
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status">Status</label>
                            <select name="status" id="status" class="form-control">
                                <option value="">All Status</option>
                                <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn--primary">
                                    <i class="tio-search"></i> Search
                                </button>
                                @if(request('search') || request('category_id') || request('status'))
                                    <a href="{{ route('admin.products.index') }}" class="btn btn--reset">
                                        <i class="tio-clear"></i> Clear
                                    </a>
                                @endif
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Product Name</th>
                        <th class="border-0">Category</th>
                        <th class="border-0">Price</th>
                        <th class="border-0 text-center">Trending</th>
                        <th class="border-0 text-center">Latest</th>
                        <th class="border-0 text-center">Express-30</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($products as $key => $product)
                        <tr>
                            <td>{{ ($products->currentPage() - 1) * $products->perPage() + $key + 1 }}</td>
                            <td>
                                @php
                                    $primaryImage = $product->images->where('is_primary', true)->first() ?? $product->images->first();
                                @endphp
                                @if($primaryImage)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $primaryImage->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $product->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/160x160/img2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ Str::limit($product->name, 30, '...') }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $product->category ? $product->category->name : '-' }}
                                </span>
                            </td>
                            <td>
                                @php
                                    $variant = $product->variants->first();
                                    $price = $variant ? ($variant->sale_price ?? $variant->price) : 0;
                                @endphp
                                <span class="d-block font-size-sm text-body">
                                    ‚Çπ{{ number_format($price, 2) }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="trending-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_trending"
                                           data-value="{{ $product->is_trending ? 0 : 1 }}"
                                           id="trending-{{ $product->id }}" {{ $product->is_trending ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="latest-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_latest"
                                           data-value="{{ $product->is_latest ? 0 : 1 }}"
                                           id="latest-{{ $product->id }}" {{ $product->is_latest ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="express-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_express_30"
                                           data-value="{{ $product->is_express_30 ? 0 : 1 }}"
                                           id="express-{{ $product->id }}" {{ $product->is_express_30 ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $product->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this product?"
                                           data-title-off="Want to deactivate this product?"
                                           id="status-{{ $product->id }}" {{ $product->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.products.status') }}" method="post" id="status-{{ $product->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $product->id }}">
                                    <input type="hidden" name="status" value="{{ $product->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.products.edit', $product->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="product-{{ $product->id }}" 
                                       data-form-id="product-{{ $product->id }}"
                                       data-message="Want to delete this product?" 
                                       data-title="Delete Product"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.products.destroy', $product->id) }}"
                                            method="post" id="product-{{ $product->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr class="no-data-row">
                            <td colspan="10" class="text-center py-5">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5 class="mb-2">{{ translate('no_data_found') }}</h5>
                                    @if(request('search') || request('category_id') || request('status'))
                                        <p class="text-muted">Try adjusting your search or filter criteria.</p>
                                        <a href="{{ route('admin.products.index') }}" class="btn btn--primary btn-sm mt-2">
                                            <i class="tio-clear"></i> Clear Filters
                                        </a>
                                    @endif
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                @if($products->hasPages() && $products->total() > 0)
                    <div class="mt-4">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <div class="pagination-info">
                                    <p class="text-muted mb-0">
                                        Showing <strong>{{ $products->firstItem() ?? 0 }}</strong> to <strong>{{ $products->lastItem() ?? 0 }}</strong> of <strong>{{ number_format($products->total()) }}</strong> products
                                    </p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex justify-content-end">
                                    {{ $products->appends(request()->query())->links() }}
                                </div>
                            </div>
                        </div>
                    </div>
                @elseif($products->total() > 0)
                    <div class="mt-3">
                        <p class="text-muted mb-0">
                            Showing all <strong>{{ number_format($products->total()) }}</strong> products
                        </p>
                    </div>
                @endif
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    // Function to hide loader - multiple methods to ensure it works
    function hideLoader() {
        // Method 1: Use PageLoader object if available
        if (typeof PageLoader !== 'undefined' && PageLoader.hide) {
            PageLoader.hide();
        }
        // Method 2: Directly hide the loader element
        var loader = document.getElementById('page-loader');
        if (loader) {
            loader.classList.add('hide');
            loader.style.display = 'none';
            loader.style.visibility = 'hidden';
            loader.style.opacity = '0';
        }
        // Method 3: jQuery fallback
        $('#page-loader').addClass('hide').hide().css({
            'display': 'none',
            'visibility': 'hidden',
            'opacity': '0'
        });
    }
    
    $(document).ready(function () {
        // Don't show loader if page is already loaded or if we're filtering
        var isFiltering = {{ (request()->has('search') || request()->has('category_id') || request()->has('status')) ? 'true' : 'false' }};
        if (!isFiltering && typeof PageLoader !== 'undefined' && document.readyState !== 'complete') {
            PageLoader.show();
        } else {
            // If filtering or page already loaded, hide loader immediately
            hideLoader();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                // Ensure empty state row is visible
                $('.no-data-row').show();
                // Hide loader immediately after DataTables initialization
                hideLoader();
            }
        });
        
        // Hide loader immediately after table initialization
        hideLoader();
        
        // Ensure empty state is always visible when table is empty
        setTimeout(function() {
            if (table.rows().count() === 0) {
                $('.no-data-row').show();
            }
            hideLoader();
        }, 100);
        
        // Fallback: Hide loader after a short delay to ensure it's hidden
        setTimeout(function() {
            hideLoader();
        }, 300);
        
        // Additional fallback with longer delay
        setTimeout(function() {
            hideLoader();
        }, 600);
        
        // Handle flag toggles
        $(document).on('change', '.flag-toggle', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $checkbox = $(this);
            var productId = $checkbox.data('id');
            var flag = $checkbox.data('flag');
            var value = $checkbox.data('value');
            
            $.ajax({
                url: '{{ route('admin.products.flag') }}',
                method: 'POST',
                data: {
                    _token: '{{ csrf_token() }}',
                    id: productId,
                    flag: flag,
                    value: value
                },
                success: function(response) {
                    // Update the data-value for next toggle
                    $checkbox.data('value', value == 1 ? 0 : 1);
                },
                error: function(xhr) {
                    // Revert checkbox
                    $checkbox.prop('checked', !$checkbox.prop('checked'));
                    alert('Failed to update flag. Please try again.');
                }
            });
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        // Hide loader on window load as final fallback
        $(window).on('load', function() {
            hideLoader();
        });
        
        // Force hide loader immediately if page is already loaded
        if (document.readyState === 'complete') {
            hideLoader();
        }
        
        // Additional event listeners to ensure loader is hidden
        window.addEventListener('load', function() {
            hideLoader();
        });
        
        // Final fallback - hide after 1 second
        setTimeout(function() {
            hideLoader();
        }, 1000);
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.categories'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .dataTables_wrapper .dataTables_length label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .dataTables_wrapper .dataTables_length select {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 80px;
    }
    
    .dataTables_wrapper .dataTables_filter {
        text-align: right;
    }
    
    .dataTables_wrapper .dataTables_filter label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: flex-end;
    }
    
    .dataTables_wrapper .dataTables_filter input {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 200px;
    }
    
    .no-data-row {
        display: table-row !important;
    }
    
    .no-data-row td {
        padding: 3rem 1rem !important;
    }
    
    /* Pagination Styles */
    .pagination {
        margin-bottom: 0;
    }
    
    .pagination .page-link {
        color: #5e6278;
        border-color: #e4e6ef;
        padding: 0.5rem 0.75rem;
        font-weight: 500;
    }
    
    .pagination .page-link:hover {
        color: #009ef7;
        background-color: #f1faff;
        border-color: #009ef7;
    }
    
    .pagination .page-item.active .page-link {
        background-color: #009ef7;
        border-color: #009ef7;
        color: #fff;
    }
    
    .pagination .page-item.disabled .page-link {
        color: #b5b5c3;
        background-color: #f5f8fa;
        border-color: #e4e6ef;
        cursor: not-allowed;
    }
    
    .pagination-info {
        font-size: 0.875rem;
    }
    
    @media (max-width: 768px) {
        .pagination-info {
            text-align: center;
            margin-bottom: 1rem;
        }
        
        .pagination {
            justify-content: center;
        }
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-category"></i>
                </span>
                <span>
                    {{ translate('messages.categories') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.categories') }} <span class="badge badge-soft-dark ml-2" id="category-count">{{ $categories->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.categories.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_category') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.categories.index') }}" id="category-filter-form" class="mb-3">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="search">Search Categories</label>
                                <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or slug..." value="{{ old('search', request('search')) }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="status">Status</label>
                                <select name="status" id="status" class="form-control">
                                    <option value="">All Status</option>
                                    <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                    <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="parent_id">Parent Category</label>
                                <select name="parent_id" id="parent_id" class="form-control">
                                    <option value="">All Categories</option>
                                    <option value="null" {{ old('parent_id', request('parent_id')) == 'null' ? 'selected' : '' }}>Main Categories Only</option>
                                    @foreach($parentCategories as $parent)
                                        <option value="{{ $parent->id }}" {{ old('parent_id', request('parent_id')) == $parent->id || (string)old('parent_id', request('parent_id')) === (string)$parent->id ? 'selected' : '' }}>{{ $parent->name }}</option>
                                    @endforeach
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <div class="d-flex gap-2">
                                    <button type="submit" class="btn btn--primary w-100">
                                        <i class="tio-search"></i> Filter
                                    </button>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--reset">
                                            <i class="tio-clear"></i>
                                        </a>
                                    @endif
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Name</th>
                        <th class="border-0">Parent</th>
                        <th class="border-0">Slug</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($categories as $key => $category)
                        <tr>
                            <td>{{ ($categories->currentPage() - 1) * $categories->perPage() + $key + 1 }}</td>
                            <td>
                                @if($category->image_url)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('category', $category->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $category->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/100x100/2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->name }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->parent ? $category->parent->name : '-' }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->slug }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $category->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $category->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this category?"
                                           data-title-off="Want to deactivate this category?"
                                           id="status-{{ $category->id }}" {{ $category->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.categories.status') }}" method="post" id="status-{{ $category->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $category->id }}">
                                    <input type="hidden" name="status" value="{{ $category->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.categories.edit', $category->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="category-{{ $category->id }}" 
                                       data-form-id="category-{{ $category->id }}"
                                       data-message="Want to delete this category?" 
                                       data-title="Delete Category"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.categories.destroy', $category->id) }}"
                                            method="post" id="category-{{ $category->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr class="no-data-row">
                            <td colspan="7" class="text-center py-5">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5 class="mb-2">{{ translate('no_data_found') }}</h5>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <p class="text-muted">Try adjusting your search or filter criteria.</p>
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--primary btn-sm mt-2">
                                            <i class="tio-clear"></i> Clear Filters
                                        </a>
                                    @endif
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                @if($categories->hasPages() && $categories->total() > 0)
                    <div class="mt-4">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <div class="pagination-info">
                                    <p class="text-muted mb-0">
                                        Showing <strong>{{ $categories->firstItem() ?? 0 }}</strong> to <strong>{{ $categories->lastItem() ?? 0 }}</strong> of <strong>{{ number_format($categories->total()) }}</strong> categories
                                    </p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex justify-content-end">
                                    {{ $categories->appends(request()->query())->links() }}
                                </div>
                            </div>
                        </div>
                    </div>
                @elseif($categories->total() > 0)
                    <div class="mt-3">
                        <p class="text-muted mb-0">
                            Showing all <strong>{{ number_format($categories->total()) }}</strong> categories
                        </p>
                    </div>
                @endif
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    // Function to hide loader - multiple methods to ensure it works
    function hideLoader() {
        // Method 1: Use PageLoader object if available
        if (typeof PageLoader !== 'undefined' && PageLoader.hide) {
            PageLoader.hide();
        }
        // Method 2: Directly hide the loader element
        var loader = document.getElementById('page-loader');
        if (loader) {
            loader.classList.add('hide');
            loader.style.display = 'none';
            loader.style.visibility = 'hidden';
            loader.style.opacity = '0';
        }
        // Method 3: jQuery fallback
        $('#page-loader').addClass('hide').hide().css({
            'display': 'none',
            'visibility': 'hidden',
            'opacity': '0'
        });
    }
    
    $(document).ready(function () {
        // Don't show loader if page is already loaded or if we're filtering
        var isFiltering = {{ (request()->has('search') || request()->has('status') || request()->has('parent_id')) ? 'true' : 'false' }};
        if (!isFiltering && typeof PageLoader !== 'undefined' && document.readyState !== 'complete') {
            PageLoader.show();
        } else {
            // If filtering or page already loaded, hide loader immediately
            hideLoader();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                // Ensure empty state row is visible
                $('.no-data-row').show();
                // Hide loader immediately after DataTables initialization
                hideLoader();
            }
        });
        
        // Hide loader immediately after table initialization
        hideLoader();
        
        // Ensure empty state is always visible when table is empty
        setTimeout(function() {
            if (table.rows().count() === 0) {
                $('.no-data-row').show();
            }
            hideLoader();
        }, 100);
        
        // Fallback: Hide loader after a short delay to ensure it's hidden
        setTimeout(function() {
            hideLoader();
        }, 300);
        
        // Additional fallback with longer delay
        setTimeout(function() {
            hideLoader();
        }, 600);
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        // Hide loader on window load as final fallback
        $(window).on('load', function() {
            hideLoader();
        });
        
        // Force hide loader immediately if page is already loaded
        if (document.readyState === 'complete') {
            hideLoader();
        }
        
        // Additional event listeners to ensure loader is hidden
        window.addEventListener('load', function() {
            hideLoader();
        });
        
        // Final fallback - hide after 1 second
        setTimeout(function() {
            hideLoader();
        }, 1000);
    });
</script>
@endpush


```


Checking published pagination views and customizing them for next/prev buttons:



Enhancing the pagination view with "Previous" and "Next" text labels:


```blade
@if ($paginator->hasPages())
    <nav>
        <ul class="pagination">
            {{-- Previous Page Link --}}
            @if ($paginator->onFirstPage())
                <li class="page-item disabled" aria-disabled="true" aria-label="@lang('pagination.previous')">
                    <span class="page-link" aria-hidden="true">
                        <i class="tio-chevron-left"></i> Previous
                    </span>
                </li>
            @else
                <li class="page-item">
                    <a class="page-link" href="{{ $paginator->previousPageUrl() }}" rel="prev" aria-label="@lang('pagination.previous')">
                        <i class="tio-chevron-left"></i> Previous
                    </a>
                </li>
            @endif

            {{-- Pagination Elements --}}
            @foreach ($elements as $element)
                {{-- "Three Dots" Separator --}}
                @if (is_string($element))
                    <li class="page-item disabled" aria-disabled="true"><span class="page-link">{{ $element }}</span></li>
                @endif

                {{-- Array Of Links --}}
                @if (is_array($element))
                    @foreach ($element as $page => $url)
                        @if ($page == $paginator->currentPage())
                            <li class="page-item active" aria-current="page"><span class="page-link">{{ $page }}</span></li>
                        @else
                            <li class="page-item"><a class="page-link" href="{{ $url }}">{{ $page }}</a></li>
                        @endif
                    @endforeach
                @endif
            @endforeach

            {{-- Next Page Link --}}
            @if ($paginator->hasMorePages())
                <li class="page-item">
                    <a class="page-link" href="{{ $paginator->nextPageUrl() }}" rel="next" aria-label="@lang('pagination.next')">&rsaquo;</a>
                </li>
            @else
                <li class="page-item disabled" aria-disabled="true" aria-label="@lang('pagination.next')">
                    <span class="page-link" aria-hidden="true">&rsaquo;</span>
                </li>
            @endif
        </ul>
    </nav>
@endif

```

```blade
@if ($paginator->hasPages())
    <nav>
        <ul class="pagination">
            {{-- Previous Page Link --}}
            @if ($paginator->onFirstPage())
                <li class="page-item disabled" aria-disabled="true" aria-label="@lang('pagination.previous')">
                    <span class="page-link" aria-hidden="true">
                        <i class="tio-chevron-left"></i> Previous
                    </span>
                </li>
            @else
                <li class="page-item">
                    <a class="page-link" href="{{ $paginator->previousPageUrl() }}" rel="prev" aria-label="@lang('pagination.previous')">
                        <i class="tio-chevron-left"></i> Previous
                    </a>
                </li>
            @endif

            {{-- Pagination Elements --}}
            @foreach ($elements as $element)
                {{-- "Three Dots" Separator --}}
                @if (is_string($element))
                    <li class="page-item disabled" aria-disabled="true"><span class="page-link">{{ $element }}</span></li>
                @endif

                {{-- Array Of Links --}}
                @if (is_array($element))
                    @foreach ($element as $page => $url)
                        @if ($page == $paginator->currentPage())
                            <li class="page-item active" aria-current="page"><span class="page-link">{{ $page }}</span></li>
                        @else
                            <li class="page-item"><a class="page-link" href="{{ $url }}">{{ $page }}</a></li>
                        @endif
                    @endforeach
                @endif
            @endforeach

            {{-- Next Page Link --}}
            @if ($paginator->hasMorePages())
                <li class="page-item">
                    <a class="page-link" href="{{ $paginator->nextPageUrl() }}" rel="next" aria-label="@lang('pagination.next')">
                        Next <i class="tio-chevron-right"></i>
                    </a>
                </li>
            @else
                <li class="page-item disabled" aria-disabled="true" aria-label="@lang('pagination.next')">
                    <span class="page-link" aria-hidden="true">
                        Next <i class="tio-chevron-right"></i>
                    </span>
                </li>
            @endif
        </ul>
    </nav>
@endif

```


Adding pagination styling and ensuring it works well on mobile:


```blade
@extends('layouts.admin.app')

@section('title', translate('messages.products'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .badge-express {
        background-color: #f0ad4e;
        color: #fff;
    }
    
    .no-data-row {
        display: table-row !important;
    }
    
    .no-data-row td {
        padding: 3rem 1rem !important;
    }
    
    .search-filter-wrapper {
        display: flex;
        gap: 10px;
        align-items: flex-end;
        flex-wrap: wrap;
    }
    
    .search-filter-wrapper .form-group {
        margin-bottom: 0;
        flex: 1;
        min-width: 200px;
    }
    
    .search-filter-wrapper .form-group label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 5px;
        font-size: 0.875rem;
    }
    
    .search-filter-wrapper .btn {
        white-space: nowrap;
        height: fit-content;
    }
    
    @media (max-width: 768px) {
        .search-filter-wrapper {
            flex-direction: column;
        }
        
    .search-filter-wrapper .form-group {
        width: 100%;
    }
    
    /* Pagination Styles */
    .pagination {
        margin-bottom: 0;
    }
    
    .pagination {
        margin-bottom: 0;
        flex-wrap: wrap;
    }
    
    .pagination .page-link {
        color: #5e6278;
        border-color: #e4e6ef;
        padding: 0.5rem 0.75rem;
        font-weight: 500;
        min-width: 44px;
        text-align: center;
        transition: all 0.2s ease;
    }
    
    .pagination .page-link:hover {
        color: #009ef7;
        background-color: #f1faff;
        border-color: #009ef7;
        transform: translateY(-1px);
    }
    
    .pagination .page-item.active .page-link {
        background-color: #009ef7;
        border-color: #009ef7;
        color: #fff;
        font-weight: 600;
    }
    
    .pagination .page-item.disabled .page-link {
        color: #b5b5c3;
        background-color: #f5f8fa;
        border-color: #e4e6ef;
        cursor: not-allowed;
        opacity: 0.6;
    }
    
    .pagination .page-link i {
        font-size: 0.875rem;
        vertical-align: middle;
    }
    
    .pagination-info {
        font-size: 0.875rem;
    }
    
    .pagination-info strong {
        color: #009ef7;
        font-weight: 600;
    }
    
    @media (max-width: 768px) {
        .pagination-info {
            text-align: center;
            margin-bottom: 1rem;
        }
        
        .pagination {
            justify-content: center;
            width: 100%;
        }
        
        .pagination .page-link {
            padding: 0.4rem 0.6rem;
            font-size: 0.875rem;
        }
        
        .pagination .page-item:not(.disabled) .page-link {
            min-width: auto;
        }
    }
}
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-shop"></i>
                </span>
                <span>
                    {{ translate('messages.products') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.products') }} <span class="badge badge-soft-dark ml-2" id="product-count">{{ $products->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.products.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_product') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.products.index') }}" id="product-filter-form" class="mb-3">
                    <div class="search-filter-wrapper">
                        <div class="form-group">
                            <label for="search">Search Products</label>
                            <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or description..." value="{{ old('search', request('search')) }}">
                        </div>
                        <div class="form-group">
                            <label for="category_id">Filter by Category</label>
                            <select name="category_id" id="category_id" class="form-control">
                                <option value="">All Categories</option>
                                @foreach($categories as $category)
                                    <option value="{{ $category->id }}" {{ old('category_id', request('category_id')) == $category->id || (string)old('category_id', request('category_id')) === (string)$category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                @endforeach
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="status">Status</label>
                            <select name="status" id="status" class="form-control">
                                <option value="">All Status</option>
                                <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn--primary">
                                    <i class="tio-search"></i> Search
                                </button>
                                @if(request('search') || request('category_id') || request('status'))
                                    <a href="{{ route('admin.products.index') }}" class="btn btn--reset">
                                        <i class="tio-clear"></i> Clear
                                    </a>
                                @endif
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Product Name</th>
                        <th class="border-0">Category</th>
                        <th class="border-0">Price</th>
                        <th class="border-0 text-center">Trending</th>
                        <th class="border-0 text-center">Latest</th>
                        <th class="border-0 text-center">Express-30</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($products as $key => $product)
                        <tr>
                            <td>{{ ($products->currentPage() - 1) * $products->perPage() + $key + 1 }}</td>
                            <td>
                                @php
                                    $primaryImage = $product->images->where('is_primary', true)->first() ?? $product->images->first();
                                @endphp
                                @if($primaryImage)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $primaryImage->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $product->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/160x160/img2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ Str::limit($product->name, 30, '...') }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $product->category ? $product->category->name : '-' }}
                                </span>
                            </td>
                            <td>
                                @php
                                    $variant = $product->variants->first();
                                    $price = $variant ? ($variant->sale_price ?? $variant->price) : 0;
                                @endphp
                                <span class="d-block font-size-sm text-body">
                                    ‚Çπ{{ number_format($price, 2) }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="trending-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_trending"
                                           data-value="{{ $product->is_trending ? 0 : 1 }}"
                                           id="trending-{{ $product->id }}" {{ $product->is_trending ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="latest-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_latest"
                                           data-value="{{ $product->is_latest ? 0 : 1 }}"
                                           id="latest-{{ $product->id }}" {{ $product->is_latest ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="express-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input flag-toggle"
                                           data-id="{{ $product->id }}"
                                           data-flag="is_express_30"
                                           data-value="{{ $product->is_express_30 ? 0 : 1 }}"
                                           id="express-{{ $product->id }}" {{ $product->is_express_30 ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $product->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $product->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this product?"
                                           data-title-off="Want to deactivate this product?"
                                           id="status-{{ $product->id }}" {{ $product->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.products.status') }}" method="post" id="status-{{ $product->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $product->id }}">
                                    <input type="hidden" name="status" value="{{ $product->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.products.edit', $product->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="product-{{ $product->id }}" 
                                       data-form-id="product-{{ $product->id }}"
                                       data-message="Want to delete this product?" 
                                       data-title="Delete Product"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.products.destroy', $product->id) }}"
                                            method="post" id="product-{{ $product->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr class="no-data-row">
                            <td colspan="10" class="text-center py-5">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5 class="mb-2">{{ translate('no_data_found') }}</h5>
                                    @if(request('search') || request('category_id') || request('status'))
                                        <p class="text-muted">Try adjusting your search or filter criteria.</p>
                                        <a href="{{ route('admin.products.index') }}" class="btn btn--primary btn-sm mt-2">
                                            <i class="tio-clear"></i> Clear Filters
                                        </a>
                                    @endif
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                @if($products->hasPages() && $products->total() > 0)
                    <div class="mt-4">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <div class="pagination-info">
                                    <p class="text-muted mb-0">
                                        Showing <strong>{{ $products->firstItem() ?? 0 }}</strong> to <strong>{{ $products->lastItem() ?? 0 }}</strong> of <strong>{{ number_format($products->total()) }}</strong> products
                                    </p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex justify-content-end">
                                    {{ $products->appends(request()->query())->links() }}
                                </div>
                            </div>
                        </div>
                    </div>
                @elseif($products->total() > 0)
                    <div class="mt-3">
                        <p class="text-muted mb-0">
                            Showing all <strong>{{ number_format($products->total()) }}</strong> products
                        </p>
                    </div>
                @endif
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    // Function to hide loader - multiple methods to ensure it works
    function hideLoader() {
        // Method 1: Use PageLoader object if available
        if (typeof PageLoader !== 'undefined' && PageLoader.hide) {
            PageLoader.hide();
        }
        // Method 2: Directly hide the loader element
        var loader = document.getElementById('page-loader');
        if (loader) {
            loader.classList.add('hide');
            loader.style.display = 'none';
            loader.style.visibility = 'hidden';
            loader.style.opacity = '0';
        }
        // Method 3: jQuery fallback
        $('#page-loader').addClass('hide').hide().css({
            'display': 'none',
            'visibility': 'hidden',
            'opacity': '0'
        });
    }
    
    $(document).ready(function () {
        // Don't show loader if page is already loaded or if we're filtering
        var isFiltering = {{ (request()->has('search') || request()->has('category_id') || request()->has('status')) ? 'true' : 'false' }};
        if (!isFiltering && typeof PageLoader !== 'undefined' && document.readyState !== 'complete') {
            PageLoader.show();
        } else {
            // If filtering or page already loaded, hide loader immediately
            hideLoader();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                // Ensure empty state row is visible
                $('.no-data-row').show();
                // Hide loader immediately after DataTables initialization
                hideLoader();
            }
        });
        
        // Hide loader immediately after table initialization
        hideLoader();
        
        // Ensure empty state is always visible when table is empty
        setTimeout(function() {
            if (table.rows().count() === 0) {
                $('.no-data-row').show();
            }
            hideLoader();
        }, 100);
        
        // Fallback: Hide loader after a short delay to ensure it's hidden
        setTimeout(function() {
            hideLoader();
        }, 300);
        
        // Additional fallback with longer delay
        setTimeout(function() {
            hideLoader();
        }, 600);
        
        // Handle flag toggles
        $(document).on('change', '.flag-toggle', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $checkbox = $(this);
            var productId = $checkbox.data('id');
            var flag = $checkbox.data('flag');
            var value = $checkbox.data('value');
            
            $.ajax({
                url: '{{ route('admin.products.flag') }}',
                method: 'POST',
                data: {
                    _token: '{{ csrf_token() }}',
                    id: productId,
                    flag: flag,
                    value: value
                },
                success: function(response) {
                    // Update the data-value for next toggle
                    $checkbox.data('value', value == 1 ? 0 : 1);
                },
                error: function(xhr) {
                    // Revert checkbox
                    $checkbox.prop('checked', !$checkbox.prop('checked'));
                    alert('Failed to update flag. Please try again.');
                }
            });
        });
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        // Hide loader on window load as final fallback
        $(window).on('load', function() {
            hideLoader();
        });
        
        // Force hide loader immediately if page is already loaded
        if (document.readyState === 'complete') {
            hideLoader();
        }
        
        // Additional event listeners to ensure loader is hidden
        window.addEventListener('load', function() {
            hideLoader();
        });
        
        // Final fallback - hide after 1 second
        setTimeout(function() {
            hideLoader();
        }, 1000);
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.categories'))

@include('admin-views.partials._loader')

@push('css_or_js')
<style>
    .dataTables_wrapper {
        padding: 15px 0;
    }
    
    .dataTables_wrapper .dataTables_length,
    .dataTables_wrapper .dataTables_filter {
        margin-bottom: 15px;
    }
    
    .dataTables_wrapper .dataTables_length label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .dataTables_wrapper .dataTables_length select {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 80px;
    }
    
    .dataTables_wrapper .dataTables_filter {
        text-align: right;
    }
    
    .dataTables_wrapper .dataTables_filter label {
        font-weight: 500;
        color: #5e6278;
        margin-bottom: 0;
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: flex-end;
    }
    
    .dataTables_wrapper .dataTables_filter input {
        border: 1px solid #e4e6ef;
        border-radius: 0.475rem;
        padding: 0.55rem 0.75rem;
        font-size: 0.925rem;
        color: #5e6278;
        background-color: #fff;
        min-width: 200px;
    }
    
    .no-data-row {
        display: table-row !important;
    }
    
    .no-data-row td {
        padding: 3rem 1rem !important;
    }
    
    /* Pagination Styles */
    .pagination {
        margin-bottom: 0;
    }
    
    .pagination {
        margin-bottom: 0;
        flex-wrap: wrap;
    }
    
    .pagination .page-link {
        color: #5e6278;
        border-color: #e4e6ef;
        padding: 0.5rem 0.75rem;
        font-weight: 500;
        min-width: 44px;
        text-align: center;
        transition: all 0.2s ease;
    }
    
    .pagination .page-link:hover {
        color: #009ef7;
        background-color: #f1faff;
        border-color: #009ef7;
        transform: translateY(-1px);
    }
    
    .pagination .page-item.active .page-link {
        background-color: #009ef7;
        border-color: #009ef7;
        color: #fff;
        font-weight: 600;
    }
    
    .pagination .page-item.disabled .page-link {
        color: #b5b5c3;
        background-color: #f5f8fa;
        border-color: #e4e6ef;
        cursor: not-allowed;
        opacity: 0.6;
    }
    
    .pagination .page-link i {
        font-size: 0.875rem;
        vertical-align: middle;
    }
    
    .pagination-info {
        font-size: 0.875rem;
    }
    
    .pagination-info strong {
        color: #009ef7;
        font-weight: 600;
    }
    
    @media (max-width: 768px) {
        .pagination-info {
            text-align: center;
            margin-bottom: 1rem;
        }
        
        .pagination {
            justify-content: center;
            width: 100%;
        }
        
        .pagination .page-link {
            padding: 0.4rem 0.6rem;
            font-size: 0.875rem;
        }
        
        .pagination .page-item:not(.disabled) .page-link {
            min-width: auto;
        }
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-category"></i>
                </span>
                <span>
                    {{ translate('messages.categories') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
            <div class="card-header py-2 border-0">
                <div class="search--button-wrapper">
                    <h5 class="card-title">
                        {{ translate('messages.categories') }} <span class="badge badge-soft-dark ml-2" id="category-count">{{ $categories->total() }}</span>
                    </h5>
                    <div>
                        <a href="{{ route('admin.categories.create') }}" class="btn btn--primary m-0 pull-right">
                            <i class="tio-add-circle"></i> {{ translate('messages.add_category') }}
                        </a>
                    </div>
                </div>
            </div>
            <!-- Table -->
            <div class="card-body">
                <!-- Search and Filter -->
                <form method="GET" action="{{ route('admin.categories.index') }}" id="category-filter-form" class="mb-3">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <label for="search">Search Categories</label>
                                <input type="text" name="search" id="search" class="form-control" placeholder="Search by name or slug..." value="{{ old('search', request('search')) }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="status">Status</label>
                                <select name="status" id="status" class="form-control">
                                    <option value="">All Status</option>
                                    <option value="active" {{ old('status', request('status')) == 'active' ? 'selected' : '' }}>Active</option>
                                    <option value="inactive" {{ old('status', request('status')) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="parent_id">Parent Category</label>
                                <select name="parent_id" id="parent_id" class="form-control">
                                    <option value="">All Categories</option>
                                    <option value="null" {{ old('parent_id', request('parent_id')) == 'null' ? 'selected' : '' }}>Main Categories Only</option>
                                    @foreach($parentCategories as $parent)
                                        <option value="{{ $parent->id }}" {{ old('parent_id', request('parent_id')) == $parent->id || (string)old('parent_id', request('parent_id')) === (string)$parent->id ? 'selected' : '' }}>{{ $parent->name }}</option>
                                    @endforeach
                                </select>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <div class="d-flex gap-2">
                                    <button type="submit" class="btn btn--primary w-100">
                                        <i class="tio-search"></i> Filter
                                    </button>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--reset">
                                            <i class="tio-clear"></i>
                                        </a>
                                    @endif
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                
                <div class="table-responsive datatable-custom">
                    <table id="columnSearchDatatable"
                           class="table table-borderless table-thead-bordered table-nowrap table-align-middle card-table"
                           data-hs-datatables-options='{
                             "order": [],
                             "orderCellsTop": true,
                             "paging": false,
                             "searching": false,
                             "info": false,
                             "dom": "rt"
                           }'>
                    <thead class="thead-light">
                    <tr>
                        <th class="border-0">{{ translate('messages.sl') }}</th>
                        <th class="border-0">Image</th>
                        <th class="border-0">Name</th>
                        <th class="border-0">Parent</th>
                        <th class="border-0">Slug</th>
                        <th class="border-0 text-center">{{ translate('messages.status') }}</th>
                        <th class="border-0 text-center">{{ translate('messages.action') }}</th>
                    </tr>
                    </thead>
                    <tbody>
                    @forelse($categories as $key => $category)
                        <tr>
                            <td>{{ ($categories->currentPage() - 1) * $categories->perPage() + $key + 1 }}</td>
                            <td>
                                @if($category->image_url)
                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('category', $category->image_url, \App\CentralLogics\Helpers::getDisk()) }}" 
                                         alt="{{ $category->name }}" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px;">
                                @else
                                    <img src="{{ asset('assets/admin/img/100x100/2.jpg') }}" 
                                         alt="No Image" 
                                         class="img-thumbnail" 
                                         style="width: 60px; height: 60px; object-fit: cover; border-radius: 4px; opacity: 0.5;">
                                @endif
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->name }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->parent ? $category->parent->name : '-' }}
                                </span>
                            </td>
                            <td>
                                <span class="d-block font-size-sm text-body">
                                    {{ $category->slug }}
                                </span>
                            </td>
                            <td class="text-center">
                                <label class="toggle-switch toggle-switch-sm" for="status-{{ $category->id }}">
                                    <input type="checkbox" class="toggle-switch-input dynamic-checkbox"
                                           data-id="status-{{ $category->id }}"
                                           data-type="status"
                                           data-image-on='{{ asset('assets/admin/img/modal/zone-status-on.png') }}'
                                           data-image-off="{{ asset('assets/admin/img/modal/zone-status-off.png') }}"
                                           data-title-on="Want to activate this category?"
                                           data-title-off="Want to deactivate this category?"
                                           id="status-{{ $category->id }}" {{ $category->status == 'active' ? 'checked' : '' }}>
                                    <span class="toggle-switch-label">
                                        <span class="toggle-switch-indicator"></span>
                                    </span>
                                </label>
                                <form action="{{ route('admin.categories.status') }}" method="post" id="status-{{ $category->id }}_form">
                                    @csrf
                                    <input type="hidden" name="id" value="{{ $category->id }}">
                                    <input type="hidden" name="status" value="{{ $category->status == 'active' ? 'inactive' : 'active' }}">
                                </form>
                            </td>
                            <td>
                                <div class="btn--container justify-content-center">
                                    <a class="btn action-btn btn--primary btn-outline-primary" href="{{ route('admin.categories.edit', $category->id) }}" title="{{ translate('messages.edit') }}">
                                        <i class="tio-edit"></i>
                                    </a>
                                    <a class="btn action-btn btn--danger btn-outline-danger form-alert" href="javascript:" 
                                       data-id="category-{{ $category->id }}" 
                                       data-form-id="category-{{ $category->id }}"
                                       data-message="Want to delete this category?" 
                                       data-title="Delete Category"
                                       data-image-on="{{ asset('assets/admin/img/modal/delete-icon.png') }}"
                                       title="{{ translate('messages.delete') }}">
                                        <i class="tio-delete-outlined"></i>
                                    </a>
                                    <form action="{{ route('admin.categories.destroy', $category->id) }}"
                                            method="post" id="category-{{ $category->id }}_form">
                                        @csrf @method('delete')
                                    </form>
                                </div>
                            </td>
                        </tr>
                    @empty
                        <tr class="no-data-row">
                            <td colspan="7" class="text-center py-5">
                                <div class="text-center p-4">
                                    <img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description">
                                    <h5 class="mb-2">{{ translate('no_data_found') }}</h5>
                                    @if(request('search') || request('status') || request('parent_id'))
                                        <p class="text-muted">Try adjusting your search or filter criteria.</p>
                                        <a href="{{ route('admin.categories.index') }}" class="btn btn--primary btn-sm mt-2">
                                            <i class="tio-clear"></i> Clear Filters
                                        </a>
                                    @endif
                                </div>
                            </td>
                        </tr>
                    @endforelse
                    </tbody>
                </table>
                </div>
                <!-- Pagination -->
                @if($categories->hasPages() && $categories->total() > 0)
                    <div class="mt-4">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <div class="pagination-info">
                                    <p class="text-muted mb-0">
                                        Showing <strong>{{ $categories->firstItem() ?? 0 }}</strong> to <strong>{{ $categories->lastItem() ?? 0 }}</strong> of <strong>{{ number_format($categories->total()) }}</strong> categories
                                    </p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex justify-content-end">
                                    {{ $categories->appends(request()->query())->links() }}
                                </div>
                            </div>
                        </div>
                    </div>
                @elseif($categories->total() > 0)
                    <div class="mt-3">
                        <p class="text-muted mb-0">
                            Showing all <strong>{{ number_format($categories->total()) }}</strong> categories
                        </p>
                    </div>
                @endif
            </div>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    // Function to hide loader - multiple methods to ensure it works
    function hideLoader() {
        // Method 1: Use PageLoader object if available
        if (typeof PageLoader !== 'undefined' && PageLoader.hide) {
            PageLoader.hide();
        }
        // Method 2: Directly hide the loader element
        var loader = document.getElementById('page-loader');
        if (loader) {
            loader.classList.add('hide');
            loader.style.display = 'none';
            loader.style.visibility = 'hidden';
            loader.style.opacity = '0';
        }
        // Method 3: jQuery fallback
        $('#page-loader').addClass('hide').hide().css({
            'display': 'none',
            'visibility': 'hidden',
            'opacity': '0'
        });
    }
    
    $(document).ready(function () {
        // Don't show loader if page is already loaded or if we're filtering
        var isFiltering = {{ (request()->has('search') || request()->has('status') || request()->has('parent_id')) ? 'true' : 'false' }};
        if (!isFiltering && typeof PageLoader !== 'undefined' && document.readyState !== 'complete') {
            PageLoader.show();
        } else {
            // If filtering or page already loaded, hide loader immediately
            hideLoader();
        }
        
        var table = $('#columnSearchDatatable').DataTable({
            paging: false,
            searching: false,
            info: false,
            order: [],
            orderCellsTop: true,
            dom: "rt",
            language: {
                zeroRecords: '<div class="text-center p-4"><img class="w-7rem mb-3" src="{{ asset('assets/admin/svg/illustrations/sorry.svg') }}" alt="Image Description"><h5>{{ translate('no_data_found') }}</h5></div>',
            },
            initComplete: function() {
                // Ensure empty state row is visible
                $('.no-data-row').show();
                // Hide loader immediately after DataTables initialization
                hideLoader();
            }
        });
        
        // Hide loader immediately after table initialization
        hideLoader();
        
        // Ensure empty state is always visible when table is empty
        setTimeout(function() {
            if (table.rows().count() === 0) {
                $('.no-data-row').show();
            }
            hideLoader();
        }, 100);
        
        // Fallback: Hide loader after a short delay to ensure it's hidden
        setTimeout(function() {
            hideLoader();
        }, 300);
        
        // Additional fallback with longer delay
        setTimeout(function() {
            hideLoader();
        }, 600);
        
        $(document).on('click', '.form-alert', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            var $btn = $(this);
            var baseId = $btn.data('form-id') || $btn.data('id');
            var message = $btn.data('message') || 'Want to delete this?';
            var title = $btn.data('title') || 'Delete Confirmation';
            var imageOn = $btn.data('image-on') || '{{ asset('assets/admin/img/modal/delete-icon.png') }}';
            
            $('#toggle-status-title').text(title);
            $('#toggle-status-message').text(message);
            $('#toggle-status-image').attr('src', imageOn);
            $('#toggle-status-ok-button').attr('toggle-ok-button', baseId);
            
            $('#toggle-status-modal').modal('show');
        });
        
        // Hide loader on window load as final fallback
        $(window).on('load', function() {
            hideLoader();
        });
        
        // Force hide loader immediately if page is already loaded
        if (document.readyState === 'complete') {
            hideLoader();
        }
        
        // Additional event listeners to ensure loader is hidden
        window.addEventListener('load', function() {
            hideLoader();
        });
        
        // Final fallback - hide after 1 second
        setTimeout(function() {
            hideLoader();
        }, 1000);
    });
</script>
@endpush


```


Verifying pagination configuration and optimizing for large datasets:



Verifying the pagination view uses the correct icon classes and adding a fallback:


```blade
            {{-- Previous Page Link --}}
            @if ($paginator->onFirstPage())
                <li class="page-item disabled" aria-disabled="true" aria-label="@lang('pagination.previous')">
                    <span class="page-link" aria-hidden="true">
                        <i class="tio-chevron-left" style="font-size: 0.875rem;"></i> <span class="d-none d-md-inline">Previous</span>
                    </span>
                </li>
            @else
                <li class="page-item">
                    <a class="page-link" href="{{ $paginator->previousPageUrl() }}" rel="prev" aria-label="@lang('pagination.previous')">
                        <i class="tio-chevron-left" style="font-size: 0.875rem;"></i> <span class="d-none d-md-inline">Previous</span>
                    </a>
                </li>
            @endif
```

```blade
@if ($paginator->hasPages())
    <nav>
        <ul class="pagination">
            {{-- Previous Page Link --}}
            @if ($paginator->onFirstPage())
                <li class="page-item disabled" aria-disabled="true" aria-label="@lang('pagination.previous')">
                    <span class="page-link" aria-hidden="true">
                        <i class="tio-chevron-left"></i> Previous
                    </span>
                </li>
            @else
                <li class="page-item">
                    <a class="page-link" href="{{ $paginator->previousPageUrl() }}" rel="prev" aria-label="@lang('pagination.previous')">
                        <i class="tio-chevron-left"></i> Previous
                    </a>
                </li>
            @endif

            {{-- Pagination Elements --}}
            @foreach ($elements as $element)
                {{-- "Three Dots" Separator --}}
                @if (is_string($element))
                    <li class="page-item disabled" aria-disabled="true"><span class="page-link">{{ $element }}</span></li>
                @endif

                {{-- Array Of Links --}}
                @if (is_array($element))
                    @foreach ($element as $page => $url)
                        @if ($page == $paginator->currentPage())
                            <li class="page-item active" aria-current="page"><span class="page-link">{{ $page }}</span></li>
                        @else
                            <li class="page-item"><a class="page-link" href="{{ $url }}">{{ $page }}</a></li>
                        @endif
                    @endforeach
                @endif
            @endforeach

            {{-- Next Page Link --}}
            @if ($paginator->hasMorePages())
                <li class="page-item">
                    <a class="page-link" href="{{ $paginator->nextPageUrl() }}" rel="next" aria-label="@lang('pagination.next')">
                        <span class="d-none d-md-inline">Next</span> <i class="tio-chevron-right" style="font-size: 0.875rem;"></i>
                    </a>
                </li>
            @else
                <li class="page-item disabled" aria-disabled="true" aria-label="@lang('pagination.next')">
                    <span class="page-link" aria-hidden="true">
                        <span class="d-none d-md-inline">Next</span> <i class="tio-chevron-right" style="font-size: 0.875rem;"></i>
                    </span>
                </li>
            @endif
        </ul>
    </nav>
@endif

```


Reviewing the pagination view to ensure it's correct:



Updating the "Previous" button for consistency:


```blade
@if ($paginator->hasPages())
    <nav>
        <ul class="pagination">
            {{-- Previous Page Link --}}
            @if ($paginator->onFirstPage())
                <li class="page-item disabled" aria-disabled="true" aria-label="@lang('pagination.previous')">
                    <span class="page-link" aria-hidden="true">
                        <i class="tio-chevron-left" style="font-size: 0.875rem;"></i> <span class="d-none d-md-inline">Previous</span>
                    </span>
                </li>
            @else
                <li class="page-item">
                    <a class="page-link" href="{{ $paginator->previousPageUrl() }}" rel="prev" aria-label="@lang('pagination.previous')">
                        <i class="tio-chevron-left" style="font-size: 0.875rem;"></i> <span class="d-none d-md-inline">Previous</span>
                    </a>
                </li>
            @endif

            {{-- Pagination Elements --}}
            @foreach ($elements as $element)
                {{-- "Three Dots" Separator --}}
                @if (is_string($element))
                    <li class="page-item disabled" aria-disabled="true"><span class="page-link">{{ $element }}</span></li>
                @endif

                {{-- Array Of Links --}}
                @if (is_array($element))
                    @foreach ($element as $page => $url)
                        @if ($page == $paginator->currentPage())
                            <li class="page-item active" aria-current="page"><span class="page-link">{{ $page }}</span></li>
                        @else
                            <li class="page-item"><a class="page-link" href="{{ $url }}">{{ $page }}</a></li>
                        @endif
                    @endforeach
                @endif
            @endforeach

            {{-- Next Page Link --}}
            @if ($paginator->hasMorePages())
                <li class="page-item">
                    <a class="page-link" href="{{ $paginator->nextPageUrl() }}" rel="next" aria-label="@lang('pagination.next')">
                        <span class="d-none d-md-inline">Next</span> <i class="tio-chevron-right" style="font-size: 0.875rem;"></i>
                    </a>
                </li>
            @else
                <li class="page-item disabled" aria-disabled="true" aria-label="@lang('pagination.next')">
                    <span class="page-link" aria-hidden="true">
                        <span class="d-none d-md-inline">Next</span> <i class="tio-chevron-right" style="font-size: 0.875rem;"></i>
                    </span>
                </li>
            @endif
        </ul>
    </nav>
@endif

```


## Pagination enhancements

1. Next/Previous buttons
   - Added "Previous" and "Next" buttons with chevron icons
   - Mobile: icons only; desktop: text + icons
   - Disabled state when on first/last page

2. Pagination info
   - Shows "Showing X to Y of Z products" (e.g., "Showing 1 to 25 of 1,234,567 products")
   - Uses number formatting for large counts

3. Styling
   - Matches admin theme colors
   - Hover effects and transitions
   - Responsive layout

4. Performance
   - Uses Laravel's `paginate(25)` (LIMIT/OFFSET)
   - Preserves filter parameters across pages
   - Works with large datasets

5. Mobile responsiveness
   - Responsive layout
   - Touch-friendly button sizes
   - Icons-only on small screens

The pagination is ready to handle large datasets. It shows page numbers, Previous/Next buttons, and pagination info, and preserves search and filter parameters when navigating pages.

---

**User**

Add a maximum file upload size limit of 15 MB for product upload section
Do NOT break or change any existing upload functionality, validations, or UI behavior.

---

**Cursor**


Checking the current product upload implementation to add a 15 MB file size limit:



Checking the product create/edit views for frontend file size validation:



Updating backend validation, error messages, and frontend text to 15 MB. Adding JavaScript file size validation for better UX:


```php
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:15360',
```

```php
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 15MB!'),
```

```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Product;
use App\Models\Category;
use App\Models\Brand;
use App\Models\ProductVariant;
use App\Models\ProductImage;
use Illuminate\Http\Request;
use App\CentralLogics\ToastrWrapper as Toastr;
use App\CentralLogics\Helpers;
use Illuminate\Support\Str;

class ProductController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index(Request $request)
    {
        $query = Product::with(['category', 'brand', 'variants', 'images']);
        
        // Search
        $search = trim($request->input('search', ''));
        if ($search !== '') {
            $query->where(function ($q) use ($search) {
                $q->where('name', 'like', "%{$search}%")
                    ->orWhere('description', 'like', "%{$search}%");
            });
        }
        
        // Filter by status
        $status = $request->input('status');
        if ($status !== null && $status !== '') {
            $query->where('status', $status);
        }
        
        // Filter by category
        $categoryId = $request->input('category_id');
        if (!empty($categoryId) && is_numeric($categoryId) && (int)$categoryId > 0) {
            $query->where('category_id', (int)$categoryId);
        }
        
        // Filter by trending
        $isTrending = $request->input('is_trending');
        if ($isTrending !== null && $isTrending !== '') {
            $query->where('is_trending', (bool)$isTrending);
        }
        
        // Filter by latest
        $isLatest = $request->input('is_latest');
        if ($isLatest !== null && $isLatest !== '') {
            $query->where('is_latest', (bool)$isLatest);
        }
        
        // Filter by express_30
        $isExpress30 = $request->input('is_express_30');
        if ($isExpress30 !== null && $isExpress30 !== '') {
            $query->where('is_express_30', (bool)$isExpress30);
        }
        
        $products = $query->orderBy('created_at', 'desc')->paginate(25);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        
        return view('admin-views.products.index', compact('products', 'categories'));
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.create', compact('categories', 'brands'));
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Variant fields
                'variant_sku' => 'required|string|max:255',
                'variant_price' => 'required|numeric|min:0',
                'variant_sale_price' => 'nullable|numeric|min:0',
                'variant_status' => 'required|in:active,inactive',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:2048',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'variant_sku.required' => translate('messages.SKU is required!'),
                'variant_price.required' => translate('messages.Price is required!'),
                'variant_price.numeric' => translate('messages.Price must be a number!'),
                'variant_price.min' => translate('messages.Price must be greater than or equal to 0!'),
                'variant_sale_price.numeric' => translate('messages.Sale price must be a number!'),
                'variant_sale_price.min' => translate('messages.Sale price must be greater than or equal to 0!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 2MB!'),
            ]);

            // Check if SKU already exists
            if (ProductVariant::where('sku', $request->variant_sku)->exists()) {
                Toastr::error(translate('messages.SKU already exists!'));
                return back()->withInput();
            }

            // Create product
            $product = new Product();
            $product->name = $request->name;
            $product->slug = Str::slug($request->name) . '-' . uniqid();
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Create default variant
            $variant = new ProductVariant();
            $variant->product_id = $product->id;
            $variant->sku = $request->variant_sku;
            $variant->price = $request->variant_price;
            $variant->sale_price = $request->variant_sale_price ?? null;
            $variant->status = $request->variant_status;
            $variant->save();

            // Handle images
            if ($request->hasFile('images')) {
                $sortOrder = 0;
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant->id;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = ($sortOrder === 0) ? true : false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_added'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_add_product') . ': ' . $e->getMessage());
            \Log::error('Product creation error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit($id)
    {
        $product = Product::with(['category', 'brand', 'variants', 'images'])->findOrFail($id);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.edit', compact('product', 'categories', 'brands'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, $id)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:15360',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 15MB!'),
            ]);

            $product = Product::findOrFail($id);
            $product->name = $request->name;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Handle new images
            if ($request->hasFile('images')) {
                $existingImages = ProductImage::where('product_id', $product->id)->count();
                $sortOrder = $existingImages;
                
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $variant = $product->variants->first();
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant ? $variant->id : null;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_updated'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_product') . ': ' . $e->getMessage());
            \Log::error('Product update error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy($id)
    {
        try {
            $product = Product::findOrFail($id);
            
            // Delete product images
            foreach ($product->images as $image) {
                if ($image->image_url) {
                    try {
                        $storageType = Helpers::getDisk();
                        if ($storageType === 's3') {
                            \Storage::disk('s3')->delete('product/' . $image->image_url);
                        } else {
                            \Storage::disk('public')->delete('product/' . $image->image_url);
                        }
                    } catch (\Exception $e) {
                        \Log::warning('Failed to delete product image: ' . $e->getMessage());
                    }
                }
                $image->delete();
            }
            
            // Delete variants (this will cascade delete related data)
            $product->variants()->delete();
            
            $product->delete();
            
            Toastr::success(translate('messages.product_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_product') . ': ' . $e->getMessage());
            \Log::error('Product deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product status
     */
    public function statusToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $product->status = $request->status;
            $product->save();
            Toastr::success(translate('messages.product_status_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_status') . ': ' . $e->getMessage());
            \Log::error('Product status update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product flag (trending, latest, express_30)
     */
    public function flagToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $flag = $request->flag; // is_trending, is_latest, is_express_30
            
            if (!in_array($flag, ['is_trending', 'is_latest', 'is_express_30'])) {
                Toastr::error(translate('messages.Invalid flag!'));
                return back();
            }
            
            $product->$flag = $request->value;
            $product->save();
            
            Toastr::success(translate('messages.product_flag_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_flag') . ': ' . $e->getMessage());
            \Log::error('Product flag update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Delete product image
     */
    public function deleteImage($id)
    {
        try {
            $image = ProductImage::findOrFail($id);
            
            // Delete file
            if ($image->image_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('product/' . $image->image_url);
                    } else {
                        \Storage::disk('public')->delete('product/' . $image->image_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete product image file: ' . $e->getMessage());
                }
            }
            
            $image->delete();
            
            Toastr::success(translate('messages.image_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_image') . ': ' . $e->getMessage());
            \Log::error('Image deletion error: ' . $e->getMessage());
            return back();
        }
    }
}


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.add_product'))

@push('css_or_js')
<style>
    .card {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075), 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        border: 1px solid rgba(0, 0, 0, 0.125);
        border-radius: 0.5rem;
    }
    .card-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .card-footer {
        background-color: #f8f9fa;
        border-top: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .image-preview-container {
        margin-top: 15px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    .image-preview-item {
        position: relative;
        width: 120px;
        height: 120px;
    }
    .image-preview-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 8px;
        border: 2px solid #e4e6ef;
    }
    .image-preview-item .remove-image {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #dc3545;
        color: white;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 14px;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-add-circle"></i>
                </span>
                <span>
                    {{ translate('messages.add_product') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">{{ translate('messages.add_product') }}</h5>
                    </div>
                    <form action="{{ route('admin.products.store') }}" method="post" enctype="multipart/form-data" id="product-form">
                        @csrf
                        <div class="card-body">
                            <div class="row">
                                <!-- Basic Info -->
                                <div class="col-md-12">
                                    <h5 class="mb-3">Basic Information</h5>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="name">Product Name <span class="text-danger">*</span></label>
                                        <input type="text" name="name" id="name" class="form-control" placeholder="Enter product name" value="{{ old('name') }}" required maxlength="255">
                                        @error('name')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="category_id">Category <span class="text-danger">*</span></label>
                                        <select name="category_id" id="category_id" class="form-control" required>
                                            <option value="">Select Category</option>
                                            @foreach($categories as $category)
                                                <option value="{{ $category->id }}" {{ old('category_id') == $category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('category_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="brand_id">Brand</label>
                                        <select name="brand_id" id="brand_id" class="form-control">
                                            <option value="">Select Brand</option>
                                            @foreach($brands as $brand)
                                                <option value="{{ $brand->id }}" {{ old('brand_id') == $brand->id ? 'selected' : '' }}>{{ $brand->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('brand_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="status">Status <span class="text-danger">*</span></label>
                                        <select name="status" id="status" class="form-control" required>
                                            <option value="active" {{ old('status', 'active') == 'active' ? 'selected' : '' }}>Active</option>
                                            <option value="inactive" {{ old('status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                        </select>
                                        @error('status')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="short_description">Short Description</label>
                                        <textarea name="short_description" id="short_description" class="form-control" rows="2" placeholder="Enter short description (max 500 characters)" maxlength="500">{{ old('short_description') }}</textarea>
                                        @error('short_description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="description">Description</label>
                                        <textarea name="description" id="description" class="form-control" rows="4" placeholder="Enter product description">{{ old('description') }}</textarea>
                                        @error('description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Pricing -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Pricing (Default Variant)</h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_sku">SKU <span class="text-danger">*</span></label>
                                        <input type="text" name="variant_sku" id="variant_sku" class="form-control" placeholder="Enter SKU" value="{{ old('variant_sku') }}" required maxlength="255">
                                        @error('variant_sku')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_price">Price <span class="text-danger">*</span></label>
                                        <input type="number" name="variant_price" id="variant_price" class="form-control" placeholder="0.00" value="{{ old('variant_price') }}" step="0.01" min="0" required>
                                        @error('variant_price')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_sale_price">Sale Price</label>
                                        <input type="number" name="variant_sale_price" id="variant_sale_price" class="form-control" placeholder="0.00" value="{{ old('variant_sale_price') }}" step="0.01" min="0">
                                        @error('variant_sale_price')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_status">Variant Status <span class="text-danger">*</span></label>
                                        <select name="variant_status" id="variant_status" class="form-control" required>
                                            <option value="active" {{ old('variant_status', 'active') == 'active' ? 'selected' : '' }}>Active</option>
                                            <option value="inactive" {{ old('variant_status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                        </select>
                                        @error('variant_status')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Images -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Images</h5>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="images">Images</label>
                                        <input type="file" name="images[]" id="images" class="form-control" accept="image/*" multiple onchange="previewImages(this)">
                                        <small class="text-muted">Accepted formats: JPG, PNG, GIF, WEBP (Max: 15MB each). You can select multiple images.</small>
                                        <div class="image-preview-container" id="image-preview-container"></div>
                                        @error('images.*')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Flags -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Flags</h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Trending</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_trending" id="is_trending" value="1" {{ old('is_trending') ? 'checked' : '' }} switch="bool">
                                            <label for="is_trending" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls trending_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Latest</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_latest" id="is_latest" value="1" {{ old('is_latest') ? 'checked' : '' }} switch="bool">
                                            <label for="is_latest" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls latest_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Express-30</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_express_30" id="is_express_30" value="1" {{ old('is_express_30') ? 'checked' : '' }} switch="bool">
                                            <label for="is_express_30" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls /api/express-30/products</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="btn--container justify-content-end">
                                <a href="{{ route('admin.products.index') }}" class="btn btn--reset">{{ translate('messages.cancel') }}</a>
                                <button type="submit" class="btn btn--primary">{{ translate('messages.submit') }}</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    var imageFiles = [];
    
    function previewImages(input) {
        var container = document.getElementById('image-preview-container');
        container.innerHTML = '';
        
        if (input.files && input.files.length > 0) {
            for (var i = 0; i < input.files.length; i++) {
                var file = input.files[i];
                imageFiles.push(file);
                
                var reader = new FileReader();
                reader.onload = function(e) {
                    var div = document.createElement('div');
                    div.className = 'image-preview-item';
                    div.innerHTML = '<img src="' + e.target.result + '" alt="Preview">';
                    container.appendChild(div);
                };
                reader.readAsDataURL(file);
            }
        }
    }
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.edit_product'))

@push('css_or_js')
<style>
    .card {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075), 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        border: 1px solid rgba(0, 0, 0, 0.125);
        border-radius: 0.5rem;
    }
    .card-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .card-footer {
        background-color: #f8f9fa;
        border-top: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .image-preview-container {
        margin-top: 15px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    .image-preview-item {
        position: relative;
        width: 120px;
        height: 120px;
    }
    .image-preview-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 8px;
        border: 2px solid #e4e6ef;
    }
    .image-preview-item .remove-image {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #dc3545;
        color: white;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 14px;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-edit"></i>
                </span>
                <span>
                    {{ translate('messages.edit_product') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">{{ translate('messages.edit_product') }}</h5>
                    </div>
                    <form action="{{ route('admin.products.update', $product->id) }}" method="post" enctype="multipart/form-data" id="product-form">
                        @csrf
                        @method('PUT')
                        <div class="card-body">
                            <div class="row">
                                <!-- Basic Info -->
                                <div class="col-md-12">
                                    <h5 class="mb-3">Basic Information</h5>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="name">Product Name <span class="text-danger">*</span></label>
                                        <input type="text" name="name" id="name" class="form-control" placeholder="Enter product name" value="{{ old('name', $product->name) }}" required maxlength="255">
                                        @error('name')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="category_id">Category <span class="text-danger">*</span></label>
                                        <select name="category_id" id="category_id" class="form-control" required>
                                            <option value="">Select Category</option>
                                            @foreach($categories as $category)
                                                <option value="{{ $category->id }}" {{ old('category_id', $product->category_id) == $category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('category_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="brand_id">Brand</label>
                                        <select name="brand_id" id="brand_id" class="form-control">
                                            <option value="">Select Brand</option>
                                            @foreach($brands as $brand)
                                                <option value="{{ $brand->id }}" {{ old('brand_id', $product->brand_id) == $brand->id ? 'selected' : '' }}>{{ $brand->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('brand_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="status">Status <span class="text-danger">*</span></label>
                                        <select name="status" id="status" class="form-control" required>
                                            <option value="active" {{ old('status', $product->status) == 'active' ? 'selected' : '' }}>Active</option>
                                            <option value="inactive" {{ old('status', $product->status) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                        </select>
                                        @error('status')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="short_description">Short Description</label>
                                        <textarea name="short_description" id="short_description" class="form-control" rows="2" placeholder="Enter short description (max 500 characters)" maxlength="500">{{ old('short_description', $product->short_description) }}</textarea>
                                        @error('short_description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="description">Description</label>
                                        <textarea name="description" id="description" class="form-control" rows="4" placeholder="Enter product description">{{ old('description', $product->description) }}</textarea>
                                        @error('description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Images -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Images</h5>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="images">Add New Images</label>
                                        <input type="file" name="images[]" id="images" class="form-control" accept="image/*" multiple onchange="previewImages(this)">
                                        <small class="text-muted">Accepted formats: JPG, PNG, GIF, WEBP (Max: 15MB each). You can select multiple images.</small>
                                        <div class="image-preview-container" id="image-preview-container"></div>
                                        @error('images.*')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label">Existing Images</label>
                                        <div class="image-preview-container">
                                            @foreach($product->images as $image)
                                                <div class="image-preview-item">
                                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $image->image_url, \App\CentralLogics\Helpers::getDisk()) }}" alt="Product Image">
                                                    <a href="{{ route('admin.products.delete-image', $image->id) }}" 
                                                       class="remove-image" 
                                                       onclick="return confirm('Are you sure you want to delete this image?')"
                                                       title="Delete Image">
                                                        <i class="tio-delete-outlined"></i>
                                                    </a>
                                                </div>
                                            @endforeach
                                        </div>
                                    </div>
                                </div>

                                <!-- Flags -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Flags</h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Trending</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_trending" id="is_trending" value="1" {{ old('is_trending', $product->is_trending) ? 'checked' : '' }} switch="bool">
                                            <label for="is_trending" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls trending_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Latest</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_latest" id="is_latest" value="1" {{ old('is_latest', $product->is_latest) ? 'checked' : '' }} switch="bool">
                                            <label for="is_latest" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls latest_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Express-30</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_express_30" id="is_express_30" value="1" {{ old('is_express_30', $product->is_express_30) ? 'checked' : '' }} switch="bool">
                                            <label for="is_express_30" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls /api/express-30/products</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="btn--container justify-content-end">
                                <a href="{{ route('admin.products.index') }}" class="btn btn--reset">{{ translate('messages.cancel') }}</a>
                                <button type="submit" class="btn btn--primary">{{ translate('messages.submit') }}</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    function previewImages(input) {
        var container = document.getElementById('image-preview-container');
        
        if (input.files && input.files.length > 0) {
            for (var i = 0; i < input.files.length; i++) {
                var file = input.files[i];
                var reader = new FileReader();
                reader.onload = function(e) {
                    var div = document.createElement('div');
                    div.className = 'image-preview-item';
                    div.innerHTML = '<img src="' + e.target.result + '" alt="Preview">';
                    container.appendChild(div);
                };
                reader.readAsDataURL(file);
            }
        }
    }
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.add_product'))

@push('css_or_js')
<style>
    .card {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075), 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        border: 1px solid rgba(0, 0, 0, 0.125);
        border-radius: 0.5rem;
    }
    .card-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .card-footer {
        background-color: #f8f9fa;
        border-top: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .image-preview-container {
        margin-top: 15px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    .image-preview-item {
        position: relative;
        width: 120px;
        height: 120px;
    }
    .image-preview-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 8px;
        border: 2px solid #e4e6ef;
    }
    .image-preview-item .remove-image {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #dc3545;
        color: white;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 14px;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-add-circle"></i>
                </span>
                <span>
                    {{ translate('messages.add_product') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">{{ translate('messages.add_product') }}</h5>
                    </div>
                    <form action="{{ route('admin.products.store') }}" method="post" enctype="multipart/form-data" id="product-form">
                        @csrf
                        <div class="card-body">
                            <div class="row">
                                <!-- Basic Info -->
                                <div class="col-md-12">
                                    <h5 class="mb-3">Basic Information</h5>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="name">Product Name <span class="text-danger">*</span></label>
                                        <input type="text" name="name" id="name" class="form-control" placeholder="Enter product name" value="{{ old('name') }}" required maxlength="255">
                                        @error('name')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="category_id">Category <span class="text-danger">*</span></label>
                                        <select name="category_id" id="category_id" class="form-control" required>
                                            <option value="">Select Category</option>
                                            @foreach($categories as $category)
                                                <option value="{{ $category->id }}" {{ old('category_id') == $category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('category_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="brand_id">Brand</label>
                                        <select name="brand_id" id="brand_id" class="form-control">
                                            <option value="">Select Brand</option>
                                            @foreach($brands as $brand)
                                                <option value="{{ $brand->id }}" {{ old('brand_id') == $brand->id ? 'selected' : '' }}>{{ $brand->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('brand_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="status">Status <span class="text-danger">*</span></label>
                                        <select name="status" id="status" class="form-control" required>
                                            <option value="active" {{ old('status', 'active') == 'active' ? 'selected' : '' }}>Active</option>
                                            <option value="inactive" {{ old('status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                        </select>
                                        @error('status')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="short_description">Short Description</label>
                                        <textarea name="short_description" id="short_description" class="form-control" rows="2" placeholder="Enter short description (max 500 characters)" maxlength="500">{{ old('short_description') }}</textarea>
                                        @error('short_description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="description">Description</label>
                                        <textarea name="description" id="description" class="form-control" rows="4" placeholder="Enter product description">{{ old('description') }}</textarea>
                                        @error('description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Pricing -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Pricing (Default Variant)</h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_sku">SKU <span class="text-danger">*</span></label>
                                        <input type="text" name="variant_sku" id="variant_sku" class="form-control" placeholder="Enter SKU" value="{{ old('variant_sku') }}" required maxlength="255">
                                        @error('variant_sku')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_price">Price <span class="text-danger">*</span></label>
                                        <input type="number" name="variant_price" id="variant_price" class="form-control" placeholder="0.00" value="{{ old('variant_price') }}" step="0.01" min="0" required>
                                        @error('variant_price')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_sale_price">Sale Price</label>
                                        <input type="number" name="variant_sale_price" id="variant_sale_price" class="form-control" placeholder="0.00" value="{{ old('variant_sale_price') }}" step="0.01" min="0">
                                        @error('variant_sale_price')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_status">Variant Status <span class="text-danger">*</span></label>
                                        <select name="variant_status" id="variant_status" class="form-control" required>
                                            <option value="active" {{ old('variant_status', 'active') == 'active' ? 'selected' : '' }}>Active</option>
                                            <option value="inactive" {{ old('variant_status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                        </select>
                                        @error('variant_status')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Images -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Images</h5>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="images">Images</label>
                                        <input type="file" name="images[]" id="images" class="form-control" accept="image/*" multiple onchange="previewImages(this)">
                                        <small class="text-muted">Accepted formats: JPG, PNG, GIF, WEBP (Max: 15MB each). You can select multiple images.</small>
                                        <div class="image-preview-container" id="image-preview-container"></div>
                                        @error('images.*')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Flags -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Flags</h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Trending</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_trending" id="is_trending" value="1" {{ old('is_trending') ? 'checked' : '' }} switch="bool">
                                            <label for="is_trending" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls trending_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Latest</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_latest" id="is_latest" value="1" {{ old('is_latest') ? 'checked' : '' }} switch="bool">
                                            <label for="is_latest" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls latest_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Express-30</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_express_30" id="is_express_30" value="1" {{ old('is_express_30') ? 'checked' : '' }} switch="bool">
                                            <label for="is_express_30" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls /api/express-30/products</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="btn--container justify-content-end">
                                <a href="{{ route('admin.products.index') }}" class="btn btn--reset">{{ translate('messages.cancel') }}</a>
                                <button type="submit" class="btn btn--primary">{{ translate('messages.submit') }}</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    var imageFiles = [];
    var maxFileSize = 15 * 1024 * 1024; // 15MB in bytes
    
    function previewImages(input) {
        var container = document.getElementById('image-preview-container');
        container.innerHTML = '';
        imageFiles = [];
        
        if (input.files && input.files.length > 0) {
            var validFiles = [];
            var hasError = false;
            
            for (var i = 0; i < input.files.length; i++) {
                var file = input.files[i];
                
                // Check file size
                if (file.size > maxFileSize) {
                    alert('File "' + file.name + '" exceeds the maximum file size of 15MB. Please choose a smaller file.');
                    hasError = true;
                    continue;
                }
                
                validFiles.push(file);
                imageFiles.push(file);
                
                var reader = new FileReader();
                reader.onload = function(e) {
                    var div = document.createElement('div');
                    div.className = 'image-preview-item';
                    div.innerHTML = '<img src="' + e.target.result + '" alt="Preview">';
                    container.appendChild(div);
                };
                reader.readAsDataURL(file);
            }
            
            // Reset input if there were invalid files
            if (hasError) {
                var dataTransfer = new DataTransfer();
                validFiles.forEach(function(file) {
                    dataTransfer.items.add(file);
                });
                input.files = dataTransfer.files;
            }
        }
    }
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.edit_product'))

@push('css_or_js')
<style>
    .card {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075), 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        border: 1px solid rgba(0, 0, 0, 0.125);
        border-radius: 0.5rem;
    }
    .card-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .card-footer {
        background-color: #f8f9fa;
        border-top: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .image-preview-container {
        margin-top: 15px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    .image-preview-item {
        position: relative;
        width: 120px;
        height: 120px;
    }
    .image-preview-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 8px;
        border: 2px solid #e4e6ef;
    }
    .image-preview-item .remove-image {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #dc3545;
        color: white;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 14px;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-edit"></i>
                </span>
                <span>
                    {{ translate('messages.edit_product') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">{{ translate('messages.edit_product') }}</h5>
                    </div>
                    <form action="{{ route('admin.products.update', $product->id) }}" method="post" enctype="multipart/form-data" id="product-form">
                        @csrf
                        @method('PUT')
                        <div class="card-body">
                            <div class="row">
                                <!-- Basic Info -->
                                <div class="col-md-12">
                                    <h5 class="mb-3">Basic Information</h5>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="name">Product Name <span class="text-danger">*</span></label>
                                        <input type="text" name="name" id="name" class="form-control" placeholder="Enter product name" value="{{ old('name', $product->name) }}" required maxlength="255">
                                        @error('name')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="category_id">Category <span class="text-danger">*</span></label>
                                        <select name="category_id" id="category_id" class="form-control" required>
                                            <option value="">Select Category</option>
                                            @foreach($categories as $category)
                                                <option value="{{ $category->id }}" {{ old('category_id', $product->category_id) == $category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('category_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="brand_id">Brand</label>
                                        <select name="brand_id" id="brand_id" class="form-control">
                                            <option value="">Select Brand</option>
                                            @foreach($brands as $brand)
                                                <option value="{{ $brand->id }}" {{ old('brand_id', $product->brand_id) == $brand->id ? 'selected' : '' }}>{{ $brand->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('brand_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="status">Status <span class="text-danger">*</span></label>
                                        <select name="status" id="status" class="form-control" required>
                                            <option value="active" {{ old('status', $product->status) == 'active' ? 'selected' : '' }}>Active</option>
                                            <option value="inactive" {{ old('status', $product->status) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                        </select>
                                        @error('status')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="short_description">Short Description</label>
                                        <textarea name="short_description" id="short_description" class="form-control" rows="2" placeholder="Enter short description (max 500 characters)" maxlength="500">{{ old('short_description', $product->short_description) }}</textarea>
                                        @error('short_description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="description">Description</label>
                                        <textarea name="description" id="description" class="form-control" rows="4" placeholder="Enter product description">{{ old('description', $product->description) }}</textarea>
                                        @error('description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Images -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Images</h5>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="images">Add New Images</label>
                                        <input type="file" name="images[]" id="images" class="form-control" accept="image/*" multiple onchange="previewImages(this)">
                                        <small class="text-muted">Accepted formats: JPG, PNG, GIF, WEBP (Max: 15MB each). You can select multiple images.</small>
                                        <div class="image-preview-container" id="image-preview-container"></div>
                                        @error('images.*')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label">Existing Images</label>
                                        <div class="image-preview-container">
                                            @foreach($product->images as $image)
                                                <div class="image-preview-item">
                                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $image->image_url, \App\CentralLogics\Helpers::getDisk()) }}" alt="Product Image">
                                                    <a href="{{ route('admin.products.delete-image', $image->id) }}" 
                                                       class="remove-image" 
                                                       onclick="return confirm('Are you sure you want to delete this image?')"
                                                       title="Delete Image">
                                                        <i class="tio-delete-outlined"></i>
                                                    </a>
                                                </div>
                                            @endforeach
                                        </div>
                                    </div>
                                </div>

                                <!-- Flags -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Flags</h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Trending</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_trending" id="is_trending" value="1" {{ old('is_trending', $product->is_trending) ? 'checked' : '' }} switch="bool">
                                            <label for="is_trending" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls trending_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Latest</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_latest" id="is_latest" value="1" {{ old('is_latest', $product->is_latest) ? 'checked' : '' }} switch="bool">
                                            <label for="is_latest" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls latest_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Express-30</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_express_30" id="is_express_30" value="1" {{ old('is_express_30', $product->is_express_30) ? 'checked' : '' }} switch="bool">
                                            <label for="is_express_30" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls /api/express-30/products</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="btn--container justify-content-end">
                                <a href="{{ route('admin.products.index') }}" class="btn btn--reset">{{ translate('messages.cancel') }}</a>
                                <button type="submit" class="btn btn--primary">{{ translate('messages.submit') }}</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    var maxFileSize = 15 * 1024 * 1024; // 15MB in bytes
    
    function previewImages(input) {
        var container = document.getElementById('image-preview-container');
        
        if (input.files && input.files.length > 0) {
            var validFiles = [];
            var hasError = false;
            
            for (var i = 0; i < input.files.length; i++) {
                var file = input.files[i];
                
                // Check file size
                if (file.size > maxFileSize) {
                    alert('File "' + file.name + '" exceeds the maximum file size of 15MB. Please choose a smaller file.');
                    hasError = true;
                    continue;
                }
                
                validFiles.push(file);
                
                var reader = new FileReader();
                reader.onload = function(e) {
                    var div = document.createElement('div');
                    div.className = 'image-preview-item';
                    div.innerHTML = '<img src="' + e.target.result + '" alt="Preview">';
                    container.appendChild(div);
                };
                reader.readAsDataURL(file);
            }
            
            // Reset input if there were invalid files
            if (hasError) {
                var dataTransfer = new DataTransfer();
                validFiles.forEach(function(file) {
                    dataTransfer.items.add(file);
                });
                input.files = dataTransfer.files;
            }
        }
    }
</script>
@endpush


```


Fixing the remaining validation rules that failed due to multiple matches:



Fixing the store method validation:


```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Product;
use App\Models\Category;
use App\Models\Brand;
use App\Models\ProductVariant;
use App\Models\ProductImage;
use Illuminate\Http\Request;
use App\CentralLogics\ToastrWrapper as Toastr;
use App\CentralLogics\Helpers;
use Illuminate\Support\Str;

class ProductController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index(Request $request)
    {
        $query = Product::with(['category', 'brand', 'variants', 'images']);
        
        // Search
        $search = trim($request->input('search', ''));
        if ($search !== '') {
            $query->where(function ($q) use ($search) {
                $q->where('name', 'like', "%{$search}%")
                    ->orWhere('description', 'like', "%{$search}%");
            });
        }
        
        // Filter by status
        $status = $request->input('status');
        if ($status !== null && $status !== '') {
            $query->where('status', $status);
        }
        
        // Filter by category
        $categoryId = $request->input('category_id');
        if (!empty($categoryId) && is_numeric($categoryId) && (int)$categoryId > 0) {
            $query->where('category_id', (int)$categoryId);
        }
        
        // Filter by trending
        $isTrending = $request->input('is_trending');
        if ($isTrending !== null && $isTrending !== '') {
            $query->where('is_trending', (bool)$isTrending);
        }
        
        // Filter by latest
        $isLatest = $request->input('is_latest');
        if ($isLatest !== null && $isLatest !== '') {
            $query->where('is_latest', (bool)$isLatest);
        }
        
        // Filter by express_30
        $isExpress30 = $request->input('is_express_30');
        if ($isExpress30 !== null && $isExpress30 !== '') {
            $query->where('is_express_30', (bool)$isExpress30);
        }
        
        $products = $query->orderBy('created_at', 'desc')->paginate(25);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        
        return view('admin-views.products.index', compact('products', 'categories'));
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.create', compact('categories', 'brands'));
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Variant fields
                'variant_sku' => 'required|string|max:255',
                'variant_price' => 'required|numeric|min:0',
                'variant_sale_price' => 'nullable|numeric|min:0',
                'variant_status' => 'required|in:active,inactive',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:15360',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'variant_sku.required' => translate('messages.SKU is required!'),
                'variant_price.required' => translate('messages.Price is required!'),
                'variant_price.numeric' => translate('messages.Price must be a number!'),
                'variant_price.min' => translate('messages.Price must be greater than or equal to 0!'),
                'variant_sale_price.numeric' => translate('messages.Sale price must be a number!'),
                'variant_sale_price.min' => translate('messages.Sale price must be greater than or equal to 0!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 15MB!'),
            ]);

            // Check if SKU already exists
            if (ProductVariant::where('sku', $request->variant_sku)->exists()) {
                Toastr::error(translate('messages.SKU already exists!'));
                return back()->withInput();
            }

            // Create product
            $product = new Product();
            $product->name = $request->name;
            $product->slug = Str::slug($request->name) . '-' . uniqid();
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Create default variant
            $variant = new ProductVariant();
            $variant->product_id = $product->id;
            $variant->sku = $request->variant_sku;
            $variant->price = $request->variant_price;
            $variant->sale_price = $request->variant_sale_price ?? null;
            $variant->status = $request->variant_status;
            $variant->save();

            // Handle images
            if ($request->hasFile('images')) {
                $sortOrder = 0;
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant->id;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = ($sortOrder === 0) ? true : false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_added'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_add_product') . ': ' . $e->getMessage());
            \Log::error('Product creation error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit($id)
    {
        $product = Product::with(['category', 'brand', 'variants', 'images'])->findOrFail($id);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.edit', compact('product', 'categories', 'brands'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, $id)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:15360',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 15MB!'),
            ]);

            $product = Product::findOrFail($id);
            $product->name = $request->name;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Handle new images
            if ($request->hasFile('images')) {
                $existingImages = ProductImage::where('product_id', $product->id)->count();
                $sortOrder = $existingImages;
                
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $variant = $product->variants->first();
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant ? $variant->id : null;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_updated'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_product') . ': ' . $e->getMessage());
            \Log::error('Product update error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy($id)
    {
        try {
            $product = Product::findOrFail($id);
            
            // Delete product images
            foreach ($product->images as $image) {
                if ($image->image_url) {
                    try {
                        $storageType = Helpers::getDisk();
                        if ($storageType === 's3') {
                            \Storage::disk('s3')->delete('product/' . $image->image_url);
                        } else {
                            \Storage::disk('public')->delete('product/' . $image->image_url);
                        }
                    } catch (\Exception $e) {
                        \Log::warning('Failed to delete product image: ' . $e->getMessage());
                    }
                }
                $image->delete();
            }
            
            // Delete variants (this will cascade delete related data)
            $product->variants()->delete();
            
            $product->delete();
            
            Toastr::success(translate('messages.product_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_product') . ': ' . $e->getMessage());
            \Log::error('Product deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product status
     */
    public function statusToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $product->status = $request->status;
            $product->save();
            Toastr::success(translate('messages.product_status_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_status') . ': ' . $e->getMessage());
            \Log::error('Product status update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product flag (trending, latest, express_30)
     */
    public function flagToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $flag = $request->flag; // is_trending, is_latest, is_express_30
            
            if (!in_array($flag, ['is_trending', 'is_latest', 'is_express_30'])) {
                Toastr::error(translate('messages.Invalid flag!'));
                return back();
            }
            
            $product->$flag = $request->value;
            $product->save();
            
            Toastr::success(translate('messages.product_flag_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_flag') . ': ' . $e->getMessage());
            \Log::error('Product flag update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Delete product image
     */
    public function deleteImage($id)
    {
        try {
            $image = ProductImage::findOrFail($id);
            
            // Delete file
            if ($image->image_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('product/' . $image->image_url);
                    } else {
                        \Storage::disk('public')->delete('product/' . $image->image_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete product image file: ' . $e->getMessage());
                }
            }
            
            $image->delete();
            
            Toastr::success(translate('messages.image_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_image') . ': ' . $e->getMessage());
            \Log::error('Image deletion error: ' . $e->getMessage());
            return back();
        }
    }
}


```


Verifying all changes are complete:



## Changes completed

1. Backend validation (ProductController.php)
   - Updated `max:2048` to `max:15360` (15MB in KB) in both `store()` and `update()` methods
   - Updated error messages from "2MB" to "15MB" in both methods

2. Frontend display (create.blade.php & edit.blade.php)
   - Updated help text from "Max: 2MB each" to "Max: 15MB each"

3. JavaScript validation (create.blade.php & edit.blade.php)
   - Added client-side file size validation (15MB limit)
   - Shows an alert if a file exceeds 15MB
   - Removes oversized files from the selection automatically

## Summary

- Backend: Validates up to 15MB per image file
- Frontend: Displays "Max: 15MB each" message
- JavaScript: Pre-validates file size before upload
- Error messages: Updated to reflect 15MB limit

Existing upload functionality, validations, and UI behavior remain unchanged. The system now accepts product images up to 15MB per file with validation on both client and server sides.

---

**User**

Fix the Admin Panel ‚Üí Add Product functionality which is currently not working / not saving product data correctly. Ensure products added from admin panel are successfully stored in database and visible in existing product APIs. Do NOT change API response formats or existing business logic.

---

**Cursor**


Investigating the Add Product issue. Reviewing the store method, form submission, and related models:



Checking the Helpers::upload function and reviewing the API ProductController to understand the expected data structure:



Reading the Helpers::upload function:



Checking the Helpers::getDisk() function and testing the full product creation flow:



Checking for issues and testing the product creation flow:



Reviewing the store method for potential issues. Adding transaction handling and improving error handling:



Improving the store method with transaction handling and better error handling:


```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Product;
use App\Models\Category;
use App\Models\Brand;
use App\Models\ProductVariant;
use App\Models\ProductImage;
use Illuminate\Http\Request;
use App\CentralLogics\ToastrWrapper as Toastr;
use App\CentralLogics\Helpers;
use Illuminate\Support\Str;
use Illuminate\Support\Facades\DB;

class ProductController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index(Request $request)
    {
        $query = Product::with(['category', 'brand', 'variants', 'images']);
        
        // Search
        $search = trim($request->input('search', ''));
        if ($search !== '') {
            $query->where(function ($q) use ($search) {
                $q->where('name', 'like', "%{$search}%")
                    ->orWhere('description', 'like', "%{$search}%");
            });
        }
        
        // Filter by status
        $status = $request->input('status');
        if ($status !== null && $status !== '') {
            $query->where('status', $status);
        }
        
        // Filter by category
        $categoryId = $request->input('category_id');
        if (!empty($categoryId) && is_numeric($categoryId) && (int)$categoryId > 0) {
            $query->where('category_id', (int)$categoryId);
        }
        
        // Filter by trending
        $isTrending = $request->input('is_trending');
        if ($isTrending !== null && $isTrending !== '') {
            $query->where('is_trending', (bool)$isTrending);
        }
        
        // Filter by latest
        $isLatest = $request->input('is_latest');
        if ($isLatest !== null && $isLatest !== '') {
            $query->where('is_latest', (bool)$isLatest);
        }
        
        // Filter by express_30
        $isExpress30 = $request->input('is_express_30');
        if ($isExpress30 !== null && $isExpress30 !== '') {
            $query->where('is_express_30', (bool)$isExpress30);
        }
        
        $products = $query->orderBy('created_at', 'desc')->paginate(25);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        
        return view('admin-views.products.index', compact('products', 'categories'));
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.create', compact('categories', 'brands'));
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Variant fields
                'variant_sku' => 'required|string|max:255',
                'variant_price' => 'required|numeric|min:0',
                'variant_sale_price' => 'nullable|numeric|min:0',
                'variant_status' => 'required|in:active,inactive',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:15360',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'variant_sku.required' => translate('messages.SKU is required!'),
                'variant_price.required' => translate('messages.Price is required!'),
                'variant_price.numeric' => translate('messages.Price must be a number!'),
                'variant_price.min' => translate('messages.Price must be greater than or equal to 0!'),
                'variant_sale_price.numeric' => translate('messages.Sale price must be a number!'),
                'variant_sale_price.min' => translate('messages.Sale price must be greater than or equal to 0!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 15MB!'),
            ]);

            // Check if SKU already exists
            if (ProductVariant::where('sku', $request->variant_sku)->exists()) {
                Toastr::error(translate('messages.SKU already exists!'));
                return back()->withInput();
            }

            // Create product
            $product = new Product();
            $product->name = $request->name;
            $product->slug = Str::slug($request->name) . '-' . uniqid();
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Create default variant
            $variant = new ProductVariant();
            $variant->product_id = $product->id;
            $variant->sku = $request->variant_sku;
            $variant->price = $request->variant_price;
            $variant->sale_price = $request->variant_sale_price ?? null;
            $variant->status = $request->variant_status;
            $variant->save();

            // Handle images
            if ($request->hasFile('images')) {
                $sortOrder = 0;
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant->id;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = ($sortOrder === 0) ? true : false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_added'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_add_product') . ': ' . $e->getMessage());
            \Log::error('Product creation error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit($id)
    {
        $product = Product::with(['category', 'brand', 'variants', 'images'])->findOrFail($id);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.edit', compact('product', 'categories', 'brands'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, $id)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:15360',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 15MB!'),
            ]);

            $product = Product::findOrFail($id);
            $product->name = $request->name;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Handle new images
            if ($request->hasFile('images')) {
                $existingImages = ProductImage::where('product_id', $product->id)->count();
                $sortOrder = $existingImages;
                
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $variant = $product->variants->first();
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant ? $variant->id : null;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_updated'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_product') . ': ' . $e->getMessage());
            \Log::error('Product update error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy($id)
    {
        try {
            $product = Product::findOrFail($id);
            
            // Delete product images
            foreach ($product->images as $image) {
                if ($image->image_url) {
                    try {
                        $storageType = Helpers::getDisk();
                        if ($storageType === 's3') {
                            \Storage::disk('s3')->delete('product/' . $image->image_url);
                        } else {
                            \Storage::disk('public')->delete('product/' . $image->image_url);
                        }
                    } catch (\Exception $e) {
                        \Log::warning('Failed to delete product image: ' . $e->getMessage());
                    }
                }
                $image->delete();
            }
            
            // Delete variants (this will cascade delete related data)
            $product->variants()->delete();
            
            $product->delete();
            
            Toastr::success(translate('messages.product_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_product') . ': ' . $e->getMessage());
            \Log::error('Product deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product status
     */
    public function statusToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $product->status = $request->status;
            $product->save();
            Toastr::success(translate('messages.product_status_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_status') . ': ' . $e->getMessage());
            \Log::error('Product status update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product flag (trending, latest, express_30)
     */
    public function flagToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $flag = $request->flag; // is_trending, is_latest, is_express_30
            
            if (!in_array($flag, ['is_trending', 'is_latest', 'is_express_30'])) {
                Toastr::error(translate('messages.Invalid flag!'));
                return back();
            }
            
            $product->$flag = $request->value;
            $product->save();
            
            Toastr::success(translate('messages.product_flag_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_flag') . ': ' . $e->getMessage());
            \Log::error('Product flag update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Delete product image
     */
    public function deleteImage($id)
    {
        try {
            $image = ProductImage::findOrFail($id);
            
            // Delete file
            if ($image->image_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('product/' . $image->image_url);
                    } else {
                        \Storage::disk('public')->delete('product/' . $image->image_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete product image file: ' . $e->getMessage());
                }
            }
            
            $image->delete();
            
            Toastr::success(translate('messages.image_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_image') . ': ' . $e->getMessage());
            \Log::error('Image deletion error: ' . $e->getMessage());
            return back();
        }
    }
}


```

```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Product;
use App\Models\Category;
use App\Models\Brand;
use App\Models\ProductVariant;
use App\Models\ProductImage;
use Illuminate\Http\Request;
use App\CentralLogics\ToastrWrapper as Toastr;
use App\CentralLogics\Helpers;
use Illuminate\Support\Str;
use Illuminate\Support\Facades\DB;

class ProductController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index(Request $request)
    {
        $query = Product::with(['category', 'brand', 'variants', 'images']);
        
        // Search
        $search = trim($request->input('search', ''));
        if ($search !== '') {
            $query->where(function ($q) use ($search) {
                $q->where('name', 'like', "%{$search}%")
                    ->orWhere('description', 'like', "%{$search}%");
            });
        }
        
        // Filter by status
        $status = $request->input('status');
        if ($status !== null && $status !== '') {
            $query->where('status', $status);
        }
        
        // Filter by category
        $categoryId = $request->input('category_id');
        if (!empty($categoryId) && is_numeric($categoryId) && (int)$categoryId > 0) {
            $query->where('category_id', (int)$categoryId);
        }
        
        // Filter by trending
        $isTrending = $request->input('is_trending');
        if ($isTrending !== null && $isTrending !== '') {
            $query->where('is_trending', (bool)$isTrending);
        }
        
        // Filter by latest
        $isLatest = $request->input('is_latest');
        if ($isLatest !== null && $isLatest !== '') {
            $query->where('is_latest', (bool)$isLatest);
        }
        
        // Filter by express_30
        $isExpress30 = $request->input('is_express_30');
        if ($isExpress30 !== null && $isExpress30 !== '') {
            $query->where('is_express_30', (bool)$isExpress30);
        }
        
        $products = $query->orderBy('created_at', 'desc')->paginate(25);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        
        return view('admin-views.products.index', compact('products', 'categories'));
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.create', compact('categories', 'brands'));
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        DB::beginTransaction();
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Variant fields
                'variant_sku' => 'required|string|max:255',
                'variant_price' => 'required|numeric|min:0',
                'variant_sale_price' => 'nullable|numeric|min:0',
                'variant_status' => 'required|in:active,inactive',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:15360',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'variant_sku.required' => translate('messages.SKU is required!'),
                'variant_price.required' => translate('messages.Price is required!'),
                'variant_price.numeric' => translate('messages.Price must be a number!'),
                'variant_price.min' => translate('messages.Price must be greater than or equal to 0!'),
                'variant_sale_price.numeric' => translate('messages.Sale price must be a number!'),
                'variant_sale_price.min' => translate('messages.Sale price must be greater than or equal to 0!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 15MB!'),
            ]);

            // Check if SKU already exists
            if (ProductVariant::where('sku', $request->variant_sku)->exists()) {
                DB::rollBack();
                Toastr::error(translate('messages.SKU already exists!'));
                return back()->withInput();
            }

            // Create product
            $product = new Product();
            $product->name = $request->name;
            $product->slug = Str::slug($request->name) . '-' . uniqid();
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            
            if (!$product->save()) {
                throw new \Exception('Failed to save product');
            }

            // Create default variant
            $variant = new ProductVariant();
            $variant->product_id = $product->id;
            $variant->sku = $request->variant_sku;
            $variant->price = $request->variant_price;
            $variant->sale_price = $request->variant_sale_price ?? null;
            $variant->status = $request->variant_status;
            
            if (!$variant->save()) {
                throw new \Exception('Failed to save product variant');
            }

            // Handle images
            if ($request->hasFile('images')) {
                $sortOrder = 0;
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant->id;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = ($sortOrder === 0) ? true : false;
                                $productImage->sort_order = $sortOrder;
                                
                                if (!$productImage->save()) {
                                    \Log::warning('Failed to save product image: ' . $imageName);
                                } else {
                                    $sortOrder++;
                                }
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                            // Continue with other images even if one fails
                        }
                    }
                }
            }

            DB::commit();
            
            Toastr::success(translate('messages.product_added'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            DB::rollBack();
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            DB::rollBack();
            Toastr::error(translate('messages.failed_to_add_product') . ': ' . $e->getMessage());
            \Log::error('Product creation error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->except(['images'])
            ]);
            return back()->withInput();
        }
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit($id)
    {
        $product = Product::with(['category', 'brand', 'variants', 'images'])->findOrFail($id);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.edit', compact('product', 'categories', 'brands'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, $id)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:15360',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 15MB!'),
            ]);

            $product = Product::findOrFail($id);
            $product->name = $request->name;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Handle new images
            if ($request->hasFile('images')) {
                $existingImages = ProductImage::where('product_id', $product->id)->count();
                $sortOrder = $existingImages;
                
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $variant = $product->variants->first();
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant ? $variant->id : null;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_updated'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_product') . ': ' . $e->getMessage());
            \Log::error('Product update error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy($id)
    {
        try {
            $product = Product::findOrFail($id);
            
            // Delete product images
            foreach ($product->images as $image) {
                if ($image->image_url) {
                    try {
                        $storageType = Helpers::getDisk();
                        if ($storageType === 's3') {
                            \Storage::disk('s3')->delete('product/' . $image->image_url);
                        } else {
                            \Storage::disk('public')->delete('product/' . $image->image_url);
                        }
                    } catch (\Exception $e) {
                        \Log::warning('Failed to delete product image: ' . $e->getMessage());
                    }
                }
                $image->delete();
            }
            
            // Delete variants (this will cascade delete related data)
            $product->variants()->delete();
            
            $product->delete();
            
            Toastr::success(translate('messages.product_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_product') . ': ' . $e->getMessage());
            \Log::error('Product deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product status
     */
    public function statusToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $product->status = $request->status;
            $product->save();
            Toastr::success(translate('messages.product_status_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_status') . ': ' . $e->getMessage());
            \Log::error('Product status update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product flag (trending, latest, express_30)
     */
    public function flagToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $flag = $request->flag; // is_trending, is_latest, is_express_30
            
            if (!in_array($flag, ['is_trending', 'is_latest', 'is_express_30'])) {
                Toastr::error(translate('messages.Invalid flag!'));
                return back();
            }
            
            $product->$flag = $request->value;
            $product->save();
            
            Toastr::success(translate('messages.product_flag_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_flag') . ': ' . $e->getMessage());
            \Log::error('Product flag update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Delete product image
     */
    public function deleteImage($id)
    {
        try {
            $image = ProductImage::findOrFail($id);
            
            // Delete file
            if ($image->image_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('product/' . $image->image_url);
                    } else {
                        \Storage::disk('public')->delete('product/' . $image->image_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete product image file: ' . $e->getMessage());
                }
            }
            
            $image->delete();
            
            Toastr::success(translate('messages.image_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_image') . ': ' . $e->getMessage());
            \Log::error('Image deletion error: ' . $e->getMessage());
            return back();
        }
    }
}


```


Checking slug uniqueness and ensuring products are saved correctly:


```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Product;
use App\Models\Category;
use App\Models\Brand;
use App\Models\ProductVariant;
use App\Models\ProductImage;
use Illuminate\Http\Request;
use App\CentralLogics\ToastrWrapper as Toastr;
use App\CentralLogics\Helpers;
use Illuminate\Support\Str;
use Illuminate\Support\Facades\DB;

class ProductController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index(Request $request)
    {
        $query = Product::with(['category', 'brand', 'variants', 'images']);
        
        // Search
        $search = trim($request->input('search', ''));
        if ($search !== '') {
            $query->where(function ($q) use ($search) {
                $q->where('name', 'like', "%{$search}%")
                    ->orWhere('description', 'like', "%{$search}%");
            });
        }
        
        // Filter by status
        $status = $request->input('status');
        if ($status !== null && $status !== '') {
            $query->where('status', $status);
        }
        
        // Filter by category
        $categoryId = $request->input('category_id');
        if (!empty($categoryId) && is_numeric($categoryId) && (int)$categoryId > 0) {
            $query->where('category_id', (int)$categoryId);
        }
        
        // Filter by trending
        $isTrending = $request->input('is_trending');
        if ($isTrending !== null && $isTrending !== '') {
            $query->where('is_trending', (bool)$isTrending);
        }
        
        // Filter by latest
        $isLatest = $request->input('is_latest');
        if ($isLatest !== null && $isLatest !== '') {
            $query->where('is_latest', (bool)$isLatest);
        }
        
        // Filter by express_30
        $isExpress30 = $request->input('is_express_30');
        if ($isExpress30 !== null && $isExpress30 !== '') {
            $query->where('is_express_30', (bool)$isExpress30);
        }
        
        $products = $query->orderBy('created_at', 'desc')->paginate(25);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        
        return view('admin-views.products.index', compact('products', 'categories'));
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.create', compact('categories', 'brands'));
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        DB::beginTransaction();
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Variant fields
                'variant_sku' => 'required|string|max:255',
                'variant_price' => 'required|numeric|min:0',
                'variant_sale_price' => 'nullable|numeric|min:0',
                'variant_status' => 'required|in:active,inactive',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:15360',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'variant_sku.required' => translate('messages.SKU is required!'),
                'variant_price.required' => translate('messages.Price is required!'),
                'variant_price.numeric' => translate('messages.Price must be a number!'),
                'variant_price.min' => translate('messages.Price must be greater than or equal to 0!'),
                'variant_sale_price.numeric' => translate('messages.Sale price must be a number!'),
                'variant_sale_price.min' => translate('messages.Sale price must be greater than or equal to 0!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 15MB!'),
            ]);

            // Check if SKU already exists
            if (ProductVariant::where('sku', $request->variant_sku)->exists()) {
                DB::rollBack();
                Toastr::error(translate('messages.SKU already exists!'));
                return back()->withInput();
            }

            // Generate unique slug
            $baseSlug = Str::slug($request->name);
            $slug = $baseSlug;
            $counter = 1;
            while (Product::where('slug', $slug)->exists()) {
                $slug = $baseSlug . '-' . uniqid() . '-' . $counter;
                $counter++;
            }

            // Create product
            $product = new Product();
            $product->name = $request->name;
            $product->slug = $slug;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            
            if (!$product->save()) {
                throw new \Exception('Failed to save product');
            }

            // Create default variant
            $variant = new ProductVariant();
            $variant->product_id = $product->id;
            $variant->sku = $request->variant_sku;
            $variant->price = $request->variant_price;
            $variant->sale_price = $request->variant_sale_price ?? null;
            $variant->status = $request->variant_status;
            
            if (!$variant->save()) {
                throw new \Exception('Failed to save product variant');
            }

            // Handle images
            if ($request->hasFile('images')) {
                $sortOrder = 0;
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant->id;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = ($sortOrder === 0) ? true : false;
                                $productImage->sort_order = $sortOrder;
                                
                                if (!$productImage->save()) {
                                    \Log::warning('Failed to save product image: ' . $imageName);
                                } else {
                                    $sortOrder++;
                                }
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                            // Continue with other images even if one fails
                        }
                    }
                }
            }

            DB::commit();
            
            Toastr::success(translate('messages.product_added'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            DB::rollBack();
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            DB::rollBack();
            Toastr::error(translate('messages.failed_to_add_product') . ': ' . $e->getMessage());
            \Log::error('Product creation error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->except(['images'])
            ]);
            return back()->withInput();
        }
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit($id)
    {
        $product = Product::with(['category', 'brand', 'variants', 'images'])->findOrFail($id);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.edit', compact('product', 'categories', 'brands'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, $id)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:15360',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 15MB!'),
            ]);

            $product = Product::findOrFail($id);
            $product->name = $request->name;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Handle new images
            if ($request->hasFile('images')) {
                $existingImages = ProductImage::where('product_id', $product->id)->count();
                $sortOrder = $existingImages;
                
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $variant = $product->variants->first();
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant ? $variant->id : null;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_updated'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_product') . ': ' . $e->getMessage());
            \Log::error('Product update error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy($id)
    {
        try {
            $product = Product::findOrFail($id);
            
            // Delete product images
            foreach ($product->images as $image) {
                if ($image->image_url) {
                    try {
                        $storageType = Helpers::getDisk();
                        if ($storageType === 's3') {
                            \Storage::disk('s3')->delete('product/' . $image->image_url);
                        } else {
                            \Storage::disk('public')->delete('product/' . $image->image_url);
                        }
                    } catch (\Exception $e) {
                        \Log::warning('Failed to delete product image: ' . $e->getMessage());
                    }
                }
                $image->delete();
            }
            
            // Delete variants (this will cascade delete related data)
            $product->variants()->delete();
            
            $product->delete();
            
            Toastr::success(translate('messages.product_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_product') . ': ' . $e->getMessage());
            \Log::error('Product deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product status
     */
    public function statusToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $product->status = $request->status;
            $product->save();
            Toastr::success(translate('messages.product_status_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_status') . ': ' . $e->getMessage());
            \Log::error('Product status update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product flag (trending, latest, express_30)
     */
    public function flagToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $flag = $request->flag; // is_trending, is_latest, is_express_30
            
            if (!in_array($flag, ['is_trending', 'is_latest', 'is_express_30'])) {
                Toastr::error(translate('messages.Invalid flag!'));
                return back();
            }
            
            $product->$flag = $request->value;
            $product->save();
            
            Toastr::success(translate('messages.product_flag_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_flag') . ': ' . $e->getMessage());
            \Log::error('Product flag update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Delete product image
     */
    public function deleteImage($id)
    {
        try {
            $image = ProductImage::findOrFail($id);
            
            // Delete file
            if ($image->image_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('product/' . $image->image_url);
                    } else {
                        \Storage::disk('public')->delete('product/' . $image->image_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete product image file: ' . $e->getMessage());
                }
            }
            
            $image->delete();
            
            Toastr::success(translate('messages.image_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_image') . ': ' . $e->getMessage());
            \Log::error('Image deletion error: ' . $e->getMessage());
            return back();
        }
    }
}


```


Verifying the changes and checking for other potential issues:



## Fixes applied

1. Database transaction handling
   - Wrapped product creation in a transaction
   - Rollback on any error to maintain data integrity
   - Commit only after all data is saved

2. Unique slug generation
   - Checks for existing slugs before saving
   - Generates a unique slug if a duplicate is found
   - Prevents database constraint violations

3. Error handling
   - Explicit checks for product and variant saves
   - Throws exceptions if saves fail
   - Logs errors for debugging

4. Image upload handling
   - Continues processing other images if one fails
   - Logs warnings for failed image saves
   - Does not block product creation if images fail

5. Data integrity
   - Product, variant, and images are saved atomically
   - If any part fails, the entire operation is rolled back
   - Products are saved with all required relationships

## What this fixes

- Products are saved correctly with all data
- Variants are created and linked to products
- Images are uploaded and linked (if provided)
- Products appear in the API when status is 'active'
- Data integrity is maintained with transactions
- Unique slugs prevent database errors

The Add Product functionality should now work correctly. Products created from the admin panel will be saved to the database with all relationships and will be visible in the existing product APIs.

---

**User**

Add frontend (client-side) validation on Admin Panel ‚Üí Add Product form submit, to prevent submitting invalid or incomplete data. Keep backend validation unchanged. Do NOT change UI design, layout, routes, or API behavior.

---

**Cursor**


Adding client-side validation to the Add Product form. Reviewing the current form structure:



Adding client-side validation to the Add Product form:


```blade
@extends('layouts.admin.app')

@section('title', translate('messages.add_product'))

@push('css_or_js')
<style>
    .card {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075), 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        border: 1px solid rgba(0, 0, 0, 0.125);
        border-radius: 0.5rem;
    }
    .card-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .card-footer {
        background-color: #f8f9fa;
        border-top: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .image-preview-container {
        margin-top: 15px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    .image-preview-item {
        position: relative;
        width: 120px;
        height: 120px;
    }
    .image-preview-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 8px;
        border: 2px solid #e4e6ef;
    }
    .image-preview-item .remove-image {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #dc3545;
        color: white;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 14px;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-add-circle"></i>
                </span>
                <span>
                    {{ translate('messages.add_product') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">{{ translate('messages.add_product') }}</h5>
                    </div>
                    <form action="{{ route('admin.products.store') }}" method="post" enctype="multipart/form-data" id="product-form">
                        @csrf
                        <div class="card-body">
                            <div class="row">
                                <!-- Basic Info -->
                                <div class="col-md-12">
                                    <h5 class="mb-3">Basic Information</h5>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="name">Product Name <span class="text-danger">*</span></label>
                                        <input type="text" name="name" id="name" class="form-control" placeholder="Enter product name" value="{{ old('name') }}" required maxlength="255">
                                        @error('name')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="category_id">Category <span class="text-danger">*</span></label>
                                        <select name="category_id" id="category_id" class="form-control" required>
                                            <option value="">Select Category</option>
                                            @foreach($categories as $category)
                                                <option value="{{ $category->id }}" {{ old('category_id') == $category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('category_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="brand_id">Brand</label>
                                        <select name="brand_id" id="brand_id" class="form-control">
                                            <option value="">Select Brand</option>
                                            @foreach($brands as $brand)
                                                <option value="{{ $brand->id }}" {{ old('brand_id') == $brand->id ? 'selected' : '' }}>{{ $brand->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('brand_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="status">Status <span class="text-danger">*</span></label>
                                        <select name="status" id="status" class="form-control" required>
                                            <option value="active" {{ old('status', 'active') == 'active' ? 'selected' : '' }}>Active</option>
                                            <option value="inactive" {{ old('status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                        </select>
                                        @error('status')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="short_description">Short Description</label>
                                        <textarea name="short_description" id="short_description" class="form-control" rows="2" placeholder="Enter short description (max 500 characters)" maxlength="500">{{ old('short_description') }}</textarea>
                                        @error('short_description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="description">Description</label>
                                        <textarea name="description" id="description" class="form-control" rows="4" placeholder="Enter product description">{{ old('description') }}</textarea>
                                        @error('description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Pricing -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Pricing (Default Variant)</h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_sku">SKU <span class="text-danger">*</span></label>
                                        <input type="text" name="variant_sku" id="variant_sku" class="form-control" placeholder="Enter SKU" value="{{ old('variant_sku') }}" required maxlength="255">
                                        @error('variant_sku')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_price">Price <span class="text-danger">*</span></label>
                                        <input type="number" name="variant_price" id="variant_price" class="form-control" placeholder="0.00" value="{{ old('variant_price') }}" step="0.01" min="0" required>
                                        @error('variant_price')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_sale_price">Sale Price</label>
                                        <input type="number" name="variant_sale_price" id="variant_sale_price" class="form-control" placeholder="0.00" value="{{ old('variant_sale_price') }}" step="0.01" min="0">
                                        @error('variant_sale_price')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_status">Variant Status <span class="text-danger">*</span></label>
                                        <select name="variant_status" id="variant_status" class="form-control" required>
                                            <option value="active" {{ old('variant_status', 'active') == 'active' ? 'selected' : '' }}>Active</option>
                                            <option value="inactive" {{ old('variant_status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                        </select>
                                        @error('variant_status')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Images -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Images</h5>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="images">Images</label>
                                        <input type="file" name="images[]" id="images" class="form-control" accept="image/*" multiple onchange="previewImages(this)">
                                        <small class="text-muted">Accepted formats: JPG, PNG, GIF, WEBP (Max: 15MB each). You can select multiple images.</small>
                                        <div class="image-preview-container" id="image-preview-container"></div>
                                        @error('images.*')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Flags -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Flags</h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Trending</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_trending" id="is_trending" value="1" {{ old('is_trending') ? 'checked' : '' }} switch="bool">
                                            <label for="is_trending" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls trending_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Latest</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_latest" id="is_latest" value="1" {{ old('is_latest') ? 'checked' : '' }} switch="bool">
                                            <label for="is_latest" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls latest_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Express-30</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_express_30" id="is_express_30" value="1" {{ old('is_express_30') ? 'checked' : '' }} switch="bool">
                                            <label for="is_express_30" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls /api/express-30/products</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="btn--container justify-content-end">
                                <a href="{{ route('admin.products.index') }}" class="btn btn--reset">{{ translate('messages.cancel') }}</a>
                                <button type="submit" class="btn btn--primary">{{ translate('messages.submit') }}</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    var imageFiles = [];
    var maxFileSize = 15 * 1024 * 1024; // 15MB in bytes
    
    function previewImages(input) {
        var container = document.getElementById('image-preview-container');
        container.innerHTML = '';
        imageFiles = [];
        
        if (input.files && input.files.length > 0) {
            var validFiles = [];
            var hasError = false;
            
            for (var i = 0; i < input.files.length; i++) {
                var file = input.files[i];
                
                // Check file size
                if (file.size > maxFileSize) {
                    alert('File "' + file.name + '" exceeds the maximum file size of 15MB. Please choose a smaller file.');
                    hasError = true;
                    continue;
                }
                
                validFiles.push(file);
                imageFiles.push(file);
                
                var reader = new FileReader();
                reader.onload = function(e) {
                    var div = document.createElement('div');
                    div.className = 'image-preview-item';
                    div.innerHTML = '<img src="' + e.target.result + '" alt="Preview">';
                    container.appendChild(div);
                };
                reader.readAsDataURL(file);
            }
            
            // Reset input if there were invalid files
            if (hasError) {
                var dataTransfer = new DataTransfer();
                validFiles.forEach(function(file) {
                    dataTransfer.items.add(file);
                });
                input.files = dataTransfer.files;
            }
        }
    }

    // Form validation
    document.addEventListener('DOMContentLoaded', function() {
        var form = document.getElementById('product-form');
        if (!form) return;

        // Helper function to show error message
        function showError(fieldId, message) {
            var field = document.getElementById(fieldId);
            if (!field) return;

            // Remove existing error message
            var existingError = field.parentElement.querySelector('.validation-error');
            if (existingError) {
                existingError.remove();
            }

            // Add error class to field
            field.classList.add('is-invalid');

            // Create and show error message
            var errorDiv = document.createElement('div');
            errorDiv.className = 'validation-error text-danger mt-1';
            errorDiv.style.fontSize = '0.875rem';
            errorDiv.textContent = message;
            field.parentElement.appendChild(errorDiv);
        }

        // Helper function to clear error
        function clearError(fieldId) {
            var field = document.getElementById(fieldId);
            if (!field) return;

            field.classList.remove('is-invalid');
            var existingError = field.parentElement.querySelector('.validation-error');
            if (existingError) {
                existingError.remove();
            }
        }

        // Real-time validation on blur
        var requiredFields = ['name', 'category_id', 'status', 'variant_sku', 'variant_price', 'variant_status'];
        requiredFields.forEach(function(fieldId) {
            var field = document.getElementById(fieldId);
            if (field) {
                field.addEventListener('blur', function() {
                    validateField(fieldId);
                });
                field.addEventListener('input', function() {
                    if (field.classList.contains('is-invalid')) {
                        validateField(fieldId);
                    }
                });
            }
        });

        // Validate individual field
        function validateField(fieldId) {
            var field = document.getElementById(fieldId);
            if (!field) return true;

            var value = field.value.trim();
            var isValid = true;
            var errorMessage = '';

            switch(fieldId) {
                case 'name':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Product name is required';
                    } else if (value.length > 255) {
                        isValid = false;
                        errorMessage = 'Product name must not exceed 255 characters';
                    }
                    break;
                case 'category_id':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Category is required';
                    }
                    break;
                case 'status':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Status is required';
                    }
                    break;
                case 'variant_sku':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'SKU is required';
                    } else if (value.length > 255) {
                        isValid = false;
                        errorMessage = 'SKU must not exceed 255 characters';
                    }
                    break;
                case 'variant_price':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Price is required';
                    } else {
                        var price = parseFloat(value);
                        if (isNaN(price)) {
                            isValid = false;
                            errorMessage = 'Price must be a valid number';
                        } else if (price < 0) {
                            isValid = false;
                            errorMessage = 'Price must be greater than or equal to 0';
                        }
                    }
                    break;
                case 'variant_status':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Variant status is required';
                    }
                    break;
            }

            if (isValid) {
                clearError(fieldId);
            } else {
                showError(fieldId, errorMessage);
            }

            return isValid;
        }

        // Validate sale price
        var salePriceField = document.getElementById('variant_sale_price');
        if (salePriceField) {
            salePriceField.addEventListener('blur', function() {
                var salePrice = salePriceField.value.trim();
                if (salePrice) {
                    var salePriceNum = parseFloat(salePrice);
                    var priceField = document.getElementById('variant_price');
                    var price = priceField ? parseFloat(priceField.value) : 0;

                    if (isNaN(salePriceNum)) {
                        showError('variant_sale_price', 'Sale price must be a valid number');
                    } else if (salePriceNum < 0) {
                        showError('variant_sale_price', 'Sale price must be greater than or equal to 0');
                    } else if (price > 0 && salePriceNum > price) {
                        showError('variant_sale_price', 'Sale price must be less than or equal to regular price');
                    } else {
                        clearError('variant_sale_price');
                    }
                } else {
                    clearError('variant_sale_price');
                }
            });
        }

        // Validate short description length
        var shortDescField = document.getElementById('short_description');
        if (shortDescField) {
            shortDescField.addEventListener('input', function() {
                if (this.value.length > 500) {
                    showError('short_description', 'Short description must not exceed 500 characters');
                } else {
                    clearError('short_description');
                }
            });
        }

        // Validate images
        var imagesField = document.getElementById('images');
        if (imagesField) {
            imagesField.addEventListener('change', function() {
                if (this.files && this.files.length > 0) {
                    var allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
                    var hasInvalidFile = false;

                    for (var i = 0; i < this.files.length; i++) {
                        var file = this.files[i];
                        if (!allowedTypes.includes(file.type)) {
                            hasInvalidFile = true;
                            showError('images', 'Only JPG, PNG, GIF, and WEBP image formats are allowed');
                            break;
                        }
                    }

                    if (!hasInvalidFile) {
                        clearError('images');
                    }
                }
            });
        }

        // Form submit validation
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            var isValid = true;
            var firstErrorField = null;

            // Validate all required fields
            requiredFields.forEach(function(fieldId) {
                if (!validateField(fieldId)) {
                    isValid = false;
                    if (!firstErrorField) {
                        firstErrorField = document.getElementById(fieldId);
                    }
                }
            });

            // Validate sale price if provided
            if (salePriceField && salePriceField.value.trim()) {
                var salePrice = parseFloat(salePriceField.value);
                var price = parseFloat(document.getElementById('variant_price').value);
                
                if (isNaN(salePrice) || salePrice < 0 || (price > 0 && salePrice > price)) {
                    isValid = false;
                    if (!firstErrorField) {
                        firstErrorField = salePriceField;
                    }
                    if (isNaN(salePrice) || salePrice < 0) {
                        showError('variant_sale_price', 'Sale price must be a valid number greater than or equal to 0');
                    } else {
                        showError('variant_sale_price', 'Sale price must be less than or equal to regular price');
                    }
                }
            }

            // Validate short description length
            if (shortDescField && shortDescField.value.length > 500) {
                isValid = false;
                if (!firstErrorField) {
                    firstErrorField = shortDescField;
                }
                showError('short_description', 'Short description must not exceed 500 characters');
            }

            // Validate images if provided
            if (imagesField && imagesField.files && imagesField.files.length > 0) {
                var allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
                for (var i = 0; i < imagesField.files.length; i++) {
                    var file = imagesField.files[i];
                    if (!allowedTypes.includes(file.type)) {
                        isValid = false;
                        if (!firstErrorField) {
                            firstErrorField = imagesField;
                        }
                        showError('images', 'Only JPG, PNG, GIF, and WEBP image formats are allowed');
                        break;
                    }
                    if (file.size > maxFileSize) {
                        isValid = false;
                        if (!firstErrorField) {
                            firstErrorField = imagesField;
                        }
                        showError('images', 'File "' + file.name + '" exceeds the maximum file size of 15MB');
                        break;
                    }
                }
            }

            if (!isValid) {
                // Scroll to first error field
                if (firstErrorField) {
                    firstErrorField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    firstErrorField.focus();
                }
                return false;
            }

            // If validation passes, submit the form
            form.submit();
        });
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.add_product'))

@push('css_or_js')
<style>
    .card {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075), 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        border: 1px solid rgba(0, 0, 0, 0.125);
        border-radius: 0.5rem;
    }
    .card-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .card-footer {
        background-color: #f8f9fa;
        border-top: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .image-preview-container {
        margin-top: 15px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    .image-preview-item {
        position: relative;
        width: 120px;
        height: 120px;
    }
    .image-preview-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 8px;
        border: 2px solid #e4e6ef;
    }
    .image-preview-item .remove-image {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #dc3545;
        color: white;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 14px;
    }
    
    /* Validation styles */
    .form-control.is-invalid {
        border-color: #dc3545;
        padding-right: calc(1.5em + 0.75rem);
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath d='m5.8 3.6.4.4L6 4.4l-.2-.4-.4-.4zm0 4.8L6 8.8l.2.4.4.4-.4-.4z'/%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right calc(0.375em + 0.1875rem) center;
        background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
    }
    
    .validation-error {
        display: block;
        margin-top: 0.25rem;
        font-size: 0.875rem;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-add-circle"></i>
                </span>
                <span>
                    {{ translate('messages.add_product') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">{{ translate('messages.add_product') }}</h5>
                    </div>
                    <form action="{{ route('admin.products.store') }}" method="post" enctype="multipart/form-data" id="product-form">
                        @csrf
                        <div class="card-body">
                            <div class="row">
                                <!-- Basic Info -->
                                <div class="col-md-12">
                                    <h5 class="mb-3">Basic Information</h5>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="name">Product Name <span class="text-danger">*</span></label>
                                        <input type="text" name="name" id="name" class="form-control" placeholder="Enter product name" value="{{ old('name') }}" required maxlength="255">
                                        @error('name')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="category_id">Category <span class="text-danger">*</span></label>
                                        <select name="category_id" id="category_id" class="form-control" required>
                                            <option value="">Select Category</option>
                                            @foreach($categories as $category)
                                                <option value="{{ $category->id }}" {{ old('category_id') == $category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('category_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="brand_id">Brand</label>
                                        <select name="brand_id" id="brand_id" class="form-control">
                                            <option value="">Select Brand</option>
                                            @foreach($brands as $brand)
                                                <option value="{{ $brand->id }}" {{ old('brand_id') == $brand->id ? 'selected' : '' }}>{{ $brand->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('brand_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="status">Status <span class="text-danger">*</span></label>
                                        <select name="status" id="status" class="form-control" required>
                                            <option value="active" {{ old('status', 'active') == 'active' ? 'selected' : '' }}>Active</option>
                                            <option value="inactive" {{ old('status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                        </select>
                                        @error('status')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="short_description">Short Description</label>
                                        <textarea name="short_description" id="short_description" class="form-control" rows="2" placeholder="Enter short description (max 500 characters)" maxlength="500">{{ old('short_description') }}</textarea>
                                        @error('short_description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="description">Description</label>
                                        <textarea name="description" id="description" class="form-control" rows="4" placeholder="Enter product description">{{ old('description') }}</textarea>
                                        @error('description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Pricing -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Pricing (Default Variant)</h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_sku">SKU <span class="text-danger">*</span></label>
                                        <input type="text" name="variant_sku" id="variant_sku" class="form-control" placeholder="Enter SKU" value="{{ old('variant_sku') }}" required maxlength="255">
                                        @error('variant_sku')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_price">Price <span class="text-danger">*</span></label>
                                        <input type="number" name="variant_price" id="variant_price" class="form-control" placeholder="0.00" value="{{ old('variant_price') }}" step="0.01" min="0" required>
                                        @error('variant_price')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_sale_price">Sale Price</label>
                                        <input type="number" name="variant_sale_price" id="variant_sale_price" class="form-control" placeholder="0.00" value="{{ old('variant_sale_price') }}" step="0.01" min="0">
                                        @error('variant_sale_price')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_status">Variant Status <span class="text-danger">*</span></label>
                                        <select name="variant_status" id="variant_status" class="form-control" required>
                                            <option value="active" {{ old('variant_status', 'active') == 'active' ? 'selected' : '' }}>Active</option>
                                            <option value="inactive" {{ old('variant_status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                        </select>
                                        @error('variant_status')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Images -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Images</h5>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="images">Images</label>
                                        <input type="file" name="images[]" id="images" class="form-control" accept="image/*" multiple onchange="previewImages(this)">
                                        <small class="text-muted">Accepted formats: JPG, PNG, GIF, WEBP (Max: 15MB each). You can select multiple images.</small>
                                        <div class="image-preview-container" id="image-preview-container"></div>
                                        @error('images.*')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Flags -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Flags</h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Trending</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_trending" id="is_trending" value="1" {{ old('is_trending') ? 'checked' : '' }} switch="bool">
                                            <label for="is_trending" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls trending_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Latest</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_latest" id="is_latest" value="1" {{ old('is_latest') ? 'checked' : '' }} switch="bool">
                                            <label for="is_latest" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls latest_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Express-30</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_express_30" id="is_express_30" value="1" {{ old('is_express_30') ? 'checked' : '' }} switch="bool">
                                            <label for="is_express_30" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls /api/express-30/products</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="btn--container justify-content-end">
                                <a href="{{ route('admin.products.index') }}" class="btn btn--reset">{{ translate('messages.cancel') }}</a>
                                <button type="submit" class="btn btn--primary">{{ translate('messages.submit') }}</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    var imageFiles = [];
    var maxFileSize = 15 * 1024 * 1024; // 15MB in bytes
    
    function previewImages(input) {
        var container = document.getElementById('image-preview-container');
        container.innerHTML = '';
        imageFiles = [];
        
        if (input.files && input.files.length > 0) {
            var validFiles = [];
            var hasError = false;
            
            for (var i = 0; i < input.files.length; i++) {
                var file = input.files[i];
                
                // Check file size
                if (file.size > maxFileSize) {
                    alert('File "' + file.name + '" exceeds the maximum file size of 15MB. Please choose a smaller file.');
                    hasError = true;
                    continue;
                }
                
                validFiles.push(file);
                imageFiles.push(file);
                
                var reader = new FileReader();
                reader.onload = function(e) {
                    var div = document.createElement('div');
                    div.className = 'image-preview-item';
                    div.innerHTML = '<img src="' + e.target.result + '" alt="Preview">';
                    container.appendChild(div);
                };
                reader.readAsDataURL(file);
            }
            
            // Reset input if there were invalid files
            if (hasError) {
                var dataTransfer = new DataTransfer();
                validFiles.forEach(function(file) {
                    dataTransfer.items.add(file);
                });
                input.files = dataTransfer.files;
            }
        }
    }

    // Form validation
    document.addEventListener('DOMContentLoaded', function() {
        var form = document.getElementById('product-form');
        if (!form) return;

        // Helper function to show error message
        function showError(fieldId, message) {
            var field = document.getElementById(fieldId);
            if (!field) return;

            // Remove existing error message
            var existingError = field.parentElement.querySelector('.validation-error');
            if (existingError) {
                existingError.remove();
            }

            // Add error class to field
            field.classList.add('is-invalid');

            // Create and show error message
            var errorDiv = document.createElement('div');
            errorDiv.className = 'validation-error text-danger mt-1';
            errorDiv.style.fontSize = '0.875rem';
            errorDiv.textContent = message;
            field.parentElement.appendChild(errorDiv);
        }

        // Helper function to clear error
        function clearError(fieldId) {
            var field = document.getElementById(fieldId);
            if (!field) return;

            field.classList.remove('is-invalid');
            var existingError = field.parentElement.querySelector('.validation-error');
            if (existingError) {
                existingError.remove();
            }
        }

        // Real-time validation on blur
        var requiredFields = ['name', 'category_id', 'status', 'variant_sku', 'variant_price', 'variant_status'];
        requiredFields.forEach(function(fieldId) {
            var field = document.getElementById(fieldId);
            if (field) {
                field.addEventListener('blur', function() {
                    validateField(fieldId);
                });
                field.addEventListener('input', function() {
                    if (field.classList.contains('is-invalid')) {
                        validateField(fieldId);
                    }
                });
            }
        });

        // Validate individual field
        function validateField(fieldId) {
            var field = document.getElementById(fieldId);
            if (!field) return true;

            var value = field.value.trim();
            var isValid = true;
            var errorMessage = '';

            switch(fieldId) {
                case 'name':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Product name is required';
                    } else if (value.length > 255) {
                        isValid = false;
                        errorMessage = 'Product name must not exceed 255 characters';
                    }
                    break;
                case 'category_id':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Category is required';
                    }
                    break;
                case 'status':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Status is required';
                    }
                    break;
                case 'variant_sku':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'SKU is required';
                    } else if (value.length > 255) {
                        isValid = false;
                        errorMessage = 'SKU must not exceed 255 characters';
                    }
                    break;
                case 'variant_price':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Price is required';
                    } else {
                        var price = parseFloat(value);
                        if (isNaN(price)) {
                            isValid = false;
                            errorMessage = 'Price must be a valid number';
                        } else if (price < 0) {
                            isValid = false;
                            errorMessage = 'Price must be greater than or equal to 0';
                        }
                    }
                    break;
                case 'variant_status':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Variant status is required';
                    }
                    break;
            }

            if (isValid) {
                clearError(fieldId);
            } else {
                showError(fieldId, errorMessage);
            }

            return isValid;
        }

        // Validate sale price
        var salePriceField = document.getElementById('variant_sale_price');
        if (salePriceField) {
            salePriceField.addEventListener('blur', function() {
                var salePrice = salePriceField.value.trim();
                if (salePrice) {
                    var salePriceNum = parseFloat(salePrice);
                    var priceField = document.getElementById('variant_price');
                    var price = priceField ? parseFloat(priceField.value) : 0;

                    if (isNaN(salePriceNum)) {
                        showError('variant_sale_price', 'Sale price must be a valid number');
                    } else if (salePriceNum < 0) {
                        showError('variant_sale_price', 'Sale price must be greater than or equal to 0');
                    } else if (price > 0 && salePriceNum > price) {
                        showError('variant_sale_price', 'Sale price must be less than or equal to regular price');
                    } else {
                        clearError('variant_sale_price');
                    }
                } else {
                    clearError('variant_sale_price');
                }
            });
        }

        // Validate short description length
        var shortDescField = document.getElementById('short_description');
        if (shortDescField) {
            shortDescField.addEventListener('input', function() {
                if (this.value.length > 500) {
                    showError('short_description', 'Short description must not exceed 500 characters');
                } else {
                    clearError('short_description');
                }
            });
        }

        // Validate images
        var imagesField = document.getElementById('images');
        if (imagesField) {
            imagesField.addEventListener('change', function() {
                if (this.files && this.files.length > 0) {
                    var allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
                    var hasInvalidFile = false;

                    for (var i = 0; i < this.files.length; i++) {
                        var file = this.files[i];
                        if (!allowedTypes.includes(file.type)) {
                            hasInvalidFile = true;
                            showError('images', 'Only JPG, PNG, GIF, and WEBP image formats are allowed');
                            break;
                        }
                    }

                    if (!hasInvalidFile) {
                        clearError('images');
                    }
                }
            });
        }

        // Form submit validation
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            var isValid = true;
            var firstErrorField = null;

            // Validate all required fields
            requiredFields.forEach(function(fieldId) {
                if (!validateField(fieldId)) {
                    isValid = false;
                    if (!firstErrorField) {
                        firstErrorField = document.getElementById(fieldId);
                    }
                }
            });

            // Validate sale price if provided
            if (salePriceField && salePriceField.value.trim()) {
                var salePrice = parseFloat(salePriceField.value);
                var price = parseFloat(document.getElementById('variant_price').value);
                
                if (isNaN(salePrice) || salePrice < 0 || (price > 0 && salePrice > price)) {
                    isValid = false;
                    if (!firstErrorField) {
                        firstErrorField = salePriceField;
                    }
                    if (isNaN(salePrice) || salePrice < 0) {
                        showError('variant_sale_price', 'Sale price must be a valid number greater than or equal to 0');
                    } else {
                        showError('variant_sale_price', 'Sale price must be less than or equal to regular price');
                    }
                }
            }

            // Validate short description length
            if (shortDescField && shortDescField.value.length > 500) {
                isValid = false;
                if (!firstErrorField) {
                    firstErrorField = shortDescField;
                }
                showError('short_description', 'Short description must not exceed 500 characters');
            }

            // Validate images if provided
            if (imagesField && imagesField.files && imagesField.files.length > 0) {
                var allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
                for (var i = 0; i < imagesField.files.length; i++) {
                    var file = imagesField.files[i];
                    if (!allowedTypes.includes(file.type)) {
                        isValid = false;
                        if (!firstErrorField) {
                            firstErrorField = imagesField;
                        }
                        showError('images', 'Only JPG, PNG, GIF, and WEBP image formats are allowed');
                        break;
                    }
                    if (file.size > maxFileSize) {
                        isValid = false;
                        if (!firstErrorField) {
                            firstErrorField = imagesField;
                        }
                        showError('images', 'File "' + file.name + '" exceeds the maximum file size of 15MB');
                        break;
                    }
                }
            }

            if (!isValid) {
                // Scroll to first error field
                if (firstErrorField) {
                    firstErrorField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    firstErrorField.focus();
                }
                return false;
            }

            // If validation passes, submit the form
            form.submit();
        });
    });
</script>
@endpush


```


Added client-side validation to the Add Product form. Summary:

## Client-side validation features

### 1. Required field validation
- Product Name ‚Äî required, max 255 characters
- Category ‚Äî required
- Status ‚Äî required
- SKU ‚Äî required, max 255 characters
- Price ‚Äî required, numeric, >= 0
- Variant Status ‚Äî required

### 2. Optional field validation
- Sale Price ‚Äî if provided: numeric, >= 0, must be <= regular price
- Short Description ‚Äî max 500 characters
- Images ‚Äî file type (JPG, PNG, GIF, WEBP) and size (max 15MB each)

### 3. Real-time validation
- Validates on blur for required fields
- Clears errors as the user types
- Visual feedback with error styling

### 4. Form submit validation
- Prevents submission if validation fails
- Scrolls to the first error field
- Focuses the first error field
- Shows all validation errors at once

### 5. Visual feedback
- Invalid fields get a red border and error icon
- Error messages appear below each field
- Error styling matches Bootstrap validation styles

### 6. User experience
- Non-blocking: validates without interrupting workflow
- Clear error messages
- Prevents invalid submissions before server round-trip

## Validation rules

1. Product Name: Required, max 255 characters
2. Category: Required selection
3. Status: Required selection
4. SKU: Required, max 255 characters
5. Price: Required, numeric, >= 0
6. Sale Price: Optional, numeric, >= 0, must be <= Price
7. Variant Status: Required selection
8. Short Description: Optional, max 500 characters
9. Images: Optional, valid image types, max 15MB each

The validation runs entirely on the client side and does not change the UI design, layout, routes, or backend validation. Backend validation remains unchanged as a safety net.

---

**User**

Modify Admin Panel ‚Üí Add Product functionality to allow assigning a product to a specific State, City, and Fulfillment Center.
This is required to manage product availability per fulfillment center.
Keep existing product APIs and logic unchanged.

‚ö†Ô∏è STRICT RULES

‚ùå Do NOT change existing product APIs response structure

‚ùå Do NOT break current product listing or dashboard logic

‚ùå Do NOT refactor unrelated code

‚úÖ Only ADD required fields, UI, and save logic

‚úÖ Follow existing admin theme & folder structure

üß† FUNCTIONAL REQUIREMENT

When adding a product:

Admin selects State

Based on State ‚Üí load Cities

Based on City ‚Üí load Fulfillment Centers

Product is mapped to selected Fulfillment Center

Product becomes available only from that fulfillment center

üì¶ DATABASE REQUIREMENTS
1Ô∏è‚É£ Use Existing Tables (Preferred)

Use existing tables:

states
cities
fulfillment_centers
fulfillment_center_products


If mapping table already exists:

fulfillment_center_products


Ensure it contains:

fulfillment_center_id
product_id
stock_qty
reserved_qty


‚ùó Do NOT create duplicate tables.

üñ•Ô∏è ADMIN UI CHANGES (ADD PRODUCT FORM)
‚ûï Add dropdown fields:
State (dropdown)
City (dropdown ‚Äì dependent)
Fulfillment Center (dropdown ‚Äì dependent)
Initial Stock Quantity (number)

üîÑ DEPENDENT DROPDOWNS (AJAX)

Create admin AJAX endpoints (if not exist):

GET /admin/get-cities?state_id=
GET /admin/get-fulfillment-centers?city_id=


Use existing JS/jQuery pattern in admin panel.

üß† CONTROLLER MODIFICATION

Modify:

Admin\ProductController@store

On Save:

Save product normally

Insert mapping into:

fulfillment_center_products


Example logic:

FulfillmentCenterProduct::create([
    'fulfillment_center_id' => $request->fulfillment_center_id,
    'product_id' => $product->id,
    'stock_qty' => $request->stock_qty,
    'reserved_qty' => 0
]);


Wrap in DB transaction.

‚úèÔ∏è EDIT PRODUCT (OPTIONAL BUT SAFE)

Show selected State, City, Fulfillment Center

Allow updating stock per fulfillment center

Do NOT change existing products without selection

üåç MULTI-LANGUAGE SUPPORT

Add translation keys:

messages.select_state
messages.select_city
messages.select_fulfillment_center
messages.stock_quantity

üß™ VALIDATION (FRONTEND + BACKEND)

Required:

state_id
city_id
fulfillment_center_id
stock_qty (>= 0)

‚úÖ FINAL RESULT

‚úî Product assigned to fulfillment center
‚úî Location-based availability works
‚úî Express-30 & dashboard logic unaffected
‚úî Scalable for multi-warehouse setup
‚úî Admin-friendly workflow

---

**Cursor**


Reviewing the existing database structure and models:



Checking the FulfillmentCenter model and fulfillment_center_products table:



Creating the initial todo list and starting implementation:



Adding UI fields to the form, then creating the AJAX endpoints:


```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Product;
use App\Models\Category;
use App\Models\Brand;
use App\Models\ProductVariant;
use App\Models\ProductImage;
use App\Models\State;
use App\Models\City;
use App\Models\FulfillmentCenter;
use App\Models\WarehouseProduct;
use Illuminate\Http\Request;
use App\CentralLogics\ToastrWrapper as Toastr;
use App\CentralLogics\Helpers;
use Illuminate\Support\Str;
use Illuminate\Support\Facades\DB;

class ProductController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index(Request $request)
    {
        $query = Product::with(['category', 'brand', 'variants', 'images']);
        
        // Search
        $search = trim($request->input('search', ''));
        if ($search !== '') {
            $query->where(function ($q) use ($search) {
                $q->where('name', 'like', "%{$search}%")
                    ->orWhere('description', 'like', "%{$search}%");
            });
        }
        
        // Filter by status
        $status = $request->input('status');
        if ($status !== null && $status !== '') {
            $query->where('status', $status);
        }
        
        // Filter by category
        $categoryId = $request->input('category_id');
        if (!empty($categoryId) && is_numeric($categoryId) && (int)$categoryId > 0) {
            $query->where('category_id', (int)$categoryId);
        }
        
        // Filter by trending
        $isTrending = $request->input('is_trending');
        if ($isTrending !== null && $isTrending !== '') {
            $query->where('is_trending', (bool)$isTrending);
        }
        
        // Filter by latest
        $isLatest = $request->input('is_latest');
        if ($isLatest !== null && $isLatest !== '') {
            $query->where('is_latest', (bool)$isLatest);
        }
        
        // Filter by express_30
        $isExpress30 = $request->input('is_express_30');
        if ($isExpress30 !== null && $isExpress30 !== '') {
            $query->where('is_express_30', (bool)$isExpress30);
        }
        
        $products = $query->orderBy('created_at', 'desc')->paginate(25);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        
        return view('admin-views.products.index', compact('products', 'categories'));
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.create', compact('categories', 'brands'));
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        DB::beginTransaction();
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Variant fields
                'variant_sku' => 'required|string|max:255',
                'variant_price' => 'required|numeric|min:0',
                'variant_sale_price' => 'nullable|numeric|min:0',
                'variant_status' => 'required|in:active,inactive',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:15360',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'variant_sku.required' => translate('messages.SKU is required!'),
                'variant_price.required' => translate('messages.Price is required!'),
                'variant_price.numeric' => translate('messages.Price must be a number!'),
                'variant_price.min' => translate('messages.Price must be greater than or equal to 0!'),
                'variant_sale_price.numeric' => translate('messages.Sale price must be a number!'),
                'variant_sale_price.min' => translate('messages.Sale price must be greater than or equal to 0!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 15MB!'),
            ]);

            // Check if SKU already exists
            if (ProductVariant::where('sku', $request->variant_sku)->exists()) {
                DB::rollBack();
                Toastr::error(translate('messages.SKU already exists!'));
                return back()->withInput();
            }

            // Generate unique slug
            $baseSlug = Str::slug($request->name);
            $slug = $baseSlug;
            $counter = 1;
            while (Product::where('slug', $slug)->exists()) {
                $slug = $baseSlug . '-' . uniqid() . '-' . $counter;
                $counter++;
            }

            // Create product
            $product = new Product();
            $product->name = $request->name;
            $product->slug = $slug;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            
            if (!$product->save()) {
                throw new \Exception('Failed to save product');
            }

            // Create default variant
            $variant = new ProductVariant();
            $variant->product_id = $product->id;
            $variant->sku = $request->variant_sku;
            $variant->price = $request->variant_price;
            $variant->sale_price = $request->variant_sale_price ?? null;
            $variant->status = $request->variant_status;
            
            if (!$variant->save()) {
                throw new \Exception('Failed to save product variant');
            }

            // Handle images
            if ($request->hasFile('images')) {
                $sortOrder = 0;
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant->id;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = ($sortOrder === 0) ? true : false;
                                $productImage->sort_order = $sortOrder;
                                
                                if (!$productImage->save()) {
                                    \Log::warning('Failed to save product image: ' . $imageName);
                                } else {
                                    $sortOrder++;
                                }
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                            // Continue with other images even if one fails
                        }
                    }
                }
            }

            DB::commit();
            
            Toastr::success(translate('messages.product_added'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            DB::rollBack();
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            DB::rollBack();
            Toastr::error(translate('messages.failed_to_add_product') . ': ' . $e->getMessage());
            \Log::error('Product creation error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->except(['images'])
            ]);
            return back()->withInput();
        }
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit($id)
    {
        $product = Product::with(['category', 'brand', 'variants', 'images'])->findOrFail($id);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.edit', compact('product', 'categories', 'brands'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, $id)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:15360',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 15MB!'),
            ]);

            $product = Product::findOrFail($id);
            $product->name = $request->name;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Handle new images
            if ($request->hasFile('images')) {
                $existingImages = ProductImage::where('product_id', $product->id)->count();
                $sortOrder = $existingImages;
                
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $variant = $product->variants->first();
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant ? $variant->id : null;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_updated'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_product') . ': ' . $e->getMessage());
            \Log::error('Product update error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy($id)
    {
        try {
            $product = Product::findOrFail($id);
            
            // Delete product images
            foreach ($product->images as $image) {
                if ($image->image_url) {
                    try {
                        $storageType = Helpers::getDisk();
                        if ($storageType === 's3') {
                            \Storage::disk('s3')->delete('product/' . $image->image_url);
                        } else {
                            \Storage::disk('public')->delete('product/' . $image->image_url);
                        }
                    } catch (\Exception $e) {
                        \Log::warning('Failed to delete product image: ' . $e->getMessage());
                    }
                }
                $image->delete();
            }
            
            // Delete variants (this will cascade delete related data)
            $product->variants()->delete();
            
            $product->delete();
            
            Toastr::success(translate('messages.product_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_product') . ': ' . $e->getMessage());
            \Log::error('Product deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product status
     */
    public function statusToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $product->status = $request->status;
            $product->save();
            Toastr::success(translate('messages.product_status_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_status') . ': ' . $e->getMessage());
            \Log::error('Product status update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product flag (trending, latest, express_30)
     */
    public function flagToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $flag = $request->flag; // is_trending, is_latest, is_express_30
            
            if (!in_array($flag, ['is_trending', 'is_latest', 'is_express_30'])) {
                Toastr::error(translate('messages.Invalid flag!'));
                return back();
            }
            
            $product->$flag = $request->value;
            $product->save();
            
            Toastr::success(translate('messages.product_flag_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_flag') . ': ' . $e->getMessage());
            \Log::error('Product flag update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Delete product image
     */
    public function deleteImage($id)
    {
        try {
            $image = ProductImage::findOrFail($id);
            
            // Delete file
            if ($image->image_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('product/' . $image->image_url);
                    } else {
                        \Storage::disk('public')->delete('product/' . $image->image_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete product image file: ' . $e->getMessage());
                }
            }
            
            $image->delete();
            
            Toastr::success(translate('messages.image_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_image') . ': ' . $e->getMessage());
            \Log::error('Image deletion error: ' . $e->getMessage());
            return back();
        }
    }
}


```

```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Product;
use App\Models\Category;
use App\Models\Brand;
use App\Models\ProductVariant;
use App\Models\ProductImage;
use App\Models\State;
use App\Models\City;
use App\Models\FulfillmentCenter;
use App\Models\WarehouseProduct;
use Illuminate\Http\Request;
use App\CentralLogics\ToastrWrapper as Toastr;
use App\CentralLogics\Helpers;
use Illuminate\Support\Str;
use Illuminate\Support\Facades\DB;

class ProductController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index(Request $request)
    {
        $query = Product::with(['category', 'brand', 'variants', 'images']);
        
        // Search
        $search = trim($request->input('search', ''));
        if ($search !== '') {
            $query->where(function ($q) use ($search) {
                $q->where('name', 'like', "%{$search}%")
                    ->orWhere('description', 'like', "%{$search}%");
            });
        }
        
        // Filter by status
        $status = $request->input('status');
        if ($status !== null && $status !== '') {
            $query->where('status', $status);
        }
        
        // Filter by category
        $categoryId = $request->input('category_id');
        if (!empty($categoryId) && is_numeric($categoryId) && (int)$categoryId > 0) {
            $query->where('category_id', (int)$categoryId);
        }
        
        // Filter by trending
        $isTrending = $request->input('is_trending');
        if ($isTrending !== null && $isTrending !== '') {
            $query->where('is_trending', (bool)$isTrending);
        }
        
        // Filter by latest
        $isLatest = $request->input('is_latest');
        if ($isLatest !== null && $isLatest !== '') {
            $query->where('is_latest', (bool)$isLatest);
        }
        
        // Filter by express_30
        $isExpress30 = $request->input('is_express_30');
        if ($isExpress30 !== null && $isExpress30 !== '') {
            $query->where('is_express_30', (bool)$isExpress30);
        }
        
        $products = $query->orderBy('created_at', 'desc')->paginate(25);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        
        return view('admin-views.products.index', compact('products', 'categories'));
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        $states = State::orderBy('name', 'asc')->get();
        return view('admin-views.products.create', compact('categories', 'brands', 'states'));
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        DB::beginTransaction();
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Variant fields
                'variant_sku' => 'required|string|max:255',
                'variant_price' => 'required|numeric|min:0',
                'variant_sale_price' => 'nullable|numeric|min:0',
                'variant_status' => 'required|in:active,inactive',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:15360',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'variant_sku.required' => translate('messages.SKU is required!'),
                'variant_price.required' => translate('messages.Price is required!'),
                'variant_price.numeric' => translate('messages.Price must be a number!'),
                'variant_price.min' => translate('messages.Price must be greater than or equal to 0!'),
                'variant_sale_price.numeric' => translate('messages.Sale price must be a number!'),
                'variant_sale_price.min' => translate('messages.Sale price must be greater than or equal to 0!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 15MB!'),
            ]);

            // Check if SKU already exists
            if (ProductVariant::where('sku', $request->variant_sku)->exists()) {
                DB::rollBack();
                Toastr::error(translate('messages.SKU already exists!'));
                return back()->withInput();
            }

            // Generate unique slug
            $baseSlug = Str::slug($request->name);
            $slug = $baseSlug;
            $counter = 1;
            while (Product::where('slug', $slug)->exists()) {
                $slug = $baseSlug . '-' . uniqid() . '-' . $counter;
                $counter++;
            }

            // Create product
            $product = new Product();
            $product->name = $request->name;
            $product->slug = $slug;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            
            if (!$product->save()) {
                throw new \Exception('Failed to save product');
            }

            // Create default variant
            $variant = new ProductVariant();
            $variant->product_id = $product->id;
            $variant->sku = $request->variant_sku;
            $variant->price = $request->variant_price;
            $variant->sale_price = $request->variant_sale_price ?? null;
            $variant->status = $request->variant_status;
            
            if (!$variant->save()) {
                throw new \Exception('Failed to save product variant');
            }

            // Handle images
            if ($request->hasFile('images')) {
                $sortOrder = 0;
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant->id;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = ($sortOrder === 0) ? true : false;
                                $productImage->sort_order = $sortOrder;
                                
                                if (!$productImage->save()) {
                                    \Log::warning('Failed to save product image: ' . $imageName);
                                } else {
                                    $sortOrder++;
                                }
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                            // Continue with other images even if one fails
                        }
                    }
                }
            }

            DB::commit();
            
            Toastr::success(translate('messages.product_added'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            DB::rollBack();
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            DB::rollBack();
            Toastr::error(translate('messages.failed_to_add_product') . ': ' . $e->getMessage());
            \Log::error('Product creation error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->except(['images'])
            ]);
            return back()->withInput();
        }
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit($id)
    {
        $product = Product::with(['category', 'brand', 'variants', 'images'])->findOrFail($id);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.edit', compact('product', 'categories', 'brands'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, $id)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:15360',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 15MB!'),
            ]);

            $product = Product::findOrFail($id);
            $product->name = $request->name;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Handle new images
            if ($request->hasFile('images')) {
                $existingImages = ProductImage::where('product_id', $product->id)->count();
                $sortOrder = $existingImages;
                
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $variant = $product->variants->first();
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant ? $variant->id : null;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_updated'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_product') . ': ' . $e->getMessage());
            \Log::error('Product update error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy($id)
    {
        try {
            $product = Product::findOrFail($id);
            
            // Delete product images
            foreach ($product->images as $image) {
                if ($image->image_url) {
                    try {
                        $storageType = Helpers::getDisk();
                        if ($storageType === 's3') {
                            \Storage::disk('s3')->delete('product/' . $image->image_url);
                        } else {
                            \Storage::disk('public')->delete('product/' . $image->image_url);
                        }
                    } catch (\Exception $e) {
                        \Log::warning('Failed to delete product image: ' . $e->getMessage());
                    }
                }
                $image->delete();
            }
            
            // Delete variants (this will cascade delete related data)
            $product->variants()->delete();
            
            $product->delete();
            
            Toastr::success(translate('messages.product_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_product') . ': ' . $e->getMessage());
            \Log::error('Product deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product status
     */
    public function statusToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $product->status = $request->status;
            $product->save();
            Toastr::success(translate('messages.product_status_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_status') . ': ' . $e->getMessage());
            \Log::error('Product status update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product flag (trending, latest, express_30)
     */
    public function flagToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $flag = $request->flag; // is_trending, is_latest, is_express_30
            
            if (!in_array($flag, ['is_trending', 'is_latest', 'is_express_30'])) {
                Toastr::error(translate('messages.Invalid flag!'));
                return back();
            }
            
            $product->$flag = $request->value;
            $product->save();
            
            Toastr::success(translate('messages.product_flag_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_flag') . ': ' . $e->getMessage());
            \Log::error('Product flag update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Delete product image
     */
    public function deleteImage($id)
    {
        try {
            $image = ProductImage::findOrFail($id);
            
            // Delete file
            if ($image->image_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('product/' . $image->image_url);
                    } else {
                        \Storage::disk('public')->delete('product/' . $image->image_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete product image file: ' . $e->getMessage());
                }
            }
            
            $image->delete();
            
            Toastr::success(translate('messages.image_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_image') . ': ' . $e->getMessage());
            \Log::error('Image deletion error: ' . $e->getMessage());
            return back();
        }
    }
}


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.add_product'))

@push('css_or_js')
<style>
    .card {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075), 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        border: 1px solid rgba(0, 0, 0, 0.125);
        border-radius: 0.5rem;
    }
    .card-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .card-footer {
        background-color: #f8f9fa;
        border-top: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .image-preview-container {
        margin-top: 15px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    .image-preview-item {
        position: relative;
        width: 120px;
        height: 120px;
    }
    .image-preview-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 8px;
        border: 2px solid #e4e6ef;
    }
    .image-preview-item .remove-image {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #dc3545;
        color: white;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 14px;
    }
    
    /* Validation styles */
    .form-control.is-invalid {
        border-color: #dc3545;
        padding-right: calc(1.5em + 0.75rem);
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath d='m5.8 3.6.4.4L6 4.4l-.2-.4-.4-.4zm0 4.8L6 8.8l.2.4.4.4-.4-.4z'/%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right calc(0.375em + 0.1875rem) center;
        background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
    }
    
    .validation-error {
        display: block;
        margin-top: 0.25rem;
        font-size: 0.875rem;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-add-circle"></i>
                </span>
                <span>
                    {{ translate('messages.add_product') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">{{ translate('messages.add_product') }}</h5>
                    </div>
                    <form action="{{ route('admin.products.store') }}" method="post" enctype="multipart/form-data" id="product-form">
                        @csrf
                        <div class="card-body">
                            <div class="row">
                                <!-- Basic Info -->
                                <div class="col-md-12">
                                    <h5 class="mb-3">Basic Information</h5>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="name">Product Name <span class="text-danger">*</span></label>
                                        <input type="text" name="name" id="name" class="form-control" placeholder="Enter product name" value="{{ old('name') }}" required maxlength="255">
                                        @error('name')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="category_id">Category <span class="text-danger">*</span></label>
                                        <select name="category_id" id="category_id" class="form-control" required>
                                            <option value="">Select Category</option>
                                            @foreach($categories as $category)
                                                <option value="{{ $category->id }}" {{ old('category_id') == $category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('category_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="brand_id">Brand</label>
                                        <select name="brand_id" id="brand_id" class="form-control">
                                            <option value="">Select Brand</option>
                                            @foreach($brands as $brand)
                                                <option value="{{ $brand->id }}" {{ old('brand_id') == $brand->id ? 'selected' : '' }}>{{ $brand->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('brand_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="status">Status <span class="text-danger">*</span></label>
                                        <select name="status" id="status" class="form-control" required>
                                            <option value="active" {{ old('status', 'active') == 'active' ? 'selected' : '' }}>Active</option>
                                            <option value="inactive" {{ old('status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                        </select>
                                        @error('status')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="short_description">Short Description</label>
                                        <textarea name="short_description" id="short_description" class="form-control" rows="2" placeholder="Enter short description (max 500 characters)" maxlength="500">{{ old('short_description') }}</textarea>
                                        @error('short_description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="description">Description</label>
                                        <textarea name="description" id="description" class="form-control" rows="4" placeholder="Enter product description">{{ old('description') }}</textarea>
                                        @error('description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Location & Fulfillment Center -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Location & Fulfillment Center</h5>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="state_id">State <span class="text-danger">*</span></label>
                                        <select name="state_id" id="state_id" class="form-control" required>
                                            <option value="">{{ translate('messages.select_state') }}</option>
                                            @foreach($states as $state)
                                                <option value="{{ $state->id }}" {{ old('state_id') == $state->id ? 'selected' : '' }}>{{ $state->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('state_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="city_id">City <span class="text-danger">*</span></label>
                                        <select name="city_id" id="city_id" class="form-control" required disabled>
                                            <option value="">{{ translate('messages.select_city') }}</option>
                                        </select>
                                        @error('city_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="fulfillment_center_id">Fulfillment Center <span class="text-danger">*</span></label>
                                        <select name="fulfillment_center_id" id="fulfillment_center_id" class="form-control" required disabled>
                                            <option value="">{{ translate('messages.select_fulfillment_center') }}</option>
                                        </select>
                                        @error('fulfillment_center_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="stock_qty">{{ translate('messages.stock_quantity') }} <span class="text-danger">*</span></label>
                                        <input type="number" name="stock_qty" id="stock_qty" class="form-control" placeholder="0" value="{{ old('stock_qty', 0) }}" min="0" required>
                                        @error('stock_qty')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Pricing -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Pricing (Default Variant)</h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_sku">SKU <span class="text-danger">*</span></label>
                                        <input type="text" name="variant_sku" id="variant_sku" class="form-control" placeholder="Enter SKU" value="{{ old('variant_sku') }}" required maxlength="255">
                                        @error('variant_sku')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_price">Price <span class="text-danger">*</span></label>
                                        <input type="number" name="variant_price" id="variant_price" class="form-control" placeholder="0.00" value="{{ old('variant_price') }}" step="0.01" min="0" required>
                                        @error('variant_price')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_sale_price">Sale Price</label>
                                        <input type="number" name="variant_sale_price" id="variant_sale_price" class="form-control" placeholder="0.00" value="{{ old('variant_sale_price') }}" step="0.01" min="0">
                                        @error('variant_sale_price')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_status">Variant Status <span class="text-danger">*</span></label>
                                        <select name="variant_status" id="variant_status" class="form-control" required>
                                            <option value="active" {{ old('variant_status', 'active') == 'active' ? 'selected' : '' }}>Active</option>
                                            <option value="inactive" {{ old('variant_status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                        </select>
                                        @error('variant_status')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Images -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Images</h5>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="images">Images</label>
                                        <input type="file" name="images[]" id="images" class="form-control" accept="image/*" multiple onchange="previewImages(this)">
                                        <small class="text-muted">Accepted formats: JPG, PNG, GIF, WEBP (Max: 15MB each). You can select multiple images.</small>
                                        <div class="image-preview-container" id="image-preview-container"></div>
                                        @error('images.*')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Flags -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Flags</h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Trending</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_trending" id="is_trending" value="1" {{ old('is_trending') ? 'checked' : '' }} switch="bool">
                                            <label for="is_trending" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls trending_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Latest</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_latest" id="is_latest" value="1" {{ old('is_latest') ? 'checked' : '' }} switch="bool">
                                            <label for="is_latest" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls latest_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Express-30</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_express_30" id="is_express_30" value="1" {{ old('is_express_30') ? 'checked' : '' }} switch="bool">
                                            <label for="is_express_30" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls /api/express-30/products</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="btn--container justify-content-end">
                                <a href="{{ route('admin.products.index') }}" class="btn btn--reset">{{ translate('messages.cancel') }}</a>
                                <button type="submit" class="btn btn--primary">{{ translate('messages.submit') }}</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    var imageFiles = [];
    var maxFileSize = 15 * 1024 * 1024; // 15MB in bytes
    
    function previewImages(input) {
        var container = document.getElementById('image-preview-container');
        container.innerHTML = '';
        imageFiles = [];
        
        if (input.files && input.files.length > 0) {
            var validFiles = [];
            var hasError = false;
            
            for (var i = 0; i < input.files.length; i++) {
                var file = input.files[i];
                
                // Check file size
                if (file.size > maxFileSize) {
                    alert('File "' + file.name + '" exceeds the maximum file size of 15MB. Please choose a smaller file.');
                    hasError = true;
                    continue;
                }
                
                validFiles.push(file);
                imageFiles.push(file);
                
                var reader = new FileReader();
                reader.onload = function(e) {
                    var div = document.createElement('div');
                    div.className = 'image-preview-item';
                    div.innerHTML = '<img src="' + e.target.result + '" alt="Preview">';
                    container.appendChild(div);
                };
                reader.readAsDataURL(file);
            }
            
            // Reset input if there were invalid files
            if (hasError) {
                var dataTransfer = new DataTransfer();
                validFiles.forEach(function(file) {
                    dataTransfer.items.add(file);
                });
                input.files = dataTransfer.files;
            }
        }
    }

    // Form validation
    document.addEventListener('DOMContentLoaded', function() {
        var form = document.getElementById('product-form');
        if (!form) return;

        // Helper function to show error message
        function showError(fieldId, message) {
            var field = document.getElementById(fieldId);
            if (!field) return;

            // Remove existing error message
            var existingError = field.parentElement.querySelector('.validation-error');
            if (existingError) {
                existingError.remove();
            }

            // Add error class to field
            field.classList.add('is-invalid');

            // Create and show error message
            var errorDiv = document.createElement('div');
            errorDiv.className = 'validation-error text-danger mt-1';
            errorDiv.style.fontSize = '0.875rem';
            errorDiv.textContent = message;
            field.parentElement.appendChild(errorDiv);
        }

        // Helper function to clear error
        function clearError(fieldId) {
            var field = document.getElementById(fieldId);
            if (!field) return;

            field.classList.remove('is-invalid');
            var existingError = field.parentElement.querySelector('.validation-error');
            if (existingError) {
                existingError.remove();
            }
        }

        // Real-time validation on blur
        var requiredFields = ['name', 'category_id', 'status', 'variant_sku', 'variant_price', 'variant_status'];
        requiredFields.forEach(function(fieldId) {
            var field = document.getElementById(fieldId);
            if (field) {
                field.addEventListener('blur', function() {
                    validateField(fieldId);
                });
                field.addEventListener('input', function() {
                    if (field.classList.contains('is-invalid')) {
                        validateField(fieldId);
                    }
                });
            }
        });

        // Validate individual field
        function validateField(fieldId) {
            var field = document.getElementById(fieldId);
            if (!field) return true;

            var value = field.value.trim();
            var isValid = true;
            var errorMessage = '';

            switch(fieldId) {
                case 'name':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Product name is required';
                    } else if (value.length > 255) {
                        isValid = false;
                        errorMessage = 'Product name must not exceed 255 characters';
                    }
                    break;
                case 'category_id':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Category is required';
                    }
                    break;
                case 'status':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Status is required';
                    }
                    break;
                case 'variant_sku':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'SKU is required';
                    } else if (value.length > 255) {
                        isValid = false;
                        errorMessage = 'SKU must not exceed 255 characters';
                    }
                    break;
                case 'variant_price':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Price is required';
                    } else {
                        var price = parseFloat(value);
                        if (isNaN(price)) {
                            isValid = false;
                            errorMessage = 'Price must be a valid number';
                        } else if (price < 0) {
                            isValid = false;
                            errorMessage = 'Price must be greater than or equal to 0';
                        }
                    }
                    break;
                case 'variant_status':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Variant status is required';
                    }
                    break;
            }

            if (isValid) {
                clearError(fieldId);
            } else {
                showError(fieldId, errorMessage);
            }

            return isValid;
        }

        // Validate sale price
        var salePriceField = document.getElementById('variant_sale_price');
        if (salePriceField) {
            salePriceField.addEventListener('blur', function() {
                var salePrice = salePriceField.value.trim();
                if (salePrice) {
                    var salePriceNum = parseFloat(salePrice);
                    var priceField = document.getElementById('variant_price');
                    var price = priceField ? parseFloat(priceField.value) : 0;

                    if (isNaN(salePriceNum)) {
                        showError('variant_sale_price', 'Sale price must be a valid number');
                    } else if (salePriceNum < 0) {
                        showError('variant_sale_price', 'Sale price must be greater than or equal to 0');
                    } else if (price > 0 && salePriceNum > price) {
                        showError('variant_sale_price', 'Sale price must be less than or equal to regular price');
                    } else {
                        clearError('variant_sale_price');
                    }
                } else {
                    clearError('variant_sale_price');
                }
            });
        }

        // Validate short description length
        var shortDescField = document.getElementById('short_description');
        if (shortDescField) {
            shortDescField.addEventListener('input', function() {
                if (this.value.length > 500) {
                    showError('short_description', 'Short description must not exceed 500 characters');
                } else {
                    clearError('short_description');
                }
            });
        }

        // Validate images
        var imagesField = document.getElementById('images');
        if (imagesField) {
            imagesField.addEventListener('change', function() {
                if (this.files && this.files.length > 0) {
                    var allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
                    var hasInvalidFile = false;

                    for (var i = 0; i < this.files.length; i++) {
                        var file = this.files[i];
                        if (!allowedTypes.includes(file.type)) {
                            hasInvalidFile = true;
                            showError('images', 'Only JPG, PNG, GIF, and WEBP image formats are allowed');
                            break;
                        }
                    }

                    if (!hasInvalidFile) {
                        clearError('images');
                    }
                }
            });
        }

        // Form submit validation
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            var isValid = true;
            var firstErrorField = null;

            // Validate all required fields
            requiredFields.forEach(function(fieldId) {
                if (!validateField(fieldId)) {
                    isValid = false;
                    if (!firstErrorField) {
                        firstErrorField = document.getElementById(fieldId);
                    }
                }
            });

            // Validate sale price if provided
            if (salePriceField && salePriceField.value.trim()) {
                var salePrice = parseFloat(salePriceField.value);
                var price = parseFloat(document.getElementById('variant_price').value);
                
                if (isNaN(salePrice) || salePrice < 0 || (price > 0 && salePrice > price)) {
                    isValid = false;
                    if (!firstErrorField) {
                        firstErrorField = salePriceField;
                    }
                    if (isNaN(salePrice) || salePrice < 0) {
                        showError('variant_sale_price', 'Sale price must be a valid number greater than or equal to 0');
                    } else {
                        showError('variant_sale_price', 'Sale price must be less than or equal to regular price');
                    }
                }
            }

            // Validate short description length
            if (shortDescField && shortDescField.value.length > 500) {
                isValid = false;
                if (!firstErrorField) {
                    firstErrorField = shortDescField;
                }
                showError('short_description', 'Short description must not exceed 500 characters');
            }

            // Validate images if provided
            if (imagesField && imagesField.files && imagesField.files.length > 0) {
                var allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
                for (var i = 0; i < imagesField.files.length; i++) {
                    var file = imagesField.files[i];
                    if (!allowedTypes.includes(file.type)) {
                        isValid = false;
                        if (!firstErrorField) {
                            firstErrorField = imagesField;
                        }
                        showError('images', 'Only JPG, PNG, GIF, and WEBP image formats are allowed');
                        break;
                    }
                    if (file.size > maxFileSize) {
                        isValid = false;
                        if (!firstErrorField) {
                            firstErrorField = imagesField;
                        }
                        showError('images', 'File "' + file.name + '" exceeds the maximum file size of 15MB');
                        break;
                    }
                }
            }

            if (!isValid) {
                // Scroll to first error field
                if (firstErrorField) {
                    firstErrorField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    firstErrorField.focus();
                }
                return false;
            }

            // If validation passes, submit the form
            form.submit();
        });
    });
</script>
@endpush


```


Adding AJAX endpoints and updating the controller:


```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Product;
use App\Models\Category;
use App\Models\Brand;
use App\Models\ProductVariant;
use App\Models\ProductImage;
use App\Models\State;
use App\Models\City;
use App\Models\FulfillmentCenter;
use App\Models\WarehouseProduct;
use Illuminate\Http\Request;
use App\CentralLogics\ToastrWrapper as Toastr;
use App\CentralLogics\Helpers;
use Illuminate\Support\Str;
use Illuminate\Support\Facades\DB;

class ProductController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index(Request $request)
    {
        $query = Product::with(['category', 'brand', 'variants', 'images']);
        
        // Search
        $search = trim($request->input('search', ''));
        if ($search !== '') {
            $query->where(function ($q) use ($search) {
                $q->where('name', 'like', "%{$search}%")
                    ->orWhere('description', 'like', "%{$search}%");
            });
        }
        
        // Filter by status
        $status = $request->input('status');
        if ($status !== null && $status !== '') {
            $query->where('status', $status);
        }
        
        // Filter by category
        $categoryId = $request->input('category_id');
        if (!empty($categoryId) && is_numeric($categoryId) && (int)$categoryId > 0) {
            $query->where('category_id', (int)$categoryId);
        }
        
        // Filter by trending
        $isTrending = $request->input('is_trending');
        if ($isTrending !== null && $isTrending !== '') {
            $query->where('is_trending', (bool)$isTrending);
        }
        
        // Filter by latest
        $isLatest = $request->input('is_latest');
        if ($isLatest !== null && $isLatest !== '') {
            $query->where('is_latest', (bool)$isLatest);
        }
        
        // Filter by express_30
        $isExpress30 = $request->input('is_express_30');
        if ($isExpress30 !== null && $isExpress30 !== '') {
            $query->where('is_express_30', (bool)$isExpress30);
        }
        
        $products = $query->orderBy('created_at', 'desc')->paginate(25);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        
        return view('admin-views.products.index', compact('products', 'categories'));
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        $states = State::orderBy('name', 'asc')->get();
        return view('admin-views.products.create', compact('categories', 'brands', 'states'));
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        DB::beginTransaction();
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Variant fields
                'variant_sku' => 'required|string|max:255',
                'variant_price' => 'required|numeric|min:0',
                'variant_sale_price' => 'nullable|numeric|min:0',
                'variant_status' => 'required|in:active,inactive',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:15360',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'variant_sku.required' => translate('messages.SKU is required!'),
                'variant_price.required' => translate('messages.Price is required!'),
                'variant_price.numeric' => translate('messages.Price must be a number!'),
                'variant_price.min' => translate('messages.Price must be greater than or equal to 0!'),
                'variant_sale_price.numeric' => translate('messages.Sale price must be a number!'),
                'variant_sale_price.min' => translate('messages.Sale price must be greater than or equal to 0!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 15MB!'),
            ]);

            // Check if SKU already exists
            if (ProductVariant::where('sku', $request->variant_sku)->exists()) {
                DB::rollBack();
                Toastr::error(translate('messages.SKU already exists!'));
                return back()->withInput();
            }

            // Generate unique slug
            $baseSlug = Str::slug($request->name);
            $slug = $baseSlug;
            $counter = 1;
            while (Product::where('slug', $slug)->exists()) {
                $slug = $baseSlug . '-' . uniqid() . '-' . $counter;
                $counter++;
            }

            // Create product
            $product = new Product();
            $product->name = $request->name;
            $product->slug = $slug;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            
            if (!$product->save()) {
                throw new \Exception('Failed to save product');
            }

            // Create default variant
            $variant = new ProductVariant();
            $variant->product_id = $product->id;
            $variant->sku = $request->variant_sku;
            $variant->price = $request->variant_price;
            $variant->sale_price = $request->variant_sale_price ?? null;
            $variant->status = $request->variant_status;
            
            if (!$variant->save()) {
                throw new \Exception('Failed to save product variant');
            }

            // Create warehouse product mapping
            if ($request->fulfillment_center_id && $request->stock_qty !== null) {
                $warehouseProduct = new WarehouseProduct();
                $warehouseProduct->warehouse_id = $request->fulfillment_center_id;
                $warehouseProduct->product_variant_id = $variant->id;
                $warehouseProduct->stock_qty = $request->stock_qty ?? 0;
                $warehouseProduct->reserved_qty = 0;
                
                if (!$warehouseProduct->save()) {
                    throw new \Exception('Failed to save warehouse product mapping');
                }
            }

            // Handle images
            if ($request->hasFile('images')) {
                $sortOrder = 0;
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant->id;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = ($sortOrder === 0) ? true : false;
                                $productImage->sort_order = $sortOrder;
                                
                                if (!$productImage->save()) {
                                    \Log::warning('Failed to save product image: ' . $imageName);
                                } else {
                                    $sortOrder++;
                                }
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                            // Continue with other images even if one fails
                        }
                    }
                }
            }

            DB::commit();
            
            Toastr::success(translate('messages.product_added'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            DB::rollBack();
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            DB::rollBack();
            Toastr::error(translate('messages.failed_to_add_product') . ': ' . $e->getMessage());
            \Log::error('Product creation error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->except(['images'])
            ]);
            return back()->withInput();
        }
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit($id)
    {
        $product = Product::with(['category', 'brand', 'variants', 'images'])->findOrFail($id);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.edit', compact('product', 'categories', 'brands'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, $id)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:15360',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 15MB!'),
            ]);

            $product = Product::findOrFail($id);
            $product->name = $request->name;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Handle new images
            if ($request->hasFile('images')) {
                $existingImages = ProductImage::where('product_id', $product->id)->count();
                $sortOrder = $existingImages;
                
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $variant = $product->variants->first();
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant ? $variant->id : null;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_updated'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_product') . ': ' . $e->getMessage());
            \Log::error('Product update error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy($id)
    {
        try {
            $product = Product::findOrFail($id);
            
            // Delete product images
            foreach ($product->images as $image) {
                if ($image->image_url) {
                    try {
                        $storageType = Helpers::getDisk();
                        if ($storageType === 's3') {
                            \Storage::disk('s3')->delete('product/' . $image->image_url);
                        } else {
                            \Storage::disk('public')->delete('product/' . $image->image_url);
                        }
                    } catch (\Exception $e) {
                        \Log::warning('Failed to delete product image: ' . $e->getMessage());
                    }
                }
                $image->delete();
            }
            
            // Delete variants (this will cascade delete related data)
            $product->variants()->delete();
            
            $product->delete();
            
            Toastr::success(translate('messages.product_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_product') . ': ' . $e->getMessage());
            \Log::error('Product deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product status
     */
    public function statusToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $product->status = $request->status;
            $product->save();
            Toastr::success(translate('messages.product_status_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_status') . ': ' . $e->getMessage());
            \Log::error('Product status update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product flag (trending, latest, express_30)
     */
    public function flagToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $flag = $request->flag; // is_trending, is_latest, is_express_30
            
            if (!in_array($flag, ['is_trending', 'is_latest', 'is_express_30'])) {
                Toastr::error(translate('messages.Invalid flag!'));
                return back();
            }
            
            $product->$flag = $request->value;
            $product->save();
            
            Toastr::success(translate('messages.product_flag_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_flag') . ': ' . $e->getMessage());
            \Log::error('Product flag update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Delete product image
     */
    public function deleteImage($id)
    {
        try {
            $image = ProductImage::findOrFail($id);
            
            // Delete file
            if ($image->image_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('product/' . $image->image_url);
                    } else {
                        \Storage::disk('public')->delete('product/' . $image->image_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete product image file: ' . $e->getMessage());
                }
            }
            
            $image->delete();
            
            Toastr::success(translate('messages.image_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_image') . ': ' . $e->getMessage());
            \Log::error('Image deletion error: ' . $e->getMessage());
            return back();
        }
    }
}


```

```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Product;
use App\Models\Category;
use App\Models\Brand;
use App\Models\ProductVariant;
use App\Models\ProductImage;
use App\Models\State;
use App\Models\City;
use App\Models\FulfillmentCenter;
use App\Models\WarehouseProduct;
use Illuminate\Http\Request;
use App\CentralLogics\ToastrWrapper as Toastr;
use App\CentralLogics\Helpers;
use Illuminate\Support\Str;
use Illuminate\Support\Facades\DB;

class ProductController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index(Request $request)
    {
        $query = Product::with(['category', 'brand', 'variants', 'images']);
        
        // Search
        $search = trim($request->input('search', ''));
        if ($search !== '') {
            $query->where(function ($q) use ($search) {
                $q->where('name', 'like', "%{$search}%")
                    ->orWhere('description', 'like', "%{$search}%");
            });
        }
        
        // Filter by status
        $status = $request->input('status');
        if ($status !== null && $status !== '') {
            $query->where('status', $status);
        }
        
        // Filter by category
        $categoryId = $request->input('category_id');
        if (!empty($categoryId) && is_numeric($categoryId) && (int)$categoryId > 0) {
            $query->where('category_id', (int)$categoryId);
        }
        
        // Filter by trending
        $isTrending = $request->input('is_trending');
        if ($isTrending !== null && $isTrending !== '') {
            $query->where('is_trending', (bool)$isTrending);
        }
        
        // Filter by latest
        $isLatest = $request->input('is_latest');
        if ($isLatest !== null && $isLatest !== '') {
            $query->where('is_latest', (bool)$isLatest);
        }
        
        // Filter by express_30
        $isExpress30 = $request->input('is_express_30');
        if ($isExpress30 !== null && $isExpress30 !== '') {
            $query->where('is_express_30', (bool)$isExpress30);
        }
        
        $products = $query->orderBy('created_at', 'desc')->paginate(25);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        
        return view('admin-views.products.index', compact('products', 'categories'));
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        $states = State::orderBy('name', 'asc')->get();
        return view('admin-views.products.create', compact('categories', 'brands', 'states'));
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        DB::beginTransaction();
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Variant fields
                'variant_sku' => 'required|string|max:255',
                'variant_price' => 'required|numeric|min:0',
                'variant_sale_price' => 'nullable|numeric|min:0',
                'variant_status' => 'required|in:active,inactive',
                // Location & Fulfillment Center
                'state_id' => 'required|exists:states,id',
                'city_id' => 'required|exists:cities,id',
                'fulfillment_center_id' => 'required|exists:fulfillment_centers,id',
                'stock_qty' => 'required|integer|min:0',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:15360',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'variant_sku.required' => translate('messages.SKU is required!'),
                'variant_price.required' => translate('messages.Price is required!'),
                'variant_price.numeric' => translate('messages.Price must be a number!'),
                'variant_price.min' => translate('messages.Price must be greater than or equal to 0!'),
                'variant_sale_price.numeric' => translate('messages.Sale price must be a number!'),
                'variant_sale_price.min' => translate('messages.Sale price must be greater than or equal to 0!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 15MB!'),
            ]);

            // Check if SKU already exists
            if (ProductVariant::where('sku', $request->variant_sku)->exists()) {
                DB::rollBack();
                Toastr::error(translate('messages.SKU already exists!'));
                return back()->withInput();
            }

            // Generate unique slug
            $baseSlug = Str::slug($request->name);
            $slug = $baseSlug;
            $counter = 1;
            while (Product::where('slug', $slug)->exists()) {
                $slug = $baseSlug . '-' . uniqid() . '-' . $counter;
                $counter++;
            }

            // Create product
            $product = new Product();
            $product->name = $request->name;
            $product->slug = $slug;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            
            if (!$product->save()) {
                throw new \Exception('Failed to save product');
            }

            // Create default variant
            $variant = new ProductVariant();
            $variant->product_id = $product->id;
            $variant->sku = $request->variant_sku;
            $variant->price = $request->variant_price;
            $variant->sale_price = $request->variant_sale_price ?? null;
            $variant->status = $request->variant_status;
            
            if (!$variant->save()) {
                throw new \Exception('Failed to save product variant');
            }

            // Create warehouse product mapping
            if ($request->fulfillment_center_id && $request->stock_qty !== null) {
                $warehouseProduct = new WarehouseProduct();
                $warehouseProduct->warehouse_id = $request->fulfillment_center_id;
                $warehouseProduct->product_variant_id = $variant->id;
                $warehouseProduct->stock_qty = $request->stock_qty ?? 0;
                $warehouseProduct->reserved_qty = 0;
                
                if (!$warehouseProduct->save()) {
                    throw new \Exception('Failed to save warehouse product mapping');
                }
            }

            // Handle images
            if ($request->hasFile('images')) {
                $sortOrder = 0;
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant->id;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = ($sortOrder === 0) ? true : false;
                                $productImage->sort_order = $sortOrder;
                                
                                if (!$productImage->save()) {
                                    \Log::warning('Failed to save product image: ' . $imageName);
                                } else {
                                    $sortOrder++;
                                }
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                            // Continue with other images even if one fails
                        }
                    }
                }
            }

            DB::commit();
            
            Toastr::success(translate('messages.product_added'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            DB::rollBack();
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            DB::rollBack();
            Toastr::error(translate('messages.failed_to_add_product') . ': ' . $e->getMessage());
            \Log::error('Product creation error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->except(['images'])
            ]);
            return back()->withInput();
        }
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit($id)
    {
        $product = Product::with(['category', 'brand', 'variants', 'images'])->findOrFail($id);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.edit', compact('product', 'categories', 'brands'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, $id)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:15360',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 15MB!'),
            ]);

            $product = Product::findOrFail($id);
            $product->name = $request->name;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Handle new images
            if ($request->hasFile('images')) {
                $existingImages = ProductImage::where('product_id', $product->id)->count();
                $sortOrder = $existingImages;
                
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $variant = $product->variants->first();
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant ? $variant->id : null;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_updated'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_product') . ': ' . $e->getMessage());
            \Log::error('Product update error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy($id)
    {
        try {
            $product = Product::findOrFail($id);
            
            // Delete product images
            foreach ($product->images as $image) {
                if ($image->image_url) {
                    try {
                        $storageType = Helpers::getDisk();
                        if ($storageType === 's3') {
                            \Storage::disk('s3')->delete('product/' . $image->image_url);
                        } else {
                            \Storage::disk('public')->delete('product/' . $image->image_url);
                        }
                    } catch (\Exception $e) {
                        \Log::warning('Failed to delete product image: ' . $e->getMessage());
                    }
                }
                $image->delete();
            }
            
            // Delete variants (this will cascade delete related data)
            $product->variants()->delete();
            
            $product->delete();
            
            Toastr::success(translate('messages.product_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_product') . ': ' . $e->getMessage());
            \Log::error('Product deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product status
     */
    public function statusToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $product->status = $request->status;
            $product->save();
            Toastr::success(translate('messages.product_status_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_status') . ': ' . $e->getMessage());
            \Log::error('Product status update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product flag (trending, latest, express_30)
     */
    public function flagToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $flag = $request->flag; // is_trending, is_latest, is_express_30
            
            if (!in_array($flag, ['is_trending', 'is_latest', 'is_express_30'])) {
                Toastr::error(translate('messages.Invalid flag!'));
                return back();
            }
            
            $product->$flag = $request->value;
            $product->save();
            
            Toastr::success(translate('messages.product_flag_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_flag') . ': ' . $e->getMessage());
            \Log::error('Product flag update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Delete product image
     */
    public function deleteImage($id)
    {
        try {
            $image = ProductImage::findOrFail($id);
            
            // Delete file
            if ($image->image_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('product/' . $image->image_url);
                    } else {
                        \Storage::disk('public')->delete('product/' . $image->image_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete product image file: ' . $e->getMessage());
                }
            }
            
            $image->delete();
            
            Toastr::success(translate('messages.image_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_image') . ': ' . $e->getMessage());
            \Log::error('Image deletion error: ' . $e->getMessage());
            return back();
        }
    }
}


```

```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Product;
use App\Models\Category;
use App\Models\Brand;
use App\Models\ProductVariant;
use App\Models\ProductImage;
use App\Models\State;
use App\Models\City;
use App\Models\FulfillmentCenter;
use App\Models\WarehouseProduct;
use Illuminate\Http\Request;
use App\CentralLogics\ToastrWrapper as Toastr;
use App\CentralLogics\Helpers;
use Illuminate\Support\Str;
use Illuminate\Support\Facades\DB;

class ProductController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index(Request $request)
    {
        $query = Product::with(['category', 'brand', 'variants', 'images']);
        
        // Search
        $search = trim($request->input('search', ''));
        if ($search !== '') {
            $query->where(function ($q) use ($search) {
                $q->where('name', 'like', "%{$search}%")
                    ->orWhere('description', 'like', "%{$search}%");
            });
        }
        
        // Filter by status
        $status = $request->input('status');
        if ($status !== null && $status !== '') {
            $query->where('status', $status);
        }
        
        // Filter by category
        $categoryId = $request->input('category_id');
        if (!empty($categoryId) && is_numeric($categoryId) && (int)$categoryId > 0) {
            $query->where('category_id', (int)$categoryId);
        }
        
        // Filter by trending
        $isTrending = $request->input('is_trending');
        if ($isTrending !== null && $isTrending !== '') {
            $query->where('is_trending', (bool)$isTrending);
        }
        
        // Filter by latest
        $isLatest = $request->input('is_latest');
        if ($isLatest !== null && $isLatest !== '') {
            $query->where('is_latest', (bool)$isLatest);
        }
        
        // Filter by express_30
        $isExpress30 = $request->input('is_express_30');
        if ($isExpress30 !== null && $isExpress30 !== '') {
            $query->where('is_express_30', (bool)$isExpress30);
        }
        
        $products = $query->orderBy('created_at', 'desc')->paginate(25);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        
        return view('admin-views.products.index', compact('products', 'categories'));
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        $states = State::orderBy('name', 'asc')->get();
        return view('admin-views.products.create', compact('categories', 'brands', 'states'));
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        DB::beginTransaction();
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Variant fields
                'variant_sku' => 'required|string|max:255',
                'variant_price' => 'required|numeric|min:0',
                'variant_sale_price' => 'nullable|numeric|min:0',
                'variant_status' => 'required|in:active,inactive',
                // Location & Fulfillment Center
                'state_id' => 'required|exists:states,id',
                'city_id' => 'required|exists:cities,id',
                'fulfillment_center_id' => 'required|exists:fulfillment_centers,id',
                'stock_qty' => 'required|integer|min:0',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:15360',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'variant_sku.required' => translate('messages.SKU is required!'),
                'variant_price.required' => translate('messages.Price is required!'),
                'variant_price.numeric' => translate('messages.Price must be a number!'),
                'variant_price.min' => translate('messages.Price must be greater than or equal to 0!'),
                'variant_sale_price.numeric' => translate('messages.Sale price must be a number!'),
                'variant_sale_price.min' => translate('messages.Sale price must be greater than or equal to 0!'),
                'state_id.required' => translate('messages.State is required!'),
                'state_id.exists' => translate('messages.State not found!'),
                'city_id.required' => translate('messages.City is required!'),
                'city_id.exists' => translate('messages.City not found!'),
                'fulfillment_center_id.required' => translate('messages.Fulfillment center is required!'),
                'fulfillment_center_id.exists' => translate('messages.Fulfillment center not found!'),
                'stock_qty.required' => translate('messages.Stock quantity is required!'),
                'stock_qty.integer' => translate('messages.Stock quantity must be a number!'),
                'stock_qty.min' => translate('messages.Stock quantity must be greater than or equal to 0!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 15MB!'),
            ]);

            // Check if SKU already exists
            if (ProductVariant::where('sku', $request->variant_sku)->exists()) {
                DB::rollBack();
                Toastr::error(translate('messages.SKU already exists!'));
                return back()->withInput();
            }

            // Generate unique slug
            $baseSlug = Str::slug($request->name);
            $slug = $baseSlug;
            $counter = 1;
            while (Product::where('slug', $slug)->exists()) {
                $slug = $baseSlug . '-' . uniqid() . '-' . $counter;
                $counter++;
            }

            // Create product
            $product = new Product();
            $product->name = $request->name;
            $product->slug = $slug;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            
            if (!$product->save()) {
                throw new \Exception('Failed to save product');
            }

            // Create default variant
            $variant = new ProductVariant();
            $variant->product_id = $product->id;
            $variant->sku = $request->variant_sku;
            $variant->price = $request->variant_price;
            $variant->sale_price = $request->variant_sale_price ?? null;
            $variant->status = $request->variant_status;
            
            if (!$variant->save()) {
                throw new \Exception('Failed to save product variant');
            }

            // Create warehouse product mapping
            if ($request->fulfillment_center_id && $request->stock_qty !== null) {
                $warehouseProduct = new WarehouseProduct();
                $warehouseProduct->warehouse_id = $request->fulfillment_center_id;
                $warehouseProduct->product_variant_id = $variant->id;
                $warehouseProduct->stock_qty = $request->stock_qty ?? 0;
                $warehouseProduct->reserved_qty = 0;
                
                if (!$warehouseProduct->save()) {
                    throw new \Exception('Failed to save warehouse product mapping');
                }
            }

            // Handle images
            if ($request->hasFile('images')) {
                $sortOrder = 0;
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant->id;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = ($sortOrder === 0) ? true : false;
                                $productImage->sort_order = $sortOrder;
                                
                                if (!$productImage->save()) {
                                    \Log::warning('Failed to save product image: ' . $imageName);
                                } else {
                                    $sortOrder++;
                                }
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                            // Continue with other images even if one fails
                        }
                    }
                }
            }

            DB::commit();
            
            Toastr::success(translate('messages.product_added'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            DB::rollBack();
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            DB::rollBack();
            Toastr::error(translate('messages.failed_to_add_product') . ': ' . $e->getMessage());
            \Log::error('Product creation error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->except(['images'])
            ]);
            return back()->withInput();
        }
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit($id)
    {
        $product = Product::with(['category', 'brand', 'variants', 'images'])->findOrFail($id);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.edit', compact('product', 'categories', 'brands'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, $id)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:15360',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 15MB!'),
            ]);

            $product = Product::findOrFail($id);
            $product->name = $request->name;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Handle new images
            if ($request->hasFile('images')) {
                $existingImages = ProductImage::where('product_id', $product->id)->count();
                $sortOrder = $existingImages;
                
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $variant = $product->variants->first();
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant ? $variant->id : null;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_updated'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_product') . ': ' . $e->getMessage());
            \Log::error('Product update error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy($id)
    {
        try {
            $product = Product::findOrFail($id);
            
            // Delete product images
            foreach ($product->images as $image) {
                if ($image->image_url) {
                    try {
                        $storageType = Helpers::getDisk();
                        if ($storageType === 's3') {
                            \Storage::disk('s3')->delete('product/' . $image->image_url);
                        } else {
                            \Storage::disk('public')->delete('product/' . $image->image_url);
                        }
                    } catch (\Exception $e) {
                        \Log::warning('Failed to delete product image: ' . $e->getMessage());
                    }
                }
                $image->delete();
            }
            
            // Delete variants (this will cascade delete related data)
            $product->variants()->delete();
            
            $product->delete();
            
            Toastr::success(translate('messages.product_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_product') . ': ' . $e->getMessage());
            \Log::error('Product deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product status
     */
    public function statusToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $product->status = $request->status;
            $product->save();
            Toastr::success(translate('messages.product_status_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_status') . ': ' . $e->getMessage());
            \Log::error('Product status update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product flag (trending, latest, express_30)
     */
    public function flagToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $flag = $request->flag; // is_trending, is_latest, is_express_30
            
            if (!in_array($flag, ['is_trending', 'is_latest', 'is_express_30'])) {
                Toastr::error(translate('messages.Invalid flag!'));
                return back();
            }
            
            $product->$flag = $request->value;
            $product->save();
            
            Toastr::success(translate('messages.product_flag_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_flag') . ': ' . $e->getMessage());
            \Log::error('Product flag update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Delete product image
     */
    public function deleteImage($id)
    {
        try {
            $image = ProductImage::findOrFail($id);
            
            // Delete file
            if ($image->image_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('product/' . $image->image_url);
                    } else {
                        \Storage::disk('public')->delete('product/' . $image->image_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete product image file: ' . $e->getMessage());
                }
            }
            
            $image->delete();
            
            Toastr::success(translate('messages.image_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_image') . ': ' . $e->getMessage());
            \Log::error('Image deletion error: ' . $e->getMessage());
            return back();
        }
    }
}


```

```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Product;
use App\Models\Category;
use App\Models\Brand;
use App\Models\ProductVariant;
use App\Models\ProductImage;
use App\Models\State;
use App\Models\City;
use App\Models\FulfillmentCenter;
use App\Models\WarehouseProduct;
use Illuminate\Http\Request;
use App\CentralLogics\ToastrWrapper as Toastr;
use App\CentralLogics\Helpers;
use Illuminate\Support\Str;
use Illuminate\Support\Facades\DB;

class ProductController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index(Request $request)
    {
        $query = Product::with(['category', 'brand', 'variants', 'images']);
        
        // Search
        $search = trim($request->input('search', ''));
        if ($search !== '') {
            $query->where(function ($q) use ($search) {
                $q->where('name', 'like', "%{$search}%")
                    ->orWhere('description', 'like', "%{$search}%");
            });
        }
        
        // Filter by status
        $status = $request->input('status');
        if ($status !== null && $status !== '') {
            $query->where('status', $status);
        }
        
        // Filter by category
        $categoryId = $request->input('category_id');
        if (!empty($categoryId) && is_numeric($categoryId) && (int)$categoryId > 0) {
            $query->where('category_id', (int)$categoryId);
        }
        
        // Filter by trending
        $isTrending = $request->input('is_trending');
        if ($isTrending !== null && $isTrending !== '') {
            $query->where('is_trending', (bool)$isTrending);
        }
        
        // Filter by latest
        $isLatest = $request->input('is_latest');
        if ($isLatest !== null && $isLatest !== '') {
            $query->where('is_latest', (bool)$isLatest);
        }
        
        // Filter by express_30
        $isExpress30 = $request->input('is_express_30');
        if ($isExpress30 !== null && $isExpress30 !== '') {
            $query->where('is_express_30', (bool)$isExpress30);
        }
        
        $products = $query->orderBy('created_at', 'desc')->paginate(25);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        
        return view('admin-views.products.index', compact('products', 'categories'));
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        $states = State::orderBy('name', 'asc')->get();
        return view('admin-views.products.create', compact('categories', 'brands', 'states'));
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        DB::beginTransaction();
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Variant fields
                'variant_sku' => 'required|string|max:255',
                'variant_price' => 'required|numeric|min:0',
                'variant_sale_price' => 'nullable|numeric|min:0',
                'variant_status' => 'required|in:active,inactive',
                // Location & Fulfillment Center
                'state_id' => 'required|exists:states,id',
                'city_id' => 'required|exists:cities,id',
                'fulfillment_center_id' => 'required|exists:fulfillment_centers,id',
                'stock_qty' => 'required|integer|min:0',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:15360',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'variant_sku.required' => translate('messages.SKU is required!'),
                'variant_price.required' => translate('messages.Price is required!'),
                'variant_price.numeric' => translate('messages.Price must be a number!'),
                'variant_price.min' => translate('messages.Price must be greater than or equal to 0!'),
                'variant_sale_price.numeric' => translate('messages.Sale price must be a number!'),
                'variant_sale_price.min' => translate('messages.Sale price must be greater than or equal to 0!'),
                'state_id.required' => translate('messages.State is required!'),
                'state_id.exists' => translate('messages.State not found!'),
                'city_id.required' => translate('messages.City is required!'),
                'city_id.exists' => translate('messages.City not found!'),
                'fulfillment_center_id.required' => translate('messages.Fulfillment center is required!'),
                'fulfillment_center_id.exists' => translate('messages.Fulfillment center not found!'),
                'stock_qty.required' => translate('messages.Stock quantity is required!'),
                'stock_qty.integer' => translate('messages.Stock quantity must be a number!'),
                'stock_qty.min' => translate('messages.Stock quantity must be greater than or equal to 0!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 15MB!'),
            ]);

            // Check if SKU already exists
            if (ProductVariant::where('sku', $request->variant_sku)->exists()) {
                DB::rollBack();
                Toastr::error(translate('messages.SKU already exists!'));
                return back()->withInput();
            }

            // Generate unique slug
            $baseSlug = Str::slug($request->name);
            $slug = $baseSlug;
            $counter = 1;
            while (Product::where('slug', $slug)->exists()) {
                $slug = $baseSlug . '-' . uniqid() . '-' . $counter;
                $counter++;
            }

            // Create product
            $product = new Product();
            $product->name = $request->name;
            $product->slug = $slug;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            
            if (!$product->save()) {
                throw new \Exception('Failed to save product');
            }

            // Create default variant
            $variant = new ProductVariant();
            $variant->product_id = $product->id;
            $variant->sku = $request->variant_sku;
            $variant->price = $request->variant_price;
            $variant->sale_price = $request->variant_sale_price ?? null;
            $variant->status = $request->variant_status;
            
            if (!$variant->save()) {
                throw new \Exception('Failed to save product variant');
            }

            // Create warehouse product mapping
            if ($request->fulfillment_center_id && $request->stock_qty !== null) {
                $warehouseProduct = new WarehouseProduct();
                $warehouseProduct->warehouse_id = $request->fulfillment_center_id;
                $warehouseProduct->product_variant_id = $variant->id;
                $warehouseProduct->stock_qty = $request->stock_qty ?? 0;
                $warehouseProduct->reserved_qty = 0;
                
                if (!$warehouseProduct->save()) {
                    throw new \Exception('Failed to save warehouse product mapping');
                }
            }

            // Handle images
            if ($request->hasFile('images')) {
                $sortOrder = 0;
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant->id;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = ($sortOrder === 0) ? true : false;
                                $productImage->sort_order = $sortOrder;
                                
                                if (!$productImage->save()) {
                                    \Log::warning('Failed to save product image: ' . $imageName);
                                } else {
                                    $sortOrder++;
                                }
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                            // Continue with other images even if one fails
                        }
                    }
                }
            }

            DB::commit();
            
            Toastr::success(translate('messages.product_added'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            DB::rollBack();
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            DB::rollBack();
            Toastr::error(translate('messages.failed_to_add_product') . ': ' . $e->getMessage());
            \Log::error('Product creation error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->except(['images'])
            ]);
            return back()->withInput();
        }
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit($id)
    {
        $product = Product::with(['category', 'brand', 'variants', 'images'])->findOrFail($id);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        return view('admin-views.products.edit', compact('product', 'categories', 'brands'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, $id)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:15360',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 15MB!'),
            ]);

            $product = Product::findOrFail($id);
            $product->name = $request->name;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Handle new images
            if ($request->hasFile('images')) {
                $existingImages = ProductImage::where('product_id', $product->id)->count();
                $sortOrder = $existingImages;
                
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $variant = $product->variants->first();
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant ? $variant->id : null;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_updated'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_product') . ': ' . $e->getMessage());
            \Log::error('Product update error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy($id)
    {
        try {
            $product = Product::findOrFail($id);
            
            // Delete product images
            foreach ($product->images as $image) {
                if ($image->image_url) {
                    try {
                        $storageType = Helpers::getDisk();
                        if ($storageType === 's3') {
                            \Storage::disk('s3')->delete('product/' . $image->image_url);
                        } else {
                            \Storage::disk('public')->delete('product/' . $image->image_url);
                        }
                    } catch (\Exception $e) {
                        \Log::warning('Failed to delete product image: ' . $e->getMessage());
                    }
                }
                $image->delete();
            }
            
            // Delete variants (this will cascade delete related data)
            $product->variants()->delete();
            
            $product->delete();
            
            Toastr::success(translate('messages.product_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_product') . ': ' . $e->getMessage());
            \Log::error('Product deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product status
     */
    public function statusToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $product->status = $request->status;
            $product->save();
            Toastr::success(translate('messages.product_status_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_status') . ': ' . $e->getMessage());
            \Log::error('Product status update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product flag (trending, latest, express_30)
     */
    public function flagToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $flag = $request->flag; // is_trending, is_latest, is_express_30
            
            if (!in_array($flag, ['is_trending', 'is_latest', 'is_express_30'])) {
                Toastr::error(translate('messages.Invalid flag!'));
                return back();
            }
            
            $product->$flag = $request->value;
            $product->save();
            
            Toastr::success(translate('messages.product_flag_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_flag') . ': ' . $e->getMessage());
            \Log::error('Product flag update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Delete product image
     */
    public function deleteImage($id)
    {
        try {
            $image = ProductImage::findOrFail($id);
            
            // Delete file
            if ($image->image_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('product/' . $image->image_url);
                    } else {
                        \Storage::disk('public')->delete('product/' . $image->image_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete product image file: ' . $e->getMessage());
                }
            }
            
            $image->delete();
            
            Toastr::success(translate('messages.image_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_image') . ': ' . $e->getMessage());
            \Log::error('Image deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Get cities by state (AJAX)
     */
    public function getCities(Request $request)
    {
        $stateId = $request->input('state_id');
        
        if (!$stateId) {
            return response()->json(['cities' => []]);
        }

        $cities = City::where('state_id', $stateId)
            ->orderBy('name', 'asc')
            ->get(['id', 'name']);

        return response()->json(['cities' => $cities]);
    }

    /**
     * Get fulfillment centers by city (AJAX)
     */
    public function getFulfillmentCenters(Request $request)
    {
        $cityId = $request->input('city_id');
        
        if (!$cityId) {
            return response()->json(['fulfillment_centers' => []]);
        }

        $fulfillmentCenters = FulfillmentCenter::where('city_id', $cityId)
            ->where('status', 'active')
            ->orderBy('name', 'asc')
            ->get(['id', 'name']);

        return response()->json(['fulfillment_centers' => $fulfillmentCenters]);
    }
}


```


Adding AJAX routes and JavaScript for dependent dropdowns:


```php
<?php

use Illuminate\Support\Facades\Route;
use App\Http\Controllers\Admin\DashboardController;

Route::get('/', function () {
    return redirect()->route('login');
});

// Login Routes
Route::get('login', [App\Http\Controllers\LoginController::class, 'login'])->name('login');
Route::post('login', [App\Http\Controllers\LoginController::class, 'submit'])->name('login.post');
Route::post('logout', [App\Http\Controllers\LoginController::class, 'logout'])->name('logout');
Route::get('logout', [App\Http\Controllers\LoginController::class, 'logout'])->name('logout'); // Fallback for GET requests
Route::get('reload-captcha', [App\Http\Controllers\LoginController::class, 'reloadCaptcha'])->name('reload-captcha');
Route::get('reset-password', [App\Http\Controllers\LoginController::class, 'reset_password'])->name('reset-password');

// Admin routes - protected by auth middleware
Route::group(['prefix' => 'admin', 'as' => 'admin.', 'middleware' => ['auth']], function () {
    Route::get('/', [App\Http\Controllers\Admin\DashboardController::class, 'dashboard'])->name('dashboard');
    Route::get('dashboard', [App\Http\Controllers\Admin\DashboardController::class, 'dashboard'])->name('dashboard');
    
    // Dashboard stats routes
    Route::group(['prefix' => 'dashboard-stats', 'as' => 'dashboard-stats.'], function () {
        Route::post('order', [App\Http\Controllers\Admin\DashboardController::class, 'order'])->name('order');
        Route::post('zone', [App\Http\Controllers\Admin\DashboardController::class, 'zone'])->name('zone');
        Route::post('user-overview', [App\Http\Controllers\Admin\DashboardController::class, 'user_overview'])->name('user-overview');
        Route::post('commission-overview', [App\Http\Controllers\Admin\DashboardController::class, 'commission_overview'])->name('commission-overview');
    });
    
    // Logistics Routes
    Route::group(['prefix' => 'logistics', 'as' => 'logistics.'], function () {
        Route::get('warehouse', [App\Http\Controllers\Admin\Logistics\WarehouseController::class, 'index'])->name('warehouse.index');
        Route::get('warehouse/create', [App\Http\Controllers\Admin\Logistics\WarehouseController::class, 'create'])->name('warehouse.create');
        Route::post('warehouse', [App\Http\Controllers\Admin\Logistics\WarehouseController::class, 'store'])->name('warehouse.store');
        Route::get('warehouse/{id}/edit', [App\Http\Controllers\Admin\Logistics\WarehouseController::class, 'edit'])->name('warehouse.edit');
        Route::put('warehouse/{id}', [App\Http\Controllers\Admin\Logistics\WarehouseController::class, 'update'])->name('warehouse.update');
        Route::delete('warehouse/{id}', [App\Http\Controllers\Admin\Logistics\WarehouseController::class, 'destroy'])->name('warehouse.destroy');
        Route::post('warehouse/status', [App\Http\Controllers\Admin\Logistics\WarehouseController::class, 'status'])->name('warehouse.status');
        
        Route::get('miniwarehouse', [App\Http\Controllers\Admin\Logistics\MiniwarehouseController::class, 'index'])->name('miniwarehouse.index');
        Route::get('miniwarehouse/create', [App\Http\Controllers\Admin\Logistics\MiniwarehouseController::class, 'create'])->name('miniwarehouse.create');
        Route::post('miniwarehouse', [App\Http\Controllers\Admin\Logistics\MiniwarehouseController::class, 'store'])->name('miniwarehouse.store');
        Route::get('miniwarehouse/{id}/edit', [App\Http\Controllers\Admin\Logistics\MiniwarehouseController::class, 'edit'])->name('miniwarehouse.edit');
        Route::put('miniwarehouse/{id}', [App\Http\Controllers\Admin\Logistics\MiniwarehouseController::class, 'update'])->name('miniwarehouse.update');
        Route::delete('miniwarehouse/{id}', [App\Http\Controllers\Admin\Logistics\MiniwarehouseController::class, 'destroy'])->name('miniwarehouse.destroy');
        Route::post('miniwarehouse/status', [App\Http\Controllers\Admin\Logistics\MiniwarehouseController::class, 'status'])->name('miniwarehouse.status');
        
        Route::get('lm-center', [App\Http\Controllers\Admin\Logistics\LmCenterController::class, 'index'])->name('lm-center.index');
        Route::get('lm-center/create', [App\Http\Controllers\Admin\Logistics\LmCenterController::class, 'create'])->name('lm-center.create');
        Route::post('lm-center', [App\Http\Controllers\Admin\Logistics\LmCenterController::class, 'store'])->name('lm-center.store');
        Route::get('lm-center/{id}/edit', [App\Http\Controllers\Admin\Logistics\LmCenterController::class, 'edit'])->name('lm-center.edit');
        Route::put('lm-center/{id}', [App\Http\Controllers\Admin\Logistics\LmCenterController::class, 'update'])->name('lm-center.update');
        Route::delete('lm-center/{id}', [App\Http\Controllers\Admin\Logistics\LmCenterController::class, 'destroy'])->name('lm-center.destroy');
        Route::post('lm-center/status', [App\Http\Controllers\Admin\Logistics\LmCenterController::class, 'status'])->name('lm-center.status');
        Route::post('lm-center/verify-document', [App\Http\Controllers\Admin\Logistics\LmCenterController::class, 'verifyDocument'])->name('lm-center.verify-document');
        
        Route::get('fm-rt-center', [App\Http\Controllers\Admin\Logistics\FmRtCenterController::class, 'index'])->name('fm-rt-center.index');
        Route::get('fm-rt-center/create', [App\Http\Controllers\Admin\Logistics\FmRtCenterController::class, 'create'])->name('fm-rt-center.create');
        Route::post('fm-rt-center', [App\Http\Controllers\Admin\Logistics\FmRtCenterController::class, 'store'])->name('fm-rt-center.store');
        Route::get('fm-rt-center/{id}/edit', [App\Http\Controllers\Admin\Logistics\FmRtCenterController::class, 'edit'])->name('fm-rt-center.edit');
        Route::put('fm-rt-center/{id}', [App\Http\Controllers\Admin\Logistics\FmRtCenterController::class, 'update'])->name('fm-rt-center.update');
        Route::delete('fm-rt-center/{id}', [App\Http\Controllers\Admin\Logistics\FmRtCenterController::class, 'destroy'])->name('fm-rt-center.destroy');
        Route::post('fm-rt-center/status', [App\Http\Controllers\Admin\Logistics\FmRtCenterController::class, 'status'])->name('fm-rt-center.status');
        
        Route::get('pending-mapping', [App\Http\Controllers\Admin\Logistics\PendingMappingController::class, 'index'])->name('pending-mapping.index');
    });
    
    // Banner Routes
    Route::resource('banner', App\Http\Controllers\Admin\BannerController::class);
    Route::post('banner/status', [App\Http\Controllers\Admin\BannerController::class, 'statusToggle'])->name('banner.status');
    
    // Category Routes
    Route::resource('categories', App\Http\Controllers\Admin\CategoryController::class);
    Route::post('categories/status', [App\Http\Controllers\Admin\CategoryController::class, 'statusToggle'])->name('categories.status');
    
    // Product Routes
    Route::resource('products', App\Http\Controllers\Admin\ProductController::class);
    Route::post('products/status', [App\Http\Controllers\Admin\ProductController::class, 'statusToggle'])->name('products.status');
    Route::post('products/flag', [App\Http\Controllers\Admin\ProductController::class, 'flagToggle'])->name('products.flag');
    Route::delete('products/image/{id}', [App\Http\Controllers\Admin\ProductController::class, 'deleteImage'])->name('products.delete-image');
    Route::get('get-cities', [App\Http\Controllers\Admin\ProductController::class, 'getCities'])->name('get-cities');
    Route::get('get-fulfillment-centers', [App\Http\Controllers\Admin\ProductController::class, 'getFulfillmentCenters'])->name('get-fulfillment-centers');
});

```

```blade
    // Dependent dropdowns for State, City, Fulfillment Center
    $(document).ready(function() {
        // State change - load cities
        $('#state_id').on('change', function() {
            var stateId = $(this).val();
            var citySelect = $('#city_id');
            var fulfillmentCenterSelect = $('#fulfillment_center_id');
            
            // Reset dependent dropdowns
            citySelect.html('<option value="">{{ translate('messages.select_city') }}</option>').prop('disabled', true);
            fulfillmentCenterSelect.html('<option value="">{{ translate('messages.select_fulfillment_center') }}</option>').prop('disabled', true);
            
            if (stateId) {
                $.ajax({
                    url: '{{ route('admin.get-cities') }}',
                    type: 'GET',
                    data: { state_id: stateId },
                    success: function(response) {
                        if (response.cities && response.cities.length > 0) {
                            citySelect.prop('disabled', false);
                            response.cities.forEach(function(city) {
                                citySelect.append('<option value="' + city.id + '">' + city.name + '</option>');
                            });
                        } else {
                            citySelect.append('<option value="">{{ translate('messages.no_cities_found') }}</option>');
                        }
                    },
                    error: function() {
                        alert('{{ translate('messages.failed_to_load_cities') }}');
                    }
                });
            }
        });
        
        // City change - load fulfillment centers
        $('#city_id').on('change', function() {
            var cityId = $(this).val();
            var fulfillmentCenterSelect = $('#fulfillment_center_id');
            
            // Reset fulfillment center dropdown
            fulfillmentCenterSelect.html('<option value="">{{ translate('messages.select_fulfillment_center') }}</option>').prop('disabled', true);
            
            if (cityId) {
                $.ajax({
                    url: '{{ route('admin.get-fulfillment-centers') }}',
                    type: 'GET',
                    data: { city_id: cityId },
                    success: function(response) {
                        if (response.fulfillment_centers && response.fulfillment_centers.length > 0) {
                            fulfillmentCenterSelect.prop('disabled', false);
                            response.fulfillment_centers.forEach(function(fc) {
                                fulfillmentCenterSelect.append('<option value="' + fc.id + '">' + fc.name + '</option>');
                            });
                        } else {
                            fulfillmentCenterSelect.append('<option value="">{{ translate('messages.no_fulfillment_centers_found') }}</option>');
                        }
                    },
                    error: function() {
                        alert('{{ translate('messages.failed_to_load_fulfillment_centers') }}');
                    }
                });
            }
        });
        
        // Restore old values if form was submitted with errors
        @if(old('state_id'))
            $('#state_id').trigger('change');
            setTimeout(function() {
                $('#city_id').val('{{ old('city_id') }}').trigger('change');
                setTimeout(function() {
                    $('#fulfillment_center_id').val('{{ old('fulfillment_center_id') }}');
                }, 500);
            }, 500);
        @endif
    });

    // Form validation
    document.addEventListener('DOMContentLoaded', function() {
        var form = document.getElementById('product-form');
        if (!form) return;
```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.add_product'))

@push('css_or_js')
<style>
    .card {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075), 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        border: 1px solid rgba(0, 0, 0, 0.125);
        border-radius: 0.5rem;
    }
    .card-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .card-footer {
        background-color: #f8f9fa;
        border-top: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .image-preview-container {
        margin-top: 15px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    .image-preview-item {
        position: relative;
        width: 120px;
        height: 120px;
    }
    .image-preview-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 8px;
        border: 2px solid #e4e6ef;
    }
    .image-preview-item .remove-image {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #dc3545;
        color: white;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 14px;
    }
    
    /* Validation styles */
    .form-control.is-invalid {
        border-color: #dc3545;
        padding-right: calc(1.5em + 0.75rem);
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath d='m5.8 3.6.4.4L6 4.4l-.2-.4-.4-.4zm0 4.8L6 8.8l.2.4.4.4-.4-.4z'/%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right calc(0.375em + 0.1875rem) center;
        background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
    }
    
    .validation-error {
        display: block;
        margin-top: 0.25rem;
        font-size: 0.875rem;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-add-circle"></i>
                </span>
                <span>
                    {{ translate('messages.add_product') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">{{ translate('messages.add_product') }}</h5>
                    </div>
                    <form action="{{ route('admin.products.store') }}" method="post" enctype="multipart/form-data" id="product-form">
                        @csrf
                        <div class="card-body">
                            <div class="row">
                                <!-- Basic Info -->
                                <div class="col-md-12">
                                    <h5 class="mb-3">Basic Information</h5>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="name">Product Name <span class="text-danger">*</span></label>
                                        <input type="text" name="name" id="name" class="form-control" placeholder="Enter product name" value="{{ old('name') }}" required maxlength="255">
                                        @error('name')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="category_id">Category <span class="text-danger">*</span></label>
                                        <select name="category_id" id="category_id" class="form-control" required>
                                            <option value="">Select Category</option>
                                            @foreach($categories as $category)
                                                <option value="{{ $category->id }}" {{ old('category_id') == $category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('category_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="brand_id">Brand</label>
                                        <select name="brand_id" id="brand_id" class="form-control">
                                            <option value="">Select Brand</option>
                                            @foreach($brands as $brand)
                                                <option value="{{ $brand->id }}" {{ old('brand_id') == $brand->id ? 'selected' : '' }}>{{ $brand->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('brand_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="status">Status <span class="text-danger">*</span></label>
                                        <select name="status" id="status" class="form-control" required>
                                            <option value="active" {{ old('status', 'active') == 'active' ? 'selected' : '' }}>Active</option>
                                            <option value="inactive" {{ old('status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                        </select>
                                        @error('status')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="short_description">Short Description</label>
                                        <textarea name="short_description" id="short_description" class="form-control" rows="2" placeholder="Enter short description (max 500 characters)" maxlength="500">{{ old('short_description') }}</textarea>
                                        @error('short_description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="description">Description</label>
                                        <textarea name="description" id="description" class="form-control" rows="4" placeholder="Enter product description">{{ old('description') }}</textarea>
                                        @error('description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Location & Fulfillment Center -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Location & Fulfillment Center</h5>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="state_id">State <span class="text-danger">*</span></label>
                                        <select name="state_id" id="state_id" class="form-control" required>
                                            <option value="">{{ translate('messages.select_state') }}</option>
                                            @foreach($states as $state)
                                                <option value="{{ $state->id }}" {{ old('state_id') == $state->id ? 'selected' : '' }}>{{ $state->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('state_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="city_id">City <span class="text-danger">*</span></label>
                                        <select name="city_id" id="city_id" class="form-control" required disabled>
                                            <option value="">{{ translate('messages.select_city') }}</option>
                                        </select>
                                        @error('city_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="fulfillment_center_id">Fulfillment Center <span class="text-danger">*</span></label>
                                        <select name="fulfillment_center_id" id="fulfillment_center_id" class="form-control" required disabled>
                                            <option value="">{{ translate('messages.select_fulfillment_center') }}</option>
                                        </select>
                                        @error('fulfillment_center_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="stock_qty">{{ translate('messages.stock_quantity') }} <span class="text-danger">*</span></label>
                                        <input type="number" name="stock_qty" id="stock_qty" class="form-control" placeholder="0" value="{{ old('stock_qty', 0) }}" min="0" required>
                                        @error('stock_qty')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Pricing -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Pricing (Default Variant)</h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_sku">SKU <span class="text-danger">*</span></label>
                                        <input type="text" name="variant_sku" id="variant_sku" class="form-control" placeholder="Enter SKU" value="{{ old('variant_sku') }}" required maxlength="255">
                                        @error('variant_sku')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_price">Price <span class="text-danger">*</span></label>
                                        <input type="number" name="variant_price" id="variant_price" class="form-control" placeholder="0.00" value="{{ old('variant_price') }}" step="0.01" min="0" required>
                                        @error('variant_price')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_sale_price">Sale Price</label>
                                        <input type="number" name="variant_sale_price" id="variant_sale_price" class="form-control" placeholder="0.00" value="{{ old('variant_sale_price') }}" step="0.01" min="0">
                                        @error('variant_sale_price')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_status">Variant Status <span class="text-danger">*</span></label>
                                        <select name="variant_status" id="variant_status" class="form-control" required>
                                            <option value="active" {{ old('variant_status', 'active') == 'active' ? 'selected' : '' }}>Active</option>
                                            <option value="inactive" {{ old('variant_status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                        </select>
                                        @error('variant_status')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Images -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Images</h5>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="images">Images</label>
                                        <input type="file" name="images[]" id="images" class="form-control" accept="image/*" multiple onchange="previewImages(this)">
                                        <small class="text-muted">Accepted formats: JPG, PNG, GIF, WEBP (Max: 15MB each). You can select multiple images.</small>
                                        <div class="image-preview-container" id="image-preview-container"></div>
                                        @error('images.*')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Flags -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Flags</h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Trending</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_trending" id="is_trending" value="1" {{ old('is_trending') ? 'checked' : '' }} switch="bool">
                                            <label for="is_trending" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls trending_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Latest</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_latest" id="is_latest" value="1" {{ old('is_latest') ? 'checked' : '' }} switch="bool">
                                            <label for="is_latest" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls latest_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Express-30</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_express_30" id="is_express_30" value="1" {{ old('is_express_30') ? 'checked' : '' }} switch="bool">
                                            <label for="is_express_30" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls /api/express-30/products</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="btn--container justify-content-end">
                                <a href="{{ route('admin.products.index') }}" class="btn btn--reset">{{ translate('messages.cancel') }}</a>
                                <button type="submit" class="btn btn--primary">{{ translate('messages.submit') }}</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    var imageFiles = [];
    var maxFileSize = 15 * 1024 * 1024; // 15MB in bytes
    
    function previewImages(input) {
        var container = document.getElementById('image-preview-container');
        container.innerHTML = '';
        imageFiles = [];
        
        if (input.files && input.files.length > 0) {
            var validFiles = [];
            var hasError = false;
            
            for (var i = 0; i < input.files.length; i++) {
                var file = input.files[i];
                
                // Check file size
                if (file.size > maxFileSize) {
                    alert('File "' + file.name + '" exceeds the maximum file size of 15MB. Please choose a smaller file.');
                    hasError = true;
                    continue;
                }
                
                validFiles.push(file);
                imageFiles.push(file);
                
                var reader = new FileReader();
                reader.onload = function(e) {
                    var div = document.createElement('div');
                    div.className = 'image-preview-item';
                    div.innerHTML = '<img src="' + e.target.result + '" alt="Preview">';
                    container.appendChild(div);
                };
                reader.readAsDataURL(file);
            }
            
            // Reset input if there were invalid files
            if (hasError) {
                var dataTransfer = new DataTransfer();
                validFiles.forEach(function(file) {
                    dataTransfer.items.add(file);
                });
                input.files = dataTransfer.files;
            }
        }
    }

    // Form validation
    document.addEventListener('DOMContentLoaded', function() {
        var form = document.getElementById('product-form');
        if (!form) return;

        // Helper function to show error message
        function showError(fieldId, message) {
            var field = document.getElementById(fieldId);
            if (!field) return;

            // Remove existing error message
            var existingError = field.parentElement.querySelector('.validation-error');
            if (existingError) {
                existingError.remove();
            }

            // Add error class to field
            field.classList.add('is-invalid');

            // Create and show error message
            var errorDiv = document.createElement('div');
            errorDiv.className = 'validation-error text-danger mt-1';
            errorDiv.style.fontSize = '0.875rem';
            errorDiv.textContent = message;
            field.parentElement.appendChild(errorDiv);
        }

        // Helper function to clear error
        function clearError(fieldId) {
            var field = document.getElementById(fieldId);
            if (!field) return;

            field.classList.remove('is-invalid');
            var existingError = field.parentElement.querySelector('.validation-error');
            if (existingError) {
                existingError.remove();
            }
        }

        // Real-time validation on blur
        var requiredFields = ['name', 'category_id', 'status', 'state_id', 'city_id', 'fulfillment_center_id', 'stock_qty', 'variant_sku', 'variant_price', 'variant_status'];
        requiredFields.forEach(function(fieldId) {
            var field = document.getElementById(fieldId);
            if (field) {
                field.addEventListener('blur', function() {
                    validateField(fieldId);
                });
                field.addEventListener('input', function() {
                    if (field.classList.contains('is-invalid')) {
                        validateField(fieldId);
                    }
                });
            }
        });

        // Validate individual field
        function validateField(fieldId) {
            var field = document.getElementById(fieldId);
            if (!field) return true;

            var value = field.value.trim();
            var isValid = true;
            var errorMessage = '';

            switch(fieldId) {
                case 'name':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Product name is required';
                    } else if (value.length > 255) {
                        isValid = false;
                        errorMessage = 'Product name must not exceed 255 characters';
                    }
                    break;
                case 'category_id':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Category is required';
                    }
                    break;
                case 'status':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Status is required';
                    }
                    break;
                case 'variant_sku':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'SKU is required';
                    } else if (value.length > 255) {
                        isValid = false;
                        errorMessage = 'SKU must not exceed 255 characters';
                    }
                    break;
                case 'variant_price':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Price is required';
                    } else {
                        var price = parseFloat(value);
                        if (isNaN(price)) {
                            isValid = false;
                            errorMessage = 'Price must be a valid number';
                        } else if (price < 0) {
                            isValid = false;
                            errorMessage = 'Price must be greater than or equal to 0';
                        }
                    }
                    break;
                case 'variant_status':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Variant status is required';
                    }
                    break;
            }

            if (isValid) {
                clearError(fieldId);
            } else {
                showError(fieldId, errorMessage);
            }

            return isValid;
        }

        // Validate sale price
        var salePriceField = document.getElementById('variant_sale_price');
        if (salePriceField) {
            salePriceField.addEventListener('blur', function() {
                var salePrice = salePriceField.value.trim();
                if (salePrice) {
                    var salePriceNum = parseFloat(salePrice);
                    var priceField = document.getElementById('variant_price');
                    var price = priceField ? parseFloat(priceField.value) : 0;

                    if (isNaN(salePriceNum)) {
                        showError('variant_sale_price', 'Sale price must be a valid number');
                    } else if (salePriceNum < 0) {
                        showError('variant_sale_price', 'Sale price must be greater than or equal to 0');
                    } else if (price > 0 && salePriceNum > price) {
                        showError('variant_sale_price', 'Sale price must be less than or equal to regular price');
                    } else {
                        clearError('variant_sale_price');
                    }
                } else {
                    clearError('variant_sale_price');
                }
            });
        }

        // Validate short description length
        var shortDescField = document.getElementById('short_description');
        if (shortDescField) {
            shortDescField.addEventListener('input', function() {
                if (this.value.length > 500) {
                    showError('short_description', 'Short description must not exceed 500 characters');
                } else {
                    clearError('short_description');
                }
            });
        }

        // Validate images
        var imagesField = document.getElementById('images');
        if (imagesField) {
            imagesField.addEventListener('change', function() {
                if (this.files && this.files.length > 0) {
                    var allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
                    var hasInvalidFile = false;

                    for (var i = 0; i < this.files.length; i++) {
                        var file = this.files[i];
                        if (!allowedTypes.includes(file.type)) {
                            hasInvalidFile = true;
                            showError('images', 'Only JPG, PNG, GIF, and WEBP image formats are allowed');
                            break;
                        }
                    }

                    if (!hasInvalidFile) {
                        clearError('images');
                    }
                }
            });
        }

        // Form submit validation
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            var isValid = true;
            var firstErrorField = null;

            // Validate all required fields
            requiredFields.forEach(function(fieldId) {
                if (!validateField(fieldId)) {
                    isValid = false;
                    if (!firstErrorField) {
                        firstErrorField = document.getElementById(fieldId);
                    }
                }
            });

            // Validate sale price if provided
            if (salePriceField && salePriceField.value.trim()) {
                var salePrice = parseFloat(salePriceField.value);
                var price = parseFloat(document.getElementById('variant_price').value);
                
                if (isNaN(salePrice) || salePrice < 0 || (price > 0 && salePrice > price)) {
                    isValid = false;
                    if (!firstErrorField) {
                        firstErrorField = salePriceField;
                    }
                    if (isNaN(salePrice) || salePrice < 0) {
                        showError('variant_sale_price', 'Sale price must be a valid number greater than or equal to 0');
                    } else {
                        showError('variant_sale_price', 'Sale price must be less than or equal to regular price');
                    }
                }
            }

            // Validate short description length
            if (shortDescField && shortDescField.value.length > 500) {
                isValid = false;
                if (!firstErrorField) {
                    firstErrorField = shortDescField;
                }
                showError('short_description', 'Short description must not exceed 500 characters');
            }

            // Validate images if provided
            if (imagesField && imagesField.files && imagesField.files.length > 0) {
                var allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
                for (var i = 0; i < imagesField.files.length; i++) {
                    var file = imagesField.files[i];
                    if (!allowedTypes.includes(file.type)) {
                        isValid = false;
                        if (!firstErrorField) {
                            firstErrorField = imagesField;
                        }
                        showError('images', 'Only JPG, PNG, GIF, and WEBP image formats are allowed');
                        break;
                    }
                    if (file.size > maxFileSize) {
                        isValid = false;
                        if (!firstErrorField) {
                            firstErrorField = imagesField;
                        }
                        showError('images', 'File "' + file.name + '" exceeds the maximum file size of 15MB');
                        break;
                    }
                }
            }

            if (!isValid) {
                // Scroll to first error field
                if (firstErrorField) {
                    firstErrorField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    firstErrorField.focus();
                }
                return false;
            }

            // If validation passes, submit the form
            form.submit();
        });
    });
</script>
@endpush


```

```blade
@extends('layouts.admin.app')

@section('title', translate('messages.add_product'))

@push('css_or_js')
<style>
    .card {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075), 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        border: 1px solid rgba(0, 0, 0, 0.125);
        border-radius: 0.5rem;
    }
    .card-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .card-footer {
        background-color: #f8f9fa;
        border-top: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .image-preview-container {
        margin-top: 15px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    .image-preview-item {
        position: relative;
        width: 120px;
        height: 120px;
    }
    .image-preview-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 8px;
        border: 2px solid #e4e6ef;
    }
    .image-preview-item .remove-image {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #dc3545;
        color: white;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 14px;
    }
    
    /* Validation styles */
    .form-control.is-invalid {
        border-color: #dc3545;
        padding-right: calc(1.5em + 0.75rem);
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath d='m5.8 3.6.4.4L6 4.4l-.2-.4-.4-.4zm0 4.8L6 8.8l.2.4.4.4-.4-.4z'/%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right calc(0.375em + 0.1875rem) center;
        background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
    }
    
    .validation-error {
        display: block;
        margin-top: 0.25rem;
        font-size: 0.875rem;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-add-circle"></i>
                </span>
                <span>
                    {{ translate('messages.add_product') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">{{ translate('messages.add_product') }}</h5>
                    </div>
                    <form action="{{ route('admin.products.store') }}" method="post" enctype="multipart/form-data" id="product-form">
                        @csrf
                        <div class="card-body">
                            <div class="row">
                                <!-- Basic Info -->
                                <div class="col-md-12">
                                    <h5 class="mb-3">Basic Information</h5>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="name">Product Name <span class="text-danger">*</span></label>
                                        <input type="text" name="name" id="name" class="form-control" placeholder="Enter product name" value="{{ old('name') }}" required maxlength="255">
                                        @error('name')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="category_id">Category <span class="text-danger">*</span></label>
                                        <select name="category_id" id="category_id" class="form-control" required>
                                            <option value="">Select Category</option>
                                            @foreach($categories as $category)
                                                <option value="{{ $category->id }}" {{ old('category_id') == $category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('category_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="brand_id">Brand</label>
                                        <select name="brand_id" id="brand_id" class="form-control">
                                            <option value="">Select Brand</option>
                                            @foreach($brands as $brand)
                                                <option value="{{ $brand->id }}" {{ old('brand_id') == $brand->id ? 'selected' : '' }}>{{ $brand->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('brand_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="status">Status <span class="text-danger">*</span></label>
                                        <select name="status" id="status" class="form-control" required>
                                            <option value="active" {{ old('status', 'active') == 'active' ? 'selected' : '' }}>Active</option>
                                            <option value="inactive" {{ old('status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                        </select>
                                        @error('status')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="short_description">Short Description</label>
                                        <textarea name="short_description" id="short_description" class="form-control" rows="2" placeholder="Enter short description (max 500 characters)" maxlength="500">{{ old('short_description') }}</textarea>
                                        @error('short_description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="description">Description</label>
                                        <textarea name="description" id="description" class="form-control" rows="4" placeholder="Enter product description">{{ old('description') }}</textarea>
                                        @error('description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Location & Fulfillment Center -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Location & Fulfillment Center</h5>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="state_id">State <span class="text-danger">*</span></label>
                                        <select name="state_id" id="state_id" class="form-control" required>
                                            <option value="">{{ translate('messages.select_state') }}</option>
                                            @foreach($states as $state)
                                                <option value="{{ $state->id }}" {{ old('state_id') == $state->id ? 'selected' : '' }}>{{ $state->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('state_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="city_id">City <span class="text-danger">*</span></label>
                                        <select name="city_id" id="city_id" class="form-control" required disabled>
                                            <option value="">{{ translate('messages.select_city') }}</option>
                                        </select>
                                        @error('city_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="fulfillment_center_id">Fulfillment Center <span class="text-danger">*</span></label>
                                        <select name="fulfillment_center_id" id="fulfillment_center_id" class="form-control" required disabled>
                                            <option value="">{{ translate('messages.select_fulfillment_center') }}</option>
                                        </select>
                                        @error('fulfillment_center_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="stock_qty">{{ translate('messages.stock_quantity') }} <span class="text-danger">*</span></label>
                                        <input type="number" name="stock_qty" id="stock_qty" class="form-control" placeholder="0" value="{{ old('stock_qty', 0) }}" min="0" required>
                                        @error('stock_qty')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Pricing -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Pricing (Default Variant)</h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_sku">SKU <span class="text-danger">*</span></label>
                                        <input type="text" name="variant_sku" id="variant_sku" class="form-control" placeholder="Enter SKU" value="{{ old('variant_sku') }}" required maxlength="255">
                                        @error('variant_sku')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_price">Price <span class="text-danger">*</span></label>
                                        <input type="number" name="variant_price" id="variant_price" class="form-control" placeholder="0.00" value="{{ old('variant_price') }}" step="0.01" min="0" required>
                                        @error('variant_price')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_sale_price">Sale Price</label>
                                        <input type="number" name="variant_sale_price" id="variant_sale_price" class="form-control" placeholder="0.00" value="{{ old('variant_sale_price') }}" step="0.01" min="0">
                                        @error('variant_sale_price')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_status">Variant Status <span class="text-danger">*</span></label>
                                        <select name="variant_status" id="variant_status" class="form-control" required>
                                            <option value="active" {{ old('variant_status', 'active') == 'active' ? 'selected' : '' }}>Active</option>
                                            <option value="inactive" {{ old('variant_status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                        </select>
                                        @error('variant_status')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Images -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Images</h5>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="images">Images</label>
                                        <input type="file" name="images[]" id="images" class="form-control" accept="image/*" multiple onchange="previewImages(this)">
                                        <small class="text-muted">Accepted formats: JPG, PNG, GIF, WEBP (Max: 15MB each). You can select multiple images.</small>
                                        <div class="image-preview-container" id="image-preview-container"></div>
                                        @error('images.*')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Flags -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Flags</h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Trending</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_trending" id="is_trending" value="1" {{ old('is_trending') ? 'checked' : '' }} switch="bool">
                                            <label for="is_trending" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls trending_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Latest</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_latest" id="is_latest" value="1" {{ old('is_latest') ? 'checked' : '' }} switch="bool">
                                            <label for="is_latest" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls latest_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Express-30</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_express_30" id="is_express_30" value="1" {{ old('is_express_30') ? 'checked' : '' }} switch="bool">
                                            <label for="is_express_30" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls /api/express-30/products</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="btn--container justify-content-end">
                                <a href="{{ route('admin.products.index') }}" class="btn btn--reset">{{ translate('messages.cancel') }}</a>
                                <button type="submit" class="btn btn--primary">{{ translate('messages.submit') }}</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    var imageFiles = [];
    var maxFileSize = 15 * 1024 * 1024; // 15MB in bytes
    
    function previewImages(input) {
        var container = document.getElementById('image-preview-container');
        container.innerHTML = '';
        imageFiles = [];
        
        if (input.files && input.files.length > 0) {
            var validFiles = [];
            var hasError = false;
            
            for (var i = 0; i < input.files.length; i++) {
                var file = input.files[i];
                
                // Check file size
                if (file.size > maxFileSize) {
                    alert('File "' + file.name + '" exceeds the maximum file size of 15MB. Please choose a smaller file.');
                    hasError = true;
                    continue;
                }
                
                validFiles.push(file);
                imageFiles.push(file);
                
                var reader = new FileReader();
                reader.onload = function(e) {
                    var div = document.createElement('div');
                    div.className = 'image-preview-item';
                    div.innerHTML = '<img src="' + e.target.result + '" alt="Preview">';
                    container.appendChild(div);
                };
                reader.readAsDataURL(file);
            }
            
            // Reset input if there were invalid files
            if (hasError) {
                var dataTransfer = new DataTransfer();
                validFiles.forEach(function(file) {
                    dataTransfer.items.add(file);
                });
                input.files = dataTransfer.files;
            }
        }
    }

    // Form validation
    document.addEventListener('DOMContentLoaded', function() {
        var form = document.getElementById('product-form');
        if (!form) return;

        // Helper function to show error message
        function showError(fieldId, message) {
            var field = document.getElementById(fieldId);
            if (!field) return;

            // Remove existing error message
            var existingError = field.parentElement.querySelector('.validation-error');
            if (existingError) {
                existingError.remove();
            }

            // Add error class to field
            field.classList.add('is-invalid');

            // Create and show error message
            var errorDiv = document.createElement('div');
            errorDiv.className = 'validation-error text-danger mt-1';
            errorDiv.style.fontSize = '0.875rem';
            errorDiv.textContent = message;
            field.parentElement.appendChild(errorDiv);
        }

        // Helper function to clear error
        function clearError(fieldId) {
            var field = document.getElementById(fieldId);
            if (!field) return;

            field.classList.remove('is-invalid');
            var existingError = field.parentElement.querySelector('.validation-error');
            if (existingError) {
                existingError.remove();
            }
        }

        // Real-time validation on blur
        var requiredFields = ['name', 'category_id', 'status', 'state_id', 'city_id', 'fulfillment_center_id', 'stock_qty', 'variant_sku', 'variant_price', 'variant_status'];
        requiredFields.forEach(function(fieldId) {
            var field = document.getElementById(fieldId);
            if (field) {
                field.addEventListener('blur', function() {
                    validateField(fieldId);
                });
                field.addEventListener('input', function() {
                    if (field.classList.contains('is-invalid')) {
                        validateField(fieldId);
                    }
                });
            }
        });

        // Validate individual field
        function validateField(fieldId) {
            var field = document.getElementById(fieldId);
            if (!field) return true;

            var value = field.value.trim();
            var isValid = true;
            var errorMessage = '';

            switch(fieldId) {
                case 'name':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Product name is required';
                    } else if (value.length > 255) {
                        isValid = false;
                        errorMessage = 'Product name must not exceed 255 characters';
                    }
                    break;
                case 'category_id':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Category is required';
                    }
                    break;
                case 'status':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Status is required';
                    }
                    break;
                case 'variant_sku':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'SKU is required';
                    } else if (value.length > 255) {
                        isValid = false;
                        errorMessage = 'SKU must not exceed 255 characters';
                    }
                    break;
                case 'variant_price':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Price is required';
                    } else {
                        var price = parseFloat(value);
                        if (isNaN(price)) {
                            isValid = false;
                            errorMessage = 'Price must be a valid number';
                        } else if (price < 0) {
                            isValid = false;
                            errorMessage = 'Price must be greater than or equal to 0';
                        }
                    }
                    break;
                case 'variant_status':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Variant status is required';
                    }
                    break;
                case 'state_id':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'State is required';
                    }
                    break;
                case 'city_id':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'City is required';
                    }
                    break;
                case 'fulfillment_center_id':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Fulfillment center is required';
                    }
                    break;
                case 'stock_qty':
                    if (value === '' || value === null) {
                        isValid = false;
                        errorMessage = 'Stock quantity is required';
                    } else {
                        var stockQty = parseInt(value);
                        if (isNaN(stockQty)) {
                            isValid = false;
                            errorMessage = 'Stock quantity must be a number';
                        } else if (stockQty < 0) {
                            isValid = false;
                            errorMessage = 'Stock quantity must be greater than or equal to 0';
                        }
                    }
                    break;
            }

            if (isValid) {
                clearError(fieldId);
            } else {
                showError(fieldId, errorMessage);
            }

            return isValid;
        }

        // Validate sale price
        var salePriceField = document.getElementById('variant_sale_price');
        if (salePriceField) {
            salePriceField.addEventListener('blur', function() {
                var salePrice = salePriceField.value.trim();
                if (salePrice) {
                    var salePriceNum = parseFloat(salePrice);
                    var priceField = document.getElementById('variant_price');
                    var price = priceField ? parseFloat(priceField.value) : 0;

                    if (isNaN(salePriceNum)) {
                        showError('variant_sale_price', 'Sale price must be a valid number');
                    } else if (salePriceNum < 0) {
                        showError('variant_sale_price', 'Sale price must be greater than or equal to 0');
                    } else if (price > 0 && salePriceNum > price) {
                        showError('variant_sale_price', 'Sale price must be less than or equal to regular price');
                    } else {
                        clearError('variant_sale_price');
                    }
                } else {
                    clearError('variant_sale_price');
                }
            });
        }

        // Validate short description length
        var shortDescField = document.getElementById('short_description');
        if (shortDescField) {
            shortDescField.addEventListener('input', function() {
                if (this.value.length > 500) {
                    showError('short_description', 'Short description must not exceed 500 characters');
                } else {
                    clearError('short_description');
                }
            });
        }

        // Validate images
        var imagesField = document.getElementById('images');
        if (imagesField) {
            imagesField.addEventListener('change', function() {
                if (this.files && this.files.length > 0) {
                    var allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
                    var hasInvalidFile = false;

                    for (var i = 0; i < this.files.length; i++) {
                        var file = this.files[i];
                        if (!allowedTypes.includes(file.type)) {
                            hasInvalidFile = true;
                            showError('images', 'Only JPG, PNG, GIF, and WEBP image formats are allowed');
                            break;
                        }
                    }

                    if (!hasInvalidFile) {
                        clearError('images');
                    }
                }
            });
        }

        // Form submit validation
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            var isValid = true;
            var firstErrorField = null;

            // Validate all required fields
            requiredFields.forEach(function(fieldId) {
                if (!validateField(fieldId)) {
                    isValid = false;
                    if (!firstErrorField) {
                        firstErrorField = document.getElementById(fieldId);
                    }
                }
            });

            // Validate sale price if provided
            if (salePriceField && salePriceField.value.trim()) {
                var salePrice = parseFloat(salePriceField.value);
                var price = parseFloat(document.getElementById('variant_price').value);
                
                if (isNaN(salePrice) || salePrice < 0 || (price > 0 && salePrice > price)) {
                    isValid = false;
                    if (!firstErrorField) {
                        firstErrorField = salePriceField;
                    }
                    if (isNaN(salePrice) || salePrice < 0) {
                        showError('variant_sale_price', 'Sale price must be a valid number greater than or equal to 0');
                    } else {
                        showError('variant_sale_price', 'Sale price must be less than or equal to regular price');
                    }
                }
            }

            // Validate short description length
            if (shortDescField && shortDescField.value.length > 500) {
                isValid = false;
                if (!firstErrorField) {
                    firstErrorField = shortDescField;
                }
                showError('short_description', 'Short description must not exceed 500 characters');
            }

            // Validate images if provided
            if (imagesField && imagesField.files && imagesField.files.length > 0) {
                var allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
                for (var i = 0; i < imagesField.files.length; i++) {
                    var file = imagesField.files[i];
                    if (!allowedTypes.includes(file.type)) {
                        isValid = false;
                        if (!firstErrorField) {
                            firstErrorField = imagesField;
                        }
                        showError('images', 'Only JPG, PNG, GIF, and WEBP image formats are allowed');
                        break;
                    }
                    if (file.size > maxFileSize) {
                        isValid = false;
                        if (!firstErrorField) {
                            firstErrorField = imagesField;
                        }
                        showError('images', 'File "' + file.name + '" exceeds the maximum file size of 15MB');
                        break;
                    }
                }
            }

            if (!isValid) {
                // Scroll to first error field
                if (firstErrorField) {
                    firstErrorField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    firstErrorField.focus();
                }
                return false;
            }

            // If validation passes, submit the form
            form.submit();
        });
    });
</script>
@endpush


```


Reading the JavaScript section and adding the dependent dropdown code:


```blade
@extends('layouts.admin.app')

@section('title', translate('messages.add_product'))

@push('css_or_js')
<style>
    .card {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075), 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        border: 1px solid rgba(0, 0, 0, 0.125);
        border-radius: 0.5rem;
    }
    .card-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .card-footer {
        background-color: #f8f9fa;
        border-top: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .image-preview-container {
        margin-top: 15px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    .image-preview-item {
        position: relative;
        width: 120px;
        height: 120px;
    }
    .image-preview-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 8px;
        border: 2px solid #e4e6ef;
    }
    .image-preview-item .remove-image {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #dc3545;
        color: white;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 14px;
    }
    
    /* Validation styles */
    .form-control.is-invalid {
        border-color: #dc3545;
        padding-right: calc(1.5em + 0.75rem);
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath d='m5.8 3.6.4.4L6 4.4l-.2-.4-.4-.4zm0 4.8L6 8.8l.2.4.4.4-.4-.4z'/%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right calc(0.375em + 0.1875rem) center;
        background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
    }
    
    .validation-error {
        display: block;
        margin-top: 0.25rem;
        font-size: 0.875rem;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-add-circle"></i>
                </span>
                <span>
                    {{ translate('messages.add_product') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">{{ translate('messages.add_product') }}</h5>
                    </div>
                    <form action="{{ route('admin.products.store') }}" method="post" enctype="multipart/form-data" id="product-form">
                        @csrf
                        <div class="card-body">
                            <div class="row">
                                <!-- Basic Info -->
                                <div class="col-md-12">
                                    <h5 class="mb-3">Basic Information</h5>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="name">Product Name <span class="text-danger">*</span></label>
                                        <input type="text" name="name" id="name" class="form-control" placeholder="Enter product name" value="{{ old('name') }}" required maxlength="255">
                                        @error('name')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="category_id">Category <span class="text-danger">*</span></label>
                                        <select name="category_id" id="category_id" class="form-control" required>
                                            <option value="">Select Category</option>
                                            @foreach($categories as $category)
                                                <option value="{{ $category->id }}" {{ old('category_id') == $category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('category_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="brand_id">Brand</label>
                                        <select name="brand_id" id="brand_id" class="form-control">
                                            <option value="">Select Brand</option>
                                            @foreach($brands as $brand)
                                                <option value="{{ $brand->id }}" {{ old('brand_id') == $brand->id ? 'selected' : '' }}>{{ $brand->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('brand_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="status">Status <span class="text-danger">*</span></label>
                                        <select name="status" id="status" class="form-control" required>
                                            <option value="active" {{ old('status', 'active') == 'active' ? 'selected' : '' }}>Active</option>
                                            <option value="inactive" {{ old('status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                        </select>
                                        @error('status')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="short_description">Short Description</label>
                                        <textarea name="short_description" id="short_description" class="form-control" rows="2" placeholder="Enter short description (max 500 characters)" maxlength="500">{{ old('short_description') }}</textarea>
                                        @error('short_description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="description">Description</label>
                                        <textarea name="description" id="description" class="form-control" rows="4" placeholder="Enter product description">{{ old('description') }}</textarea>
                                        @error('description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Location & Fulfillment Center -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Location & Fulfillment Center</h5>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="state_id">State <span class="text-danger">*</span></label>
                                        <select name="state_id" id="state_id" class="form-control" required>
                                            <option value="">{{ translate('messages.select_state') }}</option>
                                            @foreach($states as $state)
                                                <option value="{{ $state->id }}" {{ old('state_id') == $state->id ? 'selected' : '' }}>{{ $state->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('state_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="city_id">City <span class="text-danger">*</span></label>
                                        <select name="city_id" id="city_id" class="form-control" required disabled>
                                            <option value="">{{ translate('messages.select_city') }}</option>
                                        </select>
                                        @error('city_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="fulfillment_center_id">Fulfillment Center <span class="text-danger">*</span></label>
                                        <select name="fulfillment_center_id" id="fulfillment_center_id" class="form-control" required disabled>
                                            <option value="">{{ translate('messages.select_fulfillment_center') }}</option>
                                        </select>
                                        @error('fulfillment_center_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="stock_qty">{{ translate('messages.stock_quantity') }} <span class="text-danger">*</span></label>
                                        <input type="number" name="stock_qty" id="stock_qty" class="form-control" placeholder="0" value="{{ old('stock_qty', 0) }}" min="0" required>
                                        @error('stock_qty')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Pricing -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Pricing (Default Variant)</h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_sku">SKU <span class="text-danger">*</span></label>
                                        <input type="text" name="variant_sku" id="variant_sku" class="form-control" placeholder="Enter SKU" value="{{ old('variant_sku') }}" required maxlength="255">
                                        @error('variant_sku')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_price">Price <span class="text-danger">*</span></label>
                                        <input type="number" name="variant_price" id="variant_price" class="form-control" placeholder="0.00" value="{{ old('variant_price') }}" step="0.01" min="0" required>
                                        @error('variant_price')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_sale_price">Sale Price</label>
                                        <input type="number" name="variant_sale_price" id="variant_sale_price" class="form-control" placeholder="0.00" value="{{ old('variant_sale_price') }}" step="0.01" min="0">
                                        @error('variant_sale_price')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_status">Variant Status <span class="text-danger">*</span></label>
                                        <select name="variant_status" id="variant_status" class="form-control" required>
                                            <option value="active" {{ old('variant_status', 'active') == 'active' ? 'selected' : '' }}>Active</option>
                                            <option value="inactive" {{ old('variant_status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                        </select>
                                        @error('variant_status')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Images -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Images</h5>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="images">Images</label>
                                        <input type="file" name="images[]" id="images" class="form-control" accept="image/*" multiple onchange="previewImages(this)">
                                        <small class="text-muted">Accepted formats: JPG, PNG, GIF, WEBP (Max: 15MB each). You can select multiple images.</small>
                                        <div class="image-preview-container" id="image-preview-container"></div>
                                        @error('images.*')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Flags -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Flags</h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Trending</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_trending" id="is_trending" value="1" {{ old('is_trending') ? 'checked' : '' }} switch="bool">
                                            <label for="is_trending" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls trending_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Latest</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_latest" id="is_latest" value="1" {{ old('is_latest') ? 'checked' : '' }} switch="bool">
                                            <label for="is_latest" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls latest_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Express-30</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_express_30" id="is_express_30" value="1" {{ old('is_express_30') ? 'checked' : '' }} switch="bool">
                                            <label for="is_express_30" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls /api/express-30/products</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="btn--container justify-content-end">
                                <a href="{{ route('admin.products.index') }}" class="btn btn--reset">{{ translate('messages.cancel') }}</a>
                                <button type="submit" class="btn btn--primary">{{ translate('messages.submit') }}</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    var imageFiles = [];
    var maxFileSize = 15 * 1024 * 1024; // 15MB in bytes
    
    // Dependent dropdowns for State, City, Fulfillment Center
    $(document).ready(function() {
        // State change - load cities
        $('#state_id').on('change', function() {
            var stateId = $(this).val();
            var citySelect = $('#city_id');
            var fulfillmentCenterSelect = $('#fulfillment_center_id');
            
            // Reset dependent dropdowns
            citySelect.html('<option value="">{{ translate('messages.select_city') }}</option>').prop('disabled', true);
            fulfillmentCenterSelect.html('<option value="">{{ translate('messages.select_fulfillment_center') }}</option>').prop('disabled', true);
            
            if (stateId) {
                $.ajax({
                    url: '{{ route('admin.get-cities') }}',
                    type: 'GET',
                    data: { state_id: stateId },
                    success: function(response) {
                        if (response.cities && response.cities.length > 0) {
                            citySelect.prop('disabled', false);
                            response.cities.forEach(function(city) {
                                citySelect.append('<option value="' + city.id + '">' + city.name + '</option>');
                            });
                        } else {
                            citySelect.append('<option value="">{{ translate('messages.no_cities_found') }}</option>');
                        }
                    },
                    error: function() {
                        alert('{{ translate('messages.failed_to_load_cities') }}');
                    }
                });
            }
        });
        
        // City change - load fulfillment centers
        $('#city_id').on('change', function() {
            var cityId = $(this).val();
            var fulfillmentCenterSelect = $('#fulfillment_center_id');
            
            // Reset fulfillment center dropdown
            fulfillmentCenterSelect.html('<option value="">{{ translate('messages.select_fulfillment_center') }}</option>').prop('disabled', true);
            
            if (cityId) {
                $.ajax({
                    url: '{{ route('admin.get-fulfillment-centers') }}',
                    type: 'GET',
                    data: { city_id: cityId },
                    success: function(response) {
                        if (response.fulfillment_centers && response.fulfillment_centers.length > 0) {
                            fulfillmentCenterSelect.prop('disabled', false);
                            response.fulfillment_centers.forEach(function(fc) {
                                fulfillmentCenterSelect.append('<option value="' + fc.id + '">' + fc.name + '</option>');
                            });
                        } else {
                            fulfillmentCenterSelect.append('<option value="">{{ translate('messages.no_fulfillment_centers_found') }}</option>');
                        }
                    },
                    error: function() {
                        alert('{{ translate('messages.failed_to_load_fulfillment_centers') }}');
                    }
                });
            }
        });
        
        // Restore old values if form was submitted with errors
        @if(old('state_id'))
            $('#state_id').trigger('change');
            setTimeout(function() {
                $('#city_id').val('{{ old('city_id') }}').trigger('change');
                setTimeout(function() {
                    $('#fulfillment_center_id').val('{{ old('fulfillment_center_id') }}');
                }, 500);
            }, 500);
        @endif
    });
    
    function previewImages(input) {
        var container = document.getElementById('image-preview-container');
        container.innerHTML = '';
        imageFiles = [];
        
        if (input.files && input.files.length > 0) {
            var validFiles = [];
            var hasError = false;
            
            for (var i = 0; i < input.files.length; i++) {
                var file = input.files[i];
                
                // Check file size
                if (file.size > maxFileSize) {
                    alert('File "' + file.name + '" exceeds the maximum file size of 15MB. Please choose a smaller file.');
                    hasError = true;
                    continue;
                }
                
                validFiles.push(file);
                imageFiles.push(file);
                
                var reader = new FileReader();
                reader.onload = function(e) {
                    var div = document.createElement('div');
                    div.className = 'image-preview-item';
                    div.innerHTML = '<img src="' + e.target.result + '" alt="Preview">';
                    container.appendChild(div);
                };
                reader.readAsDataURL(file);
            }
            
            // Reset input if there were invalid files
            if (hasError) {
                var dataTransfer = new DataTransfer();
                validFiles.forEach(function(file) {
                    dataTransfer.items.add(file);
                });
                input.files = dataTransfer.files;
            }
        }
    }

    // Form validation
    document.addEventListener('DOMContentLoaded', function() {
        var form = document.getElementById('product-form');
        if (!form) return;

        // Helper function to show error message
        function showError(fieldId, message) {
            var field = document.getElementById(fieldId);
            if (!field) return;

            // Remove existing error message
            var existingError = field.parentElement.querySelector('.validation-error');
            if (existingError) {
                existingError.remove();
            }

            // Add error class to field
            field.classList.add('is-invalid');

            // Create and show error message
            var errorDiv = document.createElement('div');
            errorDiv.className = 'validation-error text-danger mt-1';
            errorDiv.style.fontSize = '0.875rem';
            errorDiv.textContent = message;
            field.parentElement.appendChild(errorDiv);
        }

        // Helper function to clear error
        function clearError(fieldId) {
            var field = document.getElementById(fieldId);
            if (!field) return;

            field.classList.remove('is-invalid');
            var existingError = field.parentElement.querySelector('.validation-error');
            if (existingError) {
                existingError.remove();
            }
        }

        // Real-time validation on blur
        var requiredFields = ['name', 'category_id', 'status', 'state_id', 'city_id', 'fulfillment_center_id', 'stock_qty', 'variant_sku', 'variant_price', 'variant_status'];
        requiredFields.forEach(function(fieldId) {
            var field = document.getElementById(fieldId);
            if (field) {
                field.addEventListener('blur', function() {
                    validateField(fieldId);
                });
                field.addEventListener('input', function() {
                    if (field.classList.contains('is-invalid')) {
                        validateField(fieldId);
                    }
                });
            }
        });

        // Validate individual field
        function validateField(fieldId) {
            var field = document.getElementById(fieldId);
            if (!field) return true;

            var value = field.value.trim();
            var isValid = true;
            var errorMessage = '';

            switch(fieldId) {
                case 'name':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Product name is required';
                    } else if (value.length > 255) {
                        isValid = false;
                        errorMessage = 'Product name must not exceed 255 characters';
                    }
                    break;
                case 'category_id':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Category is required';
                    }
                    break;
                case 'status':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Status is required';
                    }
                    break;
                case 'variant_sku':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'SKU is required';
                    } else if (value.length > 255) {
                        isValid = false;
                        errorMessage = 'SKU must not exceed 255 characters';
                    }
                    break;
                case 'variant_price':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Price is required';
                    } else {
                        var price = parseFloat(value);
                        if (isNaN(price)) {
                            isValid = false;
                            errorMessage = 'Price must be a valid number';
                        } else if (price < 0) {
                            isValid = false;
                            errorMessage = 'Price must be greater than or equal to 0';
                        }
                    }
                    break;
                case 'variant_status':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Variant status is required';
                    }
                    break;
                case 'state_id':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'State is required';
                    }
                    break;
                case 'city_id':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'City is required';
                    }
                    break;
                case 'fulfillment_center_id':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Fulfillment center is required';
                    }
                    break;
                case 'stock_qty':
                    if (value === '' || value === null) {
                        isValid = false;
                        errorMessage = 'Stock quantity is required';
                    } else {
                        var stockQty = parseInt(value);
                        if (isNaN(stockQty)) {
                            isValid = false;
                            errorMessage = 'Stock quantity must be a number';
                        } else if (stockQty < 0) {
                            isValid = false;
                            errorMessage = 'Stock quantity must be greater than or equal to 0';
                        }
                    }
                    break;
            }

            if (isValid) {
                clearError(fieldId);
            } else {
                showError(fieldId, errorMessage);
            }

            return isValid;
        }

        // Validate sale price
        var salePriceField = document.getElementById('variant_sale_price');
        if (salePriceField) {
            salePriceField.addEventListener('blur', function() {
                var salePrice = salePriceField.value.trim();
                if (salePrice) {
                    var salePriceNum = parseFloat(salePrice);
                    var priceField = document.getElementById('variant_price');
                    var price = priceField ? parseFloat(priceField.value) : 0;

                    if (isNaN(salePriceNum)) {
                        showError('variant_sale_price', 'Sale price must be a valid number');
                    } else if (salePriceNum < 0) {
                        showError('variant_sale_price', 'Sale price must be greater than or equal to 0');
                    } else if (price > 0 && salePriceNum > price) {
                        showError('variant_sale_price', 'Sale price must be less than or equal to regular price');
                    } else {
                        clearError('variant_sale_price');
                    }
                } else {
                    clearError('variant_sale_price');
                }
            });
        }

        // Validate short description length
        var shortDescField = document.getElementById('short_description');
        if (shortDescField) {
            shortDescField.addEventListener('input', function() {
                if (this.value.length > 500) {
                    showError('short_description', 'Short description must not exceed 500 characters');
                } else {
                    clearError('short_description');
                }
            });
        }

        // Validate images
        var imagesField = document.getElementById('images');
        if (imagesField) {
            imagesField.addEventListener('change', function() {
                if (this.files && this.files.length > 0) {
                    var allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
                    var hasInvalidFile = false;

                    for (var i = 0; i < this.files.length; i++) {
                        var file = this.files[i];
                        if (!allowedTypes.includes(file.type)) {
                            hasInvalidFile = true;
                            showError('images', 'Only JPG, PNG, GIF, and WEBP image formats are allowed');
                            break;
                        }
                    }

                    if (!hasInvalidFile) {
                        clearError('images');
                    }
                }
            });
        }

        // Form submit validation
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            var isValid = true;
            var firstErrorField = null;

            // Validate all required fields
            requiredFields.forEach(function(fieldId) {
                if (!validateField(fieldId)) {
                    isValid = false;
                    if (!firstErrorField) {
                        firstErrorField = document.getElementById(fieldId);
                    }
                }
            });

            // Validate sale price if provided
            if (salePriceField && salePriceField.value.trim()) {
                var salePrice = parseFloat(salePriceField.value);
                var price = parseFloat(document.getElementById('variant_price').value);
                
                if (isNaN(salePrice) || salePrice < 0 || (price > 0 && salePrice > price)) {
                    isValid = false;
                    if (!firstErrorField) {
                        firstErrorField = salePriceField;
                    }
                    if (isNaN(salePrice) || salePrice < 0) {
                        showError('variant_sale_price', 'Sale price must be a valid number greater than or equal to 0');
                    } else {
                        showError('variant_sale_price', 'Sale price must be less than or equal to regular price');
                    }
                }
            }

            // Validate short description length
            if (shortDescField && shortDescField.value.length > 500) {
                isValid = false;
                if (!firstErrorField) {
                    firstErrorField = shortDescField;
                }
                showError('short_description', 'Short description must not exceed 500 characters');
            }

            // Validate images if provided
            if (imagesField && imagesField.files && imagesField.files.length > 0) {
                var allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
                for (var i = 0; i < imagesField.files.length; i++) {
                    var file = imagesField.files[i];
                    if (!allowedTypes.includes(file.type)) {
                        isValid = false;
                        if (!firstErrorField) {
                            firstErrorField = imagesField;
                        }
                        showError('images', 'Only JPG, PNG, GIF, and WEBP image formats are allowed');
                        break;
                    }
                    if (file.size > maxFileSize) {
                        isValid = false;
                        if (!firstErrorField) {
                            firstErrorField = imagesField;
                        }
                        showError('images', 'File "' + file.name + '" exceeds the maximum file size of 15MB');
                        break;
                    }
                }
            }

            if (!isValid) {
                // Scroll to first error field
                if (firstErrorField) {
                    firstErrorField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    firstErrorField.focus();
                }
                return false;
            }

            // If validation passes, submit the form
            form.submit();
        });
    });
</script>
@endpush


```

```php
<?php

return [
    // Product Management
    'product_management' => 'Product Management',
    'products' => 'Products',
    'categories' => 'Categories',
    'add_product' => 'Add Product',
    'edit_product' => 'Edit Product',
    'add_category' => 'Add Category',
    'edit_category' => 'Edit Category',
    'trending' => 'Trending',
    'latest' => 'Latest',
    'express_30' => 'Express-30',
    'product_saved' => 'Product saved successfully',
    'category_saved' => 'Category saved successfully',
    
    // Common
    'sl' => 'SL',
    'status' => 'Status',
    'action' => 'Action',
    'cancel' => 'Cancel',
    'submit' => 'Submit',
    'edit' => 'Edit',
    'delete' => 'Delete',
    'no_data_found' => 'No data found',
    
    // Messages
    'category_added' => 'Category added successfully',
    'category_updated' => 'Category updated successfully',
    'category_deleted' => 'Category deleted successfully',
    'category_status_updated' => 'Category status updated successfully',
    'failed_to_add_category' => 'Failed to add category',
    'failed_to_update_category' => 'Failed to update category',
    'failed_to_delete_category' => 'Failed to delete category',
    'failed_to_update_status' => 'Failed to update status',
    'failed_to_upload_image' => 'Failed to upload image',
    'Cannot delete category with products' => 'Cannot delete category with products',
    'Cannot delete category with subcategories' => 'Cannot delete category with subcategories',
    
    'product_added' => 'Product added successfully',
    'product_updated' => 'Product updated successfully',
    'select_state' => 'Select State',
    'select_city' => 'Select City',
    'select_fulfillment_center' => 'Select Fulfillment Center',
    'stock_quantity' => 'Stock Quantity',
    'no_cities_found' => 'No cities found',
    'no_fulfillment_centers_found' => 'No fulfillment centers found',
    'failed_to_load_cities' => 'Failed to load cities',
    'failed_to_load_fulfillment_centers' => 'Failed to load fulfillment centers',
    'State is required!' => 'State is required!',
    'State not found!' => 'State not found!',
    'City is required!' => 'City is required!',
    'City not found!' => 'City not found!',
    'Fulfillment center is required!' => 'Fulfillment center is required!',
    'Fulfillment center not found!' => 'Fulfillment center not found!',
    'Stock quantity is required!' => 'Stock quantity is required!',
    'Stock quantity must be a number!' => 'Stock quantity must be a number!',
    'Stock quantity must be greater than or equal to 0!' => 'Stock quantity must be greater than or equal to 0!',
    'product_deleted' => 'Product deleted successfully',
    'product_status_updated' => 'Product status updated successfully',
    'product_flag_updated' => 'Product flag updated successfully',
    'failed_to_add_product' => 'Failed to add product',
    'failed_to_update_product' => 'Failed to update product',
    'failed_to_delete_product' => 'Failed to delete product',
    'failed_to_update_flag' => 'Failed to update flag',
    'image_deleted' => 'Image deleted successfully',
    'failed_to_delete_image' => 'Failed to delete image',
    'Invalid flag' => 'Invalid flag',
    'SKU already exists' => 'SKU already exists',
];


```


Checking if jQuery is already included and fixing the JavaScript:


```blade
@extends('layouts.admin.app')

@section('title', translate('messages.add_product'))

@push('css_or_js')
<style>
    .card {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075), 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        border: 1px solid rgba(0, 0, 0, 0.125);
        border-radius: 0.5rem;
    }
    .card-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .card-footer {
        background-color: #f8f9fa;
        border-top: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .image-preview-container {
        margin-top: 15px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    .image-preview-item {
        position: relative;
        width: 120px;
        height: 120px;
    }
    .image-preview-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 8px;
        border: 2px solid #e4e6ef;
    }
    .image-preview-item .remove-image {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #dc3545;
        color: white;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 14px;
    }
    
    /* Validation styles */
    .form-control.is-invalid {
        border-color: #dc3545;
        padding-right: calc(1.5em + 0.75rem);
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath d='m5.8 3.6.4.4L6 4.4l-.2-.4-.4-.4zm0 4.8L6 8.8l.2.4.4.4-.4-.4z'/%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right calc(0.375em + 0.1875rem) center;
        background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
    }
    
    .validation-error {
        display: block;
        margin-top: 0.25rem;
        font-size: 0.875rem;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-add-circle"></i>
                </span>
                <span>
                    {{ translate('messages.add_product') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">{{ translate('messages.add_product') }}</h5>
                    </div>
                    <form action="{{ route('admin.products.store') }}" method="post" enctype="multipart/form-data" id="product-form">
                        @csrf
                        <div class="card-body">
                            <div class="row">
                                <!-- Basic Info -->
                                <div class="col-md-12">
                                    <h5 class="mb-3">Basic Information</h5>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="name">Product Name <span class="text-danger">*</span></label>
                                        <input type="text" name="name" id="name" class="form-control" placeholder="Enter product name" value="{{ old('name') }}" required maxlength="255">
                                        @error('name')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="category_id">Category <span class="text-danger">*</span></label>
                                        <select name="category_id" id="category_id" class="form-control" required>
                                            <option value="">Select Category</option>
                                            @foreach($categories as $category)
                                                <option value="{{ $category->id }}" {{ old('category_id') == $category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('category_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="brand_id">Brand</label>
                                        <select name="brand_id" id="brand_id" class="form-control">
                                            <option value="">Select Brand</option>
                                            @foreach($brands as $brand)
                                                <option value="{{ $brand->id }}" {{ old('brand_id') == $brand->id ? 'selected' : '' }}>{{ $brand->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('brand_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="status">Status <span class="text-danger">*</span></label>
                                        <select name="status" id="status" class="form-control" required>
                                            <option value="active" {{ old('status', 'active') == 'active' ? 'selected' : '' }}>Active</option>
                                            <option value="inactive" {{ old('status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                        </select>
                                        @error('status')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="short_description">Short Description</label>
                                        <textarea name="short_description" id="short_description" class="form-control" rows="2" placeholder="Enter short description (max 500 characters)" maxlength="500">{{ old('short_description') }}</textarea>
                                        @error('short_description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="description">Description</label>
                                        <textarea name="description" id="description" class="form-control" rows="4" placeholder="Enter product description">{{ old('description') }}</textarea>
                                        @error('description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Location & Fulfillment Center -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Location & Fulfillment Center</h5>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="state_id">State <span class="text-danger">*</span></label>
                                        <select name="state_id" id="state_id" class="form-control" required>
                                            <option value="">{{ translate('messages.select_state') }}</option>
                                            @foreach($states as $state)
                                                <option value="{{ $state->id }}" {{ old('state_id') == $state->id ? 'selected' : '' }}>{{ $state->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('state_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="city_id">City <span class="text-danger">*</span></label>
                                        <select name="city_id" id="city_id" class="form-control" required disabled>
                                            <option value="">{{ translate('messages.select_city') }}</option>
                                        </select>
                                        @error('city_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="fulfillment_center_id">Fulfillment Center <span class="text-danger">*</span></label>
                                        <select name="fulfillment_center_id" id="fulfillment_center_id" class="form-control" required disabled>
                                            <option value="">{{ translate('messages.select_fulfillment_center') }}</option>
                                        </select>
                                        @error('fulfillment_center_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="stock_qty">{{ translate('messages.stock_quantity') }} <span class="text-danger">*</span></label>
                                        <input type="number" name="stock_qty" id="stock_qty" class="form-control" placeholder="0" value="{{ old('stock_qty', 0) }}" min="0" required>
                                        @error('stock_qty')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Pricing -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Pricing (Default Variant)</h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_sku">SKU <span class="text-danger">*</span></label>
                                        <input type="text" name="variant_sku" id="variant_sku" class="form-control" placeholder="Enter SKU" value="{{ old('variant_sku') }}" required maxlength="255">
                                        @error('variant_sku')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_price">Price <span class="text-danger">*</span></label>
                                        <input type="number" name="variant_price" id="variant_price" class="form-control" placeholder="0.00" value="{{ old('variant_price') }}" step="0.01" min="0" required>
                                        @error('variant_price')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_sale_price">Sale Price</label>
                                        <input type="number" name="variant_sale_price" id="variant_sale_price" class="form-control" placeholder="0.00" value="{{ old('variant_sale_price') }}" step="0.01" min="0">
                                        @error('variant_sale_price')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_status">Variant Status <span class="text-danger">*</span></label>
                                        <select name="variant_status" id="variant_status" class="form-control" required>
                                            <option value="active" {{ old('variant_status', 'active') == 'active' ? 'selected' : '' }}>Active</option>
                                            <option value="inactive" {{ old('variant_status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                        </select>
                                        @error('variant_status')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Images -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Images</h5>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="images">Images</label>
                                        <input type="file" name="images[]" id="images" class="form-control" accept="image/*" multiple onchange="previewImages(this)">
                                        <small class="text-muted">Accepted formats: JPG, PNG, GIF, WEBP (Max: 15MB each). You can select multiple images.</small>
                                        <div class="image-preview-container" id="image-preview-container"></div>
                                        @error('images.*')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Flags -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Flags</h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Trending</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_trending" id="is_trending" value="1" {{ old('is_trending') ? 'checked' : '' }} switch="bool">
                                            <label for="is_trending" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls trending_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Latest</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_latest" id="is_latest" value="1" {{ old('is_latest') ? 'checked' : '' }} switch="bool">
                                            <label for="is_latest" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls latest_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Express-30</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_express_30" id="is_express_30" value="1" {{ old('is_express_30') ? 'checked' : '' }} switch="bool">
                                            <label for="is_express_30" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls /api/express-30/products</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="btn--container justify-content-end">
                                <a href="{{ route('admin.products.index') }}" class="btn btn--reset">{{ translate('messages.cancel') }}</a>
                                <button type="submit" class="btn btn--primary">{{ translate('messages.submit') }}</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    var imageFiles = [];
    var maxFileSize = 15 * 1024 * 1024; // 15MB in bytes
    
    // Dependent dropdowns for State, City, Fulfillment Center
    $(document).ready(function() {
        // State change - load cities
        $('#state_id').on('change', function() {
            var stateId = $(this).val();
            var citySelect = $('#city_id');
            var fulfillmentCenterSelect = $('#fulfillment_center_id');
            
            // Reset dependent dropdowns
            citySelect.html('<option value="">{{ translate('messages.select_city') }}</option>').prop('disabled', true);
            fulfillmentCenterSelect.html('<option value="">{{ translate('messages.select_fulfillment_center') }}</option>').prop('disabled', true);
            
            if (stateId) {
                $.ajax({
                    url: '{{ route('admin.get-cities') }}',
                    type: 'GET',
                    data: { state_id: stateId },
                    success: function(response) {
                        if (response.cities && response.cities.length > 0) {
                            citySelect.prop('disabled', false);
                            response.cities.forEach(function(city) {
                                citySelect.append('<option value="' + city.id + '">' + city.name + '</option>');
                            });
                        } else {
                            citySelect.append('<option value="">{{ translate('messages.no_cities_found') }}</option>');
                        }
                    },
                    error: function() {
                        alert('{{ translate('messages.failed_to_load_cities') }}');
                    }
                });
            }
        });
        
        // City change - load fulfillment centers
        $('#city_id').on('change', function() {
            var cityId = $(this).val();
            var fulfillmentCenterSelect = $('#fulfillment_center_id');
            
            // Reset fulfillment center dropdown
            fulfillmentCenterSelect.html('<option value="">{{ translate('messages.select_fulfillment_center') }}</option>').prop('disabled', true);
            
            if (cityId) {
                $.ajax({
                    url: '{{ route('admin.get-fulfillment-centers') }}',
                    type: 'GET',
                    data: { city_id: cityId },
                    success: function(response) {
                        if (response.fulfillment_centers && response.fulfillment_centers.length > 0) {
                            fulfillmentCenterSelect.prop('disabled', false);
                            response.fulfillment_centers.forEach(function(fc) {
                                fulfillmentCenterSelect.append('<option value="' + fc.id + '">' + fc.name + '</option>');
                            });
                        } else {
                            fulfillmentCenterSelect.append('<option value="">{{ translate('messages.no_fulfillment_centers_found') }}</option>');
                        }
                    },
                    error: function() {
                        alert('{{ translate('messages.failed_to_load_fulfillment_centers') }}');
                    }
                });
            }
        });
        
        // Restore old values if form was submitted with errors
        @if(old('state_id'))
            $('#state_id').trigger('change');
            setTimeout(function() {
                $('#city_id').val('{{ old('city_id') }}').trigger('change');
                setTimeout(function() {
                    $('#fulfillment_center_id').val('{{ old('fulfillment_center_id') }}');
                }, 500);
            }, 500);
        @endif
    });
    
    function previewImages(input) {
        var container = document.getElementById('image-preview-container');
        container.innerHTML = '';
        imageFiles = [];
        
        if (input.files && input.files.length > 0) {
            var validFiles = [];
            var hasError = false;
            
            for (var i = 0; i < input.files.length; i++) {
                var file = input.files[i];
                
                // Check file size
                if (file.size > maxFileSize) {
                    alert('File "' + file.name + '" exceeds the maximum file size of 15MB. Please choose a smaller file.');
                    hasError = true;
                    continue;
                }
                
                validFiles.push(file);
                imageFiles.push(file);
                
                var reader = new FileReader();
                reader.onload = function(e) {
                    var div = document.createElement('div');
                    div.className = 'image-preview-item';
                    div.innerHTML = '<img src="' + e.target.result + '" alt="Preview">';
                    container.appendChild(div);
                };
                reader.readAsDataURL(file);
            }
            
            // Reset input if there were invalid files
            if (hasError) {
                var dataTransfer = new DataTransfer();
                validFiles.forEach(function(file) {
                    dataTransfer.items.add(file);
                });
                input.files = dataTransfer.files;
            }
        }
    }

    // Form validation
    document.addEventListener('DOMContentLoaded', function() {
        var form = document.getElementById('product-form');
        if (!form) return;

        // Helper function to show error message
        function showError(fieldId, message) {
            var field = document.getElementById(fieldId);
            if (!field) return;

            // Remove existing error message
            var existingError = field.parentElement.querySelector('.validation-error');
            if (existingError) {
                existingError.remove();
            }

            // Add error class to field
            field.classList.add('is-invalid');

            // Create and show error message
            var errorDiv = document.createElement('div');
            errorDiv.className = 'validation-error text-danger mt-1';
            errorDiv.style.fontSize = '0.875rem';
            errorDiv.textContent = message;
            field.parentElement.appendChild(errorDiv);
        }

        // Helper function to clear error
        function clearError(fieldId) {
            var field = document.getElementById(fieldId);
            if (!field) return;

            field.classList.remove('is-invalid');
            var existingError = field.parentElement.querySelector('.validation-error');
            if (existingError) {
                existingError.remove();
            }
        }

        // Real-time validation on blur
        var requiredFields = ['name', 'category_id', 'status', 'state_id', 'city_id', 'fulfillment_center_id', 'stock_qty', 'variant_sku', 'variant_price', 'variant_status'];
        requiredFields.forEach(function(fieldId) {
            var field = document.getElementById(fieldId);
            if (field) {
                field.addEventListener('blur', function() {
                    validateField(fieldId);
                });
                field.addEventListener('input', function() {
                    if (field.classList.contains('is-invalid')) {
                        validateField(fieldId);
                    }
                });
            }
        });

        // Validate individual field
        function validateField(fieldId) {
            var field = document.getElementById(fieldId);
            if (!field) return true;

            var value = field.value.trim();
            var isValid = true;
            var errorMessage = '';

            switch(fieldId) {
                case 'name':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Product name is required';
                    } else if (value.length > 255) {
                        isValid = false;
                        errorMessage = 'Product name must not exceed 255 characters';
                    }
                    break;
                case 'category_id':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Category is required';
                    }
                    break;
                case 'status':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Status is required';
                    }
                    break;
                case 'variant_sku':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'SKU is required';
                    } else if (value.length > 255) {
                        isValid = false;
                        errorMessage = 'SKU must not exceed 255 characters';
                    }
                    break;
                case 'variant_price':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Price is required';
                    } else {
                        var price = parseFloat(value);
                        if (isNaN(price)) {
                            isValid = false;
                            errorMessage = 'Price must be a valid number';
                        } else if (price < 0) {
                            isValid = false;
                            errorMessage = 'Price must be greater than or equal to 0';
                        }
                    }
                    break;
                case 'variant_status':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Variant status is required';
                    }
                    break;
                case 'state_id':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'State is required';
                    }
                    break;
                case 'city_id':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'City is required';
                    }
                    break;
                case 'fulfillment_center_id':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Fulfillment center is required';
                    }
                    break;
                case 'stock_qty':
                    if (value === '' || value === null) {
                        isValid = false;
                        errorMessage = 'Stock quantity is required';
                    } else {
                        var stockQty = parseInt(value);
                        if (isNaN(stockQty)) {
                            isValid = false;
                            errorMessage = 'Stock quantity must be a number';
                        } else if (stockQty < 0) {
                            isValid = false;
                            errorMessage = 'Stock quantity must be greater than or equal to 0';
                        }
                    }
                    break;
            }

            if (isValid) {
                clearError(fieldId);
            } else {
                showError(fieldId, errorMessage);
            }

            return isValid;
        }

        // Validate sale price
        var salePriceField = document.getElementById('variant_sale_price');
        if (salePriceField) {
            salePriceField.addEventListener('blur', function() {
                var salePrice = salePriceField.value.trim();
                if (salePrice) {
                    var salePriceNum = parseFloat(salePrice);
                    var priceField = document.getElementById('variant_price');
                    var price = priceField ? parseFloat(priceField.value) : 0;

                    if (isNaN(salePriceNum)) {
                        showError('variant_sale_price', 'Sale price must be a valid number');
                    } else if (salePriceNum < 0) {
                        showError('variant_sale_price', 'Sale price must be greater than or equal to 0');
                    } else if (price > 0 && salePriceNum > price) {
                        showError('variant_sale_price', 'Sale price must be less than or equal to regular price');
                    } else {
                        clearError('variant_sale_price');
                    }
                } else {
                    clearError('variant_sale_price');
                }
            });
        }

        // Validate short description length
        var shortDescField = document.getElementById('short_description');
        if (shortDescField) {
            shortDescField.addEventListener('input', function() {
                if (this.value.length > 500) {
                    showError('short_description', 'Short description must not exceed 500 characters');
                } else {
                    clearError('short_description');
                }
            });
        }

        // Validate images
        var imagesField = document.getElementById('images');
        if (imagesField) {
            imagesField.addEventListener('change', function() {
                if (this.files && this.files.length > 0) {
                    var allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
                    var hasInvalidFile = false;

                    for (var i = 0; i < this.files.length; i++) {
                        var file = this.files[i];
                        if (!allowedTypes.includes(file.type)) {
                            hasInvalidFile = true;
                            showError('images', 'Only JPG, PNG, GIF, and WEBP image formats are allowed');
                            break;
                        }
                    }

                    if (!hasInvalidFile) {
                        clearError('images');
                    }
                }
            });
        }

        // Form submit validation
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            var isValid = true;
            var firstErrorField = null;

            // Validate all required fields
            requiredFields.forEach(function(fieldId) {
                if (!validateField(fieldId)) {
                    isValid = false;
                    if (!firstErrorField) {
                        firstErrorField = document.getElementById(fieldId);
                    }
                }
            });

            // Validate sale price if provided
            if (salePriceField && salePriceField.value.trim()) {
                var salePrice = parseFloat(salePriceField.value);
                var price = parseFloat(document.getElementById('variant_price').value);
                
                if (isNaN(salePrice) || salePrice < 0 || (price > 0 && salePrice > price)) {
                    isValid = false;
                    if (!firstErrorField) {
                        firstErrorField = salePriceField;
                    }
                    if (isNaN(salePrice) || salePrice < 0) {
                        showError('variant_sale_price', 'Sale price must be a valid number greater than or equal to 0');
                    } else {
                        showError('variant_sale_price', 'Sale price must be less than or equal to regular price');
                    }
                }
            }

            // Validate short description length
            if (shortDescField && shortDescField.value.length > 500) {
                isValid = false;
                if (!firstErrorField) {
                    firstErrorField = shortDescField;
                }
                showError('short_description', 'Short description must not exceed 500 characters');
            }

            // Validate images if provided
            if (imagesField && imagesField.files && imagesField.files.length > 0) {
                var allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
                for (var i = 0; i < imagesField.files.length; i++) {
                    var file = imagesField.files[i];
                    if (!allowedTypes.includes(file.type)) {
                        isValid = false;
                        if (!firstErrorField) {
                            firstErrorField = imagesField;
                        }
                        showError('images', 'Only JPG, PNG, GIF, and WEBP image formats are allowed');
                        break;
                    }
                    if (file.size > maxFileSize) {
                        isValid = false;
                        if (!firstErrorField) {
                            firstErrorField = imagesField;
                        }
                        showError('images', 'File "' + file.name + '" exceeds the maximum file size of 15MB');
                        break;
                    }
                }
            }

            if (!isValid) {
                // Scroll to first error field
                if (firstErrorField) {
                    firstErrorField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    firstErrorField.focus();
                }
                return false;
            }

            // If validation passes, submit the form
            form.submit();
        });
    });
</script>
@endpush


```

```blade
        // Restore old values if form was submitted with errors
        @if(old('state_id'))
            var oldStateId = '{{ old('state_id') }}';
            var oldCityId = '{{ old('city_id') }}';
            var oldFulfillmentCenterId = '{{ old('fulfillment_center_id') }}';
            
            $('#state_id').val(oldStateId).trigger('change');
            setTimeout(function() {
                if (oldCityId) {
                    $('#city_id').val(oldCityId).trigger('change');
                    setTimeout(function() {
                        if (oldFulfillmentCenterId) {
                            $('#fulfillment_center_id').val(oldFulfillmentCenterId);
                        }
                    }, 500);
                }
            }, 500);
        @endif
    });
```


Checking if jQuery is available and verifying the implementation:



Checking if jQuery is included in the layout and fixing the old values restoration:


```blade
@extends('layouts.admin.app')

@section('title', translate('messages.add_product'))

@push('css_or_js')
<style>
    .card {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075), 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        border: 1px solid rgba(0, 0, 0, 0.125);
        border-radius: 0.5rem;
    }
    .card-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .card-footer {
        background-color: #f8f9fa;
        border-top: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .image-preview-container {
        margin-top: 15px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    .image-preview-item {
        position: relative;
        width: 120px;
        height: 120px;
    }
    .image-preview-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 8px;
        border: 2px solid #e4e6ef;
    }
    .image-preview-item .remove-image {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #dc3545;
        color: white;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 14px;
    }
    
    /* Validation styles */
    .form-control.is-invalid {
        border-color: #dc3545;
        padding-right: calc(1.5em + 0.75rem);
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath d='m5.8 3.6.4.4L6 4.4l-.2-.4-.4-.4zm0 4.8L6 8.8l.2.4.4.4-.4-.4z'/%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right calc(0.375em + 0.1875rem) center;
        background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
    }
    
    .validation-error {
        display: block;
        margin-top: 0.25rem;
        font-size: 0.875rem;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-add-circle"></i>
                </span>
                <span>
                    {{ translate('messages.add_product') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">{{ translate('messages.add_product') }}</h5>
                    </div>
                    <form action="{{ route('admin.products.store') }}" method="post" enctype="multipart/form-data" id="product-form">
                        @csrf
                        <div class="card-body">
                            <div class="row">
                                <!-- Basic Info -->
                                <div class="col-md-12">
                                    <h5 class="mb-3">Basic Information</h5>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="name">Product Name <span class="text-danger">*</span></label>
                                        <input type="text" name="name" id="name" class="form-control" placeholder="Enter product name" value="{{ old('name') }}" required maxlength="255">
                                        @error('name')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="category_id">Category <span class="text-danger">*</span></label>
                                        <select name="category_id" id="category_id" class="form-control" required>
                                            <option value="">Select Category</option>
                                            @foreach($categories as $category)
                                                <option value="{{ $category->id }}" {{ old('category_id') == $category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('category_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="brand_id">Brand</label>
                                        <select name="brand_id" id="brand_id" class="form-control">
                                            <option value="">Select Brand</option>
                                            @foreach($brands as $brand)
                                                <option value="{{ $brand->id }}" {{ old('brand_id') == $brand->id ? 'selected' : '' }}>{{ $brand->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('brand_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="status">Status <span class="text-danger">*</span></label>
                                        <select name="status" id="status" class="form-control" required>
                                            <option value="active" {{ old('status', 'active') == 'active' ? 'selected' : '' }}>Active</option>
                                            <option value="inactive" {{ old('status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                        </select>
                                        @error('status')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="short_description">Short Description</label>
                                        <textarea name="short_description" id="short_description" class="form-control" rows="2" placeholder="Enter short description (max 500 characters)" maxlength="500">{{ old('short_description') }}</textarea>
                                        @error('short_description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="description">Description</label>
                                        <textarea name="description" id="description" class="form-control" rows="4" placeholder="Enter product description">{{ old('description') }}</textarea>
                                        @error('description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Location & Fulfillment Center -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Location & Fulfillment Center</h5>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="state_id">State <span class="text-danger">*</span></label>
                                        <select name="state_id" id="state_id" class="form-control" required>
                                            <option value="">{{ translate('messages.select_state') }}</option>
                                            @foreach($states as $state)
                                                <option value="{{ $state->id }}" {{ old('state_id') == $state->id ? 'selected' : '' }}>{{ $state->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('state_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="city_id">City <span class="text-danger">*</span></label>
                                        <select name="city_id" id="city_id" class="form-control" required disabled>
                                            <option value="">{{ translate('messages.select_city') }}</option>
                                        </select>
                                        @error('city_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="fulfillment_center_id">Fulfillment Center <span class="text-danger">*</span></label>
                                        <select name="fulfillment_center_id" id="fulfillment_center_id" class="form-control" required disabled>
                                            <option value="">{{ translate('messages.select_fulfillment_center') }}</option>
                                        </select>
                                        @error('fulfillment_center_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="stock_qty">{{ translate('messages.stock_quantity') }} <span class="text-danger">*</span></label>
                                        <input type="number" name="stock_qty" id="stock_qty" class="form-control" placeholder="0" value="{{ old('stock_qty', 0) }}" min="0" required>
                                        @error('stock_qty')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Pricing -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Pricing (Default Variant)</h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_sku">SKU <span class="text-danger">*</span></label>
                                        <input type="text" name="variant_sku" id="variant_sku" class="form-control" placeholder="Enter SKU" value="{{ old('variant_sku') }}" required maxlength="255">
                                        @error('variant_sku')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_price">Price <span class="text-danger">*</span></label>
                                        <input type="number" name="variant_price" id="variant_price" class="form-control" placeholder="0.00" value="{{ old('variant_price') }}" step="0.01" min="0" required>
                                        @error('variant_price')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_sale_price">Sale Price</label>
                                        <input type="number" name="variant_sale_price" id="variant_sale_price" class="form-control" placeholder="0.00" value="{{ old('variant_sale_price') }}" step="0.01" min="0">
                                        @error('variant_sale_price')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label" for="variant_status">Variant Status <span class="text-danger">*</span></label>
                                        <select name="variant_status" id="variant_status" class="form-control" required>
                                            <option value="active" {{ old('variant_status', 'active') == 'active' ? 'selected' : '' }}>Active</option>
                                            <option value="inactive" {{ old('variant_status') == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                        </select>
                                        @error('variant_status')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Images -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Images</h5>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="images">Images</label>
                                        <input type="file" name="images[]" id="images" class="form-control" accept="image/*" multiple onchange="previewImages(this)">
                                        <small class="text-muted">Accepted formats: JPG, PNG, GIF, WEBP (Max: 15MB each). You can select multiple images.</small>
                                        <div class="image-preview-container" id="image-preview-container"></div>
                                        @error('images.*')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Flags -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Flags</h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Trending</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_trending" id="is_trending" value="1" {{ old('is_trending') ? 'checked' : '' }} switch="bool">
                                            <label for="is_trending" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls trending_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Latest</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_latest" id="is_latest" value="1" {{ old('is_latest') ? 'checked' : '' }} switch="bool">
                                            <label for="is_latest" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls latest_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Express-30</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_express_30" id="is_express_30" value="1" {{ old('is_express_30') ? 'checked' : '' }} switch="bool">
                                            <label for="is_express_30" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls /api/express-30/products</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="btn--container justify-content-end">
                                <a href="{{ route('admin.products.index') }}" class="btn btn--reset">{{ translate('messages.cancel') }}</a>
                                <button type="submit" class="btn btn--primary">{{ translate('messages.submit') }}</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    var imageFiles = [];
    var maxFileSize = 15 * 1024 * 1024; // 15MB in bytes
    
    // Dependent dropdowns for State, City, Fulfillment Center
    $(document).ready(function() {
        // State change - load cities
        $('#state_id').on('change', function() {
            var stateId = $(this).val();
            var citySelect = $('#city_id');
            var fulfillmentCenterSelect = $('#fulfillment_center_id');
            
            // Reset dependent dropdowns
            citySelect.html('<option value="">{{ translate('messages.select_city') }}</option>').prop('disabled', true);
            fulfillmentCenterSelect.html('<option value="">{{ translate('messages.select_fulfillment_center') }}</option>').prop('disabled', true);
            
            if (stateId) {
                $.ajax({
                    url: '{{ route('admin.get-cities') }}',
                    type: 'GET',
                    data: { state_id: stateId },
                    success: function(response) {
                        if (response.cities && response.cities.length > 0) {
                            citySelect.prop('disabled', false);
                            response.cities.forEach(function(city) {
                                citySelect.append('<option value="' + city.id + '">' + city.name + '</option>');
                            });
                        } else {
                            citySelect.append('<option value="">{{ translate('messages.no_cities_found') }}</option>');
                        }
                    },
                    error: function() {
                        alert('{{ translate('messages.failed_to_load_cities') }}');
                    }
                });
            }
        });
        
        // City change - load fulfillment centers
        $('#city_id').on('change', function() {
            var cityId = $(this).val();
            var fulfillmentCenterSelect = $('#fulfillment_center_id');
            
            // Reset fulfillment center dropdown
            fulfillmentCenterSelect.html('<option value="">{{ translate('messages.select_fulfillment_center') }}</option>').prop('disabled', true);
            
            if (cityId) {
                $.ajax({
                    url: '{{ route('admin.get-fulfillment-centers') }}',
                    type: 'GET',
                    data: { city_id: cityId },
                    success: function(response) {
                        if (response.fulfillment_centers && response.fulfillment_centers.length > 0) {
                            fulfillmentCenterSelect.prop('disabled', false);
                            response.fulfillment_centers.forEach(function(fc) {
                                fulfillmentCenterSelect.append('<option value="' + fc.id + '">' + fc.name + '</option>');
                            });
                        } else {
                            fulfillmentCenterSelect.append('<option value="">{{ translate('messages.no_fulfillment_centers_found') }}</option>');
                        }
                    },
                    error: function() {
                        alert('{{ translate('messages.failed_to_load_fulfillment_centers') }}');
                    }
                });
            }
        });
        
        // Restore old values if form was submitted with errors
        @if(old('state_id'))
            var oldStateId = '{{ old('state_id') }}';
            var oldCityId = '{{ old('city_id') }}';
            var oldFulfillmentCenterId = '{{ old('fulfillment_center_id') }}';
            
            $('#state_id').val(oldStateId).trigger('change');
            setTimeout(function() {
                if (oldCityId) {
                    $('#city_id').val(oldCityId).trigger('change');
                    setTimeout(function() {
                        if (oldFulfillmentCenterId) {
                            $('#fulfillment_center_id').val(oldFulfillmentCenterId);
                        }
                    }, 500);
                }
            }, 500);
        @endif
    });
    
    function previewImages(input) {
        var container = document.getElementById('image-preview-container');
        container.innerHTML = '';
        imageFiles = [];
        
        if (input.files && input.files.length > 0) {
            var validFiles = [];
            var hasError = false;
            
            for (var i = 0; i < input.files.length; i++) {
                var file = input.files[i];
                
                // Check file size
                if (file.size > maxFileSize) {
                    alert('File "' + file.name + '" exceeds the maximum file size of 15MB. Please choose a smaller file.');
                    hasError = true;
                    continue;
                }
                
                validFiles.push(file);
                imageFiles.push(file);
                
                var reader = new FileReader();
                reader.onload = function(e) {
                    var div = document.createElement('div');
                    div.className = 'image-preview-item';
                    div.innerHTML = '<img src="' + e.target.result + '" alt="Preview">';
                    container.appendChild(div);
                };
                reader.readAsDataURL(file);
            }
            
            // Reset input if there were invalid files
            if (hasError) {
                var dataTransfer = new DataTransfer();
                validFiles.forEach(function(file) {
                    dataTransfer.items.add(file);
                });
                input.files = dataTransfer.files;
            }
        }
    }

    // Form validation
    document.addEventListener('DOMContentLoaded', function() {
        var form = document.getElementById('product-form');
        if (!form) return;

        // Helper function to show error message
        function showError(fieldId, message) {
            var field = document.getElementById(fieldId);
            if (!field) return;

            // Remove existing error message
            var existingError = field.parentElement.querySelector('.validation-error');
            if (existingError) {
                existingError.remove();
            }

            // Add error class to field
            field.classList.add('is-invalid');

            // Create and show error message
            var errorDiv = document.createElement('div');
            errorDiv.className = 'validation-error text-danger mt-1';
            errorDiv.style.fontSize = '0.875rem';
            errorDiv.textContent = message;
            field.parentElement.appendChild(errorDiv);
        }

        // Helper function to clear error
        function clearError(fieldId) {
            var field = document.getElementById(fieldId);
            if (!field) return;

            field.classList.remove('is-invalid');
            var existingError = field.parentElement.querySelector('.validation-error');
            if (existingError) {
                existingError.remove();
            }
        }

        // Real-time validation on blur
        var requiredFields = ['name', 'category_id', 'status', 'state_id', 'city_id', 'fulfillment_center_id', 'stock_qty', 'variant_sku', 'variant_price', 'variant_status'];
        requiredFields.forEach(function(fieldId) {
            var field = document.getElementById(fieldId);
            if (field) {
                field.addEventListener('blur', function() {
                    validateField(fieldId);
                });
                field.addEventListener('input', function() {
                    if (field.classList.contains('is-invalid')) {
                        validateField(fieldId);
                    }
                });
            }
        });

        // Validate individual field
        function validateField(fieldId) {
            var field = document.getElementById(fieldId);
            if (!field) return true;

            var value = field.value.trim();
            var isValid = true;
            var errorMessage = '';

            switch(fieldId) {
                case 'name':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Product name is required';
                    } else if (value.length > 255) {
                        isValid = false;
                        errorMessage = 'Product name must not exceed 255 characters';
                    }
                    break;
                case 'category_id':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Category is required';
                    }
                    break;
                case 'status':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Status is required';
                    }
                    break;
                case 'variant_sku':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'SKU is required';
                    } else if (value.length > 255) {
                        isValid = false;
                        errorMessage = 'SKU must not exceed 255 characters';
                    }
                    break;
                case 'variant_price':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Price is required';
                    } else {
                        var price = parseFloat(value);
                        if (isNaN(price)) {
                            isValid = false;
                            errorMessage = 'Price must be a valid number';
                        } else if (price < 0) {
                            isValid = false;
                            errorMessage = 'Price must be greater than or equal to 0';
                        }
                    }
                    break;
                case 'variant_status':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Variant status is required';
                    }
                    break;
                case 'state_id':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'State is required';
                    }
                    break;
                case 'city_id':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'City is required';
                    }
                    break;
                case 'fulfillment_center_id':
                    if (!value) {
                        isValid = false;
                        errorMessage = 'Fulfillment center is required';
                    }
                    break;
                case 'stock_qty':
                    if (value === '' || value === null) {
                        isValid = false;
                        errorMessage = 'Stock quantity is required';
                    } else {
                        var stockQty = parseInt(value);
                        if (isNaN(stockQty)) {
                            isValid = false;
                            errorMessage = 'Stock quantity must be a number';
                        } else if (stockQty < 0) {
                            isValid = false;
                            errorMessage = 'Stock quantity must be greater than or equal to 0';
                        }
                    }
                    break;
            }

            if (isValid) {
                clearError(fieldId);
            } else {
                showError(fieldId, errorMessage);
            }

            return isValid;
        }

        // Validate sale price
        var salePriceField = document.getElementById('variant_sale_price');
        if (salePriceField) {
            salePriceField.addEventListener('blur', function() {
                var salePrice = salePriceField.value.trim();
                if (salePrice) {
                    var salePriceNum = parseFloat(salePrice);
                    var priceField = document.getElementById('variant_price');
                    var price = priceField ? parseFloat(priceField.value) : 0;

                    if (isNaN(salePriceNum)) {
                        showError('variant_sale_price', 'Sale price must be a valid number');
                    } else if (salePriceNum < 0) {
                        showError('variant_sale_price', 'Sale price must be greater than or equal to 0');
                    } else if (price > 0 && salePriceNum > price) {
                        showError('variant_sale_price', 'Sale price must be less than or equal to regular price');
                    } else {
                        clearError('variant_sale_price');
                    }
                } else {
                    clearError('variant_sale_price');
                }
            });
        }

        // Validate short description length
        var shortDescField = document.getElementById('short_description');
        if (shortDescField) {
            shortDescField.addEventListener('input', function() {
                if (this.value.length > 500) {
                    showError('short_description', 'Short description must not exceed 500 characters');
                } else {
                    clearError('short_description');
                }
            });
        }

        // Validate images
        var imagesField = document.getElementById('images');
        if (imagesField) {
            imagesField.addEventListener('change', function() {
                if (this.files && this.files.length > 0) {
                    var allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
                    var hasInvalidFile = false;

                    for (var i = 0; i < this.files.length; i++) {
                        var file = this.files[i];
                        if (!allowedTypes.includes(file.type)) {
                            hasInvalidFile = true;
                            showError('images', 'Only JPG, PNG, GIF, and WEBP image formats are allowed');
                            break;
                        }
                    }

                    if (!hasInvalidFile) {
                        clearError('images');
                    }
                }
            });
        }

        // Form submit validation
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            var isValid = true;
            var firstErrorField = null;

            // Validate all required fields
            requiredFields.forEach(function(fieldId) {
                if (!validateField(fieldId)) {
                    isValid = false;
                    if (!firstErrorField) {
                        firstErrorField = document.getElementById(fieldId);
                    }
                }
            });

            // Validate sale price if provided
            if (salePriceField && salePriceField.value.trim()) {
                var salePrice = parseFloat(salePriceField.value);
                var price = parseFloat(document.getElementById('variant_price').value);
                
                if (isNaN(salePrice) || salePrice < 0 || (price > 0 && salePrice > price)) {
                    isValid = false;
                    if (!firstErrorField) {
                        firstErrorField = salePriceField;
                    }
                    if (isNaN(salePrice) || salePrice < 0) {
                        showError('variant_sale_price', 'Sale price must be a valid number greater than or equal to 0');
                    } else {
                        showError('variant_sale_price', 'Sale price must be less than or equal to regular price');
                    }
                }
            }

            // Validate short description length
            if (shortDescField && shortDescField.value.length > 500) {
                isValid = false;
                if (!firstErrorField) {
                    firstErrorField = shortDescField;
                }
                showError('short_description', 'Short description must not exceed 500 characters');
            }

            // Validate images if provided
            if (imagesField && imagesField.files && imagesField.files.length > 0) {
                var allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
                for (var i = 0; i < imagesField.files.length; i++) {
                    var file = imagesField.files[i];
                    if (!allowedTypes.includes(file.type)) {
                        isValid = false;
                        if (!firstErrorField) {
                            firstErrorField = imagesField;
                        }
                        showError('images', 'Only JPG, PNG, GIF, and WEBP image formats are allowed');
                        break;
                    }
                    if (file.size > maxFileSize) {
                        isValid = false;
                        if (!firstErrorField) {
                            firstErrorField = imagesField;
                        }
                        showError('images', 'File "' + file.name + '" exceeds the maximum file size of 15MB');
                        break;
                    }
                }
            }

            if (!isValid) {
                // Scroll to first error field
                if (firstErrorField) {
                    firstErrorField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    firstErrorField.focus();
                }
                return false;
            }

            // If validation passes, submit the form
            form.submit();
        });
    });
</script>
@endpush


```


Checking the layout for jQuery and verifying the implementation:



Checking where scripts are included in the layout:



jQuery is available (used in the layout). Summary of changes:

## Implementation summary

### 1. Database structure
- Uses existing `warehouse_products` table
- Maps `product_variant_id` to `warehouse_id` (fulfillment_center)
- Stores `stock_qty` and `reserved_qty`

### 2. UI changes (Add Product form)
- Added State dropdown (required)
- Added City dropdown (dependent on State, required)
- Added Fulfillment Center dropdown (dependent on City, required)
- Added Stock Quantity input (required, >= 0)

### 3. AJAX endpoints
- `GET /admin/get-cities?state_id=` ‚Äî Returns cities for a state
- `GET /admin/get-fulfillment-centers?city_id=` ‚Äî Returns fulfillment centers for a city

### 4. JavaScript functionality
- Dependent dropdowns with AJAX
- Auto-populates City when State changes
- Auto-populates Fulfillment Center when City changes
- Restores old values on validation errors
- Disables dependent dropdowns until parent is selected

### 5. Backend validation
- `state_id`: required, exists in states
- `city_id`: required, exists in cities
- `fulfillment_center_id`: required, exists in fulfillment_centers
- `stock_qty`: required, integer, >= 0

### 6. Controller modifications
- `ProductController@create`: Loads states
- `ProductController@store`: Saves `WarehouseProduct` mapping in transaction
- `ProductController@getCities`: AJAX endpoint for cities
- `ProductController@getFulfillmentCenters`: AJAX endpoint for fulfillment centers

### 7. Translation keys
- `select_state`, `select_city`, `select_fulfillment_center`
- `stock_quantity`
- Error messages for validation

### 8. Frontend validation
- Client-side validation for new fields
- Real-time error feedback
- Prevents form submission if validation fails

## Features
- Location-based product assignment
- Multi-warehouse support
- Stock management per fulfillment center
- Existing APIs unchanged
- Transaction-safe saves
- User-friendly dependent dropdowns

The implementation follows existing patterns and does not modify existing product APIs or business logic. Products are now assigned to fulfillment centers with stock quantities, enabling location-based availability management.

---

**User**

Perfect, but same i want to in edit product functionality

---

**Cursor**


Adding the same State, City, Fulfillment Center, and Stock Quantity fields to the Edit Product form. Reviewing the current edit implementation:



Updating the edit functionality to include the same fields:


```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Product;
use App\Models\Category;
use App\Models\Brand;
use App\Models\ProductVariant;
use App\Models\ProductImage;
use App\Models\State;
use App\Models\City;
use App\Models\FulfillmentCenter;
use App\Models\WarehouseProduct;
use Illuminate\Http\Request;
use App\CentralLogics\ToastrWrapper as Toastr;
use App\CentralLogics\Helpers;
use Illuminate\Support\Str;
use Illuminate\Support\Facades\DB;

class ProductController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index(Request $request)
    {
        $query = Product::with(['category', 'brand', 'variants', 'images']);
        
        // Search
        $search = trim($request->input('search', ''));
        if ($search !== '') {
            $query->where(function ($q) use ($search) {
                $q->where('name', 'like', "%{$search}%")
                    ->orWhere('description', 'like', "%{$search}%");
            });
        }
        
        // Filter by status
        $status = $request->input('status');
        if ($status !== null && $status !== '') {
            $query->where('status', $status);
        }
        
        // Filter by category
        $categoryId = $request->input('category_id');
        if (!empty($categoryId) && is_numeric($categoryId) && (int)$categoryId > 0) {
            $query->where('category_id', (int)$categoryId);
        }
        
        // Filter by trending
        $isTrending = $request->input('is_trending');
        if ($isTrending !== null && $isTrending !== '') {
            $query->where('is_trending', (bool)$isTrending);
        }
        
        // Filter by latest
        $isLatest = $request->input('is_latest');
        if ($isLatest !== null && $isLatest !== '') {
            $query->where('is_latest', (bool)$isLatest);
        }
        
        // Filter by express_30
        $isExpress30 = $request->input('is_express_30');
        if ($isExpress30 !== null && $isExpress30 !== '') {
            $query->where('is_express_30', (bool)$isExpress30);
        }
        
        $products = $query->orderBy('created_at', 'desc')->paginate(25);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        
        return view('admin-views.products.index', compact('products', 'categories'));
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        $states = State::orderBy('name', 'asc')->get();
        return view('admin-views.products.create', compact('categories', 'brands', 'states'));
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        DB::beginTransaction();
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Variant fields
                'variant_sku' => 'required|string|max:255',
                'variant_price' => 'required|numeric|min:0',
                'variant_sale_price' => 'nullable|numeric|min:0',
                'variant_status' => 'required|in:active,inactive',
                // Location & Fulfillment Center
                'state_id' => 'required|exists:states,id',
                'city_id' => 'required|exists:cities,id',
                'fulfillment_center_id' => 'required|exists:fulfillment_centers,id',
                'stock_qty' => 'required|integer|min:0',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:15360',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'variant_sku.required' => translate('messages.SKU is required!'),
                'variant_price.required' => translate('messages.Price is required!'),
                'variant_price.numeric' => translate('messages.Price must be a number!'),
                'variant_price.min' => translate('messages.Price must be greater than or equal to 0!'),
                'variant_sale_price.numeric' => translate('messages.Sale price must be a number!'),
                'variant_sale_price.min' => translate('messages.Sale price must be greater than or equal to 0!'),
                'state_id.required' => translate('messages.State is required!'),
                'state_id.exists' => translate('messages.State not found!'),
                'city_id.required' => translate('messages.City is required!'),
                'city_id.exists' => translate('messages.City not found!'),
                'fulfillment_center_id.required' => translate('messages.Fulfillment center is required!'),
                'fulfillment_center_id.exists' => translate('messages.Fulfillment center not found!'),
                'stock_qty.required' => translate('messages.Stock quantity is required!'),
                'stock_qty.integer' => translate('messages.Stock quantity must be a number!'),
                'stock_qty.min' => translate('messages.Stock quantity must be greater than or equal to 0!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 15MB!'),
            ]);

            // Check if SKU already exists
            if (ProductVariant::where('sku', $request->variant_sku)->exists()) {
                DB::rollBack();
                Toastr::error(translate('messages.SKU already exists!'));
                return back()->withInput();
            }

            // Generate unique slug
            $baseSlug = Str::slug($request->name);
            $slug = $baseSlug;
            $counter = 1;
            while (Product::where('slug', $slug)->exists()) {
                $slug = $baseSlug . '-' . uniqid() . '-' . $counter;
                $counter++;
            }

            // Create product
            $product = new Product();
            $product->name = $request->name;
            $product->slug = $slug;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            
            if (!$product->save()) {
                throw new \Exception('Failed to save product');
            }

            // Create default variant
            $variant = new ProductVariant();
            $variant->product_id = $product->id;
            $variant->sku = $request->variant_sku;
            $variant->price = $request->variant_price;
            $variant->sale_price = $request->variant_sale_price ?? null;
            $variant->status = $request->variant_status;
            
            if (!$variant->save()) {
                throw new \Exception('Failed to save product variant');
            }

            // Create warehouse product mapping
            if ($request->fulfillment_center_id && $request->stock_qty !== null) {
                $warehouseProduct = new WarehouseProduct();
                $warehouseProduct->warehouse_id = $request->fulfillment_center_id;
                $warehouseProduct->product_variant_id = $variant->id;
                $warehouseProduct->stock_qty = $request->stock_qty ?? 0;
                $warehouseProduct->reserved_qty = 0;
                
                if (!$warehouseProduct->save()) {
                    throw new \Exception('Failed to save warehouse product mapping');
                }
            }

            // Handle images
            if ($request->hasFile('images')) {
                $sortOrder = 0;
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant->id;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = ($sortOrder === 0) ? true : false;
                                $productImage->sort_order = $sortOrder;
                                
                                if (!$productImage->save()) {
                                    \Log::warning('Failed to save product image: ' . $imageName);
                                } else {
                                    $sortOrder++;
                                }
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                            // Continue with other images even if one fails
                        }
                    }
                }
            }

            DB::commit();
            
            Toastr::success(translate('messages.product_added'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            DB::rollBack();
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            DB::rollBack();
            Toastr::error(translate('messages.failed_to_add_product') . ': ' . $e->getMessage());
            \Log::error('Product creation error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->except(['images'])
            ]);
            return back()->withInput();
        }
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit($id)
    {
        $product = Product::with(['category', 'brand', 'variants.warehouseProducts.warehouse', 'images'])->findOrFail($id);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        $states = State::orderBy('name', 'asc')->get();
        
        // Get warehouse product mapping for the first variant (default variant)
        $warehouseProduct = null;
        $selectedStateId = null;
        $selectedCityId = null;
        $selectedFulfillmentCenterId = null;
        $stockQty = 0;
        
        if ($product->variants->isNotEmpty()) {
            $firstVariant = $product->variants->first();
            $warehouseProduct = WarehouseProduct::where('product_variant_id', $firstVariant->id)
                ->with('warehouse')
                ->first();
            
            if ($warehouseProduct && $warehouseProduct->warehouse) {
                $selectedFulfillmentCenterId = $warehouseProduct->warehouse_id;
                $selectedCityId = $warehouseProduct->warehouse->city_id;
                $selectedStateId = $warehouseProduct->warehouse->state_id;
                $stockQty = $warehouseProduct->stock_qty;
            }
        }
        
        return view('admin-views.products.edit', compact('product', 'categories', 'brands', 'states', 'warehouseProduct', 'selectedStateId', 'selectedCityId', 'selectedFulfillmentCenterId', 'stockQty'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, $id)
    {
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:15360',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 15MB!'),
            ]);

            $product = Product::findOrFail($id);
            $product->name = $request->name;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            $product->save();

            // Handle new images
            if ($request->hasFile('images')) {
                $existingImages = ProductImage::where('product_id', $product->id)->count();
                $sortOrder = $existingImages;
                
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $variant = $product->variants->first();
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant ? $variant->id : null;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_updated'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_product') . ': ' . $e->getMessage());
            \Log::error('Product update error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy($id)
    {
        try {
            $product = Product::findOrFail($id);
            
            // Delete product images
            foreach ($product->images as $image) {
                if ($image->image_url) {
                    try {
                        $storageType = Helpers::getDisk();
                        if ($storageType === 's3') {
                            \Storage::disk('s3')->delete('product/' . $image->image_url);
                        } else {
                            \Storage::disk('public')->delete('product/' . $image->image_url);
                        }
                    } catch (\Exception $e) {
                        \Log::warning('Failed to delete product image: ' . $e->getMessage());
                    }
                }
                $image->delete();
            }
            
            // Delete variants (this will cascade delete related data)
            $product->variants()->delete();
            
            $product->delete();
            
            Toastr::success(translate('messages.product_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_product') . ': ' . $e->getMessage());
            \Log::error('Product deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product status
     */
    public function statusToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $product->status = $request->status;
            $product->save();
            Toastr::success(translate('messages.product_status_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_status') . ': ' . $e->getMessage());
            \Log::error('Product status update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product flag (trending, latest, express_30)
     */
    public function flagToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $flag = $request->flag; // is_trending, is_latest, is_express_30
            
            if (!in_array($flag, ['is_trending', 'is_latest', 'is_express_30'])) {
                Toastr::error(translate('messages.Invalid flag!'));
                return back();
            }
            
            $product->$flag = $request->value;
            $product->save();
            
            Toastr::success(translate('messages.product_flag_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_flag') . ': ' . $e->getMessage());
            \Log::error('Product flag update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Delete product image
     */
    public function deleteImage($id)
    {
        try {
            $image = ProductImage::findOrFail($id);
            
            // Delete file
            if ($image->image_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('product/' . $image->image_url);
                    } else {
                        \Storage::disk('public')->delete('product/' . $image->image_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete product image file: ' . $e->getMessage());
                }
            }
            
            $image->delete();
            
            Toastr::success(translate('messages.image_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_image') . ': ' . $e->getMessage());
            \Log::error('Image deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Get cities by state (AJAX)
     */
    public function getCities(Request $request)
    {
        $stateId = $request->input('state_id');
        
        if (!$stateId) {
            return response()->json(['cities' => []]);
        }

        $cities = City::where('state_id', $stateId)
            ->orderBy('name', 'asc')
            ->get(['id', 'name']);

        return response()->json(['cities' => $cities]);
    }

    /**
     * Get fulfillment centers by city (AJAX)
     */
    public function getFulfillmentCenters(Request $request)
    {
        $cityId = $request->input('city_id');
        
        if (!$cityId) {
            return response()->json(['fulfillment_centers' => []]);
        }

        $fulfillmentCenters = FulfillmentCenter::where('city_id', $cityId)
            ->where('status', 'active')
            ->orderBy('name', 'asc')
            ->get(['id', 'name']);

        return response()->json(['fulfillment_centers' => $fulfillmentCenters]);
    }
}


```

```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Product;
use App\Models\Category;
use App\Models\Brand;
use App\Models\ProductVariant;
use App\Models\ProductImage;
use App\Models\State;
use App\Models\City;
use App\Models\FulfillmentCenter;
use App\Models\WarehouseProduct;
use Illuminate\Http\Request;
use App\CentralLogics\ToastrWrapper as Toastr;
use App\CentralLogics\Helpers;
use Illuminate\Support\Str;
use Illuminate\Support\Facades\DB;

class ProductController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index(Request $request)
    {
        $query = Product::with(['category', 'brand', 'variants', 'images']);
        
        // Search
        $search = trim($request->input('search', ''));
        if ($search !== '') {
            $query->where(function ($q) use ($search) {
                $q->where('name', 'like', "%{$search}%")
                    ->orWhere('description', 'like', "%{$search}%");
            });
        }
        
        // Filter by status
        $status = $request->input('status');
        if ($status !== null && $status !== '') {
            $query->where('status', $status);
        }
        
        // Filter by category
        $categoryId = $request->input('category_id');
        if (!empty($categoryId) && is_numeric($categoryId) && (int)$categoryId > 0) {
            $query->where('category_id', (int)$categoryId);
        }
        
        // Filter by trending
        $isTrending = $request->input('is_trending');
        if ($isTrending !== null && $isTrending !== '') {
            $query->where('is_trending', (bool)$isTrending);
        }
        
        // Filter by latest
        $isLatest = $request->input('is_latest');
        if ($isLatest !== null && $isLatest !== '') {
            $query->where('is_latest', (bool)$isLatest);
        }
        
        // Filter by express_30
        $isExpress30 = $request->input('is_express_30');
        if ($isExpress30 !== null && $isExpress30 !== '') {
            $query->where('is_express_30', (bool)$isExpress30);
        }
        
        $products = $query->orderBy('created_at', 'desc')->paginate(25);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        
        return view('admin-views.products.index', compact('products', 'categories'));
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        $states = State::orderBy('name', 'asc')->get();
        return view('admin-views.products.create', compact('categories', 'brands', 'states'));
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        DB::beginTransaction();
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Variant fields
                'variant_sku' => 'required|string|max:255',
                'variant_price' => 'required|numeric|min:0',
                'variant_sale_price' => 'nullable|numeric|min:0',
                'variant_status' => 'required|in:active,inactive',
                // Location & Fulfillment Center
                'state_id' => 'required|exists:states,id',
                'city_id' => 'required|exists:cities,id',
                'fulfillment_center_id' => 'required|exists:fulfillment_centers,id',
                'stock_qty' => 'required|integer|min:0',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:15360',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'variant_sku.required' => translate('messages.SKU is required!'),
                'variant_price.required' => translate('messages.Price is required!'),
                'variant_price.numeric' => translate('messages.Price must be a number!'),
                'variant_price.min' => translate('messages.Price must be greater than or equal to 0!'),
                'variant_sale_price.numeric' => translate('messages.Sale price must be a number!'),
                'variant_sale_price.min' => translate('messages.Sale price must be greater than or equal to 0!'),
                'state_id.required' => translate('messages.State is required!'),
                'state_id.exists' => translate('messages.State not found!'),
                'city_id.required' => translate('messages.City is required!'),
                'city_id.exists' => translate('messages.City not found!'),
                'fulfillment_center_id.required' => translate('messages.Fulfillment center is required!'),
                'fulfillment_center_id.exists' => translate('messages.Fulfillment center not found!'),
                'stock_qty.required' => translate('messages.Stock quantity is required!'),
                'stock_qty.integer' => translate('messages.Stock quantity must be a number!'),
                'stock_qty.min' => translate('messages.Stock quantity must be greater than or equal to 0!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 15MB!'),
            ]);

            // Check if SKU already exists
            if (ProductVariant::where('sku', $request->variant_sku)->exists()) {
                DB::rollBack();
                Toastr::error(translate('messages.SKU already exists!'));
                return back()->withInput();
            }

            // Generate unique slug
            $baseSlug = Str::slug($request->name);
            $slug = $baseSlug;
            $counter = 1;
            while (Product::where('slug', $slug)->exists()) {
                $slug = $baseSlug . '-' . uniqid() . '-' . $counter;
                $counter++;
            }

            // Create product
            $product = new Product();
            $product->name = $request->name;
            $product->slug = $slug;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            
            if (!$product->save()) {
                throw new \Exception('Failed to save product');
            }

            // Create default variant
            $variant = new ProductVariant();
            $variant->product_id = $product->id;
            $variant->sku = $request->variant_sku;
            $variant->price = $request->variant_price;
            $variant->sale_price = $request->variant_sale_price ?? null;
            $variant->status = $request->variant_status;
            
            if (!$variant->save()) {
                throw new \Exception('Failed to save product variant');
            }

            // Create warehouse product mapping
            if ($request->fulfillment_center_id && $request->stock_qty !== null) {
                $warehouseProduct = new WarehouseProduct();
                $warehouseProduct->warehouse_id = $request->fulfillment_center_id;
                $warehouseProduct->product_variant_id = $variant->id;
                $warehouseProduct->stock_qty = $request->stock_qty ?? 0;
                $warehouseProduct->reserved_qty = 0;
                
                if (!$warehouseProduct->save()) {
                    throw new \Exception('Failed to save warehouse product mapping');
                }
            }

            // Handle images
            if ($request->hasFile('images')) {
                $sortOrder = 0;
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant->id;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = ($sortOrder === 0) ? true : false;
                                $productImage->sort_order = $sortOrder;
                                
                                if (!$productImage->save()) {
                                    \Log::warning('Failed to save product image: ' . $imageName);
                                } else {
                                    $sortOrder++;
                                }
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                            // Continue with other images even if one fails
                        }
                    }
                }
            }

            DB::commit();
            
            Toastr::success(translate('messages.product_added'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            DB::rollBack();
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            DB::rollBack();
            Toastr::error(translate('messages.failed_to_add_product') . ': ' . $e->getMessage());
            \Log::error('Product creation error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->except(['images'])
            ]);
            return back()->withInput();
        }
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit($id)
    {
        $product = Product::with(['category', 'brand', 'variants.warehouseProducts.warehouse', 'images'])->findOrFail($id);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        $states = State::orderBy('name', 'asc')->get();
        
        // Get warehouse product mapping for the first variant (default variant)
        $warehouseProduct = null;
        $selectedStateId = null;
        $selectedCityId = null;
        $selectedFulfillmentCenterId = null;
        $stockQty = 0;
        
        if ($product->variants->isNotEmpty()) {
            $firstVariant = $product->variants->first();
            $warehouseProduct = WarehouseProduct::where('product_variant_id', $firstVariant->id)
                ->with('warehouse')
                ->first();
            
            if ($warehouseProduct && $warehouseProduct->warehouse) {
                $selectedFulfillmentCenterId = $warehouseProduct->warehouse_id;
                $selectedCityId = $warehouseProduct->warehouse->city_id;
                $selectedStateId = $warehouseProduct->warehouse->state_id;
                $stockQty = $warehouseProduct->stock_qty;
            }
        }
        
        return view('admin-views.products.edit', compact('product', 'categories', 'brands', 'states', 'warehouseProduct', 'selectedStateId', 'selectedCityId', 'selectedFulfillmentCenterId', 'stockQty'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, $id)
    {
        DB::beginTransaction();
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Location & Fulfillment Center
                'state_id' => 'required|exists:states,id',
                'city_id' => 'required|exists:cities,id',
                'fulfillment_center_id' => 'required|exists:fulfillment_centers,id',
                'stock_qty' => 'required|integer|min:0',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:15360',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'state_id.required' => translate('messages.State is required!'),
                'state_id.exists' => translate('messages.State not found!'),
                'city_id.required' => translate('messages.City is required!'),
                'city_id.exists' => translate('messages.City not found!'),
                'fulfillment_center_id.required' => translate('messages.Fulfillment center is required!'),
                'fulfillment_center_id.exists' => translate('messages.Fulfillment center not found!'),
                'stock_qty.required' => translate('messages.Stock quantity is required!'),
                'stock_qty.integer' => translate('messages.Stock quantity must be a number!'),
                'stock_qty.min' => translate('messages.Stock quantity must be greater than or equal to 0!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 15MB!'),
            ]);

            $product = Product::findOrFail($id);
            $product->name = $request->name;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            
            if (!$product->save()) {
                throw new \Exception('Failed to update product');
            }

            // Update or create warehouse product mapping for the first variant
            $firstVariant = $product->variants->first();
            if ($firstVariant && $request->fulfillment_center_id && $request->stock_qty !== null) {
                $warehouseProduct = WarehouseProduct::where('product_variant_id', $firstVariant->id)->first();
                
                if ($warehouseProduct) {
                    // Update existing mapping
                    $warehouseProduct->warehouse_id = $request->fulfillment_center_id;
                    $warehouseProduct->stock_qty = $request->stock_qty ?? 0;
                    // Keep reserved_qty as is
                    if (!$warehouseProduct->save()) {
                        throw new \Exception('Failed to update warehouse product mapping');
                    }
                } else {
                    // Create new mapping
                    $warehouseProduct = new WarehouseProduct();
                    $warehouseProduct->warehouse_id = $request->fulfillment_center_id;
                    $warehouseProduct->product_variant_id = $firstVariant->id;
                    $warehouseProduct->stock_qty = $request->stock_qty ?? 0;
                    $warehouseProduct->reserved_qty = 0;
                    
                    if (!$warehouseProduct->save()) {
                        throw new \Exception('Failed to create warehouse product mapping');
                    }
                }
            }

            // Handle new images
            if ($request->hasFile('images')) {
                $existingImages = ProductImage::where('product_id', $product->id)->count();
                $sortOrder = $existingImages;
                
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $variant = $product->variants->first();
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant ? $variant->id : null;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            Toastr::success(translate('messages.product_updated'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_product') . ': ' . $e->getMessage());
            \Log::error('Product update error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->all()
            ]);
            return back()->withInput();
        }
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy($id)
    {
        try {
            $product = Product::findOrFail($id);
            
            // Delete product images
            foreach ($product->images as $image) {
                if ($image->image_url) {
                    try {
                        $storageType = Helpers::getDisk();
                        if ($storageType === 's3') {
                            \Storage::disk('s3')->delete('product/' . $image->image_url);
                        } else {
                            \Storage::disk('public')->delete('product/' . $image->image_url);
                        }
                    } catch (\Exception $e) {
                        \Log::warning('Failed to delete product image: ' . $e->getMessage());
                    }
                }
                $image->delete();
            }
            
            // Delete variants (this will cascade delete related data)
            $product->variants()->delete();
            
            $product->delete();
            
            Toastr::success(translate('messages.product_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_product') . ': ' . $e->getMessage());
            \Log::error('Product deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product status
     */
    public function statusToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $product->status = $request->status;
            $product->save();
            Toastr::success(translate('messages.product_status_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_status') . ': ' . $e->getMessage());
            \Log::error('Product status update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product flag (trending, latest, express_30)
     */
    public function flagToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $flag = $request->flag; // is_trending, is_latest, is_express_30
            
            if (!in_array($flag, ['is_trending', 'is_latest', 'is_express_30'])) {
                Toastr::error(translate('messages.Invalid flag!'));
                return back();
            }
            
            $product->$flag = $request->value;
            $product->save();
            
            Toastr::success(translate('messages.product_flag_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_flag') . ': ' . $e->getMessage());
            \Log::error('Product flag update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Delete product image
     */
    public function deleteImage($id)
    {
        try {
            $image = ProductImage::findOrFail($id);
            
            // Delete file
            if ($image->image_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('product/' . $image->image_url);
                    } else {
                        \Storage::disk('public')->delete('product/' . $image->image_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete product image file: ' . $e->getMessage());
                }
            }
            
            $image->delete();
            
            Toastr::success(translate('messages.image_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_image') . ': ' . $e->getMessage());
            \Log::error('Image deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Get cities by state (AJAX)
     */
    public function getCities(Request $request)
    {
        $stateId = $request->input('state_id');
        
        if (!$stateId) {
            return response()->json(['cities' => []]);
        }

        $cities = City::where('state_id', $stateId)
            ->orderBy('name', 'asc')
            ->get(['id', 'name']);

        return response()->json(['cities' => $cities]);
    }

    /**
     * Get fulfillment centers by city (AJAX)
     */
    public function getFulfillmentCenters(Request $request)
    {
        $cityId = $request->input('city_id');
        
        if (!$cityId) {
            return response()->json(['fulfillment_centers' => []]);
        }

        $fulfillmentCenters = FulfillmentCenter::where('city_id', $cityId)
            ->where('status', 'active')
            ->orderBy('name', 'asc')
            ->get(['id', 'name']);

        return response()->json(['fulfillment_centers' => $fulfillmentCenters]);
    }
}


```

```php
            DB::commit();
            
            Toastr::success(translate('messages.product_updated'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            DB::rollBack();
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            DB::rollBack();
            Toastr::error(translate('messages.failed_to_update_product') . ': ' . $e->getMessage());
            \Log::error('Product update error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->except(['images'])
            ]);
            return back()->withInput();
        }
    }
```


Adding location fields to the edit form:


```blade
@extends('layouts.admin.app')

@section('title', translate('messages.edit_product'))

@push('css_or_js')
<style>
    .card {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075), 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        border: 1px solid rgba(0, 0, 0, 0.125);
        border-radius: 0.5rem;
    }
    .card-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .card-footer {
        background-color: #f8f9fa;
        border-top: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .image-preview-container {
        margin-top: 15px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    .image-preview-item {
        position: relative;
        width: 120px;
        height: 120px;
    }
    .image-preview-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 8px;
        border: 2px solid #e4e6ef;
    }
    .image-preview-item .remove-image {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #dc3545;
        color: white;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 14px;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-edit"></i>
                </span>
                <span>
                    {{ translate('messages.edit_product') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">{{ translate('messages.edit_product') }}</h5>
                    </div>
                    <form action="{{ route('admin.products.update', $product->id) }}" method="post" enctype="multipart/form-data" id="product-form">
                        @csrf
                        @method('PUT')
                        <div class="card-body">
                            <div class="row">
                                <!-- Basic Info -->
                                <div class="col-md-12">
                                    <h5 class="mb-3">Basic Information</h5>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="name">Product Name <span class="text-danger">*</span></label>
                                        <input type="text" name="name" id="name" class="form-control" placeholder="Enter product name" value="{{ old('name', $product->name) }}" required maxlength="255">
                                        @error('name')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="category_id">Category <span class="text-danger">*</span></label>
                                        <select name="category_id" id="category_id" class="form-control" required>
                                            <option value="">Select Category</option>
                                            @foreach($categories as $category)
                                                <option value="{{ $category->id }}" {{ old('category_id', $product->category_id) == $category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('category_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="brand_id">Brand</label>
                                        <select name="brand_id" id="brand_id" class="form-control">
                                            <option value="">Select Brand</option>
                                            @foreach($brands as $brand)
                                                <option value="{{ $brand->id }}" {{ old('brand_id', $product->brand_id) == $brand->id ? 'selected' : '' }}>{{ $brand->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('brand_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="status">Status <span class="text-danger">*</span></label>
                                        <select name="status" id="status" class="form-control" required>
                                            <option value="active" {{ old('status', $product->status) == 'active' ? 'selected' : '' }}>Active</option>
                                            <option value="inactive" {{ old('status', $product->status) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                        </select>
                                        @error('status')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="short_description">Short Description</label>
                                        <textarea name="short_description" id="short_description" class="form-control" rows="2" placeholder="Enter short description (max 500 characters)" maxlength="500">{{ old('short_description', $product->short_description) }}</textarea>
                                        @error('short_description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="description">Description</label>
                                        <textarea name="description" id="description" class="form-control" rows="4" placeholder="Enter product description">{{ old('description', $product->description) }}</textarea>
                                        @error('description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Location & Fulfillment Center -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Location & Fulfillment Center</h5>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="state_id">State <span class="text-danger">*</span></label>
                                        <select name="state_id" id="state_id" class="form-control" required>
                                            <option value="">{{ translate('messages.select_state') }}</option>
                                            @foreach($states as $state)
                                                <option value="{{ $state->id }}" {{ old('state_id', $selectedStateId) == $state->id ? 'selected' : '' }}>{{ $state->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('state_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="city_id">City <span class="text-danger">*</span></label>
                                        <select name="city_id" id="city_id" class="form-control" required {{ $selectedCityId ? '' : 'disabled' }}>
                                            <option value="">{{ translate('messages.select_city') }}</option>
                                            @if($selectedCityId)
                                                @php
                                                    $cities = \App\Models\City::where('state_id', $selectedStateId)->orderBy('name', 'asc')->get();
                                                @endphp
                                                @foreach($cities as $city)
                                                    <option value="{{ $city->id }}" {{ old('city_id', $selectedCityId) == $city->id ? 'selected' : '' }}>{{ $city->name }}</option>
                                                @endforeach
                                            @endif
                                        </select>
                                        @error('city_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="fulfillment_center_id">Fulfillment Center <span class="text-danger">*</span></label>
                                        <select name="fulfillment_center_id" id="fulfillment_center_id" class="form-control" required {{ $selectedFulfillmentCenterId ? '' : 'disabled' }}>
                                            <option value="">{{ translate('messages.select_fulfillment_center') }}</option>
                                            @if($selectedFulfillmentCenterId)
                                                @php
                                                    $fulfillmentCenters = \App\Models\FulfillmentCenter::where('city_id', $selectedCityId)->where('status', 'active')->orderBy('name', 'asc')->get();
                                                @endphp
                                                @foreach($fulfillmentCenters as $fc)
                                                    <option value="{{ $fc->id }}" {{ old('fulfillment_center_id', $selectedFulfillmentCenterId) == $fc->id ? 'selected' : '' }}>{{ $fc->name }}</option>
                                                @endforeach
                                            @endif
                                        </select>
                                        @error('fulfillment_center_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="stock_qty">{{ translate('messages.stock_quantity') }} <span class="text-danger">*</span></label>
                                        <input type="number" name="stock_qty" id="stock_qty" class="form-control" placeholder="0" value="{{ old('stock_qty', $stockQty) }}" min="0" required>
                                        @error('stock_qty')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Images -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Images</h5>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="images">Add New Images</label>
                                        <input type="file" name="images[]" id="images" class="form-control" accept="image/*" multiple onchange="previewImages(this)">
                                        <small class="text-muted">Accepted formats: JPG, PNG, GIF, WEBP (Max: 15MB each). You can select multiple images.</small>
                                        <div class="image-preview-container" id="image-preview-container"></div>
                                        @error('images.*')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label">Existing Images</label>
                                        <div class="image-preview-container">
                                            @foreach($product->images as $image)
                                                <div class="image-preview-item">
                                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $image->image_url, \App\CentralLogics\Helpers::getDisk()) }}" alt="Product Image">
                                                    <a href="{{ route('admin.products.delete-image', $image->id) }}" 
                                                       class="remove-image" 
                                                       onclick="return confirm('Are you sure you want to delete this image?')"
                                                       title="Delete Image">
                                                        <i class="tio-delete-outlined"></i>
                                                    </a>
                                                </div>
                                            @endforeach
                                        </div>
                                    </div>
                                </div>

                                <!-- Flags -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Flags</h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Trending</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_trending" id="is_trending" value="1" {{ old('is_trending', $product->is_trending) ? 'checked' : '' }} switch="bool">
                                            <label for="is_trending" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls trending_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Latest</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_latest" id="is_latest" value="1" {{ old('is_latest', $product->is_latest) ? 'checked' : '' }} switch="bool">
                                            <label for="is_latest" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls latest_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Express-30</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_express_30" id="is_express_30" value="1" {{ old('is_express_30', $product->is_express_30) ? 'checked' : '' }} switch="bool">
                                            <label for="is_express_30" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls /api/express-30/products</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="btn--container justify-content-end">
                                <a href="{{ route('admin.products.index') }}" class="btn btn--reset">{{ translate('messages.cancel') }}</a>
                                <button type="submit" class="btn btn--primary">{{ translate('messages.submit') }}</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    var maxFileSize = 15 * 1024 * 1024; // 15MB in bytes
    
    function previewImages(input) {
        var container = document.getElementById('image-preview-container');
        
        if (input.files && input.files.length > 0) {
            var validFiles = [];
            var hasError = false;
            
            for (var i = 0; i < input.files.length; i++) {
                var file = input.files[i];
                
                // Check file size
                if (file.size > maxFileSize) {
                    alert('File "' + file.name + '" exceeds the maximum file size of 15MB. Please choose a smaller file.');
                    hasError = true;
                    continue;
                }
                
                validFiles.push(file);
                
                var reader = new FileReader();
                reader.onload = function(e) {
                    var div = document.createElement('div');
                    div.className = 'image-preview-item';
                    div.innerHTML = '<img src="' + e.target.result + '" alt="Preview">';
                    container.appendChild(div);
                };
                reader.readAsDataURL(file);
            }
            
            // Reset input if there were invalid files
            if (hasError) {
                var dataTransfer = new DataTransfer();
                validFiles.forEach(function(file) {
                    dataTransfer.items.add(file);
                });
                input.files = dataTransfer.files;
            }
        }
    }
</script>
@endpush


```

```blade
@push('script_2')
<script>
    var maxFileSize = 15 * 1024 * 1024; // 15MB in bytes
    
    // Dependent dropdowns for State, City, Fulfillment Center
    $(document).ready(function() {
        // State change - load cities
        $('#state_id').on('change', function() {
            var stateId = $(this).val();
            var citySelect = $('#city_id');
            var fulfillmentCenterSelect = $('#fulfillment_center_id');
            
            // Reset dependent dropdowns
            citySelect.html('<option value="">{{ translate('messages.select_city') }}</option>').prop('disabled', true);
            fulfillmentCenterSelect.html('<option value="">{{ translate('messages.select_fulfillment_center') }}</option>').prop('disabled', true);
            
            if (stateId) {
                $.ajax({
                    url: '{{ route('admin.get-cities') }}',
                    type: 'GET',
                    data: { state_id: stateId },
                    success: function(response) {
                        if (response.cities && response.cities.length > 0) {
                            citySelect.prop('disabled', false);
                            response.cities.forEach(function(city) {
                                citySelect.append('<option value="' + city.id + '">' + city.name + '</option>');
                            });
                            
                            // Restore old city value if exists
                            var oldCityId = '{{ old('city_id', $selectedCityId) }}';
                            if (oldCityId) {
                                citySelect.val(oldCityId).trigger('change');
                            }
                        } else {
                            citySelect.append('<option value="">{{ translate('messages.no_cities_found') }}</option>');
                        }
                    },
                    error: function() {
                        alert('{{ translate('messages.failed_to_load_cities') }}');
                    }
                });
            }
        });
        
        // City change - load fulfillment centers
        $('#city_id').on('change', function() {
            var cityId = $(this).val();
            var fulfillmentCenterSelect = $('#fulfillment_center_id');
            
            // Reset fulfillment center dropdown
            fulfillmentCenterSelect.html('<option value="">{{ translate('messages.select_fulfillment_center') }}</option>').prop('disabled', true);
            
            if (cityId) {
                $.ajax({
                    url: '{{ route('admin.get-fulfillment-centers') }}',
                    type: 'GET',
                    data: { city_id: cityId },
                    success: function(response) {
                        if (response.fulfillment_centers && response.fulfillment_centers.length > 0) {
                            fulfillmentCenterSelect.prop('disabled', false);
                            response.fulfillment_centers.forEach(function(fc) {
                                fulfillmentCenterSelect.append('<option value="' + fc.id + '">' + fc.name + '</option>');
                            });
                            
                            // Restore old fulfillment center value if exists
                            var oldFulfillmentCenterId = '{{ old('fulfillment_center_id', $selectedFulfillmentCenterId) }}';
                            if (oldFulfillmentCenterId) {
                                fulfillmentCenterSelect.val(oldFulfillmentCenterId);
                            }
                        } else {
                            fulfillmentCenterSelect.append('<option value="">{{ translate('messages.no_fulfillment_centers_found') }}</option>');
                        }
                    },
                    error: function() {
                        alert('{{ translate('messages.failed_to_load_fulfillment_centers') }}');
                    }
                });
            }
        });
        
        // Initialize dropdowns if state is already selected
        @if($selectedStateId)
            $('#state_id').trigger('change');
        @elseif(old('state_id'))
            $('#state_id').trigger('change');
        @endif
    });
    
    function previewImages(input) {
```


Checking the end of the edit file and adding client-side validation:


```blade
@extends('layouts.admin.app')

@section('title', translate('messages.edit_product'))

@push('css_or_js')
<style>
    .card {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075), 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        border: 1px solid rgba(0, 0, 0, 0.125);
        border-radius: 0.5rem;
    }
    .card-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .card-footer {
        background-color: #f8f9fa;
        border-top: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .image-preview-container {
        margin-top: 15px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    .image-preview-item {
        position: relative;
        width: 120px;
        height: 120px;
    }
    .image-preview-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 8px;
        border: 2px solid #e4e6ef;
    }
    .image-preview-item .remove-image {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #dc3545;
        color: white;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 14px;
    }
    
    /* Validation styles */
    .form-control.is-invalid {
        border-color: #dc3545;
        padding-right: calc(1.5em + 0.75rem);
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath d='m5.8 3.6.4.4L6 4.4l-.2-.4-.4-.4zm0 4.8L6 8.8l.2.4.4.4-.4-.4z'/%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right calc(0.375em + 0.1875rem) center;
        background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
    }
    
    .validation-error {
        display: block;
        margin-top: 0.25rem;
        font-size: 0.875rem;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-edit"></i>
                </span>
                <span>
                    {{ translate('messages.edit_product') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">{{ translate('messages.edit_product') }}</h5>
                    </div>
                    <form action="{{ route('admin.products.update', $product->id) }}" method="post" enctype="multipart/form-data" id="product-form">
                        @csrf
                        @method('PUT')
                        <div class="card-body">
                            <div class="row">
                                <!-- Basic Info -->
                                <div class="col-md-12">
                                    <h5 class="mb-3">Basic Information</h5>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="name">Product Name <span class="text-danger">*</span></label>
                                        <input type="text" name="name" id="name" class="form-control" placeholder="Enter product name" value="{{ old('name', $product->name) }}" required maxlength="255">
                                        @error('name')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="category_id">Category <span class="text-danger">*</span></label>
                                        <select name="category_id" id="category_id" class="form-control" required>
                                            <option value="">Select Category</option>
                                            @foreach($categories as $category)
                                                <option value="{{ $category->id }}" {{ old('category_id', $product->category_id) == $category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('category_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="brand_id">Brand</label>
                                        <select name="brand_id" id="brand_id" class="form-control">
                                            <option value="">Select Brand</option>
                                            @foreach($brands as $brand)
                                                <option value="{{ $brand->id }}" {{ old('brand_id', $product->brand_id) == $brand->id ? 'selected' : '' }}>{{ $brand->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('brand_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="status">Status <span class="text-danger">*</span></label>
                                        <select name="status" id="status" class="form-control" required>
                                            <option value="active" {{ old('status', $product->status) == 'active' ? 'selected' : '' }}>Active</option>
                                            <option value="inactive" {{ old('status', $product->status) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                        </select>
                                        @error('status')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="short_description">Short Description</label>
                                        <textarea name="short_description" id="short_description" class="form-control" rows="2" placeholder="Enter short description (max 500 characters)" maxlength="500">{{ old('short_description', $product->short_description) }}</textarea>
                                        @error('short_description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="description">Description</label>
                                        <textarea name="description" id="description" class="form-control" rows="4" placeholder="Enter product description">{{ old('description', $product->description) }}</textarea>
                                        @error('description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Location & Fulfillment Center -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Location & Fulfillment Center</h5>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="state_id">State <span class="text-danger">*</span></label>
                                        <select name="state_id" id="state_id" class="form-control" required>
                                            <option value="">{{ translate('messages.select_state') }}</option>
                                            @foreach($states as $state)
                                                <option value="{{ $state->id }}" {{ old('state_id', $selectedStateId) == $state->id ? 'selected' : '' }}>{{ $state->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('state_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="city_id">City <span class="text-danger">*</span></label>
                                        <select name="city_id" id="city_id" class="form-control" required {{ $selectedCityId ? '' : 'disabled' }}>
                                            <option value="">{{ translate('messages.select_city') }}</option>
                                            @if($selectedCityId)
                                                @php
                                                    $cities = \App\Models\City::where('state_id', $selectedStateId)->orderBy('name', 'asc')->get();
                                                @endphp
                                                @foreach($cities as $city)
                                                    <option value="{{ $city->id }}" {{ old('city_id', $selectedCityId) == $city->id ? 'selected' : '' }}>{{ $city->name }}</option>
                                                @endforeach
                                            @endif
                                        </select>
                                        @error('city_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="fulfillment_center_id">Fulfillment Center <span class="text-danger">*</span></label>
                                        <select name="fulfillment_center_id" id="fulfillment_center_id" class="form-control" required {{ $selectedFulfillmentCenterId ? '' : 'disabled' }}>
                                            <option value="">{{ translate('messages.select_fulfillment_center') }}</option>
                                            @if($selectedFulfillmentCenterId)
                                                @php
                                                    $fulfillmentCenters = \App\Models\FulfillmentCenter::where('city_id', $selectedCityId)->where('status', 'active')->orderBy('name', 'asc')->get();
                                                @endphp
                                                @foreach($fulfillmentCenters as $fc)
                                                    <option value="{{ $fc->id }}" {{ old('fulfillment_center_id', $selectedFulfillmentCenterId) == $fc->id ? 'selected' : '' }}>{{ $fc->name }}</option>
                                                @endforeach
                                            @endif
                                        </select>
                                        @error('fulfillment_center_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="stock_qty">{{ translate('messages.stock_quantity') }} <span class="text-danger">*</span></label>
                                        <input type="number" name="stock_qty" id="stock_qty" class="form-control" placeholder="0" value="{{ old('stock_qty', $stockQty) }}" min="0" required>
                                        @error('stock_qty')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Images -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Images</h5>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="images">Add New Images</label>
                                        <input type="file" name="images[]" id="images" class="form-control" accept="image/*" multiple onchange="previewImages(this)">
                                        <small class="text-muted">Accepted formats: JPG, PNG, GIF, WEBP (Max: 15MB each). You can select multiple images.</small>
                                        <div class="image-preview-container" id="image-preview-container"></div>
                                        @error('images.*')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label">Existing Images</label>
                                        <div class="image-preview-container">
                                            @foreach($product->images as $image)
                                                <div class="image-preview-item">
                                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $image->image_url, \App\CentralLogics\Helpers::getDisk()) }}" alt="Product Image">
                                                    <a href="{{ route('admin.products.delete-image', $image->id) }}" 
                                                       class="remove-image" 
                                                       onclick="return confirm('Are you sure you want to delete this image?')"
                                                       title="Delete Image">
                                                        <i class="tio-delete-outlined"></i>
                                                    </a>
                                                </div>
                                            @endforeach
                                        </div>
                                    </div>
                                </div>

                                <!-- Flags -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Flags</h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Trending</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_trending" id="is_trending" value="1" {{ old('is_trending', $product->is_trending) ? 'checked' : '' }} switch="bool">
                                            <label for="is_trending" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls trending_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Latest</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_latest" id="is_latest" value="1" {{ old('is_latest', $product->is_latest) ? 'checked' : '' }} switch="bool">
                                            <label for="is_latest" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls latest_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Express-30</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_express_30" id="is_express_30" value="1" {{ old('is_express_30', $product->is_express_30) ? 'checked' : '' }} switch="bool">
                                            <label for="is_express_30" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls /api/express-30/products</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="btn--container justify-content-end">
                                <a href="{{ route('admin.products.index') }}" class="btn btn--reset">{{ translate('messages.cancel') }}</a>
                                <button type="submit" class="btn btn--primary">{{ translate('messages.submit') }}</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    var maxFileSize = 15 * 1024 * 1024; // 15MB in bytes
    
    function previewImages(input) {
        var container = document.getElementById('image-preview-container');
        
        if (input.files && input.files.length > 0) {
            var validFiles = [];
            var hasError = false;
            
            for (var i = 0; i < input.files.length; i++) {
                var file = input.files[i];
                
                // Check file size
                if (file.size > maxFileSize) {
                    alert('File "' + file.name + '" exceeds the maximum file size of 15MB. Please choose a smaller file.');
                    hasError = true;
                    continue;
                }
                
                validFiles.push(file);
                
                var reader = new FileReader();
                reader.onload = function(e) {
                    var div = document.createElement('div');
                    div.className = 'image-preview-item';
                    div.innerHTML = '<img src="' + e.target.result + '" alt="Preview">';
                    container.appendChild(div);
                };
                reader.readAsDataURL(file);
            }
            
            // Reset input if there were invalid files
            if (hasError) {
                var dataTransfer = new DataTransfer();
                validFiles.forEach(function(file) {
                    dataTransfer.items.add(file);
                });
                input.files = dataTransfer.files;
            }
        }
    }
</script>
@endpush


```


Adding the dependent dropdown JavaScript to the edit form:


```blade
@extends('layouts.admin.app')

@section('title', translate('messages.edit_product'))

@push('css_or_js')
<style>
    .card {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075), 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        border: 1px solid rgba(0, 0, 0, 0.125);
        border-radius: 0.5rem;
    }
    .card-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .card-footer {
        background-color: #f8f9fa;
        border-top: 1px solid rgba(0, 0, 0, 0.125);
        padding: 1rem 1.25rem;
    }
    .image-preview-container {
        margin-top: 15px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    .image-preview-item {
        position: relative;
        width: 120px;
        height: 120px;
    }
    .image-preview-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 8px;
        border: 2px solid #e4e6ef;
    }
    .image-preview-item .remove-image {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #dc3545;
        color: white;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 14px;
    }
    
    /* Validation styles */
    .form-control.is-invalid {
        border-color: #dc3545;
        padding-right: calc(1.5em + 0.75rem);
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath d='m5.8 3.6.4.4L6 4.4l-.2-.4-.4-.4zm0 4.8L6 8.8l.2.4.4.4-.4-.4z'/%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right calc(0.375em + 0.1875rem) center;
        background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
    }
    
    .validation-error {
        display: block;
        margin-top: 0.25rem;
        font-size: 0.875rem;
    }
</style>
@endpush

@section('content')
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-header-title">
                <span class="page-header-icon">
                    <i class="tio-edit"></i>
                </span>
                <span>
                    {{ translate('messages.edit_product') }}
                </span>
            </h1>
        </div>
        <!-- End Page Header -->
        
        <div class="row gx-2 gx-lg-3">
            <div class="col-sm-12 col-lg-12 mb-3 mb-lg-2">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">{{ translate('messages.edit_product') }}</h5>
                    </div>
                    <form action="{{ route('admin.products.update', $product->id) }}" method="post" enctype="multipart/form-data" id="product-form">
                        @csrf
                        @method('PUT')
                        <div class="card-body">
                            <div class="row">
                                <!-- Basic Info -->
                                <div class="col-md-12">
                                    <h5 class="mb-3">Basic Information</h5>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="name">Product Name <span class="text-danger">*</span></label>
                                        <input type="text" name="name" id="name" class="form-control" placeholder="Enter product name" value="{{ old('name', $product->name) }}" required maxlength="255">
                                        @error('name')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="category_id">Category <span class="text-danger">*</span></label>
                                        <select name="category_id" id="category_id" class="form-control" required>
                                            <option value="">Select Category</option>
                                            @foreach($categories as $category)
                                                <option value="{{ $category->id }}" {{ old('category_id', $product->category_id) == $category->id ? 'selected' : '' }}>{{ $category->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('category_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="brand_id">Brand</label>
                                        <select name="brand_id" id="brand_id" class="form-control">
                                            <option value="">Select Brand</option>
                                            @foreach($brands as $brand)
                                                <option value="{{ $brand->id }}" {{ old('brand_id', $product->brand_id) == $brand->id ? 'selected' : '' }}>{{ $brand->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('brand_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="input-label" for="status">Status <span class="text-danger">*</span></label>
                                        <select name="status" id="status" class="form-control" required>
                                            <option value="active" {{ old('status', $product->status) == 'active' ? 'selected' : '' }}>Active</option>
                                            <option value="inactive" {{ old('status', $product->status) == 'inactive' ? 'selected' : '' }}>Inactive</option>
                                        </select>
                                        @error('status')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="short_description">Short Description</label>
                                        <textarea name="short_description" id="short_description" class="form-control" rows="2" placeholder="Enter short description (max 500 characters)" maxlength="500">{{ old('short_description', $product->short_description) }}</textarea>
                                        @error('short_description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="description">Description</label>
                                        <textarea name="description" id="description" class="form-control" rows="4" placeholder="Enter product description">{{ old('description', $product->description) }}</textarea>
                                        @error('description')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Location & Fulfillment Center -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Location & Fulfillment Center</h5>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="state_id">State <span class="text-danger">*</span></label>
                                        <select name="state_id" id="state_id" class="form-control" required>
                                            <option value="">{{ translate('messages.select_state') }}</option>
                                            @foreach($states as $state)
                                                <option value="{{ $state->id }}" {{ old('state_id', $selectedStateId) == $state->id ? 'selected' : '' }}>{{ $state->name }}</option>
                                            @endforeach
                                        </select>
                                        @error('state_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="city_id">City <span class="text-danger">*</span></label>
                                        <select name="city_id" id="city_id" class="form-control" required {{ $selectedCityId ? '' : 'disabled' }}>
                                            <option value="">{{ translate('messages.select_city') }}</option>
                                            @if($selectedCityId)
                                                @php
                                                    $cities = \App\Models\City::where('state_id', $selectedStateId)->orderBy('name', 'asc')->get();
                                                @endphp
                                                @foreach($cities as $city)
                                                    <option value="{{ $city->id }}" {{ old('city_id', $selectedCityId) == $city->id ? 'selected' : '' }}>{{ $city->name }}</option>
                                                @endforeach
                                            @endif
                                        </select>
                                        @error('city_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="fulfillment_center_id">Fulfillment Center <span class="text-danger">*</span></label>
                                        <select name="fulfillment_center_id" id="fulfillment_center_id" class="form-control" required {{ $selectedFulfillmentCenterId ? '' : 'disabled' }}>
                                            <option value="">{{ translate('messages.select_fulfillment_center') }}</option>
                                            @if($selectedFulfillmentCenterId)
                                                @php
                                                    $fulfillmentCenters = \App\Models\FulfillmentCenter::where('city_id', $selectedCityId)->where('status', 'active')->orderBy('name', 'asc')->get();
                                                @endphp
                                                @foreach($fulfillmentCenters as $fc)
                                                    <option value="{{ $fc->id }}" {{ old('fulfillment_center_id', $selectedFulfillmentCenterId) == $fc->id ? 'selected' : '' }}>{{ $fc->name }}</option>
                                                @endforeach
                                            @endif
                                        </select>
                                        @error('fulfillment_center_id')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label class="input-label" for="stock_qty">{{ translate('messages.stock_quantity') }} <span class="text-danger">*</span></label>
                                        <input type="number" name="stock_qty" id="stock_qty" class="form-control" placeholder="0" value="{{ old('stock_qty', $stockQty) }}" min="0" required>
                                        @error('stock_qty')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>

                                <!-- Images -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Images</h5>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label" for="images">Add New Images</label>
                                        <input type="file" name="images[]" id="images" class="form-control" accept="image/*" multiple onchange="previewImages(this)">
                                        <small class="text-muted">Accepted formats: JPG, PNG, GIF, WEBP (Max: 15MB each). You can select multiple images.</small>
                                        <div class="image-preview-container" id="image-preview-container"></div>
                                        @error('images.*')
                                            <div class="text-danger">{{ $message }}</div>
                                        @enderror
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="input-label">Existing Images</label>
                                        <div class="image-preview-container">
                                            @foreach($product->images as $image)
                                                <div class="image-preview-item">
                                                    <img src="{{ \App\CentralLogics\Helpers::get_full_url('product', $image->image_url, \App\CentralLogics\Helpers::getDisk()) }}" alt="Product Image">
                                                    <a href="{{ route('admin.products.delete-image', $image->id) }}" 
                                                       class="remove-image" 
                                                       onclick="return confirm('Are you sure you want to delete this image?')"
                                                       title="Delete Image">
                                                        <i class="tio-delete-outlined"></i>
                                                    </a>
                                                </div>
                                            @endforeach
                                        </div>
                                    </div>
                                </div>

                                <!-- Flags -->
                                <div class="col-md-12 mt-3">
                                    <h5 class="mb-3">Product Flags</h5>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Trending</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_trending" id="is_trending" value="1" {{ old('is_trending', $product->is_trending) ? 'checked' : '' }} switch="bool">
                                            <label for="is_trending" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls trending_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Latest</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_latest" id="is_latest" value="1" {{ old('is_latest', $product->is_latest) ? 'checked' : '' }} switch="bool">
                                            <label for="is_latest" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls latest_products in dashboard API</small>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="input-label">Express-30</label>
                                        <div class="custom--switch">
                                            <input type="checkbox" name="is_express_30" id="is_express_30" value="1" {{ old('is_express_30', $product->is_express_30) ? 'checked' : '' }} switch="bool">
                                            <label for="is_express_30" data-on-label="On" data-off-label="Off"></label>
                                        </div>
                                        <small class="text-muted">Controls /api/express-30/products</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <div class="btn--container justify-content-end">
                                <a href="{{ route('admin.products.index') }}" class="btn btn--reset">{{ translate('messages.cancel') }}</a>
                                <button type="submit" class="btn btn--primary">{{ translate('messages.submit') }}</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
@endsection

@push('script_2')
<script>
    var maxFileSize = 15 * 1024 * 1024; // 15MB in bytes
    
    // Dependent dropdowns for State, City, Fulfillment Center
    $(document).ready(function() {
        // State change - load cities
        $('#state_id').on('change', function() {
            var stateId = $(this).val();
            var citySelect = $('#city_id');
            var fulfillmentCenterSelect = $('#fulfillment_center_id');
            
            // Reset dependent dropdowns
            citySelect.html('<option value="">{{ translate('messages.select_city') }}</option>').prop('disabled', true);
            fulfillmentCenterSelect.html('<option value="">{{ translate('messages.select_fulfillment_center') }}</option>').prop('disabled', true);
            
            if (stateId) {
                $.ajax({
                    url: '{{ route('admin.get-cities') }}',
                    type: 'GET',
                    data: { state_id: stateId },
                    success: function(response) {
                        if (response.cities && response.cities.length > 0) {
                            citySelect.prop('disabled', false);
                            response.cities.forEach(function(city) {
                                citySelect.append('<option value="' + city.id + '">' + city.name + '</option>');
                            });
                            
                            // Restore old city value if exists
                            var oldCityId = '{{ old('city_id', $selectedCityId) }}';
                            if (oldCityId) {
                                citySelect.val(oldCityId).trigger('change');
                            }
                        } else {
                            citySelect.append('<option value="">{{ translate('messages.no_cities_found') }}</option>');
                        }
                    },
                    error: function() {
                        alert('{{ translate('messages.failed_to_load_cities') }}');
                    }
                });
            }
        });
        
        // City change - load fulfillment centers
        $('#city_id').on('change', function() {
            var cityId = $(this).val();
            var fulfillmentCenterSelect = $('#fulfillment_center_id');
            
            // Reset fulfillment center dropdown
            fulfillmentCenterSelect.html('<option value="">{{ translate('messages.select_fulfillment_center') }}</option>').prop('disabled', true);
            
            if (cityId) {
                $.ajax({
                    url: '{{ route('admin.get-fulfillment-centers') }}',
                    type: 'GET',
                    data: { city_id: cityId },
                    success: function(response) {
                        if (response.fulfillment_centers && response.fulfillment_centers.length > 0) {
                            fulfillmentCenterSelect.prop('disabled', false);
                            response.fulfillment_centers.forEach(function(fc) {
                                fulfillmentCenterSelect.append('<option value="' + fc.id + '">' + fc.name + '</option>');
                            });
                            
                            // Restore old fulfillment center value if exists
                            var oldFulfillmentCenterId = '{{ old('fulfillment_center_id', $selectedFulfillmentCenterId) }}';
                            if (oldFulfillmentCenterId) {
                                fulfillmentCenterSelect.val(oldFulfillmentCenterId);
                            }
                        } else {
                            fulfillmentCenterSelect.append('<option value="">{{ translate('messages.no_fulfillment_centers_found') }}</option>');
                        }
                    },
                    error: function() {
                        alert('{{ translate('messages.failed_to_load_fulfillment_centers') }}');
                    }
                });
            }
        });
        
        // Initialize dropdowns if state is already selected
        @if($selectedStateId)
            $('#state_id').trigger('change');
        @elseif(old('state_id'))
            var oldStateId = '{{ old('state_id') }}';
            var oldCityId = '{{ old('city_id') }}';
            var oldFulfillmentCenterId = '{{ old('fulfillment_center_id') }}';
            
            $('#state_id').val(oldStateId).trigger('change');
            setTimeout(function() {
                if (oldCityId) {
                    $('#city_id').val(oldCityId).trigger('change');
                    setTimeout(function() {
                        if (oldFulfillmentCenterId) {
                            $('#fulfillment_center_id').val(oldFulfillmentCenterId);
                        }
                    }, 500);
                }
            }, 500);
        @endif
    });
    
    function previewImages(input) {
        var container = document.getElementById('image-preview-container');
        
        if (input.files && input.files.length > 0) {
            var validFiles = [];
            var hasError = false;
            
            for (var i = 0; i < input.files.length; i++) {
                var file = input.files[i];
                
                // Check file size
                if (file.size > maxFileSize) {
                    alert('File "' + file.name + '" exceeds the maximum file size of 15MB. Please choose a smaller file.');
                    hasError = true;
                    continue;
                }
                
                validFiles.push(file);
                
                var reader = new FileReader();
                reader.onload = function(e) {
                    var div = document.createElement('div');
                    div.className = 'image-preview-item';
                    div.innerHTML = '<img src="' + e.target.result + '" alt="Preview">';
                    container.appendChild(div);
                };
                reader.readAsDataURL(file);
            }
            
            // Reset input if there were invalid files
            if (hasError) {
                var dataTransfer = new DataTransfer();
                validFiles.forEach(function(file) {
                    dataTransfer.items.add(file);
                });
                input.files = dataTransfer.files;
            }
        }
    }
</script>
@endpush


```


Verifying the update method handles the transaction correctly:



Verifying the update method is complete:



Fixing the update method to include DB::commit() and DB::rollBack():


```php
<?php

namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\Product;
use App\Models\Category;
use App\Models\Brand;
use App\Models\ProductVariant;
use App\Models\ProductImage;
use App\Models\State;
use App\Models\City;
use App\Models\FulfillmentCenter;
use App\Models\WarehouseProduct;
use Illuminate\Http\Request;
use App\CentralLogics\ToastrWrapper as Toastr;
use App\CentralLogics\Helpers;
use Illuminate\Support\Str;
use Illuminate\Support\Facades\DB;

class ProductController extends Controller
{
    /**
     * Display a listing of the resource.
     */
    public function index(Request $request)
    {
        $query = Product::with(['category', 'brand', 'variants', 'images']);
        
        // Search
        $search = trim($request->input('search', ''));
        if ($search !== '') {
            $query->where(function ($q) use ($search) {
                $q->where('name', 'like', "%{$search}%")
                    ->orWhere('description', 'like', "%{$search}%");
            });
        }
        
        // Filter by status
        $status = $request->input('status');
        if ($status !== null && $status !== '') {
            $query->where('status', $status);
        }
        
        // Filter by category
        $categoryId = $request->input('category_id');
        if (!empty($categoryId) && is_numeric($categoryId) && (int)$categoryId > 0) {
            $query->where('category_id', (int)$categoryId);
        }
        
        // Filter by trending
        $isTrending = $request->input('is_trending');
        if ($isTrending !== null && $isTrending !== '') {
            $query->where('is_trending', (bool)$isTrending);
        }
        
        // Filter by latest
        $isLatest = $request->input('is_latest');
        if ($isLatest !== null && $isLatest !== '') {
            $query->where('is_latest', (bool)$isLatest);
        }
        
        // Filter by express_30
        $isExpress30 = $request->input('is_express_30');
        if ($isExpress30 !== null && $isExpress30 !== '') {
            $query->where('is_express_30', (bool)$isExpress30);
        }
        
        $products = $query->orderBy('created_at', 'desc')->paginate(25);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        
        return view('admin-views.products.index', compact('products', 'categories'));
    }

    /**
     * Show the form for creating a new resource.
     */
    public function create()
    {
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        $states = State::orderBy('name', 'asc')->get();
        return view('admin-views.products.create', compact('categories', 'brands', 'states'));
    }

    /**
     * Store a newly created resource in storage.
     */
    public function store(Request $request)
    {
        DB::beginTransaction();
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Variant fields
                'variant_sku' => 'required|string|max:255',
                'variant_price' => 'required|numeric|min:0',
                'variant_sale_price' => 'nullable|numeric|min:0',
                'variant_status' => 'required|in:active,inactive',
                // Location & Fulfillment Center
                'state_id' => 'required|exists:states,id',
                'city_id' => 'required|exists:cities,id',
                'fulfillment_center_id' => 'required|exists:fulfillment_centers,id',
                'stock_qty' => 'required|integer|min:0',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:15360',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'variant_sku.required' => translate('messages.SKU is required!'),
                'variant_price.required' => translate('messages.Price is required!'),
                'variant_price.numeric' => translate('messages.Price must be a number!'),
                'variant_price.min' => translate('messages.Price must be greater than or equal to 0!'),
                'variant_sale_price.numeric' => translate('messages.Sale price must be a number!'),
                'variant_sale_price.min' => translate('messages.Sale price must be greater than or equal to 0!'),
                'state_id.required' => translate('messages.State is required!'),
                'state_id.exists' => translate('messages.State not found!'),
                'city_id.required' => translate('messages.City is required!'),
                'city_id.exists' => translate('messages.City not found!'),
                'fulfillment_center_id.required' => translate('messages.Fulfillment center is required!'),
                'fulfillment_center_id.exists' => translate('messages.Fulfillment center not found!'),
                'stock_qty.required' => translate('messages.Stock quantity is required!'),
                'stock_qty.integer' => translate('messages.Stock quantity must be a number!'),
                'stock_qty.min' => translate('messages.Stock quantity must be greater than or equal to 0!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 15MB!'),
            ]);

            // Check if SKU already exists
            if (ProductVariant::where('sku', $request->variant_sku)->exists()) {
                DB::rollBack();
                Toastr::error(translate('messages.SKU already exists!'));
                return back()->withInput();
            }

            // Generate unique slug
            $baseSlug = Str::slug($request->name);
            $slug = $baseSlug;
            $counter = 1;
            while (Product::where('slug', $slug)->exists()) {
                $slug = $baseSlug . '-' . uniqid() . '-' . $counter;
                $counter++;
            }

            // Create product
            $product = new Product();
            $product->name = $request->name;
            $product->slug = $slug;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            
            if (!$product->save()) {
                throw new \Exception('Failed to save product');
            }

            // Create default variant
            $variant = new ProductVariant();
            $variant->product_id = $product->id;
            $variant->sku = $request->variant_sku;
            $variant->price = $request->variant_price;
            $variant->sale_price = $request->variant_sale_price ?? null;
            $variant->status = $request->variant_status;
            
            if (!$variant->save()) {
                throw new \Exception('Failed to save product variant');
            }

            // Create warehouse product mapping
            if ($request->fulfillment_center_id && $request->stock_qty !== null) {
                $warehouseProduct = new WarehouseProduct();
                $warehouseProduct->warehouse_id = $request->fulfillment_center_id;
                $warehouseProduct->product_variant_id = $variant->id;
                $warehouseProduct->stock_qty = $request->stock_qty ?? 0;
                $warehouseProduct->reserved_qty = 0;
                
                if (!$warehouseProduct->save()) {
                    throw new \Exception('Failed to save warehouse product mapping');
                }
            }

            // Handle images
            if ($request->hasFile('images')) {
                $sortOrder = 0;
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant->id;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = ($sortOrder === 0) ? true : false;
                                $productImage->sort_order = $sortOrder;
                                
                                if (!$productImage->save()) {
                                    \Log::warning('Failed to save product image: ' . $imageName);
                                } else {
                                    $sortOrder++;
                                }
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                            // Continue with other images even if one fails
                        }
                    }
                }
            }

            DB::commit();
            
            Toastr::success(translate('messages.product_added'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            DB::rollBack();
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            DB::rollBack();
            Toastr::error(translate('messages.failed_to_add_product') . ': ' . $e->getMessage());
            \Log::error('Product creation error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->except(['images'])
            ]);
            return back()->withInput();
        }
    }

    /**
     * Show the form for editing the specified resource.
     */
    public function edit($id)
    {
        $product = Product::with(['category', 'brand', 'variants.warehouseProducts.warehouse', 'images'])->findOrFail($id);
        $categories = Category::where('status', 'active')->orderBy('name', 'asc')->get();
        $brands = Brand::where('status', 'active')->orderBy('name', 'asc')->get();
        $states = State::orderBy('name', 'asc')->get();
        
        // Get warehouse product mapping for the first variant (default variant)
        $warehouseProduct = null;
        $selectedStateId = null;
        $selectedCityId = null;
        $selectedFulfillmentCenterId = null;
        $stockQty = 0;
        
        if ($product->variants->isNotEmpty()) {
            $firstVariant = $product->variants->first();
            $warehouseProduct = WarehouseProduct::where('product_variant_id', $firstVariant->id)
                ->with('warehouse')
                ->first();
            
            if ($warehouseProduct && $warehouseProduct->warehouse) {
                $selectedFulfillmentCenterId = $warehouseProduct->warehouse_id;
                $selectedCityId = $warehouseProduct->warehouse->city_id;
                $selectedStateId = $warehouseProduct->warehouse->state_id;
                $stockQty = $warehouseProduct->stock_qty;
            }
        }
        
        return view('admin-views.products.edit', compact('product', 'categories', 'brands', 'states', 'warehouseProduct', 'selectedStateId', 'selectedCityId', 'selectedFulfillmentCenterId', 'stockQty'));
    }

    /**
     * Update the specified resource in storage.
     */
    public function update(Request $request, $id)
    {
        DB::beginTransaction();
        try {
            $request->validate([
                'name' => 'required|string|max:255',
                'category_id' => 'required|exists:categories,id',
                'brand_id' => 'nullable|exists:brands,id',
                'description' => 'nullable|string',
                'short_description' => 'nullable|string|max:500',
                'status' => 'required|in:active,inactive',
                'is_trending' => 'nullable|boolean',
                'is_latest' => 'nullable|boolean',
                'is_express_30' => 'nullable|boolean',
                // Location & Fulfillment Center
                'state_id' => 'required|exists:states,id',
                'city_id' => 'required|exists:cities,id',
                'fulfillment_center_id' => 'required|exists:fulfillment_centers,id',
                'stock_qty' => 'required|integer|min:0',
                // Images
                'images' => 'nullable|array',
                'images.*' => 'image|mimes:jpeg,jpg,png,gif,webp|max:15360',
            ], [
                'name.required' => translate('messages.Product name is required!'),
                'category_id.required' => translate('messages.Category is required!'),
                'category_id.exists' => translate('messages.Category not found!'),
                'brand_id.exists' => translate('messages.Brand not found!'),
                'state_id.required' => translate('messages.State is required!'),
                'state_id.exists' => translate('messages.State not found!'),
                'city_id.required' => translate('messages.City is required!'),
                'city_id.exists' => translate('messages.City not found!'),
                'fulfillment_center_id.required' => translate('messages.Fulfillment center is required!'),
                'fulfillment_center_id.exists' => translate('messages.Fulfillment center not found!'),
                'stock_qty.required' => translate('messages.Stock quantity is required!'),
                'stock_qty.integer' => translate('messages.Stock quantity must be a number!'),
                'stock_qty.min' => translate('messages.Stock quantity must be greater than or equal to 0!'),
                'images.*.image' => translate('messages.Please upload image files only!'),
                'images.*.mimes' => translate('messages.Image must be jpeg, jpg, png, gif, or webp!'),
                'images.*.max' => translate('messages.Image size should be less than 15MB!'),
            ]);

            $product = Product::findOrFail($id);
            $product->name = $request->name;
            $product->category_id = $request->category_id;
            $product->brand_id = $request->brand_id ?? null;
            $product->description = $request->description ?? null;
            $product->short_description = $request->short_description ?? null;
            $product->status = $request->status;
            $product->is_trending = $request->has('is_trending') ? 1 : 0;
            $product->is_latest = $request->has('is_latest') ? 1 : 0;
            $product->is_express_30 = $request->has('is_express_30') ? 1 : 0;
            
            if (!$product->save()) {
                throw new \Exception('Failed to update product');
            }

            // Update or create warehouse product mapping for the first variant
            $firstVariant = $product->variants->first();
            if ($firstVariant && $request->fulfillment_center_id && $request->stock_qty !== null) {
                $warehouseProduct = WarehouseProduct::where('product_variant_id', $firstVariant->id)->first();
                
                if ($warehouseProduct) {
                    // Update existing mapping
                    $warehouseProduct->warehouse_id = $request->fulfillment_center_id;
                    $warehouseProduct->stock_qty = $request->stock_qty ?? 0;
                    // Keep reserved_qty as is
                    if (!$warehouseProduct->save()) {
                        throw new \Exception('Failed to update warehouse product mapping');
                    }
                } else {
                    // Create new mapping
                    $warehouseProduct = new WarehouseProduct();
                    $warehouseProduct->warehouse_id = $request->fulfillment_center_id;
                    $warehouseProduct->product_variant_id = $firstVariant->id;
                    $warehouseProduct->stock_qty = $request->stock_qty ?? 0;
                    $warehouseProduct->reserved_qty = 0;
                    
                    if (!$warehouseProduct->save()) {
                        throw new \Exception('Failed to create warehouse product mapping');
                    }
                }
            }

            // Handle new images
            if ($request->hasFile('images')) {
                $existingImages = ProductImage::where('product_id', $product->id)->count();
                $sortOrder = $existingImages;
                
                foreach ($request->file('images') as $image) {
                    if ($image && $image->isValid()) {
                        try {
                            $extension = $image->getClientOriginalExtension();
                            $allowedExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                            $format = in_array(strtolower($extension), $allowedExtensions) ? strtolower($extension) : 'png';
                            
                            $imageName = Helpers::upload('product/', $format, $image);
                            
                            if ($imageName && $imageName !== 'def.png') {
                                $variant = $product->variants->first();
                                $productImage = new ProductImage();
                                $productImage->product_id = $product->id;
                                $productImage->product_variant_id = $variant ? $variant->id : null;
                                $productImage->image_url = $imageName;
                                $productImage->is_primary = false;
                                $productImage->sort_order = $sortOrder;
                                $productImage->save();
                                $sortOrder++;
                            }
                        } catch (\Exception $e) {
                            \Log::error('Product image upload error: ' . $e->getMessage());
                        }
                    }
                }
            }

            DB::commit();
            
            Toastr::success(translate('messages.product_updated'));
            return redirect()->route('admin.products.index');
        } catch (\Illuminate\Validation\ValidationException $e) {
            DB::rollBack();
            return back()->withErrors($e->errors())->withInput();
        } catch (\Exception $e) {
            DB::rollBack();
            Toastr::error(translate('messages.failed_to_update_product') . ': ' . $e->getMessage());
            \Log::error('Product update error: ' . $e->getMessage(), [
                'trace' => $e->getTraceAsString(),
                'request' => $request->except(['images'])
            ]);
            return back()->withInput();
        }
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy($id)
    {
        try {
            $product = Product::findOrFail($id);
            
            // Delete product images
            foreach ($product->images as $image) {
                if ($image->image_url) {
                    try {
                        $storageType = Helpers::getDisk();
                        if ($storageType === 's3') {
                            \Storage::disk('s3')->delete('product/' . $image->image_url);
                        } else {
                            \Storage::disk('public')->delete('product/' . $image->image_url);
                        }
                    } catch (\Exception $e) {
                        \Log::warning('Failed to delete product image: ' . $e->getMessage());
                    }
                }
                $image->delete();
            }
            
            // Delete variants (this will cascade delete related data)
            $product->variants()->delete();
            
            $product->delete();
            
            Toastr::success(translate('messages.product_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_product') . ': ' . $e->getMessage());
            \Log::error('Product deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product status
     */
    public function statusToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $product->status = $request->status;
            $product->save();
            Toastr::success(translate('messages.product_status_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_status') . ': ' . $e->getMessage());
            \Log::error('Product status update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Toggle product flag (trending, latest, express_30)
     */
    public function flagToggle(Request $request)
    {
        try {
            $product = Product::findOrFail($request->id);
            $flag = $request->flag; // is_trending, is_latest, is_express_30
            
            if (!in_array($flag, ['is_trending', 'is_latest', 'is_express_30'])) {
                Toastr::error(translate('messages.Invalid flag!'));
                return back();
            }
            
            $product->$flag = $request->value;
            $product->save();
            
            Toastr::success(translate('messages.product_flag_updated'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_update_flag') . ': ' . $e->getMessage());
            \Log::error('Product flag update error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Delete product image
     */
    public function deleteImage($id)
    {
        try {
            $image = ProductImage::findOrFail($id);
            
            // Delete file
            if ($image->image_url) {
                try {
                    $storageType = Helpers::getDisk();
                    if ($storageType === 's3') {
                        \Storage::disk('s3')->delete('product/' . $image->image_url);
                    } else {
                        \Storage::disk('public')->delete('product/' . $image->image_url);
                    }
                } catch (\Exception $e) {
                    \Log::warning('Failed to delete product image file: ' . $e->getMessage());
                }
            }
            
            $image->delete();
            
            Toastr::success(translate('messages.image_deleted'));
            return back();
        } catch (\Exception $e) {
            Toastr::error(translate('messages.failed_to_delete_image') . ': ' . $e->getMessage());
            \Log::error('Image deletion error: ' . $e->getMessage());
            return back();
        }
    }

    /**
     * Get cities by state (AJAX)
     */
    public function getCities(Request $request)
    {
        $stateId = $request->input('state_id');
        
        if (!$stateId) {
            return response()->json(['cities' => []]);
        }

        $cities = City::where('state_id', $stateId)
            ->orderBy('name', 'asc')
            ->get(['id', 'name']);

        return response()->json(['cities' => $cities]);
    }

    /**
     * Get fulfillment centers by city (AJAX)
     */
    public function getFulfillmentCenters(Request $request)
    {
        $cityId = $request->input('city_id');
        
        if (!$cityId) {
            return response()->json(['fulfillment_centers' => []]);
        }

        $fulfillmentCenters = FulfillmentCenter::where('city_id', $cityId)
            ->where('status', 'active')
            ->orderBy('name', 'asc')
            ->get(['id', 'name']);

        return response()->json(['fulfillment_centers' => $fulfillmentCenters]);
    }
}


```


## Edit Product functionality updates

### 1. Controller changes (`ProductController@edit`)
- Loads states for the dropdown
- Retrieves existing warehouse product mapping for the first variant
- Extracts selected state, city, fulfillment center, and stock quantity
- Passes data to the view

### 2. Controller changes (`ProductController@update`)
- Added validation for state_id, city_id, fulfillment_center_id, stock_qty
- Wrapped in a database transaction
- Updates or creates warehouse product mapping:
  - Updates if mapping exists
  - Creates if mapping doesn't exist
- Preserves `reserved_qty` when updating
- Proper rollback on errors

### 3. UI changes (`edit.blade.php`)
- Added State dropdown (pre-filled with current value)
- Added City dropdown (dependent, pre-filled)
- Added Fulfillment Center dropdown (dependent, pre-filled)
- Added Stock Quantity input (pre-filled with current value)
- All fields required and validated

### 4. JavaScript functionality
- Dependent dropdowns with AJAX
- Auto-loads cities when state changes
- Auto-loads fulfillment centers when city changes
- Pre-fills values from existing warehouse product mapping
- Restores old values on validation errors
- Initializes dropdowns if state is already selected

### 5. Validation
- Backend: same validation rules as create form
- Frontend: validation styles added (same as create form)
- Real-time error feedback

## Features
- Pre-filled values: existing warehouse product data is loaded
- Update or create: handles products with or without existing mapping
- Preserves reserved quantity: only updates stock_qty, keeps reserved_qty
- Transaction safety: all changes wrapped in database transaction
- User-friendly: dependent dropdowns work seamlessly
- Error handling: proper rollback and error messages

The Edit Product form now matches the Add Product functionality, allowing admins to view and update product location and fulfillment center assignments with stock quantities.

